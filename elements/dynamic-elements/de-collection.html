<!-- element --><dom-module id="de-collection">
  <template>
    <!-- style -->
    <style is="custom-style" include="common-style">
    :host {
      width: 50%;
    }
    
    @media screen and (max-width: 740px) {
      :host {
        width: 100%;
      }
    }
    
    :host.opened {
      width: 100%;
    }
    
    .collection-container {
      margin: 2px;
    }
    
    .collection-container .title {
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 10px;
      padding-bottom: 10px;
      background: #607D8B;
      color: white;
    }
    
    .collection-container.hasData .title {
      background: #455A64;
    }
    
    .collection-container .content {
      background: #CFD8DC;
    }
    
    paper-tabs.group-tabs {
      --paper-tabs-selection-bar-color: white;
      --paper-tabs: {
        background: #607D8B;
        color: white;
      }
    }

    .dismiss-defaults {
      background: white;
      margin-top: 4px;
    }
    </style>
    <!-- local DOM - start -->
    <template is="dom-if" if="[[$both(def,data)]]">
      <div class$="collection-container vertical layout [[$getDataClass(hasData)]]">
        <!-- collection-container - start -->
        <div class="title horizontal layout center">
          <paper-icon-button icon="class"></paper-icon-button>
          <div>[[def.label]]</div>
          <div class="flex"></div>
          <template is="dom-if" if="[[!hasData]]">
            <paper-icon-button on-tap="collectionCreatePressed" icon="add"></paper-icon-button>
          </template>
          <template is="dom-if" if="[[hasData]]">
            <template is="dom-if" if="[[!isOpened]]">
              <paper-icon-button on-tap="collectionExpandPressed" icon="expand-more"></paper-icon-button>
            </template>
            <template is="dom-if" if="[[isOpened]]">
              <paper-icon-button on-tap="collectionErasePressed" icon="clear"></paper-icon-button>
              <paper-icon-button on-tap="collectionCollapsePressed" icon="expand-less"></paper-icon-button>
            </template>
          </template>
        </div>
        <template is="dom-if" if="[[isOpened]]">
          <div class="content">

            <template is="dom-if" if="[[$hasActiveDefaultGroup(def, data.isDefaultGroupDismissed)]]">
              <div class="horizontal layout">
                <div class="flex"></div>
                <paper-button class="dismiss-defaults" raised="" on-tap="dismissDefaultsPressed">DISSMISS DEFAULTS</paper-button>
              </div>
            </template>

            <template is="dom-if" if="[[!$hasActiveDefaultGroup(def, data.isDefaultGroupDismissed)]]">
              <paper-tabs class="group-tabs" selected="{{groupTabSelectedIndex}}" scrollable="" on-iron-select="groupTabSelected">
                <template is="dom-repeat" items="[[def.childList]]" as="group">
                  <paper-tab>[[group.label]]</paper-tab>
                </template>
              </paper-tabs>
            </template>

            <template is="dom-if" if="[[currentGroup]]">
              <div class="group-container">
                <de-array data="[[currentGroupData]]" def="[[currentGroup]]"></de-array>
              </div>
            </template>
          </div>
        </template>
        <!-- collection-container - end -->
      </div>
    </template>
    <!-- local DOM - end -->
  </template>
  <script>(function(){Polymer({is:"de-collection",properties:{data:{type:Object,value:null},def:{type:Object,value:null},hasData:{type:Boolean,value:!1},isOpened:{type:Boolean,value:!1},groupTabSelectedIndex:{type:Number,notify:!0,value:null},currentGroup:{type:Object,value:null},currentGroupData:{type:Object,value:null}},$both:function(e,t){return e&&t},$getDataClass:function(e){return e?"hasData":"doesNotHaveData"},observers:["systemChanged(def, data)","isOpenedChanged(isOpened)"],systemChanged:function(e,t){if(e&&t)return"isDefaultGroupDismissed"in t||this.set("data.isDefaultGroupDismissed",!1),0===Object.keys(t.childMap).length?(this.hasData=!1,this.isOpened=!1):this.hasData=!0,this.groupTabSelectedIndex=null,this.groupTabSelectedIndex=0},isOpenedChanged:function(e){var t;return t=this.getAttribute("class"),e?(t+=" opened",Polymer.dom(this).setAttribute("class",t)):t.indexOf(" opened")!==-1?(t=t.replace(" opened",""),Polymer.dom(this).setAttribute("class",t)):void 0},collectionCreatePressed:function(e){if(this.hasData=!0,this.isOpened=!0,this.groupTabSelectedIndex=null,this.groupTabSelectedIndex=0,"defaultGroup"in this.def&&!this.data.isDefaultGroupDismissed)return this.groupTabSelected()},collectionErasePressed:function(e){return this.domHost.domHost.domHost.domHost.showModalPrompt("Are you sure you want to delete this entire collection?",function(e){return function(t){if(t)return e.isOpened=!1,e.hasData=!1,e.domHost.domHost.domHost.domHost.addActivityLog(e.data.forKey,"removed",{patientSerial:window.bdemrElement.patient.serial}),e.data.childMap={},e.currentGroup=null,e.currentGroupData=null,e.groupTabSelectedIndex=null}}(this))},collectionCollapsePressed:function(e){return this.isOpened=!1},collectionExpandPressed:function(e){if(this.isOpened=!0,"defaultGroup"in this.def&&!this.data.isDefaultGroupDismissed)return this.groupTabSelected()},$hasActiveDefaultGroup:function(e,t){return"defaultGroup"in e&&!t},dismissDefaultsPressed:function(e){return this.set("data.isDefaultGroupDismissed",!0)},groupTabSelected:function(e){var t,s;if(null!==this.groupTabSelectedIndex)return t=0===this.groupTabSelectedIndex&&"defaultGroup"in this.def&&!this.data.isDefaultGroupDismissed?this.def.defaultGroup:this.def.childList[this.groupTabSelectedIndex],t.key in this.data.childMap||(this.data.childMap[t.key]={forType:"group",forKey:t.key,childMap:{}}),s=this.data.childMap[t.key],this.set("currentGroupData",s),this.set("currentGroup",t)},propagateDynamicDataAlterationSignal:function(e,t){return t.unshift(this.currentGroup.key),t.unshift(this.def.key),this.domHost.propagateDynamicDataAlterationSignal(e,t)}})}).call(this);
//# sourceMappingURL=de-collection.coffee-compiled.js.map</script>
</dom-module>
