<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><dom-module id="page-attachement-preview">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
      }

      .image {width: 100%;}
      
    </style>

    <!-- local DOM -->

    <div class="master-container">

      <div class="limiting-container document">

        <template is="dom-if" if="{{!isTestResultsValid}}">
          TestResults Invalid
        </template>
     

        <!-- editing visit - start -->
        <template is="dom-if" if="{{isTestResultsValid}}">

          <!-- Attachement Preview - start -->
         
          <paper-card class="m-top-16" heading="Test Results Attachement">
            <template is="dom-if" if="[[attachmentList]]">
              <div class="attachment-card-list horizontal layout wrap">
                
                <template is="dom-repeat" items="[[attachmentList]]" as="attachment" index-as="attachmentIndex">
                  <paper-material elevation="1">
                    <div class="attachment-card vertical layout">
                      <img class="image" src$="[[$getImageSrc(attachment)]]" hidden$="[[!attachment.isImage]]">
                      <div class="footer">
                        <div class="title horizontal layout center">
                          <div class="flex m-left-8">[[attachment.title]]</div>
                          <paper-icon-button on-tap="downloadPressed" icon="file-download"></paper-icon-button>
                        </div>
                      </div>
                    </div>
                  </paper-material>
                </template>

              </div>
            </template>
          </paper-card>
     
          <!-- Attachement Preview - end -->


        </template>
        <!-- editing visit - end -->

      </div>

    </div>




    

  </template>
  <script>(function(){var t;t=function(t){var e,i,a,n,r,s;for(a=atob(t.split(",")[1]),s=t.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(a.length),r=new Uint8Array(e),n=0;n<a.length;)r[n]=a.charCodeAt(n),n++;return i=new Blob([e],{type:s})},Polymer({is:"page-attachement-preview",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.pageLike,app.behaviors.translating,app.behaviors.apiCalling],properties:{isVisitValid:{type:Boolean,notify:!1,value:!1},isPrescriptionValid:{type:Boolean,notify:!1,value:!1},isNoteValid:{type:Boolean,notify:!1,value:!1},isNextVisitValid:{type:Boolean,notify:!1,value:!1},isTestResultsValid:{type:Boolean,notify:!0,value:!1},isPatientValid:{type:Boolean,notify:!1,value:!1},user:{type:Object,notify:!0,value:null},patient:{type:Object,notify:!0,value:null},visit:{type:Object,notify:!0,value:null},prescription:{type:Object,notify:!0,value:null},doctorNote:{type:Object,notify:!0,value:null},nextVisit:{type:Object,notify:!0,value:null},testAdvised:{type:Object,notify:!0,value:null},matchingPrescribedMedicineList:{type:Array,notify:!0,value:[]},doctorInstitutionList:{type:Array,notify:!0,value:[]},doctorSpecialityList:{type:Array,notify:!0,value:[]},doctorInstitutionSelectedIndex:{type:Number,notify:!0,value:0},doctorSpecialitySelectedIndex:{type:Number,notify:!0,value:0},settings:{type:Object,notify:!0},testResultsAttachmentSerialList:{type:Array,notify:!0,value:[]},attachmentList:{type:Array,notify:!1,value:function(){return[]}},newAttachment:{type:Object,notify:!1,value:null},localDataUriDb:{type:Object,value:null},maximumImageSizeAllowedInBytes:{type:Number,value:1e7},maximumLocalDataUriDbSizeInChars:{type:Number,value:2e6},localDataUsedPercentage:{type:Number,value:0},currentDateFilterStartDate:{type:Number},currentDateFilterEndDate:{type:Number}},_makeSettings:function(){var t;return t={serial:"only",isSyncEnabled:!1,printDecoration:{leftSideLine1:"My Institution",leftSideLine2:"My Institution Address",leftSideLine3:"My Institution Contact",rightSideLine1:"My Name",rightSideLine2:"My Degrees",rightSideLine3:"My Contact",footerLine:"A simple message on the bottom",logoDataUri:null},billingTargetEmailAddress:"",nsqipTargetEmailAddress:"",monetaryUnit:"BDT"}},_getSettings:function(){var t,e;return t=app.db.find("settings"),e=0===t.length?this._makeSettings():t[0]},_loadUser:function(){var t,e,i,a,n,r,s,o,l,u;if(u=app.db.find("user"),1===u.length){for(this.user=u[0],r=u[0].employmentDetailsList,e=0,a=r.length;e<a;e++)t=r[e],this.push("doctorInstitutionList",t.institutionName);for(s=u[0].specializationList,o=[],i=0,n=s.length;i<n;i++)l=s[i],o.push(this.push("doctorSpecialityList",l.specializationTitle));return o}},_loadPatient:function(t){var e;return e=app.db.find("patient-list",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isPatientValid=!0,this.patient=e[0]):this._notifyInvalidPatient()},arrowBackButtonPressed:function(t){return this.domHost.navigateToPreviousPage()},_loadTestResultsAttachments:function(t){var e;return e=app.db.find("patient-test-results",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isTestResultsValid=!0,this._loadAttachmentList(t),!0):(this._notifyInvalidTest(),!1)},_notifyInvalidTest:function(){var t;return t=!1,this.domHost.showModalDialog("Invalid Test Results!")},navigatedIn:function(){var t;return this._loadUser(),t=this.domHost.getPageParams(),this._loadTestResultsAttachments(t["test-result"])},navigatedOut:function(){return this.visit={},this.patient={},this.isVisitValid=!1,this.isPatientValid=!1,this.isTestResultsValid=!1,this.doctorInstitutionList=[],this.doctorSpecialityList=[]},_formatDateTime:function(t){return lib.datetime.format(new Date(t),"mmm d, yyyy h:MMTT")},_updateSpaceCalculation:function(){var t,e;if(this.localDataUriDb)return t=this.localDataUriDb.computeTotalSpaceTaken(),e=1-(this.maximumLocalDataUriDbSizeInChars-t)/this.maximumLocalDataUriDbSizeInChars,this.localDataUsedPercentage=Math.floor(100*e)},_openLocalDataUriDb:function(){var t,e;return t=new lib.DatabaseEngine({name:"local-data-uri-db",storageEngine:lib.localStorage,serializationEngine:lib.json,config:{commitDelay:0}}),t.initializeDatabase({removeExisting:!1}),t.defineCollection({name:"local-attachment"}),this.localDataUriDb=t,e=new lib.DatabaseEngine({name:"session-data-uri-db",storageEngine:lib.tabStorage,serializationEngine:lib.json,config:{commitDelay:0}}),e.initializeDatabase({removeExisting:!1}),e.defineCollection({name:"local-attachment"}),this.sessionDataUriDb=e},_makeBlankAttachment:function(){return this.set("newAttachment",{title:"",description:"",dataUri:"",originalName:null,originalType:null,sizeInBytes:0,sizeInChars:0,isImage:!1,isLoaded:!1,progress:0})},_loadAttachmentList:function(t){var e,i,a;e=app.db.find("patient-gallery--local-attachment",function(e){var i;return i=e.testResultsSerial,i===t}),i=app.db.find("patient-gallery--online-attachment",function(e){var i;return i=e.testResultsSerial,i===t}),a=[],lib.util.iterate(i,function(t){return function(e,i,n){return t.callApi("bdemr/get-uploaded-file",{attachmentId:n.data.attachmentId},function(i,n){return n.hasError?t.domHost.showModalDialog(n.error.message):(a.push(n.data),e())})}}(this))["finally"](function(t){return function(){var i;return i=[].concat(e,a),t.set("attachmentList",i)}}(this))},_saveAttachment:function(t){return app.db.upsert("patient-gallery--local-attachment",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},$toMega:function(t){return Math.ceil(t/1e3/1e3*100)/100},$getImageSrc:function(t){var e;return"local"===t.mainStorage?(e=this.localDataUriDb.find("local-attachment",function(e){var i;return i=e.attachmentSerial,i===t.serial}),e.length>0?e[0].dataUri:"assets/not-found.png"):"server"===t.mainStorage?t.dataURI:"session"===t.mainStorage?(e=this.sessionDataUriDb.find("local-attachment",function(e){var i;return i=e.attachmentSerial,i===t.serial}),e.length>0?e[0].dataUri:"assets/not-found.png"):void 0},fileInputChanged:function(t){var e,i;return i=new FileReader,e=t.target.files[0],e.size>this.maximumImageSizeAllowedInBytes?void this.domHost.showModalDialog("Please provide a file less than "+Math.floor(this.maximumImageSizeAllowedInBytes/1e3/1e3)+"mb in size."):(i.readAsDataURL(e),i.onprogress=function(t){return function(e){return t.set("newAttachment.progress",e.loaded/e.total*100)}}(this),i.onload=function(t){return function(){var a;return a=i.result,t.set("newAttachment.isImage",e.type.indexOf("image/")>-1),t.set("newAttachment.sizeInBytes",e.size),t.set("newAttachment.title",e.name),t.set("newAttachment.dataUri",a),t.set("newAttachment.originalType",e.type),t.set("newAttachment.originalName",e.name),t.set("newAttachment.sizeInChars",a.length),t.set("newAttachment.isLoaded",!0)}}(this))},_prepareAtachment:function(){var t,e,i,a,n,r,s,o,l,u;return s=this.newAttachment,u=s.title,i=s.description,e=s.dataUri,a=s.isImage,n=s.originalName,r=s.originalType,o=s.sizeInBytes,l=s.sizeInChars,t={serial:this.generateSerialForAttachment(),lastModifiedDatetimeStamp:lib.datetime.now(),mainStorage:null,title:u,description:i,isImage:a,originalName:n,originalType:r,sizeInBytes:o,sizeInChars:l}},downloadPressed:function(e){var i,a,n,r,s,o;return a=e.model.attachment,o=this.$getImageSrc(a),0===o.indexOf("data:")?(n=t(o),s=window.URL.createObjectURL(n,{type:a.originalType})):s=o,r=a.originalName,i=window.document.createElement("a"),i.href=s,i.target="_blank",i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i)}})}).call(this);
//# sourceMappingURL=page-attachement-preview.coffee-compiled.js.map</script>
</dom-module>


