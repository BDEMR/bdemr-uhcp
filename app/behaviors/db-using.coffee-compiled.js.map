{"version":3,"sources":["db-using.coffee","db-using.js"],"names":["app","behaviors","dbUsing","_locateItem","path","context","first","head","maybeNewContext","newContext","originalVirtualChildName","virtualChildName","length","shift","forKey","childMap","this","virtualChildMap","split","pop","join","locateItem","stringPath","record","ex","obj","unshift","data","error","safeExtractItem","item","safeExtractInput","alternativeValue","value","isUserLoggedIn","userList","db","find","apiKey","Error","removeAllUserInfo","i","j","k","len","len1","len2","ref","ref1","ref2","results","remove","_id","push","removeUserUnlessSessionIsPersistent","persistentSessionList","shouldRememberUser","lib","tabStorage","getItem","json","parse","loginDbAction","user","persistentSession","previousUser","serialGenerator","serial","removeExistingDatabase","initializeDatabase","insert","patient-seed","doctor-visit-seed","doctor-pcc-seed","doctor-ndr-seed","doctor-visit-prescription-seed","doctor-visit-note-seed","doctor-patient-stay-seed","doctor-visit-next-visit-seed","doctor-visit-test-advise-seed","doctor-advised-test-seed","doctor-visit-examination-seed","doctor-visit-identified-symptoms-seed","doctor-visit-custom-symptoms-seed","doctor-visit-custom-examination-seed","anaesmon-record-seed","history-physical-record-seed","medication-record-seed","favorite-medicine-seed","favorite-investigation-seed","vital-record-seed","vital-comment-thread-seed","vital-comment-message-seed","custom-investigation-name-seed","user-added-institution-list-seed","attachment-record-seed","user-setting-record-seed","activity-seed","invoice-seed","diagnosis-seed","visited-patient-log","diag-patient-log","org-role-item-log","referral-seed","inventory-seed","third-party-user-seed","price-list-seed","setItem","stringify","skipWelcomePage","welcomePageViewed","localStorage","getDashboardMetrics","dt","metrics","now","Date","accountExpiresOnDate","datetime","mkDate","daysLeft","Math","floor","diff","getCurrentUser","getCurrentUserSerial","getCurrentOrganization","generateSerialForPatient","appIdentifier","itemType","patientSeed","sessionSerial","userSerial","update","generateSerialForVisit","seed","generateSerialForRecord","generateSerialForHistoryAndPhysical","generateSerialForPrescription","generateSerialForNote","generateSerialForPatientStay","generateSerialForNextVisit","generateSerialForTestAdvised","generateSerialForIdentifiedSymptoms","generateSerialForExamination","generateSerialForCustomSymptoms","generateSerialForCustomExamination","generateSerialForTestAdvisedInvestigation","generateSerialForCustomInvestigation","generateSerialForMedication","generateSerialForFavoriteMedicine","generateSerialForFavoriteInvestigation","generateSerialForVitals","forItem","generateSerialForCommentMessage","generateSerialForUserAddedInstituion","generateSerialForAttachmentBlob","generateSerialForAttachmentSync","generateSerialForSettings","generateSerialForActivity","generateSerialForinvoice","generateSerialForDiagnosis","generateSerialForVisitedPatientLog","generateSerialForOrgRole","generateSerialForPccRecord","generateSerialForNdrRecord","generateSerialForEmployeeLeaveData","generateSerialForReferral","generateSerialForInvoiceCategory","generateSerialForThirdPartyUser","generateSerialForInventoryItem","generateSerialForPriceListItem","generateSerialForInvestigationPriceList","orgnizationId","generateSerialDoctorFees","generateSerialForServicePriceList","generateSerialForAmbulancePriceList","generateSerialForPharmacyPriceList","generateSerialForSupplyPriceList","generateSerialForPackagePriceList","generateSerialForOtherPriceList","generateSerialCustomCategory","call"],"mappings":"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","file":"db-using.coffee-compiled.js","sourcesContent":["\napp.behaviors.dbUsing =\n ## DATA EXTRACTION START ================\n\n  _locateItem: (path, context)->\n    # console.log context\n\n    return context if path.length is 0\n\n    head = path.shift()\n    return null if head isnt context.forKey\n\n    return context if path.length is 0\n    \n    first = path[0]\n    if 'childMap' of context and first of context.childMap\n      newContext = context.childMap[first]\n      return @_locateItem path, newContext\n    else if 'virtualChildMap' of context\n      newContext = null\n      for originalVirtualChildName of context.virtualChildMap\n        virtualChildName = originalVirtualChildName\n        virtualChildName = virtualChildName.split '_'\n        virtualChildName.pop()\n        virtualChildName.shift()\n        virtualChildName = virtualChildName.join '_'\n\n        console.log 'virtualChildName', virtualChildName\n        console.log 'first', first        \n        console.log 'context.virtualChildMap', context.virtualChildMap\n        console.log 'originalVirtualChildName', originalVirtualChildName\n\n        maybeNewContext = context.virtualChildMap[originalVirtualChildName]\n        if @_locateItem path, maybeNewContext\n          newContext = maybeNewContext\n          break\n      if newContext is null\n        return false\n      else\n        return @_locateItem path, newContext\n    else\n      return false\n\n  locateItem: (stringPath, record = null)->\n    if record is null\n      record = @record\n    \n    path = (stringPath.split '//')\n    head = path.shift()\n    if head in [ 'preopAssessment', 'opAnaesthesia', 'opSurgery', 'postopAnalysis', 'postopAssessment', 'progressNote' ]\n      path.unshift \"systemRoot\"\n\n      obj = try record.data catch ex then null\n      return (if obj then @_locateItem path, obj else null)\n    else\n      console.log 'CANT FIND MY WAY'\n\n  safeExtractItem: (path, record = null)->\n    item = @locateItem path, record\n    return (if item then item else null)      \n\n  safeExtractInput: (path, alternativeValue, record = null)->\n    item = @locateItem path, record\n    return (if item then item.value else alternativeValue)\n\n  ## DATA EXTRACTION END ================ \n\n  isUserLoggedIn: ->\n    userList = app.db.find 'user'\n    if (userList.length is 0) or (not userList[0].apiKey)\n      return false\n    else if userList.length is 1\n      return true\n    else\n      throw new Error 'More than one active user'\n\n  removeAllUserInfo: ->\n    app.db.remove 'user', item._id for item in app.db.find 'user'\n    app.db.remove '--persistent-session', item._id for item in app.db.find '--persistent-session'\n    app.db.remove '--serial-generator', item._id for item in app.db.find '--serial-generator'\n    \n    \n  removeUserUnlessSessionIsPersistent: ->\n    userList = app.db.find 'user'\n    persistentSessionList = app.db.find '--persistent-session'\n\n    if userList.length is 1 and persistentSessionList.length is 1\n      if persistentSessionList[0].shouldRememberUser isnt true\n        item = lib.tabStorage.getItem 'is-tab-authenticated'\n        if item\n          if (lib.json.parse item) is false\n            @removeAllUserInfo()\n        else\n          @removeAllUserInfo()\n\n  loginDbAction: (user, shouldRememberUser) ->\n    previousUser = (app.db.find 'user')[0]\n    @removeAllUserInfo()\n    \n    if previousUser \n      unless user.serial is previousUser.serial\n        app.db.removeExistingDatabase()\n        app.db.initializeDatabase()\n    \n    app.db.insert 'user', user\n\n    persistentSession = \n      shouldRememberUser: shouldRememberUser\n    app.db.insert '--persistent-session', persistentSession\n\n    serialGenerator = \n      'patient-seed': 0\n      'doctor-visit-seed': 0\n      'doctor-pcc-seed': 1\n      'doctor-ndr-seed': 1\n      'doctor-visit-prescription-seed': 0\n      'doctor-visit-note-seed': 0\n      'doctor-patient-stay-seed': 0\n      'doctor-visit-next-visit-seed': 0\n      'doctor-visit-test-advise-seed': 0\n      'doctor-advised-test-seed': 0\n      'doctor-visit-examination-seed': 0\n      'doctor-visit-identified-symptoms-seed': 1\n      'doctor-visit-custom-symptoms-seed': 1\n      'doctor-visit-custom-examination-seed': 1\n      'anaesmon-record-seed': 0\n      'history-physical-record-seed': 1\n      'medication-record-seed': 0\n      'favorite-medicine-seed': 0\n      'favorite-investigation-seed': 0\n      'vital-record-seed': 0\n      'vital-comment-thread-seed': 0\n      'vital-comment-message-seed': 0\n      'custom-investigation-name-seed': 0\n      'user-added-institution-list-seed': 0\n      'attachment-record-seed': 0\n      'user-setting-record-seed': 0\n      'activity-seed': 0\n      'invoice-seed': 1\n      'diagnosis-seed': 1\n      'visited-patient-log': 0\n      'diag-patient-log': 0\n      'org-role-item-log': 1\n      'referral-seed': 1\n      'inventory-seed': 1\n      'third-party-user-seed': 1\n      # 'investigation-price-list-seed': 1\n      # 'service-price-list-seed': 1\n      # 'supply-price-list-seed': 1\n      # 'ambulance-price-list-seed': 1\n      # 'package-price-list-seed': 1\n      # 'other-price-list-seed': 1\n      'price-list-seed': 1\n    app.db.insert '--serial-generator', serialGenerator\n\n    lib.tabStorage.setItem 'is-tab-authenticated', (lib.json.stringify true)\n\n  skipWelcomePage: ->\n    welcomePageViewed = lib.localStorage.getItem 'welcomePageViewed'\n    if welcomePageViewed\n      return true\n    return false\n  \n  getDashboardMetrics: ->\n\n    metrics = {}\n\n    ## NOTE newPatientCount\n    # patientList = app.db.find 'patient-list', ({createdDatetimeStamp})-> \n    #   lhs = lib.datetime.mkDate (new Date createdDatetimeStamp)\n    #   rhs = lib.datetime.mkDate lib.datetime.now()\n    #   return (lhs is rhs)\n    # metrics.newPatientCount = patientList.length\n\n    ## NOTE totalPatientCount\n    # metrics.totalPatientCount = (app.db.find 'patient-list').length\n\n    ## NOTE newVisitCount\n    # metrics.newVisitCount = 0\n\n    ## NOTE totalVisitCount\n    # metrics.totalVisitCount = 0\n\n    ## NOTE totalUnpaidInvoiceCount\n    # metrics.totalUnpaidInvoiceCount = 0\n\n    ## NOTE daysLeft\n    user = (app.db.find 'user')[0]\n    dt = new Date user.accountExpiresOnDate\n    now = new Date lib.datetime.mkDate lib.datetime.now()\n    metrics.daysLeft = Math.floor ((lib.datetime.diff dt, now) / 1000 / 60 / 60 / 24)\n\n    return metrics\n\n  getCurrentUser: -> (app.db.find 'user')[0]\n  getCurrentUserSerial: -> (app.db.find 'user')[0].serial\n  getCurrentOrganization: -> (app.db.find 'organization')[0]\n\n  generateSerialForPatient: ->\n    appIdentifier = 'U'\n    itemType = 'P'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    patientSeed = serialGenerator['patient-seed']\n    serialGenerator['patient-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + patientSeed)\n\n  generateSerialForVisit: ->\n    appIdentifier = 'U'\n    itemType = 'V'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-seed']\n    serialGenerator['doctor-visit-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForRecord: ->\n    appIdentifier = 'A'\n    itemType = 'R'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['anaesmon-record-seed']\n    serialGenerator['anaesmon-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForHistoryAndPhysical: ->\n    appIdentifier = 'A'\n    itemType = 'R'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['history-physical-record-seed']\n    serialGenerator['history-physical-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    console.log (appIdentifier + userSerial + sessionSerial + itemType + seed)\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n\n  generateSerialForPrescription: ->\n    appIdentifier = 'U'\n    itemType = 'PR'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-prescription-seed']\n    serialGenerator['doctor-visit-prescription-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForNote: ->\n    appIdentifier = 'U'\n    itemType = 'NT'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-note-seed']\n    serialGenerator['doctor-visit-note-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n\n  generateSerialForPatientStay: ->\n    appIdentifier = 'U'\n    itemType = 'PS'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-patient-stay-seed']\n    serialGenerator['doctor-patient-stay-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForNextVisit: ->\n    appIdentifier = 'U'\n    itemType = 'NV'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-next-visit-seed']\n    serialGenerator['doctor-visit-next-visit-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForTestAdvised: ->\n    appIdentifier = 'U'\n    itemType = 'TA'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-test-advise-seed']\n    serialGenerator['doctor-visit-test-advise-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForIdentifiedSymptoms: ->\n    appIdentifier = 'U'\n    itemType = 'SYMP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-identified-symptoms-seed']\n    serialGenerator['doctor-visit-identified-symptoms-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForExamination: ->\n    appIdentifier = 'U'\n    itemType = 'EXM'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-examination-seed']\n    serialGenerator['doctor-visit-examination-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n    \n\n  generateSerialForCustomSymptoms: ->\n    appIdentifier = 'U'\n    itemType = 'CSYMP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-custom-symptoms-seed']\n    serialGenerator['doctor-visit-custom-symptoms-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForCustomExamination: ->\n    appIdentifier = 'U'\n    itemType = 'CEXM'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-custom-examination-seed']\n    serialGenerator['doctor-visit-custom-examination-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForTestAdvisedInvestigation: ->\n    appIdentifier = 'U'\n    itemType = 'TST'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-test-advise-seed']\n    serialGenerator['doctor-visit-test-advise-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForCustomInvestigation: ->\n    appIdentifier = 'U'\n    itemType = 'TA'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-visit-test-advise-seed']\n    serialGenerator['doctor-visit-test-advise-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForMedication: ->\n    appIdentifier = 'U'\n    itemType = 'M'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['medication-record-seed']\n    serialGenerator['medication-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForFavoriteMedicine: ->\n    appIdentifier = 'U'\n    itemType = 'FM'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['favorite-medicine-seed']\n    serialGenerator['favorite-medicine-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForFavoriteInvestigation: ->\n    appIdentifier = 'U'\n    itemType = 'FI'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['favorite-investigation-seed']\n    serialGenerator['favorite-investigation-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForVitals: (forItem)->\n    appIdentifier = 'U'\n    itemType = 'V'\n    forItem = forItem\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['vital-record-seed']\n    serialGenerator['vital-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + forItem + seed)\n\n\n  generateSerialForCommentMessage: (forItem)->\n    appIdentifier = 'U'\n    itemType = 'U'\n    forItem = forItem\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['vital-comment-message-seed']\n    serialGenerator['vital-comment-message-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + forItem + seed)\n\n\n  generateSerialForUserAddedInstituion: (forItem)->\n    appIdentifier = 'U'\n    itemType = 'UI'\n    forItem = forItem\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['user-added-institution-list-seed']\n    serialGenerator['user-added-institution-list-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + forItem + seed)\n\n  generateSerialForAttachmentBlob: ->\n    appIdentifier = 'U'\n    itemType = 'AttBlob'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['attachment-record-seed']\n    serialGenerator['attachment-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n  \n  generateSerialForAttachmentSync: ->\n    appIdentifier = 'U'\n    itemType = 'AttSync'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['attachment-record-seed']\n    serialGenerator['attachment-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForSettings: ->\n    appIdentifier = 'U'\n    itemType = 'STN'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['user-setting-record-seed']\n    serialGenerator['user-setting-record-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForActivity: ->\n    appIdentifier = 'U'\n    itemType = 'Act'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['activity-seed']\n    serialGenerator['activity-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n\n  generateSerialForinvoice: ->\n    appIdentifier = 'U'\n    itemType = 'Inv'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['invoice-seed']\n    serialGenerator['invoice-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForDiagnosis: ->\n    appIdentifier = 'U'\n    itemType = 'Dg'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['diagnosis-seed']\n    serialGenerator['diagnosis-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForVisitedPatientLog: ->\n    appIdentifier = 'U'\n    itemType = 'VP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['visited-patient-log']\n    serialGenerator['visited-patient-log'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForOrgRole: ->\n    appIdentifier = 'U'\n    itemType = 'R'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['org-role-item-log']\n    serialGenerator['org-role-item-log'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForPccRecord: ->\n    appIdentifier = 'U'\n    itemType = 'PCC'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-pcc-seed']\n    console.log 'seed', seed\n    serialGenerator['doctor-pcc-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForNdrRecord: ->\n    appIdentifier = 'U'\n    itemType = 'NDR'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['doctor-ndr-seed']\n    console.log 'seed', seed\n    serialGenerator['doctor-ndr-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForEmployeeLeaveData: ->\n    appIdentifier = 'U'\n    itemType = 'EL'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType )\n\n\n  generateSerialForReferral: ->\n    appIdentifier = 'U'\n    itemType = 'ref'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['referral-seed']\n    serialGenerator['referral-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForInvoiceCategory: ()->\n    appIdentifier = 'U'\n    itemType = 'IC'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + 'only')\n\n  generateSerialForThirdPartyUser: ->\n    appIdentifier = 'U'\n    itemType = 'TPU'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['third-party-user-seed']\n    serialGenerator['third-party-user-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForInventoryItem: ->\n    appIdentifier = 'U'\n    itemType = 'Inventory'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['inventory-seed']\n    serialGenerator['inventory-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n\n  generateSerialForPriceListItem: ()->\n    appIdentifier = 'U'\n    itemType = 'PL'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    serialGenerator = (app.db.find '--serial-generator')[0]\n    seed = serialGenerator['price-list-seed']\n    serialGenerator['price-list-seed'] += 1\n    app.db.update '--serial-generator', serialGenerator._id, serialGenerator\n    return (appIdentifier + userSerial + sessionSerial + itemType + seed)\n  \n  generateSerialForInvestigationPriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'InvP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialDoctorFees: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'DocFeeP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n  \n  generateSerialForServicePriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'SvcP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialForAmbulancePriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'AmbP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialForPharmacyPriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'PhaP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialForSupplyPriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'SupP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialForPackagePriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'PackP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialForOtherPriceList: (orgnizationId)->\n    appIdentifier = 'U'\n    itemType = 'OP'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + orgnizationId)\n\n  generateSerialCustomCategory: ()->\n    appIdentifier = 'C'\n    itemType = 'UC'\n    { serial: userSerial, sessionSerial } = (app.db.find 'user')[0]\n    return (appIdentifier + userSerial + itemType + 'only')\n\n","(function() {\n  app.behaviors.dbUsing = {\n    _locateItem: function(path, context) {\n      var first, head, maybeNewContext, newContext, originalVirtualChildName, virtualChildName;\n      if (path.length === 0) {\n        return context;\n      }\n      head = path.shift();\n      if (head !== context.forKey) {\n        return null;\n      }\n      if (path.length === 0) {\n        return context;\n      }\n      first = path[0];\n      if ('childMap' in context && first in context.childMap) {\n        newContext = context.childMap[first];\n        return this._locateItem(path, newContext);\n      } else if ('virtualChildMap' in context) {\n        newContext = null;\n        for (originalVirtualChildName in context.virtualChildMap) {\n          virtualChildName = originalVirtualChildName;\n          virtualChildName = virtualChildName.split('_');\n          virtualChildName.pop();\n          virtualChildName.shift();\n          virtualChildName = virtualChildName.join('_');\n          console.log('virtualChildName', virtualChildName);\n          console.log('first', first);\n          console.log('context.virtualChildMap', context.virtualChildMap);\n          console.log('originalVirtualChildName', originalVirtualChildName);\n          maybeNewContext = context.virtualChildMap[originalVirtualChildName];\n          if (this._locateItem(path, maybeNewContext)) {\n            newContext = maybeNewContext;\n            break;\n          }\n        }\n        if (newContext === null) {\n          return false;\n        } else {\n          return this._locateItem(path, newContext);\n        }\n      } else {\n        return false;\n      }\n    },\n    locateItem: function(stringPath, record) {\n      var ex, head, obj, path;\n      if (record == null) {\n        record = null;\n      }\n      if (record === null) {\n        record = this.record;\n      }\n      path = stringPath.split('//');\n      head = path.shift();\n      if (head === 'preopAssessment' || head === 'opAnaesthesia' || head === 'opSurgery' || head === 'postopAnalysis' || head === 'postopAssessment' || head === 'progressNote') {\n        path.unshift(\"systemRoot\");\n        obj = (function() {\n          try {\n            return record.data;\n          } catch (error) {\n            ex = error;\n            return null;\n          }\n        })();\n        return (obj ? this._locateItem(path, obj) : null);\n      } else {\n        return console.log('CANT FIND MY WAY');\n      }\n    },\n    safeExtractItem: function(path, record) {\n      var item;\n      if (record == null) {\n        record = null;\n      }\n      item = this.locateItem(path, record);\n      return (item ? item : null);\n    },\n    safeExtractInput: function(path, alternativeValue, record) {\n      var item;\n      if (record == null) {\n        record = null;\n      }\n      item = this.locateItem(path, record);\n      return (item ? item.value : alternativeValue);\n    },\n    isUserLoggedIn: function() {\n      var userList;\n      userList = app.db.find('user');\n      if ((userList.length === 0) || (!userList[0].apiKey)) {\n        return false;\n      } else if (userList.length === 1) {\n        return true;\n      } else {\n        throw new Error('More than one active user');\n      }\n    },\n    removeAllUserInfo: function() {\n      var i, item, j, k, len, len1, len2, ref, ref1, ref2, results;\n      ref = app.db.find('user');\n      for (i = 0, len = ref.length; i < len; i++) {\n        item = ref[i];\n        app.db.remove('user', item._id);\n      }\n      ref1 = app.db.find('--persistent-session');\n      for (j = 0, len1 = ref1.length; j < len1; j++) {\n        item = ref1[j];\n        app.db.remove('--persistent-session', item._id);\n      }\n      ref2 = app.db.find('--serial-generator');\n      results = [];\n      for (k = 0, len2 = ref2.length; k < len2; k++) {\n        item = ref2[k];\n        results.push(app.db.remove('--serial-generator', item._id));\n      }\n      return results;\n    },\n    removeUserUnlessSessionIsPersistent: function() {\n      var item, persistentSessionList, userList;\n      userList = app.db.find('user');\n      persistentSessionList = app.db.find('--persistent-session');\n      if (userList.length === 1 && persistentSessionList.length === 1) {\n        if (persistentSessionList[0].shouldRememberUser !== true) {\n          item = lib.tabStorage.getItem('is-tab-authenticated');\n          if (item) {\n            if ((lib.json.parse(item)) === false) {\n              return this.removeAllUserInfo();\n            }\n          } else {\n            return this.removeAllUserInfo();\n          }\n        }\n      }\n    },\n    loginDbAction: function(user, shouldRememberUser) {\n      var persistentSession, previousUser, serialGenerator;\n      previousUser = (app.db.find('user'))[0];\n      this.removeAllUserInfo();\n      if (previousUser) {\n        if (user.serial !== previousUser.serial) {\n          app.db.removeExistingDatabase();\n          app.db.initializeDatabase();\n        }\n      }\n      app.db.insert('user', user);\n      persistentSession = {\n        shouldRememberUser: shouldRememberUser\n      };\n      app.db.insert('--persistent-session', persistentSession);\n      serialGenerator = {\n        'patient-seed': 0,\n        'doctor-visit-seed': 0,\n        'doctor-pcc-seed': 1,\n        'doctor-ndr-seed': 1,\n        'doctor-visit-prescription-seed': 0,\n        'doctor-visit-note-seed': 0,\n        'doctor-patient-stay-seed': 0,\n        'doctor-visit-next-visit-seed': 0,\n        'doctor-visit-test-advise-seed': 0,\n        'doctor-advised-test-seed': 0,\n        'doctor-visit-examination-seed': 0,\n        'doctor-visit-identified-symptoms-seed': 1,\n        'doctor-visit-custom-symptoms-seed': 1,\n        'doctor-visit-custom-examination-seed': 1,\n        'anaesmon-record-seed': 0,\n        'history-physical-record-seed': 1,\n        'medication-record-seed': 0,\n        'favorite-medicine-seed': 0,\n        'favorite-investigation-seed': 0,\n        'vital-record-seed': 0,\n        'vital-comment-thread-seed': 0,\n        'vital-comment-message-seed': 0,\n        'custom-investigation-name-seed': 0,\n        'user-added-institution-list-seed': 0,\n        'attachment-record-seed': 0,\n        'user-setting-record-seed': 0,\n        'activity-seed': 0,\n        'invoice-seed': 1,\n        'diagnosis-seed': 1,\n        'visited-patient-log': 0,\n        'diag-patient-log': 0,\n        'org-role-item-log': 1,\n        'referral-seed': 1,\n        'inventory-seed': 1,\n        'third-party-user-seed': 1,\n        'price-list-seed': 1\n      };\n      app.db.insert('--serial-generator', serialGenerator);\n      return lib.tabStorage.setItem('is-tab-authenticated', lib.json.stringify(true));\n    },\n    skipWelcomePage: function() {\n      var welcomePageViewed;\n      welcomePageViewed = lib.localStorage.getItem('welcomePageViewed');\n      if (welcomePageViewed) {\n        return true;\n      }\n      return false;\n    },\n    getDashboardMetrics: function() {\n      var dt, metrics, now, user;\n      metrics = {};\n      user = (app.db.find('user'))[0];\n      dt = new Date(user.accountExpiresOnDate);\n      now = new Date(lib.datetime.mkDate(lib.datetime.now()));\n      metrics.daysLeft = Math.floor((lib.datetime.diff(dt, now)) / 1000 / 60 / 60 / 24);\n      return metrics;\n    },\n    getCurrentUser: function() {\n      return (app.db.find('user'))[0];\n    },\n    getCurrentUserSerial: function() {\n      return (app.db.find('user'))[0].serial;\n    },\n    getCurrentOrganization: function() {\n      return (app.db.find('organization'))[0];\n    },\n    generateSerialForPatient: function() {\n      var appIdentifier, itemType, patientSeed, ref, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'P';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      patientSeed = serialGenerator['patient-seed'];\n      serialGenerator['patient-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + patientSeed;\n    },\n    generateSerialForVisit: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'V';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-seed'];\n      serialGenerator['doctor-visit-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForRecord: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'A';\n      itemType = 'R';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['anaesmon-record-seed'];\n      serialGenerator['anaesmon-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForHistoryAndPhysical: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'A';\n      itemType = 'R';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['history-physical-record-seed'];\n      serialGenerator['history-physical-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      console.log(appIdentifier + userSerial + sessionSerial + itemType + seed);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForPrescription: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PR';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-prescription-seed'];\n      serialGenerator['doctor-visit-prescription-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForNote: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'NT';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-note-seed'];\n      serialGenerator['doctor-visit-note-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForPatientStay: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PS';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-patient-stay-seed'];\n      serialGenerator['doctor-patient-stay-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForNextVisit: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'NV';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-next-visit-seed'];\n      serialGenerator['doctor-visit-next-visit-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForTestAdvised: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'TA';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-test-advise-seed'];\n      serialGenerator['doctor-visit-test-advise-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForIdentifiedSymptoms: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'SYMP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-identified-symptoms-seed'];\n      serialGenerator['doctor-visit-identified-symptoms-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForExamination: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'EXM';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-examination-seed'];\n      serialGenerator['doctor-visit-examination-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForCustomSymptoms: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'CSYMP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-custom-symptoms-seed'];\n      serialGenerator['doctor-visit-custom-symptoms-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForCustomExamination: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'CEXM';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-custom-examination-seed'];\n      serialGenerator['doctor-visit-custom-examination-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForTestAdvisedInvestigation: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'TST';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-test-advise-seed'];\n      serialGenerator['doctor-visit-test-advise-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForCustomInvestigation: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'TA';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-visit-test-advise-seed'];\n      serialGenerator['doctor-visit-test-advise-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForMedication: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'M';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['medication-record-seed'];\n      serialGenerator['medication-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForFavoriteMedicine: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'FM';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['favorite-medicine-seed'];\n      serialGenerator['favorite-medicine-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForFavoriteInvestigation: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'FI';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['favorite-investigation-seed'];\n      serialGenerator['favorite-investigation-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForVitals: function(forItem) {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'V';\n      forItem = forItem;\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['vital-record-seed'];\n      serialGenerator['vital-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + forItem + seed;\n    },\n    generateSerialForCommentMessage: function(forItem) {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'U';\n      forItem = forItem;\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['vital-comment-message-seed'];\n      serialGenerator['vital-comment-message-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + forItem + seed;\n    },\n    generateSerialForUserAddedInstituion: function(forItem) {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'UI';\n      forItem = forItem;\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['user-added-institution-list-seed'];\n      serialGenerator['user-added-institution-list-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + forItem + seed;\n    },\n    generateSerialForAttachmentBlob: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'AttBlob';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['attachment-record-seed'];\n      serialGenerator['attachment-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForAttachmentSync: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'AttSync';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['attachment-record-seed'];\n      serialGenerator['attachment-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForSettings: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'STN';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['user-setting-record-seed'];\n      serialGenerator['user-setting-record-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForActivity: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'Act';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['activity-seed'];\n      serialGenerator['activity-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForinvoice: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'Inv';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['invoice-seed'];\n      serialGenerator['invoice-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForDiagnosis: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'Dg';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['diagnosis-seed'];\n      serialGenerator['diagnosis-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForVisitedPatientLog: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'VP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['visited-patient-log'];\n      serialGenerator['visited-patient-log'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForOrgRole: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'R';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['org-role-item-log'];\n      serialGenerator['org-role-item-log'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForPccRecord: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PCC';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-pcc-seed'];\n      console.log('seed', seed);\n      serialGenerator['doctor-pcc-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForNdrRecord: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'NDR';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['doctor-ndr-seed'];\n      console.log('seed', seed);\n      serialGenerator['doctor-ndr-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForEmployeeLeaveData: function() {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'EL';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType;\n    },\n    generateSerialForReferral: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'ref';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['referral-seed'];\n      serialGenerator['referral-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForInvoiceCategory: function() {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'IC';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + 'only';\n    },\n    generateSerialForThirdPartyUser: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'TPU';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['third-party-user-seed'];\n      serialGenerator['third-party-user-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForInventoryItem: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'Inventory';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['inventory-seed'];\n      serialGenerator['inventory-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForPriceListItem: function() {\n      var appIdentifier, itemType, ref, seed, serialGenerator, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PL';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      serialGenerator = (app.db.find('--serial-generator'))[0];\n      seed = serialGenerator['price-list-seed'];\n      serialGenerator['price-list-seed'] += 1;\n      app.db.update('--serial-generator', serialGenerator._id, serialGenerator);\n      return appIdentifier + userSerial + sessionSerial + itemType + seed;\n    },\n    generateSerialForInvestigationPriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'InvP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialDoctorFees: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'DocFeeP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForServicePriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'SvcP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForAmbulancePriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'AmbP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForPharmacyPriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PhaP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForSupplyPriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'SupP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForPackagePriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'PackP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialForOtherPriceList: function(orgnizationId) {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'U';\n      itemType = 'OP';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + orgnizationId;\n    },\n    generateSerialCustomCategory: function() {\n      var appIdentifier, itemType, ref, sessionSerial, userSerial;\n      appIdentifier = 'C';\n      itemType = 'UC';\n      ref = (app.db.find('user'))[0], userSerial = ref.serial, sessionSerial = ref.sessionSerial;\n      return appIdentifier + userSerial + itemType + 'only';\n    }\n  };\n\n}).call(this);\n"]}