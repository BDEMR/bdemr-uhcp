{"version":3,"sources":["api-calling.coffee","api-calling.js"],"names":["desanitize","slice","object","i","keys","he","decode","Array","isArray","length","Object","app","behaviors","apiCalling","showMessageLocal","args","arguments","call","this","showModalDialog","apply","domHost","callApi","api","automaticallyHandleNetworkErrors","cbfn","data","errorMessage","options","Error","navigator","onLine","window","location","href","indexOf","lib","network","callBdemrPostApi","_this","err","response","context","el","document","querySelector","hasError","error","name","logoutPressed","routeData","page"],"mappings":"CAAA,WAAA,GAAAA,GAAAC,KAAAA,KAAAD,GAAa,SAACE,GACZ,GAAAC,GAAAC,CAAA,IAAoB,gBAAVF,GACR,MAAOG,IAAGC,OAAOJ,EACnB,IAAoB,gBAAVA,IAAiC,OAAVA,EAC/B,GAAGK,MAAMC,QAAQN,GAEf,IADAC,EAAI,EACEA,EAAID,EAAOO,QACfP,EAAOC,GAAKH,EAAWE,EAAOC,IAC9BA,QAIF,KAFAC,EAAOM,OAAON,KAAKF,GACnBC,EAAI,EACEA,EAAIC,EAAKK,QACbP,EAAOE,EAAKD,IAAMH,EAAWE,EAAOE,EAAKD,KACzCA,GAEN,OAAOD,IAETS,IAAIC,UAAUC,YAEZC,iBAAkB,WAChB,GAAAC,EAAA,OADiBA,GAAA,GAAAC,UAAAP,OAAAR,EAAAgB,KAAAD,UAAA,MACdE,KAACC,gBACFD,KAACC,gBAAgBC,MAAMF,KAAGH,GAE1BG,KAACG,QAAQF,gBAAgBC,MAAMF,KAACG,QAASN,IAE7CO,QAAS,WACP,GAAAC,GAAAR,EAAAS,EAAAC,EAAAC,EAAAC,EAAAC,CAAA,IADQb,EAAA,GAAAC,UAAAP,OAAAR,EAAAgB,KAAAD,UAAA,MACU,IAAfD,EAAKN,OACJc,EAAAR,EAAA,GAAKW,EAAAX,EAAA,GAAMU,EAAAV,EAAA,GACba,GACEJ,kCAAkC,OACjC,CAAA,GAAkB,IAAfT,EAAKN,OAGX,KAAM,IAAIoB,OAAM,gDAFdN,GAAAR,EAAA,GAAKW,EAAAX,EAAA,GAAMa,EAAAb,EAAA,GAASU,EAAAV,EAAA,GAMxB,MAFES,GAAqCI,EAAAJ,iCAEpCM,UAAUC,QAAWC,OAAOC,SAASC,KAAKC,QAAQ,mBACnDC,IAAIC,QAAQC,iBAAiBf,EAAKG,EAAM,SAAAa,GCepC,MDfoC,UAACC,EAAKC,GAC5C,GAAAC,GAAAC,EAAAhB,CAAA,IAAGa,GAAQhB,ECmBL,MDlBJG,GAAe,mGACfgB,EAAKC,SAASC,cAAc,gBAC5BF,EAAGxB,gBAAgBQ,EAEnB,EAAA,GAAOa,IAAQC,EAASK,UAAoC,wBAAvBL,EAASM,MAAMC,KC4BhD,MDlBJvB,GAAKe,EAAKxC,EAAWyC,GAPnBC,GAAaH,EAACU,cAAmBV,EAAOA,EAAClB,OACzC,KACSqB,EAAQQ,WAAeR,EAAQQ,UAAUC,KAAKhB,QAAQ,aAC3DO,EAAQO,cAAc,MAF1B,MAAAF,GAGMP,EAAAO,EACJL,EAAQO,cAAc,UAdU/B,QAkBxCS,EAAe,2DACfT,KAACJ,iBAAiBa,QC0BrBV,KAAKC","file":"api-calling.coffee-compiled.js","sourcesContent":["desanitize = (object) ->\r\n  if typeof object == 'string'\r\n    return he.decode(object)\r\n  if typeof object == 'object' and object != null\r\n    if Array.isArray(object)\r\n      i = 0\r\n      while i < object.length\r\n        object[i] = desanitize(object[i])\r\n        i++\r\n    else\r\n      keys = Object.keys(object)\r\n      i = 0\r\n      while i < keys.length\r\n        object[keys[i]] = desanitize(object[keys[i]])\r\n        i++\r\n  \r\n  return object\r\n\r\napp.behaviors.apiCalling = \r\n\r\n  showMessageLocal: (args...)->\r\n    if @showModalDialog\r\n      @showModalDialog.apply @, args\r\n    else\r\n      @domHost.showModalDialog.apply @domHost, args\r\n\r\n  callApi: (args...)->\r\n    if args.length is 3\r\n      [ api, data, cbfn ] = args\r\n      options = \r\n        automaticallyHandleNetworkErrors: false\r\n    else if args.length is 4\r\n      [ api, data, options, cbfn ] = args\r\n    else\r\n      throw new Error \"Developer Error: Missing arguments in callApi\"\r\n\r\n    { automaticallyHandleNetworkErrors } = options\r\n\r\n    if navigator.onLine or (window.location.href.indexOf('localhost:') isnt -1)\r\n      lib.network.callBdemrPostApi api, data, (err, response)=>\r\n        if err and automaticallyHandleNetworkErrors\r\n          errorMessage = \"Could not contact server. Please make sure you have an active internet connection and try again.\"\r\n          el = document.querySelector 'root-element'\r\n          el.showModalDialog errorMessage\r\n        else\r\n          if not err and response.hasError and response.error.name is \"API_KEY_AUTH_FAILED\"\r\n            # errorMessage = 'You have been automatically logged out. Taking you to the login page.'\r\n            # @showMessageLocal errorMessage\r\n            context = if @logoutPressed then @ else @domHost\r\n            try\r\n              unless context.routeData and (context.routeData.page.indexOf(\"login\") > -1)\r\n                context.logoutPressed null\r\n            catch err\r\n              context.logoutPressed null\r\n            return\r\n          cbfn err, desanitize(response)\r\n    else\r\n      errorMessage = 'You are not Connected to the Internet. Please Try Again.'\r\n      @showMessageLocal errorMessage\r\n\r\n  ## region - pcc signup - start\r\n  \r\n  ## region - pcc signup - end\r\n\r\n  \r\n\r\n\r\n","(function() {\n  var desanitize,\n    slice = [].slice;\n\n  desanitize = function(object) {\n    var i, keys;\n    if (typeof object === 'string') {\n      return he.decode(object);\n    }\n    if (typeof object === 'object' && object !== null) {\n      if (Array.isArray(object)) {\n        i = 0;\n        while (i < object.length) {\n          object[i] = desanitize(object[i]);\n          i++;\n        }\n      } else {\n        keys = Object.keys(object);\n        i = 0;\n        while (i < keys.length) {\n          object[keys[i]] = desanitize(object[keys[i]]);\n          i++;\n        }\n      }\n    }\n    return object;\n  };\n\n  app.behaviors.apiCalling = {\n    showMessageLocal: function() {\n      var args;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      if (this.showModalDialog) {\n        return this.showModalDialog.apply(this, args);\n      } else {\n        return this.domHost.showModalDialog.apply(this.domHost, args);\n      }\n    },\n    callApi: function() {\n      var api, args, automaticallyHandleNetworkErrors, cbfn, data, errorMessage, options;\n      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      if (args.length === 3) {\n        api = args[0], data = args[1], cbfn = args[2];\n        options = {\n          automaticallyHandleNetworkErrors: false\n        };\n      } else if (args.length === 4) {\n        api = args[0], data = args[1], options = args[2], cbfn = args[3];\n      } else {\n        throw new Error(\"Developer Error: Missing arguments in callApi\");\n      }\n      automaticallyHandleNetworkErrors = options.automaticallyHandleNetworkErrors;\n      if (navigator.onLine || (window.location.href.indexOf('localhost:') !== -1)) {\n        return lib.network.callBdemrPostApi(api, data, (function(_this) {\n          return function(err, response) {\n            var context, el, errorMessage;\n            if (err && automaticallyHandleNetworkErrors) {\n              errorMessage = \"Could not contact server. Please make sure you have an active internet connection and try again.\";\n              el = document.querySelector('root-element');\n              return el.showModalDialog(errorMessage);\n            } else {\n              if (!err && response.hasError && response.error.name === \"API_KEY_AUTH_FAILED\") {\n                context = _this.logoutPressed ? _this : _this.domHost;\n                try {\n                  if (!(context.routeData && (context.routeData.page.indexOf(\"login\") > -1))) {\n                    context.logoutPressed(null);\n                  }\n                } catch (error) {\n                  err = error;\n                  context.logoutPressed(null);\n                }\n                return;\n              }\n              return cbfn(err, desanitize(response));\n            }\n          };\n        })(this));\n      } else {\n        errorMessage = 'You are not Connected to the Internet. Please Try Again.';\n        return this.showMessageLocal(errorMessage);\n      }\n    }\n  };\n\n}).call(this);\n"]}