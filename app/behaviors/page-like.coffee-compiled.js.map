{"version":3,"sources":["page-like.coffee","page-like.js"],"names":["app","behaviors","pageLike","ready","this","domHost","pageReady","locateParentNode","el","nodeName","parentNode","addBalanceTapped","e","amount","target","getAttribute","showModalInput","_this","answer","parseInt","showModalDialog","_addFunds","query","apiKey","db","find","amountToAdd","currency","notes","callApi","err","response","hasError","window","location","data","redirectionUrl","replace","_showWalletFundingDialog","params","getPageParams","funding","_loadWallet","walletBalance","balance","set","_loadPatientWallet","id","cbfn","userIdOverride","patientWalletBalance","_loadPatientOrganizationWallet","organizationId","patientId","searchString","i","len","patient","ref","matchingPatientList","length","_chargePatient","amountInBdt","error","_chargeOrganizationPatient","arg","context","debug","call"],"mappings":"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","file":"page-like.coffee-compiled.js","sourcesContent":["\r\napp.behaviors.pageLike = [\r\n  {\r\n\r\n    ready: ->\r\n      # @debugInfo 'ready'\r\n      @domHost.pageReady @\r\n\r\n    locateParentNode: (el, nodeName)->\r\n      while el.nodeName isnt nodeName\r\n        el = el.parentNode\r\n      return el\r\n\r\n    # region: wallet - START =============================================\r\n\r\n    # $gte: (a, b)-> a >= b\r\n\r\n    addBalanceTapped: (e)->\r\n      amount = e.target.getAttribute('data-amount') or '100';\r\n      this.domHost.showModalInput \"Enter amount in BDT\", amount, (answer)=>\r\n        if answer\r\n          amount = parseInt answer\r\n          if amount < 10\r\n            this.domHost.showModalDialog \"Insert an amount of 10 or more.\"\r\n            return\r\n          this._addFunds(amount)\r\n          \r\n    _addFunds: (amount)->\r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n        amountToAdd:amount\r\n        currency: 'BDT'\r\n        notes: 'Funding for \"My Tests\"'\r\n      }\r\n      this.domHost.callApi '/bdemr-wallet-add-funds', query, (err, response)=>\r\n        if (not err) and (not response.hasError)\r\n          window.location = response.data.redirectionUrl.replace('//', 'https://')\r\n      \r\n    _showWalletFundingDialog: ->\r\n      params = this.domHost.getPageParams()\r\n      if 'funding' of params\r\n        if params.funding is 'successful'\r\n          this.domHost.showModalDialog \"Thank you for your payment.\"\r\n        else\r\n          this.domHost.showModalDialog \"Something went wrong with your payment. Please try again.\"\r\n\r\n    _loadWallet: ->\r\n      # this._showWalletFundingDialog()\r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n      }\r\n      this.domHost.callApi '/bdemr-wallet-get-balance-and-transaction-details', query, (err, response)=>\r\n        console.log(response)\r\n        if (not err) and (not response.hasError)\r\n          this.walletBalance = response.data.balance\r\n        else\r\n          this.walletBalance = -1;\r\n        this.domHost.set('walletBalance',this.walletBalance)\r\n\r\n    _loadPatientWallet: (id, cbfn)->\r\n      # this._showWalletFundingDialog()\r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n        userIdOverride: id\r\n      }\r\n      this.domHost.callApi '/bdemr-wallet-get-balance-and-transaction-details', query, (err, response)=>\r\n        console.log(response)\r\n        if (not err) and (not response.hasError)\r\n          this.patientWalletBalance = response.data.balance\r\n        else\r\n          this.patientWalletBalance = -1;\r\n        this.domHost.set('patientWalletBalance',this.patientWalletBalance)\r\n        cbfn() if cbfn\r\n\r\n    _loadPatientOrganizationWallet: (organizationId, patientId, cbfn)->   \r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n        organizationId\r\n        searchString: ''\r\n      }\r\n      this.domHost.callApi '/bdemr-organization-list-patient', query, (err, response)=>\r\n        unless response.data\r\n          return cbfn null\r\n        for patient in response.data.matchingPatientList\r\n          if patient.patientId is patientId\r\n            cbfn patient\r\n            return\r\n        cbfn null\r\n\r\n    # _chargeUser: (amount, purpose, cbfn)->\r\n    #   query = {\r\n    #     apiKey: (app.db.find 'user')[0].apiKey\r\n    #     amountInBdt: amount\r\n    #     notes: purpose\r\n    #   }\r\n    #   this.domHost.callApi '/bdemr-wallet-charge-user', query, (err, response)=>\r\n    #     if (err)\r\n    #       return cbfn err\r\n    #     if response.hasError\r\n    #       return cbfn response.error\r\n    #     return cbfn()\r\n\r\n    _chargePatient: (patientId, amount, notes, cbfn)->\r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n        amountInBdt: amount\r\n        notes\r\n        userIdOverride: patientId\r\n      }\r\n      this.domHost.callApi '/bdemr-wallet-charge-user', query, (err, response)=>\r\n        if (err)\r\n          return cbfn err\r\n        if response.hasError\r\n          return cbfn response.error\r\n        return cbfn()\r\n\r\n    _chargeOrganizationPatient: ({patientId, amount, notes, context, organizationId, cbfn})->\r\n      query = {\r\n        apiKey: (app.db.find 'user')[0].apiKey\r\n        amountInBdt: amount\r\n        notes\r\n        context\r\n        organizationId\r\n        userIdOverride: patientId\r\n      }\r\n      this.domHost.callApi '/bdemr-wallet-charge-user', query, (err, response)=>\r\n        if (err)\r\n          return cbfn err\r\n        if response.hasError\r\n          return cbfn response.error\r\n        return cbfn()\r\n\r\n    # region: end - START =============================================\r\n\r\n    # navigatedIn: ->\r\n    #   @debugInfo 'navigatedIn'\r\n\r\n    # navigatedOut: ->\r\n    #   @debugInfo 'navigatedOut'\r\n\r\n\r\n  }\r\n  , app.behaviors.debug\r\n]","(function() {\n  app.behaviors.pageLike = [\n    {\n      ready: function() {\n        return this.domHost.pageReady(this);\n      },\n      locateParentNode: function(el, nodeName) {\n        while (el.nodeName !== nodeName) {\n          el = el.parentNode;\n        }\n        return el;\n      },\n      addBalanceTapped: function(e) {\n        var amount;\n        amount = e.target.getAttribute('data-amount') || '100';\n        return this.domHost.showModalInput(\"Enter amount in BDT\", amount, (function(_this) {\n          return function(answer) {\n            if (answer) {\n              amount = parseInt(answer);\n              if (amount < 10) {\n                _this.domHost.showModalDialog(\"Insert an amount of 10 or more.\");\n                return;\n              }\n              return _this._addFunds(amount);\n            }\n          };\n        })(this));\n      },\n      _addFunds: function(amount) {\n        var query;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey,\n          amountToAdd: amount,\n          currency: 'BDT',\n          notes: 'Funding for \"My Tests\"'\n        };\n        return this.domHost.callApi('/bdemr-wallet-add-funds', query, (function(_this) {\n          return function(err, response) {\n            if ((!err) && (!response.hasError)) {\n              return window.location = response.data.redirectionUrl.replace('//', 'https://');\n            }\n          };\n        })(this));\n      },\n      _showWalletFundingDialog: function() {\n        var params;\n        params = this.domHost.getPageParams();\n        if ('funding' in params) {\n          if (params.funding === 'successful') {\n            return this.domHost.showModalDialog(\"Thank you for your payment.\");\n          } else {\n            return this.domHost.showModalDialog(\"Something went wrong with your payment. Please try again.\");\n          }\n        }\n      },\n      _loadWallet: function() {\n        var query;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey\n        };\n        return this.domHost.callApi('/bdemr-wallet-get-balance-and-transaction-details', query, (function(_this) {\n          return function(err, response) {\n            console.log(response);\n            if ((!err) && (!response.hasError)) {\n              _this.walletBalance = response.data.balance;\n            } else {\n              _this.walletBalance = -1;\n            }\n            return _this.domHost.set('walletBalance', _this.walletBalance);\n          };\n        })(this));\n      },\n      _loadPatientWallet: function(id, cbfn) {\n        var query;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey,\n          userIdOverride: id\n        };\n        return this.domHost.callApi('/bdemr-wallet-get-balance-and-transaction-details', query, (function(_this) {\n          return function(err, response) {\n            console.log(response);\n            if ((!err) && (!response.hasError)) {\n              _this.patientWalletBalance = response.data.balance;\n            } else {\n              _this.patientWalletBalance = -1;\n            }\n            _this.domHost.set('patientWalletBalance', _this.patientWalletBalance);\n            if (cbfn) {\n              return cbfn();\n            }\n          };\n        })(this));\n      },\n      _loadPatientOrganizationWallet: function(organizationId, patientId, cbfn) {\n        var query;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey,\n          organizationId: organizationId,\n          searchString: ''\n        };\n        return this.domHost.callApi('/bdemr-organization-list-patient', query, (function(_this) {\n          return function(err, response) {\n            var i, len, patient, ref;\n            if (!response.data) {\n              return cbfn(null);\n            }\n            ref = response.data.matchingPatientList;\n            for (i = 0, len = ref.length; i < len; i++) {\n              patient = ref[i];\n              if (patient.patientId === patientId) {\n                cbfn(patient);\n                return;\n              }\n            }\n            return cbfn(null);\n          };\n        })(this));\n      },\n      _chargePatient: function(patientId, amount, notes, cbfn) {\n        var query;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey,\n          amountInBdt: amount,\n          notes: notes,\n          userIdOverride: patientId\n        };\n        return this.domHost.callApi('/bdemr-wallet-charge-user', query, (function(_this) {\n          return function(err, response) {\n            if (err) {\n              return cbfn(err);\n            }\n            if (response.hasError) {\n              return cbfn(response.error);\n            }\n            return cbfn();\n          };\n        })(this));\n      },\n      _chargeOrganizationPatient: function(arg) {\n        var amount, cbfn, context, notes, organizationId, patientId, query;\n        patientId = arg.patientId, amount = arg.amount, notes = arg.notes, context = arg.context, organizationId = arg.organizationId, cbfn = arg.cbfn;\n        query = {\n          apiKey: (app.db.find('user'))[0].apiKey,\n          amountInBdt: amount,\n          notes: notes,\n          context: context,\n          organizationId: organizationId,\n          userIdOverride: patientId\n        };\n        return this.domHost.callApi('/bdemr-wallet-charge-user', query, (function(_this) {\n          return function(err, response) {\n            if (err) {\n              return cbfn(err);\n            }\n            if (response.hasError) {\n              return cbfn(response.error);\n            }\n            return cbfn();\n          };\n        })(this));\n      }\n    }, app.behaviors.debug\n  ];\n\n}).call(this);\n"]}