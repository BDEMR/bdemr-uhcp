<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><dom-module id="page-patient-editor">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
      }

      .patient-info-card-counter {
        margin-top: 20px;
        margin-left: 20px;
        margin-right: 10px;
        color: #777777;
      }

      .patient-info-cards {
        @apply(--layout-vertical);
        /*@apply(--layout-center);*/
        margin-top: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-bottom: 20px;
      }

      .patient-info-cards .row {
        margin-left: 10px;
        /*margin-right: 10px;*/
        margin-top: 10px;
      }

      .patient-info-cards .hr {
        margin-left: 20px;
        margin-right: 20px;
        height: 1px;
        /*width: 100px;*/
        background: #dddddd;
      }

      .patient-info-cards .row .modifier {
        font-size: 14px;
        background: #000000;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .patient-info-cards .row .modifier.online {
        background: #757575;
      }

      .patient-info-cards .row .modifier.local-only {
        background: #039BE5;
      }

      .patient-info-cards .row .modifier.locally-updated {
        background: #009688;
      }

      .patient-info-cards .row .modifier.imported {
        background: #4CAF50;
      }

      /*.info-row {
        margin-top: 10px;
      }*/

      .top-info-row {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .serial-number {
        background: #37474F;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
      }

      .address1 {
        margin-right: 10px;
      }

      .break-on-tablet {
        @apply(--layout-horizontal);
      }

      @media screen and (max-width: 740px) {
        .break-on-tablet {
          display: block;
        }
      }

      .val {
        text-decoration: underline;
      }

      .custom-input {
        margin-left: 8px;
        margin-right: 8px;
        width: calc(100% - 16px);
      }

      @media screen and (min-width: 656px) {
        .custom-input {
          width: calc(50% - 16px);
        }
      }

      @media screen and (min-width: 976px) {
        .custom-input {
          width: calc(33.33333% - 16px);
        }
      }

      .custom-checkbox {
        width: calc(100% - 16px);
        margin-left: 8px;
        margin-right: 8px;
      }

      @media screen and (min-width: 656px) {
        .custom-checkbox {
          width: calc(50% - 16px);
        }
      }

      @media screen and (min-width: 976px) {
        .custom-checkbox {
          width: calc(33.33333% - 16px);
        }
      }

      .card-custom-header {
        padding: 8px;
        /*border-bottom: 1px solid var(--paper-grey-200);*/
        background-color: var(--paper-grey-50);
      }

      .deep {
        background-color: var(--paper-grey-200);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        color: var(--brand-primary-color);
      }

      vaadin-combo-box ::content paper-input-container {
        padding: 8px 0;
      }

      .custom-radio-button-group {
        margin: 8px;
        width: calc(100% - 16px);
      }

      @media screen and (min-width: 656px) {
        .custom-radio-button-group {
          width: calc(50% - 16px);
        }
      }

      @media screen and (min-width: 976px) {
        .custom-radio-button-group {
          width: calc(33.33333% - 16px);
        }
      }

      .btn-add {
        min-width: 3em;
      }

      .custom-item {
        padding: 6px 12px;
        border-radius: 6px;
        margin: 6px 4px;
        border: 1px solid #dadada;
        background-color: #fff
      }

      .full-width {
        width: calc(100% - 16px) !important;
      }

      .profile-image {
        height: 78px;
        width: 78px;
        border-radius: 50%;
        border: 2px solid #f7f7f7;
      }

      .card-item {
        border-radius: 6px;
        margin: 4px;
        border: 1px solid #eee;
        background-color: #fff;
      }

      .btn-add {
        min-width: 0;
        padding-top: 0.5em;
        padding-bottom: 0.5em;
        background-color: #eceff1;
        color: rgba(0, 0, 0, .87);
      }

      .btn-add.small {
        margin: 3px;
        font-size: 14px;
      }

      .custom-label {
        padding: 4px 8px;
        border: 1px solid #dadada;
        border-radius: 6px;
        margin: 8px;
        /*background-color: #f7f7f7;*/
        width: calc(100% - 26px);
      }

      @media screen and (min-width: 656px) {
        .custom-label {
          width: calc(50% - 26px);
        }
      }

      @media screen and (min-width: 976px) {
        .custom-label {
          width: calc(33.33333% - 26px);
        }
      }

      .bg-gray {
        padding: 3px 6px;
        display: table;
      }

      .custom-input ::content paper-input-container [suffix] {
        color: rgba(0, 0, 0, .54) !important;
      }

      .text-bold {
        font-weight: 500;
        color: rgba(0, 0, 0, .87);
      }
    </style>

    <!-- local DOM -->
    <div class="master-container">

      <div class="limiting-container">

        <paper-card>
          <!-- patient details - start -->
          <div class="card-item p-8">
            <div class="horizontal layout wrap center">
              <iron-image class="profile-image m-right-8" src$="[[$getProfileImage(patient.profileImage)]]" preload="" sizing="cover"></iron-image>

              <div class="flex">
                <div class="m-horizontal-4 horizontal layout center wrap">
                  <div class="type body-lead capitalize">{{$getFullName(patient.name)}}</div>
                  <div class="m-left-8 type caption bg-gray">{{patient.serial}}</div>
                </div>
                <div class="type body p-horizontal-4">
                  <span class="text-bold">Registerd Number: </span>{{patient.phone}}</div>
                <div class="horizontal layout wrap type caption-2">

                  <template is="dom-if" if="[[!patient.isForOrganizationOnly]]">

                    <div class="m-horizontal-4">
                      <span class="text-bold">Sex: </span>
                      <span>{{patient.gender}}</span>
                    </div>
                    <div class="m-horizontal-4">
                      <span class="text-bold">Age: </span>
                      <span>[[_computeAge(patient.dateOfBirth)]] years </span>
                    </div>
                    <div class="m-horizontal-4">
                      <span class="text-bold">Blood Group: </span>
                      <span> [[patient.bloodGroup]]</span>
                    </div>
                    <div class="m-horizontal-4">
                      <span class="text-bold">Allergy: </span>
                      <span>[[patient.allergy]] </span>
                    </div>
                  </template>

                </div>
              </div>
            </div>
          </div>
          <!-- patient details - end -->

          <div class="card-item p-8">
            <div class="type body-lead primary m-horizontal-4">Basic</div>

            <div class="layout horizontal wrap">
              <paper-input class="custom-input" label="Name" value="{{patient.name}}"></paper-input>
              <paper-dropdown-menu class="custom-input" label="Gender" value="{{patient.gender}}">
                <paper-listbox attr-for-selected="item-name" selected="{{patient.gender}}" class="dropdown-content">
                  <paper-item item-name="Male">Male</paper-item>
                  <paper-item item-name="Female">Female</paper-item>
                </paper-listbox>
              </paper-dropdown-menu>
            </div>


            <div class="layout horizontal wrap">
              <vaadin-date-picker class="custom-input" value="{{patient.dateOfBirth}}" label="Date of Birth"></vaadin-date-picker>
              <paper-input class="custom-input" value="[[_computeAge(patient.dateOfBirth)]]" label="Years" disabled=""></paper-input>
            </div>


          </div>

          <!-- basic - start -->
          <div class="card-item p-8">
            <div class="type body-lead primary m-horizontal-4">General</div>

            <paper-input class="custom-input full-width" type="number" value="{{patient.nationalIdCardNumber}}" label="National ID"></paper-input>

            <!-- <paper-input class="custom-input full-width" value="{{patient.email}}" label="Email Address" pattern="^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$"
              auto-validate error-message="Valid Email Address Required"></paper-input> -->

            <paper-input type="number" class="custom-input full-width" value="{{patient.numberOfFamilyMember}}" label="Number of Family Member"></paper-input>


            <div class="horizontal layout wrap">
              <paper-dropdown-menu class="custom-input" label="Blood Group" value="{{patient.bloodGroup}}">
                <paper-listbox attr-for-selected="item-name" selected="{{patient.bloodGroup}}" class="dropdown-content">
                  <paper-item item-name="A+">A+</paper-item>
                  <paper-item item-name="A-">A-</paper-item>
                  <paper-item item-name="B+">B+</paper-item>
                  <paper-item item-name="B-">B-</paper-item>
                  <paper-item item-name="O+">O+</paper-item>
                  <paper-item item-name="O-">O-</paper-item>
                  <paper-item item-name="AB+">AB+</paper-item>
                  <paper-item item-name="AB-">AB-</paper-item>
                </paper-listbox>
              </paper-dropdown-menu>
              <paper-input type="text" class="flex custom-input" value="{{patient.allergy}}" label="Allergy"></paper-input>
            </div>
            <div class="horizontal layout">
              <paper-input type="text" class="custom-input" value="{{patient.patientSpouseName}}" label="Spouse Name"></paper-input>
              <paper-input type="text" class="custom-input" value="{{patient.patientFatherName}}" label="Father's Name"></paper-input>
              <paper-input type="text" class="custom-input" value="{{patient.patientMotherName}}" label="Mother's Name"></paper-input>
            </div>
            <div class="horizontal layout wrap">
              <vaadin-combo-box class="custom-input" label="Monthly Expenditure" items="{{expenditureList}}" allow-custom-value="true" value="{{patient.expenditure}}"></vaadin-combo-box>
              <vaadin-combo-box class="custom-input" label="Profession" items="{{professionList}}" allow-custom-value="true" value="{{patient.profession}}"></vaadin-combo-box>
              <vaadin-combo-box class="custom-input" label="Education" items="{{educationTypeList}}" allow-custom-value="true" value="{{patient.education}}"></vaadin-combo-box>
            </div>
          </div>
          <!-- basic - end -->

          <!-- Policy Info start -->
          <div class="card-item p-8">
            <div class="type body-lead primary m-horizontal-4">Policy Info</div>

            <div class="m-vertical-16">
              <paper-button class="btn btn-primary btn-sm" on-tap="openPolicyModalClicked">
                <iron-icon icon="add"></iron-icon>&nbsp; Add New Policy</paper-button>
            </div>

            <paper-item style="border-bottom: 1px solid #ccc">
              <div class="flex type bold">Number</div>
              <div class="flex-2 type bold">Service Provider</div>
              <div class="flex type bold">Start Date</div>
              <div class="flex type bold">End Date</div>
              <div class="flex type bold">Action</div>
            </paper-item>
            <template is="dom-if" if="[[!patient.policyList.length]]">
              <p class="layout vertical center type secondary">-- No Policy yet --</p>
            </template>
            <template is="dom-repeat" items="[[patient.policyList]]" as="policy">
              <paper-item>
                <div class="flex">[[policy.number]]</div>
                <div class="flex-2">[[policy.insuranceProvider]]</div>
                <div class="flex">[[policy.startDate]]</div>
                <div class="flex">[[policy.endDate]]</div>
                <div class="flex">
                  <paper-icon-button icon="create" on-tap="editPolicyClicked"></paper-icon-button>
                  <paper-icon-button icon="delete" on-tap="deletePolicyClicked"></paper-icon-button>
                </div>
              </paper-item>
            </template>
          </div>
          <!-- Policy Info End -->

          <!-- Contact Address - start -->
          <div class="card-item p-8">
            <div class="type body-lead primary m-horizontal-4">Contact Address</div>
            <paper-input class="custom-input full-width" value="{{patient.addressList.0.addressLine1}}" label="Address Line 1"></paper-input>
            <paper-input class="custom-input full-width" value="{{patient.addressList.0.addressLine2}}" label="Address Line 2"></paper-input>

            <div class="horizontal layout wrap">

              <paper-dropdown-menu class="custom-input" label="Division" value="{{patient.addressList.0.addressDivision}}">
                <paper-listbox class="dropdown-content" on-iron-select="onDivisionChange" selected="{{divisionIndex}}">
                  <template is="dom-repeat" items="[[divisionList]]">
                    <paper-item>{{item.divisionName}}</paper-item>
                  </template>
                </paper-listbox>
              </paper-dropdown-menu>

              <template is="dom-if" if="[[!_isEmpty(districtList.length)]]">
                <paper-dropdown-menu class="custom-input" label="District" value="{{patient.addressList.0.addressDistrict}}">
                  <paper-listbox class="dropdown-content" selected="[[districtIndex]]">
                    <template is="dom-repeat" items="[[districtList]]">
                      <paper-item>{{item}}</paper-item>
                    </template>
                  </paper-listbox>
                </paper-dropdown-menu>
              </template>

              <!-- <paper-input class="flex custom-input" value="{{patient.addressList.0.addressDistrict}}" label="Disctrict"></paper-input> -->
              <paper-input class="custom-input" value="{{patient.addressList.0.subdistrictName}}" label="Thana/Sub Disctrict"></paper-input>

            </div>

            <paper-input class="custom-input full-width" value="{{patient.addressList.0.addressCountry}}" label="Country"></paper-input>

            <div class="horizontal layout end-justified p-8">
              <paper-toggle-button class="m-left-16" checked="{{hideMoreAddressInput}}">More Address options</paper-toggle-button>
            </div>

            <div class="horizontal layout wrap" hidden$="[[!hideMoreAddressInput]]">
              <paper-input class="custom-input" value="{{patient.addressList.0.addressAreaName}}" label="Area"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.flat}}" label="Flat"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.floor}}" label="Floor"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.plot}}" label="Plot"></paper-input>

              <paper-input class="custom-input" value="{{patient.addressList.0.block}}" label="Block"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.road}}" label="Road"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.village}}" label="Village"></paper-input>

              <paper-input class="custom-input" value="{{patient.addressList.0.addressUnion}}" label="Union"></paper-input>

              <paper-input type="number" class="custom-input" value="{{patient.addressList.0.addressPostalOrZipCode}}" label="Postal/Zip Code"></paper-input>
              <paper-input class="custom-input" value="{{patient.addressList.0.addressCityOrTown}}" label="City/Town"></paper-input>

              <paper-input class="custom-input" value="{{patient.addressList.0.stateOrProvince}}" label="State/Province"></paper-input>
            </div>


          </div>
          <!-- Contact Address - end -->

          <!-- Employment Info start -->
          <div class="card-item p-8">
            <div class="type body-lead primary m-horizontal-4">Employment Info</div>
            <paper-input label="Current Position/Designation" value="{{patient.employmentInfo.currentPosition}}"></paper-input>
            <paper-input label="Department" value="{{patient.employmentInfo.department}}"></paper-input>
            <paper-input label="Salary" value="{{patient.employmentInfo.salary}}" type="number"></paper-input>
            <vaadin-date-picker label="Joining Date" value="{{patient.employmentInfo.joiningDate}}"></vaadin-date-picker>
            <vaadin-date-picker label="Termination Date" value="{{patient.employmentInfo.terminationDate}}"></vaadin-date-picker>
            <paper-input label="Institution Name" value="{{patient.employmentInfo.institutionName}}"></paper-input>
            <paper-input label="Institution Address" value="{{patient.employmentInfo.institutionAddres}}"></paper-input>
          </div>
          <!-- Employment Info end -->

        </paper-card>



        <paper-dialog id="policyModal">
          <h2>Add Policy</h2>
          <paper-dialog-scrollable>
            <div class="layout vertical p-16">
              <paper-input required="" auto-validate="" error-message="input policy number" label="Policy Number" value="{{policy.number}}"></paper-input>
              <paper-input required="" auto-validate="" error-message="input insurance provider name" label="Insurance Provider" value="{{policy.insuranceProvider}}"></paper-input>
              <vaadin-date-picker required="" label="Policy Start Date" value="{{policy.startDate}}"></vaadin-date-picker>
              <vaadin-date-picker required="" label="Policy End Date" value="{{policy.endDate}}"></vaadin-date-picker>
            </div>
          </paper-dialog-scrollable>
          <div class="buttons">
            <paper-button dialog-dismiss="">Cancel</paper-button>
            <paper-button on-tap="addPolicyButtonClicked" autofocus="">Add</paper-button>
          </div>
        </paper-dialog>


      </div>
    </div>



  </template>
  <script>(function(){Polymer({is:"page-patient-editor",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling],properties:{EDIT_MODE_ON:{type:Boolean,notify:!0,value:!1},showPhysicalActivity:{type:String,notify:!0,value:"no"},user:{type:Object,notify:!0,value:null},isPatientValid:{type:Boolean,notify:!0,value:!1},patient:{type:Object,notify:!0,value:null},patientSignupData:{type:Object,notify:!0,value:null},patientAddress:{type:Object,notify:!0,value:null},settings:{type:Object,notify:!0,value:null},selectedPatientInfoPage:{type:Number,notify:!0,value:0},sexSelectedIndex:{type:Number,value:0},genderList:{type:Array,value:function(){return["Male","Female","Other"]}},divisionIndex:{type:Number,value:-1,notify:!0},districtIndex:{type:Number,value:-1,notify:!0},districtList:{type:Array,value:function(){return[]},notify:!0},divisionList:{type:Array,value:function(){return[{divisionName:"Barisal",districtList:["Barguna","Barisal","Bhola","Jhalokati","Patuakhal","Pirojpur"]},{divisionName:"Chittagong",districtList:["Bandarban","Brahmanbaria","Chandpur","Chittagong","Comilla","Cox's Bazar","Feni","Khagrachhari","Lakshmipur","Noakhali","Rangamati"]},{divisionName:"Dhaka",districtList:["Dhaka","Faridpur","Gazipur","Gopalganj","Kishoreganj","Madaripur","Manikganj","Munshiganj","Narayanganj","Narsingdi","Rajbari","Shariatpur","Tangail "]},{divisionName:"Khulna",districtList:["Bagerhat","Chuadanga","Jessore","Jhenaidah","Khulna","Kushtia","Magura","Meherpur","Narail","Satkhira"]},{divisionName:"Mymensingh",districtList:["Jamalpur","Mymensingh","Netrakona","Sherpur"]},{divisionName:"Rajshahi",districtList:["Bogra","Joypurhat","Naogaon","Natore","Nawabganj","Pabna","Rajshahi","Sirajganj"]},{divisionName:"Rangpur",districtList:["Dinajpur","Gaibandha","Kurigram","Lalmonirhat","Nilphamari","Panchagarh","Rangpur","Thakurgaon"]},{divisionName:"Sylhet",districtList:["Habiganj","Moulvibazar","Sunamganj","Sylhet"]}]}},organization:{type:Object,notify:!0,value:null},policy:{type:Object,value:function(){return{}}},professionList:{type:Array,value:function(){return["Govt. employee","Non Govt. employye","Self employed","Student","House wife","Retired","Unemployed","Others"]}},expenditureList:{type:Array,value:function(){return["bellow 10,000","10,000-20,000","20,000-30,000","30,000-40,000","40,000-50,000","50,000 & Above"]}},maritalStatusList:{type:Array,value:function(){return["Married","Unmarried","Divorced","Widowed","Widower","Separated"]}},educationTypeList:{type:Array,value:function(){return["No Education","Primary","Secondary","College","Undergraduate","Post-Graduate"]}}},_compareFn:function(t,e,i){return"<"===e?t<i:">"===e?t>i:"=="===e?t===i:">="===e?t>=i:"<="===e?t<=i:"!="===e?t!==i:void 0},_showComputedWestHipRatio:function(t,e){return t/e},_returnSerial:function(t){return t+1},_isEmpty:function(t){return 0===t},_loadUser:function(){var t;if(t=app.db.find("user"),1===t.length)return this.user=t[0]},arrowBackButtonPressed:function(t){return this.domHost.navigateToPreviousPage()},saveButtonPressed:function(t){return this.patient.name=this.$makeNameObject(this.patient.name),this.patient.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("patient-list",this.patient,function(t){return function(e){var i;return i=e.serial,t.patient.serial===i}}(this)),this._callBDEMRPatientDetailsUpdateApi(this.patient,function(t){return function(){return t.domHost.showToast("Patient Details Updated!"),t.arrowBackButtonPressed()}}(this))},$findCreator:function(t){return"me"},_computeAge:function(t){var e,i,a,n;return n=new Date,i=new Date(t),e=n.getFullYear()-i.getFullYear(),a=n.getMonth()-i.getMonth(),(a<0||0===a&&n.getDate()<i.getDate())&&e--,e},_makePatientSignUp:function(){return this.patient={name:"",password:"123456",email:"",phone:"",additionalPhoneNumber:null,dateOfBirth:lib.datetime.mkDate(lib.datetime.now()),effectiveRegion:"Bangladesh",doctorAccessPin:"0000",nationalIdCardNumber:null,addressList:[{addressTitle:"Personal",addressType:"personal",flat:null,floor:null,plot:null,block:null,road:null,village:null,addressUnion:null,subdistrictName:null,addressDistrict:null,addressPostalOrZipCode:null,addressCityOrTown:null,addressDivision:null,addressAreaName:null,addressLine1:null,addressLine2:null,stateOrProvince:null,addressCountry:"Bangladesh"}],gender:"",bloodGroup:"",allergy:"",expenditure:null,profession:null,patientSpouseName:"",patientFatherName:"",patientMotherName:"",maritalAge:"",maritalStatus:"",numberOfFamilyMember:"",numberOfChildren:"",education:null,employmentInfo:{},policyList:[],belongOrganizationList:[{organizationId:null,patientIdbyOrganization:null}]}},onDivisionChange:function(t){var e;return this.set("districtIndex",-1),e=this.divisionList[this.divisionIndex].districtList,lib.util.delay(5,function(t){return function(){return t.set("districtList",e)}}(this))},_loadPatient:function(t,e){var i,a;return i=app.db.find("patient-list",function(e){var i;return i=e.serial,i===t}),1===i.length?(this.isPatientValid=!0,a=i[0],a.name=this.$getFullName(a.name),a.employmentInfo=a.employmentDetailsList[0]||{},this.set("patient",a)):this._notifyInvalidPatient(),e()},_notifyInvalidPatient:function(){return this.isPatientValid=!1,this.domHost.showModalDialog("Invalid Patient Provided")},getDefaultPasswordForPatientSignup:function(){return"123456"},createOrganizationSerialForPatient:function(t,e){var i,a,n;return n=t,a=n.match(/\b(\w)/g),i=a.join(""),i+e},calculateAge:function(t){var e,i,a,n;return a=t.detail.value,n=new Date(a).getFullYear(),i=(new Date).getFullYear(),e=i-n,this.ageInYears=e},makeDOBFromYears:function(t){var e,i;return e=t.target.value,i=(new Date).getFullYear(),i-=parseInt(e),this.set("patient.dateOfBirth",i+"-01-01")},printButtonPressed:function(t){return window.print()},navigatedIn:function(){var t;return this.selectedPatientInfoPage=0,t=this.domHost.getPageParams(),this.organization=this.getCurrentOrganization(),this.organization||this.domHost.navigateToPage("#/select-organization"),this._loadUser(),this.settings=this._getSettings(),"new"===t.patient?(this._makePatientSignUp(),this.isPatientValid=!0):this._loadPatient(t.patient,function(t){return function(){return t.set("EDIT_MODE_ON",!0)}}(this))},standardPatientSignupPressed:function(t){var e;return this.patient.name&&this.patient.password&&this.patient.phone?(e=this.patient,e.name=this._makeNameObject(e.name),e.belongOrganizationList[0].organizationId=this.organization.idOnServer,this._callBDEMRPatientSignupApi(e)):void this.domHost.showToast("Please Fill Up Required Information")},_callBDEMRPatientSignupApi:function(t){var e;return e={patient:t,apiKey:this.user.apiKey},this.callApi("/bdemr-birdem-patient-registration",e,function(e){return function(i,a){return a.hasError?e.domHost.showModalDialog(a.error.message):(e.domHost.showModalDialog("Patient Created Successfully!"),e.domHost.navigateToPage("#/patient-manager/query:"+t.phone))}}(this))},updatePatientDetails:function(t){var e;return this.patient.name&&this.patient.dateOfBirth?(this.patient.gender=this.genderList[this.sexSelectedIndex],e=this.patient,e.name=this._makeNameObject(e.name),app.db.upsert("patient-list",e,function(t){return function(t){var i;return i=t.serial,e.serial===i}}(this)),this._callBDEMRPatientDetailsUpdateApi(e)):void this.domHost.showToast("Please Fill Up Required Information")},_importPatient:function(t,e,i){return this.callApi("/bdemr-patient-import-new",{serial:t,pin:e,doctorName:this.user.name,organizationId:this.organization.idOnServer},function(t){return function(e,a){var n,r,s,o;return a.hasError?t.domHost.showModalDialog(a.error.message):(o=a.data,1!==o.length?t.domHost.showModalDialog("Unknown error occurred."):(s=o[0],r=app.db.find("patient-list",function(t){var e;return e=t.serial,e===s.serial})[0]._id,r&&app.db.remove("patient-list",r),s.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},s.flags.isImported=!0,t.domHost.setCurrentPatientsDetails(s),n=app.db.insert("patient-list",s),i(n)))}}(this))},_callBDEMRPatientDetailsUpdateApi:function(t,e){var i;return i={patient:t,apiKey:this.user.apiKey},this.callApi("/bdemr-patient-details-update",i,function(t){return function(i,a){return a.hasError?t.domHost.showModalDialog(a.error.message):e()}}(this))},_makeSettings:function(){return this.settings={createdByUserSerial:this.user.serial,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:null,serial:this.user.serial,printDecoration:{leftSideLine1:"My Institution",leftSideLine2:"My Institution Address",leftSideLine3:"My Institution Contact",rightSideLine1:"My Name",rightSideLine2:"My Degrees",rightSideLine3:"My Contact",fullVisitHeadline:"Print Full Visit/Discharge Certificate",footerLine:"A simple message on the bottom",logoDataUri:null},billingTargetEmailAddress:"",nsqipTargetEmailAddress:"",monetaryUnit:"BDT",otherSettings:{patientSignUpDefaultPassword:"123456"}}},_getSettings:function(){var t,e;return t=app.db.find("settings"),e=0===t.length?this._makeSettings():t[0]},_saveSettings:function(){return this.settings.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("settings",this.settings,function(t){return function(e){var i;return i=e.serial,t.settings.serial===i}}(this))},_generateRandomString:function(){var t,e,i;for(i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<255;)i+=e.charAt(Math.floor(Math.random()*e.length)),t++;return i},createOfflinePatient:function(t){var e;return e={},e={name:(t.name.first+" "+(t.name.middle||"")+" "+(t.name.last||"")).replace("  "," "),serial:t.serial,idOnServer:"Unregistered",source:"local",lastSyncedDatetimeStamp:0,lastModifiedDatetimeStamp:lib.datetime.mkDate(lib.datetime.now()),createdDatetimeStamp:lib.datetime.mkDate(lib.datetime.now()),createdByUserSerial:this.user.serial,email:t.phone,phone:t.email,address:{line1:t.addressList[0].addressLine1,line2:t.addressList[0].addressLine2,postalCode:t.addressList[0].addressPostalOrZipCode,cityOrTown:t.addressList[0].addressCityOrTown,stateOrProvince:t.addressList[0].stateOrProvince,country:t.addressList[0].addressCountry},dob:t.dateOfBirth,nIdOrSsn:""+(t.nationalIdCardNumber||""),doctorsPrivateNote:""+(t.doctorQuickNotes||""),hospitalNumber:""+(t.hospitalSerial||""),initialVisitDate:""+(t.patientInitialVisitDate||""),lastVisitDate:""+(t.lastVisitDate||""),admissionDate:""+(t.admissionDate||"")},app.db.insert("patient-list",e)},_savePatientOfflineSignupDetails:function(t){return t.serial=this.generateSerialForPatient(),app.db.insert("unregsitered-patient-details",t),this.domHost.showModalDialog("Patient Registered Successfully Offline."),this.createOfflinePatient(t),this._makePatientSignUp(),this.domHost.navigateToPage("#/patient-manager/unregsiterd:"+t.phone)},networkCheck:function(){var t;return t=!!navigator.onLine},_makeNameObject:function(t){var e,i,a,n,r,s,o;return"string"==typeof t?(t=t.trim(),o=t.split("."),s=o.pop(),i=0===o.length?"":o.join(".").trim(),o=s.trim().split(" "),r={},o.length<=1?e=o[0]:(e=o.shift(),a=o.pop(),n=o.join(" "),""===n&&(n=null),""===a&&(a=null)),""===i&&(i=null),r.honorifics=i,r.first=e,r.middle=n,r.last=a,r):t},openPolicyModalClicked:function(){return this.$.policyModal.toggle(),this.policy={}},addPolicyButtonClicked:function(t){this.policy.number&&this.policy.insuranceProvider&&this.policy.startDate&&this.policy.endDate&&(this.patient.policyList?this.push("patient.policyList",this.policy):(this.set("patient.policyList",[]),this.push("patient.policyList",this.policy)),this.policy={},this.$.policyModal.close())},editPolicyClicked:function(t){var e;return e=t.model.index,this.policy=this.patient.policyList[e],this.$.policyModal.toggle()},deletePolicyClicked:function(t){var e;return e=t.model.index,this.splice("patient.policyList",e,1)},navigatedOut:function(){return this.patient=null,this.isPatientValid=!1,this.set("EDIT_MODE_ON",!1)}})}).call(this);
//# sourceMappingURL=page-patient-editor.coffee-compiled.js.map</script>
</dom-module>