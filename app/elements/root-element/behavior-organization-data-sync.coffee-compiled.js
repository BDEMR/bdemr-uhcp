(function(){var e=[].indexOf||function(e){for(var r=0,t=this.length;r<t;r++)if(r in this&&this[r]===e)return r;return-1};app.behaviors.local["root-element"]||(app.behaviors.local["root-element"]={}),app.behaviors.local["root-element"].organizationDataSync={_syncOrganizationData:function(r,t){var a,i,n,o,l,s,d,p,u,c,f,v,h,g,m,b,I,D;if(i=r.collectionName,l=r.deletedCollectionName,p=r.headerApi,o=r.dataApi,b=app.db.find("user")[0],n=b.serial,D=b.idOnServer,a=b.apiKey,h=app.db.find("organization")[0].idOnServer){for(I="root-user",m=this,g=app.db.find(i,function(e){return function(e){var r;return r=e.organizationId,r===r}}(this)),u={},c=0,v=g.length;c<v;c++)f=g[c],u[f.serial]=f.lastModifiedDatetimeStamp;return s=app.db.find(l),d=function(){var e,r,t;for(t=[],e=0,r=s.length;e<r;e++)f=s[e],t.push(f.serial);return t}(),this.callApi(p,{apiKey:a,userId:D,organizationId:h,clientHeaderMap:u,clientDeletedSerialList:d},function(r){return function(n,s){var d,p,u,c,v,g,b,L,S,z;if(s.hasError)return m.showModalDialog(s.error.message);for(u=s.data,d=u.clientNeedsToDelete,z=u.serverHasDeleted,L=app.db.find(l,function(r){var t;return t=r.serial,e.call(z,t)>=0}),c=0,g=L.length;c<g;c++)f=L[c],app.db.remove(l,f._id);for(L=app.db.find(i,function(r){var t;return t=r.serial,e.call(d,t)>=0}),v=0,b=L.length;v<b;v++)f=L[v],app.db.remove(i,f._id);return S=u.serverHasLatestList,p=app.db.find(i,function(r){var t;return t=r.serial,e.call(u.clientHasLatestList,t)>=0}),r.callApi(o,{organizationId:h,userActiveRoleId:I,apiKey:a,userId:D,clientToServerItemList:p,requestedServerToClientItemList:S},function(e,r){var a,n,o;if(r.hasError)return m.showModalDialog(r.error.message);for(u=r.data,o=u.serverToClientItemList,a=0,n=o.length;a<n;a++)f=o[a],f.lastModifiedDatetimeStamp&&app.db.upsert(i,f,function(e){var r,t;return t=e.serial,r=e.organizationId,f.serial===t&&r===r});return t()})}}(this))}}}}).call(this);
//# sourceMappingURL=behavior-organization-data-sync.coffee-compiled.js.map