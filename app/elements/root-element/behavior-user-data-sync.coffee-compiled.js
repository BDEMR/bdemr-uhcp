(function(){var e=[].indexOf||function(e){for(var r=0,t=this.length;r<t;r++)if(r in this&&this[r]===e)return r;return-1};app.behaviors.local["root-element"]||(app.behaviors.local["root-element"]={}),app.behaviors.local["root-element"].userDataSync={_syncUser:function(r,t){var a,i,n,l,o,s,d,p,u,c,f,v,h,m,b,g,A,S,y;for(i=r.collectionName,o=r.deletedCollectionName,p=r.headerApi,l=r.dataApi,A=app.db.find("user")[0],n=A.serial,y=A.idOnServer,a=A.apiKey,h=app.db.find("organization")[0],h&&(m=h.idOnServer,S=h.isCurrentUserAnAdmin?"root-user":h.hasOwnProperty("userActiveRole")?h.userActiveRole.serial:"root-user"),g=this,b=app.db.find(i),u={},c=0,v=b.length;c<v;c++)f=b[c],u[f.serial]=f.lastModifiedDatetimeStamp;return s=app.db.find(o),d=function(){var e,r,t;for(t=[],e=0,r=s.length;e<r;e++)f=s[e],t.push(f.serial);return t}(),this.callApi(p,{apiKey:a,userId:y,createdByUserSerial:n,clientHeaderMap:u,clientDeletedSerialList:d},function(r){return function(s,d){var p,u,c,v,h,b,A,L,D,I;if(d.hasError)return g.showModalDialog(d.error.message);for(c=d.data,p=c.clientNeedsToDelete,I=c.serverHasDeleted,L=app.db.find(o,function(r){var t;return t=r.serial,e.call(I,t)>=0}),v=0,b=L.length;v<b;v++)f=L[v],app.db.remove(o,f._id);for(L=app.db.find(i,function(r){var t;return t=r.serial,e.call(p,t)>=0}),h=0,A=L.length;h<A;h++)f=L[h],app.db.remove(i,f._id);return D=c.serverHasLatestList,u=app.db.find(i,function(r){var t;return t=r.serial,e.call(c.clientHasLatestList,t)>=0}),r.callApi(l,{organizationId:m,userActiveRoleId:S,apiKey:a,userId:y,createdByUserSerial:n,clientToServerItemList:u,requestedServerToClientItemList:D},function(e,r){var a,n,l;if(r.hasError)return g.showModalDialog(r.error.message);for(c=r.data,l=c.serverToClientItemList,a=0,n=l.length;a<n;a++)f=l[a],app.db.upsert(i,f,function(e){var r;return r=e.serial,f.serial===r});return t()})}}(this))}}}).call(this);
//# sourceMappingURL=behavior-user-data-sync.coffee-compiled.js.map