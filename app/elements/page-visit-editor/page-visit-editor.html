<!-- iron-* --><!-- paper-* --><!-- 3rd party elements --><!-- Custom AutoComplete --><!-- custom-elements --><!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><div hidden="" by-polymer-bundler=""><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script>/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
function MakePromise (asap) {
  function Promise(fn) {
		if (typeof this !== 'object' || typeof fn !== 'function') throw new TypeError();
		this._state = null;
		this._value = null;
		this._deferreds = []

		doResolve(fn, resolve.bind(this), reject.bind(this));
	}

	function handle(deferred) {
		var me = this;
		if (this._state === null) {
			this._deferreds.push(deferred);
			return
		}
		asap(function() {
			var cb = me._state ? deferred.onFulfilled : deferred.onRejected
			if (typeof cb !== 'function') {
				(me._state ? deferred.resolve : deferred.reject)(me._value);
				return;
			}
			var ret;
			try {
				ret = cb(me._value);
			}
			catch (e) {
				deferred.reject(e);
				return;
			}
			deferred.resolve(ret);
		})
	}

	function resolve(newValue) {
		try { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure
			if (newValue === this) throw new TypeError();
			if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {
				var then = newValue.then;
				if (typeof then === 'function') {
					doResolve(then.bind(newValue), resolve.bind(this), reject.bind(this));
					return;
				}
			}
			this._state = true;
			this._value = newValue;
			finale.call(this);
		} catch (e) { reject.call(this, e); }
	}

	function reject(newValue) {
		this._state = false;
		this._value = newValue;
		finale.call(this);
	}

	function finale() {
		for (var i = 0, len = this._deferreds.length; i < len; i++) {
			handle.call(this, this._deferreds[i]);
		}
		this._deferreds = null;
	}

	/**
	 * Take a potentially misbehaving resolver function and make sure
	 * onFulfilled and onRejected are only called once.
	 *
	 * Makes no guarantees about asynchrony.
	 */
	function doResolve(fn, onFulfilled, onRejected) {
		var done = false;
		try {
			fn(function (value) {
				if (done) return;
				done = true;
				onFulfilled(value);
			}, function (reason) {
				if (done) return;
				done = true;
				onRejected(reason);
			})
		} catch (ex) {
			if (done) return;
			done = true;
			onRejected(ex);
		}
	}

	Promise.prototype['catch'] = function (onRejected) {
		return this.then(null, onRejected);
	};

	Promise.prototype.then = function(onFulfilled, onRejected) {
		var me = this;
		return new Promise(function(resolve, reject) {
      handle.call(me, {
        onFulfilled: onFulfilled,
        onRejected: onRejected,
        resolve: resolve,
        reject: reject
      });
		})
	};

	Promise.resolve = function (value) {
		if (value && typeof value === 'object' && value.constructor === Promise) {
			return value;
		}

		return new Promise(function (resolve) {
			resolve(value);
		});
	};

	Promise.reject = function (value) {
		return new Promise(function (resolve, reject) {
			reject(value);
		});
	};

	
  return Promise;
}

if (typeof module !== 'undefined') {
  module.exports = MakePromise;
}

</script>
<script>
if (!window.Promise) {
  window.Promise = MakePromise(Polymer.Base.async);
}
</script>
<!--
iron-request can be used to perform XMLHttpRequests.

    <iron-request id="xhr"></iron-request>
    ...
    this.$.xhr.send({url: url, body: params});
-->
<script>
  'use strict';

  Polymer({
    is: 'iron-request',

    hostAttributes: {
      hidden: true
    },

    properties: {

      /**
       * A reference to the XMLHttpRequest instance used to generate the
       * network request.
       *
       * @type {XMLHttpRequest}
       */
      xhr: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return new XMLHttpRequest();
        }
      },

      /**
       * A reference to the parsed response body, if the `xhr` has completely
       * resolved.
       *
       * @type {*}
       * @default null
       */
      response: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return null;
        }
      },

      /**
       * A reference to the status code, if the `xhr` has completely resolved.
       */
      status: {
        type: Number,
        notify: true,
        readOnly: true,
        value: 0
      },

      /**
       * A reference to the status text, if the `xhr` has completely resolved.
       */
      statusText: {
        type: String,
        notify: true,
        readOnly: true,
        value: ''
      },

      /**
       * A promise that resolves when the `xhr` response comes back, or rejects
       * if there is an error before the `xhr` completes.
       *
       * @type {Promise}
       */
      completes: {
        type: Object,
        readOnly: true,
        notify: true,
        value: function() {
          return new Promise(function (resolve, reject) {
            this.resolveCompletes = resolve;
            this.rejectCompletes = reject;
          }.bind(this));
        }
      },

      /**
       * An object that contains progress information emitted by the XHR if
       * available.
       *
       * @default {}
       */
      progress: {
        type: Object,
        notify: true,
        readOnly: true,
        value: function() {
          return {};
        }
      },

      /**
       * Aborted will be true if an abort of the request is attempted.
       */
      aborted: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false,
      },

      /**
       * Errored will be true if the browser fired an error event from the
       * XHR object (mainly network errors).
       */
      errored: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false
      },

      /**
       * TimedOut will be true if the XHR threw a timeout event.
       */
      timedOut: {
        type: Boolean,
        notify: true,
        readOnly: true,
        value: false
      }
    },

    /**
     * Succeeded is true if the request succeeded. The request succeeded if it
     * loaded without error, wasn't aborted, and the status code is â‰¥ 200, and
     * < 300, or if the status code is 0.
     *
     * The status code 0 is accepted as a success because some schemes - e.g.
     * file:// - don't provide status codes.
     *
     * @return {boolean}
     */
    get succeeded() {
      if (this.errored || this.aborted || this.timedOut) {
        return false;
      }
      var status = this.xhr.status || 0;

      // Note: if we are using the file:// protocol, the status code will be 0
      // for all outcomes (successful or otherwise).
      return status === 0 ||
        (status >= 200 && status < 300);
    },

    /**
     * Sends an HTTP request to the server and returns the XHR object.
     *
     * The handling of the `body` parameter will vary based on the Content-Type
     * header. See the docs for iron-ajax's `body` param for details.
     *
     * @param {{
     *   url: string,
     *   method: (string|undefined),
     *   async: (boolean|undefined),
     *   body: (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object),
     *   headers: (Object|undefined),
     *   handleAs: (string|undefined),
     *   jsonPrefix: (string|undefined),
     *   withCredentials: (boolean|undefined)}} options -
     *     url The url to which the request is sent.
     *     method The HTTP method to use, default is GET.
     *     async By default, all requests are sent asynchronously. To send synchronous requests,
     *         set to false.
     *     body The content for the request body for POST method.
     *     headers HTTP request headers.
     *     handleAs The response type. Default is 'text'.
     *     withCredentials Whether or not to send credentials on the request. Default is false.
     *   timeout: (Number|undefined)
     * @return {Promise}
     */
    send: function (options) {
      var xhr = this.xhr;

      if (xhr.readyState > 0) {
        return null;
      }

      xhr.addEventListener('progress', function (progress) {
        this._setProgress({
          lengthComputable: progress.lengthComputable,
          loaded: progress.loaded,
          total: progress.total
        });
      }.bind(this))

      xhr.addEventListener('error', function (error) {
        this._setErrored(true);
        this._updateStatus();
        this.rejectCompletes(error);
      }.bind(this));

      xhr.addEventListener('timeout', function (error) {
        this._setTimedOut(true);
        this._updateStatus();
        this.rejectCompletes(error);
      }.bind(this));

      xhr.addEventListener('abort', function () {
        this._updateStatus();
        this.rejectCompletes(new Error('Request aborted.'));
      }.bind(this));

      // Called after all of the above.
      xhr.addEventListener('loadend', function () {
        this._updateStatus();
        this._setResponse(this.parseResponse());

        if (!this.succeeded) {
          this.rejectCompletes(new Error('The request failed with status code: ' + this.xhr.status));
          return;
        }

        this.resolveCompletes(this);
      }.bind(this));

      this.url = options.url;
      xhr.open(
        options.method || 'GET',
        options.url,
        options.async !== false
      );

      var acceptType = {
        'json': 'application/json',
        'text': 'text/plain',
        'html': 'text/html',
        'xml': 'application/xml',
        'arraybuffer': 'application/octet-stream'
      }[options.handleAs];
      var headers = options.headers || Object.create(null);
      var newHeaders = Object.create(null);
      for (var key in headers) {
        newHeaders[key.toLowerCase()] = headers[key];
      }
      headers = newHeaders;

      if (acceptType && !headers['accept']) {
        headers['accept'] = acceptType;
      }
      Object.keys(headers).forEach(function (requestHeader) {
        if (/[A-Z]/.test(requestHeader)) {
          Polymer.Base._error('Headers must be lower case, got', requestHeader);
        }
        xhr.setRequestHeader(
          requestHeader,
          headers[requestHeader]
        );
      }, this);

      if (options.async !== false) {
        if (options.async) {
          xhr.timeout = options.timeout;
        }

        var handleAs = options.handleAs;

        // If a JSON prefix is present, the responseType must be 'text' or the
        // browser wonâ€™t be able to parse the response.
        if (!!options.jsonPrefix || !handleAs) {
          handleAs = 'text';
        }

        // In IE, `xhr.responseType` is an empty string when the response
        // returns. Hence, caching it as `xhr._responseType`.
        xhr.responseType = xhr._responseType = handleAs;

        // Cache the JSON prefix, if it exists.
        if (!!options.jsonPrefix) {
          xhr._jsonPrefix = options.jsonPrefix;
        }
      }

      xhr.withCredentials = !!options.withCredentials;


      var body = this._encodeBodyObject(options.body, headers['content-type']);

      xhr.send(
        /** @type {ArrayBuffer|ArrayBufferView|Blob|Document|FormData|
                   null|string|undefined} */
        (body));

      return this.completes;
    },

    /**
     * Attempts to parse the response body of the XHR. If parsing succeeds,
     * the value returned will be deserialized based on the `responseType`
     * set on the XHR.
     *
     * @return {*} The parsed response,
     * or undefined if there was an empty response or parsing failed.
     */
    parseResponse: function () {
      var xhr = this.xhr;
      var responseType = xhr.responseType || xhr._responseType;
      var preferResponseText = !this.xhr.responseType;
      var prefixLen = (xhr._jsonPrefix && xhr._jsonPrefix.length) || 0;

      try {
        switch (responseType) {
          case 'json':
            // If the xhr object doesn't have a natural `xhr.responseType`,
            // we can assume that the browser hasn't parsed the response for us,
            // and so parsing is our responsibility. Likewise if response is
            // undefined, as there's no way to encode undefined in JSON.
            if (preferResponseText || xhr.response === undefined) {
              // Try to emulate the JSON section of the response body section of
              // the spec: https://xhr.spec.whatwg.org/#response-body
              // That is to say, we try to parse as JSON, but if anything goes
              // wrong return null.
              try {
                return JSON.parse(xhr.responseText);
              } catch (_) {
                return null;
              }
            }

            return xhr.response;
          case 'xml':
            return xhr.responseXML;
          case 'blob':
          case 'document':
          case 'arraybuffer':
            return xhr.response;
          case 'text':
          default: {
            // If `prefixLen` is set, it implies the response should be parsed
            // as JSON once the prefix of length `prefixLen` is stripped from
            // it. Emulate the behavior above where null is returned on failure
            // to parse.
            if (prefixLen) {
              try {
                return JSON.parse(xhr.responseText.substring(prefixLen));
              } catch (_) {
                return null;
              }
            }
            return xhr.responseText;
          }
        }
      } catch (e) {
        this.rejectCompletes(new Error('Could not parse response. ' + e.message));
      }
    },

    /**
     * Aborts the request.
     */
    abort: function () {
      this._setAborted(true);
      this.xhr.abort();
    },

    /**
     * @param {*} body The given body of the request to try and encode.
     * @param {?string} contentType The given content type, to infer an encoding
     *     from.
     * @return {*} Either the encoded body as a string, if successful,
     *     or the unaltered body object if no encoding could be inferred.
     */
    _encodeBodyObject: function(body, contentType) {
      if (typeof body == 'string') {
        return body;  // Already encoded.
      }
      var bodyObj = /** @type {Object} */ (body);
      switch(contentType) {
        case('application/json'):
          return JSON.stringify(bodyObj);
        case('application/x-www-form-urlencoded'):
          return this._wwwFormUrlEncode(bodyObj);
      }
      return body;
    },

    /**
     * @param {Object} object The object to encode as x-www-form-urlencoded.
     * @return {string} .
     */
    _wwwFormUrlEncode: function(object) {
      if (!object) {
        return '';
      }
      var pieces = [];
      Object.keys(object).forEach(function(key) {
        // TODO(rictic): handle array values here, in a consistent way with
        //   iron-ajax params.
        pieces.push(
            this._wwwFormUrlEncodePiece(key) + '=' +
            this._wwwFormUrlEncodePiece(object[key]));
      }, this);
      return pieces.join('&');
    },

    /**
     * @param {*} str A key or value to encode as x-www-form-urlencoded.
     * @return {string} .
     */
    _wwwFormUrlEncodePiece: function(str) {
      // Spec says to normalize newlines to \r\n and replace %20 spaces with +.
      // jQuery does this as well, so this is likely to be widely compatible.
      if (str === null) {
        return '';
      }
      return encodeURIComponent(str.toString().replace(/\r?\n/g, '\r\n'))
          .replace(/%20/g, '+');
    },

    /**
     * Updates the status code and status text.
     */
    _updateStatus: function() {
      this._setStatus(this.xhr.status);
      this._setStatusText((this.xhr.statusText === undefined) ? '' : this.xhr.statusText);
    }
  });
</script>
<!--
The `iron-ajax` element exposes network request functionality.

    <iron-ajax
        auto
        url="https://www.googleapis.com/youtube/v3/search"
        params='{"part":"snippet", "q":"polymer", "key": "YOUTUBE_API_KEY", "type": "video"}'
        handle-as="json"
        on-response="handleResponse"
        debounce-duration="300"></iron-ajax>

With `auto` set to `true`, the element performs a request whenever
its `url`, `params` or `body` properties are changed. Automatically generated
requests will be debounced in the case that multiple attributes are changed
sequentially.

Note: The `params` attribute must be double quoted JSON.

You can trigger a request explicitly by calling `generateRequest` on the
element.

@demo demo/index.html
@hero hero.svg
-->

<script>
  'use strict';

  Polymer({

    is: 'iron-ajax',

    /**
     * Fired when a request is sent.
     *
     * @event request
     * @event iron-ajax-request
     */

    /**
     * Fired when a response is received.
     *
     * @event response
     * @event iron-ajax-response
     */

    /**
     * Fired when an error is received.
     *
     * @event error
     * @event iron-ajax-error
     */

    hostAttributes: {
      hidden: true
    },

    properties: {
      /**
       * The URL target of the request.
       */
      url: {
        type: String
      },

      /**
       * An object that contains query parameters to be appended to the
       * specified `url` when generating a request. If you wish to set the body
       * content when making a POST request, you should use the `body` property
       * instead.
       */
      params: {
        type: Object,
        value: function() {
          return {};
        }
      },

      /**
       * The HTTP method to use such as 'GET', 'POST', 'PUT', or 'DELETE'.
       * Default is 'GET'.
       */
      method: {
        type: String,
        value: 'GET'
      },

      /**
       * HTTP request headers to send.
       *
       * Example:
       *
       *     <iron-ajax
       *         auto
       *         url="http://somesite.com"
       *         headers='{"X-Requested-With": "XMLHttpRequest"}'
       *         handle-as="json"></iron-ajax>
       *
       * Note: setting a `Content-Type` header here will override the value
       * specified by the `contentType` property of this element.
       */
      headers: {
        type: Object,
        value: function() {
          return {};
        }
      },

      /**
       * Content type to use when sending data. If the `contentType` property
       * is set and a `Content-Type` header is specified in the `headers`
       * property, the `headers` property value will take precedence.
       *
       * Varies the handling of the `body` param.
       */
      contentType: {
        type: String,
        value: null
      },

      /**
       * Body content to send with the request, typically used with "POST"
       * requests.
       *
       * If body is a string it will be sent unmodified.
       *
       * If Content-Type is set to a value listed below, then
       * the body will be encoded accordingly.
       *
       *    * `content-type="application/json"`
       *      * body is encoded like `{"foo":"bar baz","x":1}`
       *    * `content-type="application/x-www-form-urlencoded"`
       *      * body is encoded like `foo=bar+baz&x=1`
       *
       * Otherwise the body will be passed to the browser unmodified, and it
       * will handle any encoding (e.g. for FormData, Blob, ArrayBuffer).
       *
       * @type (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object)
       */
      body: {
        type: Object,
        value: null
      },

      /**
       * Toggle whether XHR is synchronous or asynchronous. Don't change this
       * to true unless You Know What You Are Doingâ„¢.
       */
      sync: {
        type: Boolean,
        value: false
      },

      /**
       * Specifies what data to store in the `response` property, and
       * to deliver as `event.detail.response` in `response` events.
       *
       * One of:
       *
       *    `text`: uses `XHR.responseText`.
       *
       *    `xml`: uses `XHR.responseXML`.
       *
       *    `json`: uses `XHR.responseText` parsed as JSON.
       *
       *    `arraybuffer`: uses `XHR.response`.
       *
       *    `blob`: uses `XHR.response`.
       *
       *    `document`: uses `XHR.response`.
       */
      handleAs: {
        type: String,
        value: 'json'
      },

      /**
       * Set the withCredentials flag on the request.
       */
      withCredentials: {
        type: Boolean,
        value: false
      },

      /**
       * Set the timeout flag on the request.
       */
      timeout: {
        type: Number,
        value: 0
      },

      /**
       * If true, automatically performs an Ajax request when either `url` or
       * `params` changes.
       */
      auto: {
        type: Boolean,
        value: false
      },

      /**
       * If true, error messages will automatically be logged to the console.
       */
      verbose: {
        type: Boolean,
        value: false
      },

      /**
       * The most recent request made by this iron-ajax element.
       */
      lastRequest: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * True while lastRequest is in flight.
       */
      loading: {
        type: Boolean,
        notify: true,
        readOnly: true
      },

      /**
       * lastRequest's response.
       *
       * Note that lastResponse and lastError are set when lastRequest finishes,
       * so if loading is true, then lastResponse and lastError will correspond
       * to the result of the previous request.
       *
       * The type of the response is determined by the value of `handleAs` at
       * the time that the request was generated.
       *
       * @type {Object}
       */
      lastResponse: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * lastRequest's error, if any.
       *
       * @type {Object}
       */
      lastError: {
        type: Object,
        notify: true,
        readOnly: true
      },

      /**
       * An Array of all in-flight requests originating from this iron-ajax
       * element.
       */
      activeRequests: {
        type: Array,
        notify: true,
        readOnly: true,
        value: function() {
          return [];
        }
      },

      /**
       * Length of time in milliseconds to debounce multiple automatically generated requests.
       */
      debounceDuration: {
        type: Number,
        value: 0,
        notify: true
      },

      /**
       * Prefix to be stripped from a JSON response before parsing it.
       *
       * In order to prevent an attack using CSRF with Array responses
       * (http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx/)
       * many backends will mitigate this by prefixing all JSON response bodies
       * with a string that would be nonsensical to a JavaScript parser.
       *
       */
      jsonPrefix: {
        type: String,
        value: ''
      },

      /**
       * By default, iron-ajax's events do not bubble. Setting this attribute will cause its
       * request and response events as well as its iron-ajax-request, -response,  and -error
       * events to bubble to the window object. The vanilla error event never bubbles when
       * using shadow dom even if this.bubbles is true because a scoped flag is not passed with
       * it (first link) and because the shadow dom spec did not used to allow certain events,
       * including events named error, to leak outside of shadow trees (second link).
       * https://www.w3.org/TR/shadow-dom/#scoped-flag
       * https://www.w3.org/TR/2015/WD-shadow-dom-20151215/#events-that-are-not-leaked-into-ancestor-trees
       */
      bubbles: {
        type: Boolean,
        value: false
      },

      _boundHandleResponse: {
        type: Function,
        value: function() {
          return this._handleResponse.bind(this);
        }
      }
    },

    observers: [
      '_requestOptionsChanged(url, method, params.*, headers, contentType, ' +
          'body, sync, handleAs, jsonPrefix, withCredentials, timeout, auto)'
    ],

    /**
     * The query string that should be appended to the `url`, serialized from
     * the current value of `params`.
     *
     * @return {string}
     */
    get queryString () {
      var queryParts = [];
      var param;
      var value;

      for (param in this.params) {
        value = this.params[param];
        param = window.encodeURIComponent(param);

        if (Array.isArray(value)) {
          for (var i = 0; i < value.length; i++) {
            queryParts.push(param + '=' + window.encodeURIComponent(value[i]));
          }
        } else if (value !== null) {
          queryParts.push(param + '=' + window.encodeURIComponent(value));
        } else {
          queryParts.push(param);
        }
      }

      return queryParts.join('&');
    },

    /**
     * The `url` with query string (if `params` are specified), suitable for
     * providing to an `iron-request` instance.
     *
     * @return {string}
     */
    get requestUrl() {
      var queryString = this.queryString;
      var url = this.url || '';

      if (queryString) {
        var bindingChar = url.indexOf('?') >= 0 ? '&' : '?';
        return url + bindingChar + queryString;
      }

      return url;
    },

    /**
     * An object that maps header names to header values, first applying the
     * the value of `Content-Type` and then overlaying the headers specified
     * in the `headers` property.
     *
     * @return {Object}
     */
    get requestHeaders() {
      var headers = {};
      var contentType = this.contentType;
      if (contentType == null && (typeof this.body === 'string')) {
        contentType = 'application/x-www-form-urlencoded';
      }
      if (contentType) {
        headers['content-type'] = contentType;
      }
      var header;

      if (this.headers instanceof Object) {
        for (header in this.headers) {
          headers[header] = this.headers[header].toString();
        }
      }

      return headers;
    },

    /**
     * Request options suitable for generating an `iron-request` instance based
     * on the current state of the `iron-ajax` instance's properties.
     *
     * @return {{
     *   url: string,
     *   method: (string|undefined),
     *   async: (boolean|undefined),
     *   body: (ArrayBuffer|ArrayBufferView|Blob|Document|FormData|null|string|undefined|Object),
     *   headers: (Object|undefined),
     *   handleAs: (string|undefined),
     *   jsonPrefix: (string|undefined),
     *   withCredentials: (boolean|undefined)}}
     */
    toRequestOptions: function() {
      return {
        url: this.requestUrl || '',
        method: this.method,
        headers: this.requestHeaders,
        body: this.body,
        async: !this.sync,
        handleAs: this.handleAs,
        jsonPrefix: this.jsonPrefix,
        withCredentials: this.withCredentials,
        timeout: this.timeout
      };
    },

    /**
     * Performs an AJAX request to the specified URL.
     *
     * @return {!IronRequestElement}
     */
    generateRequest: function() {
      var request = /** @type {!IronRequestElement} */ (document.createElement('iron-request'));
      var requestOptions = this.toRequestOptions();

      this.push('activeRequests', request);

      request.completes.then(
        this._boundHandleResponse
      ).catch(
        this._handleError.bind(this, request)
      ).then(
        this._discardRequest.bind(this, request)
      );

      request.send(requestOptions);

      this._setLastRequest(request);
      this._setLoading(true);

      this.fire('request', {
        request: request,
        options: requestOptions
      }, {bubbles: this.bubbles});

      this.fire('iron-ajax-request', {
        request: request,
        options: requestOptions
      }, {bubbles: this.bubbles});

      return request;
    },

    _handleResponse: function(request) {
      if (request === this.lastRequest) {
        this._setLastResponse(request.response);
        this._setLastError(null);
        this._setLoading(false);
      }
      this.fire('response', request, {bubbles: this.bubbles});
      this.fire('iron-ajax-response', request, {bubbles: this.bubbles});
    },

    _handleError: function(request, error) {
      if (this.verbose) {
        Polymer.Base._error(error);
      }

      if (request === this.lastRequest) {
        this._setLastError({
          request: request,
          error: error,
          status: request.xhr.status,
          statusText: request.xhr.statusText,
          response: request.xhr.response
        });
        this._setLastResponse(null);
        this._setLoading(false);
      }

      // Tests fail if this goes after the normal this.fire('error', ...)
      this.fire('iron-ajax-error', {
        request: request,
        error: error
      }, {bubbles: this.bubbles});

      this.fire('error', {
        request: request,
        error: error
      }, {bubbles: this.bubbles});
    },

    _discardRequest: function(request) {
      var requestIndex = this.activeRequests.indexOf(request);

      if (requestIndex > -1) {
        this.splice('activeRequests', requestIndex, 1);
      }
    },

    _requestOptionsChanged: function() {
      this.debounce('generate-request', function() {
        if (this.url == null) {
          return;
        }

        if (this.auto) {
          this.generateRequest();
        }
      }, this.debounceDuration);
    },

  });
</script>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->


<!--
Material design: [Tooltips](https://www.google.com/design/spec/components/tooltips.html)

`<paper-tooltip>` is a label that appears on hover and focus when the user
hovers over an element with the cursor or with the keyboard. It will be centered
to an anchor element specified in the `for` attribute, or, if that doesn't exist,
centered to the parent node containing it.

Example:

    <div style="display:inline-block">
      <button>Click me!</button>
      <paper-tooltip>Tooltip text</paper-tooltip>
    </div>

    <div>
      <button id="btn">Click me!</button>
      <paper-tooltip for="btn">Tooltip text</paper-tooltip>
    </div>

The tooltip can be positioned on the top|bottom|left|right of the anchor using
the `position` attribute. The default position is bottom.

    <paper-tooltip for="btn" position="left">Tooltip text</paper-tooltip>
    <paper-tooltip for="btn" position="top">Tooltip text</paper-tooltip>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--paper-tooltip-background` | The background color of the tooltip | `#616161`
`--paper-tooltip-opacity` | The opacity of the tooltip | `0.9`
`--paper-tooltip-text-color` | The text color of the tooltip | `white`
`--paper-tooltip` | Mixin applied to the tooltip | `{}`

@group Paper Elements
@element paper-tooltip
@demo demo/index.html
-->

<dom-module id="paper-tooltip" assetpath="../../bower-assets/paper-tooltip/">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        outline: none;
        z-index: 1002;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: default;
      }

      #tooltip {
        display: block;
        outline: none;
        @apply(--paper-font-common-base);
        font-size: 10px;
        line-height: 1;

        background-color: var(--paper-tooltip-background, #616161);
        opacity: var(--paper-tooltip-opacity, 0.9);
        color: var(--paper-tooltip-text-color, white);

        padding: 8px;
        border-radius: 2px;

        @apply(--paper-tooltip);
      }

      /* Thanks IE 10. */
      .hidden {
        /*display: none !important;*/
      }
    </style>

    <div id="tooltip" class="hidden">
      <content></content>
    </div>
  </template>

  <script>
    Polymer({
      is: 'paper-tooltip',

      hostAttributes: {
        role: 'tooltip',
        tabindex: -1
      },

      behaviors: [
        Polymer.NeonAnimationRunnerBehavior
      ],

      properties: {
        /**
         * The id of the element that the tooltip is anchored to. This element
         * must be a sibling of the tooltip.
         */
        for: {
          type: String,
          observer: '_findTarget'
        },

        /**
         * Set this to true if you want to manually control when the tooltip
         * is shown or hidden.
         */
        manualMode: {
          type: Boolean,
          value: false,
          observer: '_manualModeChanged'
        },

        /**
         * Positions the tooltip to the top, right, bottom, left of its content.
         */
        position: {
          type: String,
          value: 'bottom'
        },

        /**
         * If true, no parts of the tooltip will ever be shown offscreen.
         */
        fitToVisibleBounds: {
          type: Boolean,
          value: false
        },

        /**
         * The spacing between the top of the tooltip and the element it is
         * anchored to.
         */
        offset: {
          type: Number,
          value: 14
        },

        /**
         * This property is deprecated, but left over so that it doesn't
         * break exiting code. Please use `offset` instead. If both `offset` and
         * `marginTop` are provided, `marginTop` will be ignored.
         * @deprecated since version 1.0.3
         */
        marginTop: {
          type: Number,
          value: 14
        },

        /**
         * The delay that will be applied before the `entry` animation is
         * played when showing the tooltip.
         */
        animationDelay: {
          type: Number,
          value: 500
        },

        /**
         * The entry and exit animations that will be played when showing and
         * hiding the tooltip. If you want to override this, you must ensure
         * that your animationConfig has the exact format below.
         */
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'fade-in-animation',
                node: this,
                timing: {delay: 0}
              }],
              'exit': [{
                name: 'fade-out-animation',
                node: this
              }]
            }
          }
        },

        _showing: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'neon-animation-finish': '_onAnimationFinish',
      },

      /**
       * Returns the target element that this tooltip is anchored to. It is
       * either the element given by the `for` attribute, or the immediate parent
       * of the tooltip.
       */
      get target () {
        var parentNode = Polymer.dom(this).parentNode;
        // If the parentNode is a document fragment, then we need to use the host.
        var ownerRoot = Polymer.dom(this).getOwnerRoot();

        var target;
        if (this.for) {
          target = Polymer.dom(ownerRoot).querySelector('#' + this.for);
        } else {
          target = parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE ?
              ownerRoot.host : parentNode;
        }

        return target;
      },

      attached: function() {
        this._findTarget();
      },

      detached: function() {
        if (!this.manualMode)
          this._removeListeners();
      },

      show: function() {
        // If the tooltip is already showing, there's nothing to do.
        if (this._showing)
          return;

        if (Polymer.dom(this).textContent.trim() === '')
          return;


        this.cancelAnimation();
        this._showing = true;
        this.toggleClass('hidden', false, this.$.tooltip);
        this.updatePosition();

        this.animationConfig.entry[0].timing = this.animationConfig.entry[0].timing || {};
        this.animationConfig.entry[0].timing.delay = this.animationDelay;
        this._animationPlaying = true;
        this.playAnimation('entry');
      },

      hide: function() {
        // If the tooltip is already hidden, there's nothing to do.
        if (!this._showing) {
          return;
        }

        // If the entry animation is still playing, don't try to play the exit
        // animation since this will reset the opacity to 1. Just end the animation.
        if (this._animationPlaying) {
          this.cancelAnimation();
          this._showing = false;
          this._onAnimationFinish();
          return;
        }

        this._showing = false;
        this._animationPlaying = true;
        this.playAnimation('exit');
      },

      updatePosition: function() {
        if (!this._target || !this.offsetParent)
          return;

        var offset = this.offset;
        // If a marginTop has been provided by the user (pre 1.0.3), use it.
        if (this.marginTop != 14 && this.offset == 14)
          offset = this.marginTop;

        var parentRect = this.offsetParent.getBoundingClientRect();
        var targetRect = this._target.getBoundingClientRect();
        var thisRect = this.getBoundingClientRect();

        var horizontalCenterOffset = (targetRect.width - thisRect.width) / 2;
        var verticalCenterOffset = (targetRect.height - thisRect.height) / 2;

        var targetLeft = targetRect.left - parentRect.left;
        var targetTop = targetRect.top - parentRect.top;

        var tooltipLeft, tooltipTop;

        switch (this.position) {
          case 'top':
            tooltipLeft = targetLeft + horizontalCenterOffset;
            tooltipTop = targetTop - thisRect.height - offset;
            break;
          case 'bottom':
            tooltipLeft = targetLeft + horizontalCenterOffset;
            tooltipTop = targetTop + targetRect.height + offset;
            break;
          case 'left':
            tooltipLeft = targetLeft - thisRect.width - offset;
            tooltipTop = targetTop + verticalCenterOffset;
            break;
          case 'right':
            tooltipLeft = targetLeft + targetRect.width + offset;
            tooltipTop = targetTop + verticalCenterOffset;
            break;
        }

        // TODO(noms): This should use IronFitBehavior if possible.
        if (this.fitToVisibleBounds) {
          // Clip the left/right side.
          if (tooltipLeft + thisRect.width > window.innerWidth) {
            this.style.right = '0px';
            this.style.left = 'auto';
          } else {
            this.style.left = Math.max(0, tooltipLeft) + 'px';
            this.style.right = 'auto';
          }

          // Clip the top/bottom side.
          if (tooltipTop + thisRect.height > window.innerHeight) {
            this.style.bottom = '0px';
            this.style.top = 'auto';
          } else {
            this.style.top = Math.max(0, tooltipTop) + 'px';
            this.style.bottom = 'auto';
          }
        } else {
          this.style.left = tooltipLeft + 'px';
          this.style.top = tooltipTop + 'px';
        }

      },

      _addListeners: function() {
        if (this._target) {
          this.listen(this._target, 'mouseenter', 'show');
          this.listen(this._target, 'focus', 'show');
          this.listen(this._target, 'mouseleave', 'hide');
          this.listen(this._target, 'blur', 'hide');
          this.listen(this._target, 'tap', 'hide');
        }
        this.listen(this, 'mouseenter', 'hide');
      },

      _findTarget: function() {
        if (!this.manualMode)
          this._removeListeners();

        this._target = this.target;

        if (!this.manualMode)
          this._addListeners();
      },

      _manualModeChanged: function() {
        if (this.manualMode)
          this._removeListeners();
        else
          this._addListeners();
      },

      _onAnimationFinish: function() {
        this._animationPlaying = false;
        if (!this._showing) {
          this.toggleClass('hidden', true, this.$.tooltip);
        }
      },

      _removeListeners: function() {
        if (this._target) {
          this.unlisten(this._target, 'mouseenter', 'show');
          this.unlisten(this._target, 'focus', 'show');
          this.unlisten(this._target, 'mouseleave', 'hide');
          this.unlisten(this._target, 'blur', 'hide');
          this.unlisten(this._target, 'tap', 'hide');
        }
        this.unlisten(this, 'mouseenter', 'hide');
      }
    });
  </script>
</dom-module>
<link rel="import" href="../html-block/html-block.html"></div><dom-module id="page-visit-editor">
  <template>

    <style is="custom-style" include="common-style">
      .fixed-btn {
        position: absolute;
        top: 8px;
        right: 8px;
      }

      .limiting-container {
        margin-top: 8px;
        width: 95%;
      }

      .external-card-title {
        margin-top: 20px;
        margin-left: 20px;
        margin-right: 10px;
        color: #777777;
      }

      .b-radius paper-listbox {
        border-radius: 6px;
      }

      .info-card {
        @apply(--layout-vertical);
        /*@apply(--layout-center);*/
        margin-top: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-bottom: 20px;
      }

      .info-card .row {
        margin-left: 10px;
        /*margin-right: 10px;*/
        margin-top: 10px;
      }

      .info-card .hr {
        margin-left: 20px;
        margin-right: 20px;
        height: 1px;
        /*width: 100px;*/
        background: #dddddd;
      }

      .info-card .row .modifier {
        font-size: 14px;
        background: #000000;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .info-card .row .modifier.online {
        background: #757575;
      }

      .info-card .row .modifier.local-only {
        background: #039BE5;
      }

      .info-card .row .modifier.locally-updated {
        background: #009688;
      }

      .info-card .row .modifier.imported {
        background: #4CAF50;
      }

      .info-row {
        margin-top: 10px;
      }

      .top-info-row {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .serial-number {
        background: #37474F;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
        display: inline-block;
        font-size: 14px;
      }

      .address1 {
        margin-right: 10px;
      }

      .name {
        margin-left: 5px;
        font-size: 24px;
      }

      .email {
        margin-left: 5px;
        font-size: 14px;
      }

      .phone {
        margin-left: 5px;
      }

      .val {
        text-decoration: underline;
      }

      .account-box {
        --iron-icon-width: 96px;
        --iron-icon-height: 96px;
      }

      .list-item {
        margin-top: 8px;
        margin-bottom: 8px;
      }

      .copy-button {
        background-color: #1FAE0B;
      }

      .paste-button {
        background-color: #f44336;
        color: white;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th {
        text-align: left;
      }

      .table thead * {
        border-bottom: 1px solid #ccc;
        background-color: #f5f5f5;
        padding: 5px;
      }

      .table tbody th,
      .table tbody td {
        padding: 5px;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
      }

      .table tfoot * {
        background-color: #f5f5f5;
        padding: 5px;
      }



      .item-action {
        border-top: 1px solid #e8e8e8;
        padding: 5px 16px;
        position: relative;
        padding: 15px;
        text-align: right;
      }

      paper-dropdown-menu {
        width: 100%;
      }


      paper-checkbox.remind {
        padding: 15px 25px;
      }

      paper-checkbox.guideline-checkbox {
        --paper-checkbox-size: 14px;
      }

      .guideline {
        margin-left: 10px;
        margin-top: 70px;
        height: 90%;
        overflow: auto;
      }

      .guideline h1 {
        text-align: left;
        padding: 10px 0;
        border-bottom: 1px solid var(--paper-green-500);
        color: var(--brand-primary-color);
      }

      .guideline .dose {
        margin: 10px 0;
        padding: 10px;
      }

      .guideline .subDose {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #e0e0e0;
        border-radius: 3px;
        /*background-color: var(--paper-grey-50);*/
      }

      .guideline .age-group {
        border-bottom: 1px solid #ccc;
      }

      .disclaimer p {
        color: red;
      }

      app-drawer {
        --app-drawer-width: 400px;
        --app-drawer-scrim-background: rgba(0, 0, 0, 0.1);
        --app-drawer-content-container: {
          border-left: 1px solid #ccc;
          padding-left: 10px;
        }
        text-align: left;
      }

      paper-material {
        border: 1px solid var(--paper-grey-200);
      }

      paper-fab {
        float: right;
        margin-right: 10px;
        margin-top: 30px;
      }

      .indication-group {
        border: 1px solid var(--paper-blue-grey-100);
        padding: 15px;
        border-radius: 3px;
      }

      .indication-group paper-dropdown-menu {
        --paper-input-container-color: var(--paper-orange-500);
      }

      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        color: var(--brand-primary-color);
      }

      @media screen and (max-width: 480px) {
        app-drawer {
          --app-drawer-width: 95%;
        }

        .btn-add.m-vert {
          margin: 0.29em;
        }
      }

      .card-item-2 {
        border-radius: 2px;
        margin: 8px 4px;
        border: 2px solid #eee;
        background-color: #fff;
        position: relative;
      }

      .card-item {
        border-radius: 6px;
        border: 1px solid #eee;
        margin: 3px;
      }

      .custom-card-content {
        background-color: #f7f7f7;
      }



      .card-item div {
        background-color: #fafafa;
        /*border-right: 1px solid #eee;*/
      }

      paper-checkbox {
        margin: 8px;
      }

      .btn-custom {
        background-color: #fafafa !important;
        border: 1px solid #eee;
        margin: 3px;
      }

      .btn-custom-2 {
        background-color: #fafafa !important;
        border-radius-top-left: 0;
        border-radius-bottom-left: 0;
        margin: 0 !important;
      }

      .combobox-custom {
        padding: 8px 16px;
        background-color: #f7f7f7;
        border-bottom: 1px solid #eee;
      }

      /*Full Visit Preview - start*/

      .document {
        font-family: 'Times New Roman';
        background: white;
      }

      .document-title {
        font-size: 16px;
        text-decoration: underline;
        font-weight: bold;
        @apply(--layout-vertical);
        @apply(--layout-center);
      }



      .external-card-title {
        margin-top: 20px;
        margin-left: 20px;
        margin-right: 10px;
        color: #777777;
      }

      .info-card {
        @apply(--layout-vertical);
        /*@apply(--layout-center);*/
        margin-top: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-bottom: 20px;
      }

      .info-card .row {
        margin-left: 10px;
        /*margin-right: 10px;*/
        margin-top: 10px;
      }

      .info-card .hr {
        margin-left: 20px;
        margin-right: 20px;
        height: 1px;
        /*width: 100px;*/
        background: #dddddd;
      }

      .info-card .row .modifier {
        font-size: 14px;
        background: #000000;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .info-card .row .modifier.online {
        background: #757575;
      }

      .info-card .row .modifier.local-only {
        background: #039BE5;
      }

      .info-card .row .modifier.locally-updated {
        background: #009688;
      }

      .info-card .row .modifier.imported {
        background: #4CAF50;
      }

      .info-row {
        margin-top: 10px;
      }

      .top-info-row {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .serial-number {
        background: #37474F;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
        display: inline-block;
        font-size: 14px;
      }

      .address1 {
        margin-right: 10px;
      }

      .name {
        margin-left: 5px;
        font-size: 24px;
      }

      .email {
        margin-left: 5px;
        font-size: 14px;
      }

      .phone {
        margin-left: 5px;
      }

      .val {
        text-decoration: underline;
      }

      .account-box {
        --iron-icon-width: 96px;
        --iron-icon-height: 96px;
      }

      .document {
        font-family: 'Times New Roman';
        background: white;
      }

      .document-title {
        font-size: 20px;
        font-weight: bold;
      }

      .collection {
        color: red;
        background: grey;
      }

      .document-header {
        /*background-color: #fafafa;*/
        padding-left: 10px;
        padding-right: 10px;
        border-bottom: 1px solid #eee;
      }

      .document-header .logo {
        max-width: 128px;
        max-height: 128px;
      }

      .horiline {
        width: 100%;
        height: 0px;
        /*background: black;*/
        border: 1px solid black;
        margin-bottom: 6px;
      }

      .leftSide {
        margin-left: 6px;
      }

      .leftSideLine1 {
        font-size: 24px;
      }

      .rightSideLine1 {
        font-size: 22px;
      }


      .document-header2 .logo {
        max-width: 128px;
        max-height: 128px;
      }


      .item {
        padding: 10px;
        border: 1px solid grey;
      }

      #printPreview {
        display: none !important;
        /*height: 297mm;*/
        /*width: 210mm; */
      }

      @media print {
        html,
        body {
          width: 210mm;
          height: 297mm;
        }

        #hideOnPrint {
          display: none !important;
        }

        #printPreview {
          display: block !important;
          background-color: transparent;
        }

        .footer {
          position: fixed;
          bottom: 0;
        }
      }

      @media print {
        app-header-layout #contentContainer {
          overflow-y: unset !important;
        }
      }

      .preview-title {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        padding-left: 12px;
        padding-right: 8px;
        background-color: #fff;
        min-height: 60px;
        /*border-bottom: 1px solid #eee;*/
      }

      .custom-content {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-center);
        padding-left: 12px;
        padding-right: 8px;
      }

      .b-top {
        border-top: 1px solid #eee;
      }

      /*.content {
        padding-top: 8px;
      }*/

      .content.top {}

      .content.left {
        width: 40%;
        /*padding-right: 8px;*/
      }

      .content.right {
        width: 60%;
      }

      @media screen and (max-width: 639px) {
        .content.left {
          /*margin-top: 8px;*/
          width: 100%;
          /*padding: 0;*/
        }

        .content.right {
          width: 100%;
          /*padding: 0;*/
          /*margin-top: 8px;*/
        }
      }

      .tabColor {
        background-color: teal !important;
      }

      vaadin-combo-box.combobox-custom-style {
        padding: 2px;
      }

      vaadin-combo-box.combobox-custom-style ::content paper-input-container {
        padding: 4px 0;
      }

      vaadin-combo-box.combobox-custom-style ::content label {
        font-size: 18px !important;
        /*color: rgba(0, 0, 0, .87) !important;*/
      }

      /*vaadin-combo-box.combobox-custom-style ::content .unfocused-line {
        border-bottom: none;
      }*/

      vaadin-combo-box.combobox-custom-style ::content input {
        font-size: 18px !important;
        color: rgba(0, 0, 0, .87) !important;
      }

      .paper-input-custom ::content input {
        font-size: 18px !important;
        color: rgba(0, 0, 0, .87) !important;
      }

      .paper-input-custom ::content label {
        font-size: 18px !important;
        color: #737373 !important;
      }


      paper-textarea.textarea-custom-style ::content label {
        font-size: 18px !important;
      }

      paper-textarea.textarea-custom-style ::content iron-autogrow-textarea {
        font-size: 18px !important;
      }

      /*paper-textarea ::content .unfocused-line{
        border-bottom: none;
      }*/

      .type.title-2 {
        font-size: 18px;
        line-height: 50px;
      }

      vaadin-date-picker.date-picker-custom-style ::content paper-input-container {
        padding: 0;
      }

      /*vaadin-date-picker.date-picker-custom-style ::content .unfocused-line {
        border-bottom: none;
      }*/

      vaadin-date-picker.date-picker-custom-style ::content label {
        font-size: 18px !important;
      }

      vaadin-date-picker.date-picker-custom-style ::content input {
        font-size: 18px !important;
      }

      vaadin-date-picker.date-picker-custom-style ::content .floated-label-placeholder {
        display: none;
      }

      vaadin-date-picker.date-picker-custom-style {
        padding: 8px 8px 8px 0;
      }

      paper-dropdown-menu.dropdown-menu-custom-style ::content label {
        font-size: 18px !important;
      }

      paper-dropdown-menu.dropdown-menu-custom-style ::content input {
        font-size: 18px !important;
      }

      .border-top {
        border-top: 1px solid #eee;
      }

      .action-area {
        padding: 5px 0 5px 8px;
      }

      .btn-add {
        min-width: 0;
        padding-top: 0.5em;
        padding-bottom: 0.5em;
        background-color: #eceff1;
        color: rgba(0, 0, 0, .87);
      }

      .btn-add.small {
        margin: 3px;
        font-size: 14px;
      }


      paper-tabs.custom-tabs {
        background-color: #f7f7f7;
        height: 56px;
      }

      /*Print Preview*/

      .patient-details {
        background-color: #5c4575;
        color: #fff;
      }

      .print-content {
        border-top: 1px solid #eee;
        @apply(--layout-horizontal);
      }

      .print-content .left {
        width: 34%;
        border-right: 1px solid #eee;
      }

      .print-content .right {
        width: 66%;
      }

      ol.order-list {
        margin: 4px 0;
        padding-left: 16px;
        list-style-type: lower-alpha;
      }

      ul.unorderd-list-custom {
        margin: 4px 0;
        padding-left: 16px;
      }

      ol.order-list li {
        margin: 4px 0;
      }

      .print-sub-header {
        font-size: bold;
        background-color: #fafafa;
        margin-bottom: 8px;
      }

      .profile-image {
        height: 78px;
        width: 78px;
        border-radius: 50%;
        border: 2px solid #f7f7f7;
      }


      @page {
        size: A4;
        margin: 11mm 17mm 17mm 17mm;
      }

      .partner-logo img {
        margin-right: 5px;
      }
    </style>

    <!-- local DOM -->
    <!-- <template is="dom-if" if="{{!isVisitValid}}">
      Visit invalid
    </template>

    <template is="dom-if" if="{{!isPatientValid}}">
      Patient invalid
    </template> -->

    <div class="master-container">
      <div class="limiting-container">

        <!-- Page :: New Visit - Start -->
        <paper-card id="hideOnPrint">

          <!-- visit content - start -->
          <div class="custom-card-content">
            <div class="card-item-2 p-8">
              <div class="horizontal layout wrap center">
                <iron-image class="profile-image m-right-8" src$="[[patient.profileImage]]" preload="" sizing="cover"></iron-image>

                <div class="flex">
                  <div class="m-horizontal-4 horizontal layout center">
                    <div class="type body-lead capitalize">{{$getFullName(patient.name)}}</div>
                    <template is="dom-repeat" items="[[patient.policyList]]" as="policy">
                      <div class="m-left-8 type caption bg-gray">[[policy.insuranceProvider]]-[[policy.number]]</div>
                    </template>
                  </div>
                  <div class="horizontal layout wrap type caption-2 secondary">

                    <template is="dom-if" if="[[!patient.isForOrganizationOnly]]">

                      <div class="m-horizontal-4">
                        <strong>Sex: </strong>
                        <span>{{patient.gender}}</span>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Age: </strong>
                        <span>[[_computeAge(patient.dateOfBirth)]] years </span>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Blood Group: </strong>
                        <span> [[patient.bloodGroup]]</span>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Allergy: </strong>
                        <span>[[patient.allergy]] </span>
                      </div>
                    </template>

                    <template is="dom-if" if="[[patient.isForOrganizationOnly]]">
                      <div class="m-horizontal-4">
                        <strong>Patient Name: </strong>
                        <i>REDACTED FOR CONFIDENTIALITY</i>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Age: </strong>
                        <i>REDACTED FOR CONFIDENTIALITY</i>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Blood Group: </strong>
                        <span>[[patient.bloodGroup]]</span>
                      </div>
                      <div class="m-horizontal-4">
                        <strong>Allergy: </strong>
                        <span>[[patient.allergy]]</span>
                      </div>
                    </template>
                  </div>
                  <div class="layout horizontal m-4">
                    <div class="type secondary caption-2">OPD:
                      <span class="type caption bold bg-gray">[[patientServiceBalance.outdoorBalance]]</span>
                    </div>
                    <div class="type secondary caption-2 m-left-8">IPD:
                      <span class="type caption bold bg-gray">[[patientServiceBalance.indoorBalance]]</span>
                    </div>
                  </div>
                </div>
              </div>
              <paper-button raised="" class="fixed-btn btn-add colored" on-tap="editPatientBtnPressed">Edit Patient</paper-button>
            </div>
            <!-- visit details - start -->
            <div class="card-item-2 horizontal layout wrap center p-8">

              <div class="content left horizontal layout wrap type caption-2">
                <div class="m-4">
                  <strong>Record:</strong> [[visit.serial]]</div>
                <div class="m-4">
                  <strong>Created Date:</strong> [[$mkDateTime(visit.createdDatetimeStamp)]]</div>
                <div class="m-4">
                  <strong>Created By:</strong> {{visit.doctorName}}</div>
              </div>

              <div class="content right horizontal layout end-justified">
                <paper-button class="btn-add m-vert" on-tap="openVisitSettingsDialog">
                  <iron-icon icon="icons:settings"></iron-icon>
                </paper-button>

                <paper-button class="btn-add m-vert" on-tap="printButtonPressed">
                  <iron-icon icon="icons:print" class="m-right-8"></iron-icon>Print
                </paper-button>

                <!-- <paper-button raised class="btn-add m-vert" on-tap="openVisitSettingsDialog">
                  <iron-icon icon="communication:email"></iron-icon>
                </paper-button> -->

                <paper-button raised="" class="colored btn-add m-vert" on-tap="finishButtonPressed">
                  <iron-icon icon="icons:check" class="m-right-8"></iron-icon>Finish
                </paper-button>

                <paper-button style="background: green !important;" raised="" class="colored btn-add m-vert" on-tap="makeNewVisitButtonPressed">
                  <iron-icon icon="icons:check" class="m-right-8"></iron-icon>New Visit
                </paper-button>


              </div>
            </div>
            <!-- visit details - end -->
          </div>

          <div class="custom-card-content horizontal layout wrap">

            <div class="content left">

              <!-- Card - Symptoms - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-ajax url="../../static-data/symptoms-list.json" last-response="{{symptomsDataList}}" auto></iron-ajax> -->
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_symptoms.png"></iron-icon> -->
                  <vaadin-combo-box class="flex combobox-custom-style" label="Symptoms" id="comboBoxSymptoms" items="{{symptomsDataList}}" allow-custom-value="true" value-changed="onComboBoxSymptomsValueChanged" on-keyup="comboBoxKeyUpSymptomsValueChanged" selected-item="{{comboBoxSymptomsSelectedItem}}" value="{{comboBoxSymptomsInputValue}}">
                  </vaadin-combo-box>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="addSymptoms">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>
                <template is="dom-if" if="[[!_isEmpty(addedIdentifiedSymptomsList.length)]]">
                  <div class="b-radius p-0">
                    <paper-listbox>
                      <template is="dom-repeat" items="[[addedIdentifiedSymptomsList]]">
                        <paper-item class="custom layout horizontal center">

                          <div class="type caption secondary">[[_returnSerial(index)]]</div>
                          <div class="flex type body m-left-8 vertical layout">
                            <div>
                              {{item.name}}
                              <template is="dom-if" if="[[_compareFn(item.possibleValueList.length, '>', 0)]]">
                                [
                                <template is="dom-repeat" items="[[item.possibleValueList]]">
                                  <span class="type caption-2">{{item}}, </span>
                                </template>]
                              </template>
                            </div>
                          </div>
                          <paper-icon-button icon="delete" on-tap="_selectedAddedIdentifiedSymtomsDeleteBtnPressed"></paper-icon-button>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Symptoms - end -->

              <!-- Card - Examination - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_stethoscope.png"></iron-icon> -->
                  <vaadin-combo-box class="flex combobox-custom-style" label="Examination" id="comboBoxExamination" items="{{examinationDataList}}" allow-custom-value="true" value-changed="onComboBoxExaminationValueChanged" on-keyup="comboBoxKeyUpExaminationValueChanged" selected-item="{{comboBoxExaminationSelectedItem}}" value="{{comboBoxExaminationInputValue}}">
                  </vaadin-combo-box>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="addExamination">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>
                <template is="dom-if" if="[[!_isEmpty(addedExaminationList.length)]]">
                  <div class="p-0 b-radius">
                    <paper-listbox>
                      <template id="added-examination-list-repeater" is="dom-repeat" items="[[addedExaminationList]]">
                        <paper-item class="custom layout horizontal center">

                          <div class="type caption secondary">[[_returnSerial(index)]]</div>
                          <div class="flex type body m-left-8 vertical layout">
                            <div class="type body-lead">{{item.name}}</div>
                            <div class="horizontal layout wrap center">
                              <template is="dom-repeat" items="[[item.examinationValueList]]">
                                <!-- <div class="horizontal layout center" class="m-horizontal-4">
                                  <paper-icon-button icon="icons:remove-circle" class="m-right-4" on-tap="removeExaminationMember"></paper-icon-button>
                                  <div class="type body">{{item.value}}</div>

                                </div> -->
                                <paper-checkbox checked="{{item.checked}}" on-tap="checkExaminationMember">{{item.value}}</paper-checkbox>
                              </template>

                            </div>
                          </div>
                          <paper-icon-button icon="icons:add-circle" class="colored" on-tap="openDialogForExaminationMember"></paper-icon-button>
                          <paper-icon-button icon="delete" on-tap="_selectedAddedExaminationDeleteBtnPressed"></paper-icon-button>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Examination - end -->

              <!-- Card - Vitals - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_pulse_rate.png"></iron-icon> -->
                  <!-- <div class="type title-2">Vitals</div> -->
                  <div class="flex">
                    <paper-dropdown-menu class="dropdown-menu-custom-style" label="[[$TRANSLATE('Vital',LANG)]]">
                      <paper-menu class="dropdown-content" selected="{{selectedVitalIndex}}" on-iron-select="onVitalIndexChange">
                        <paper-item disabled$="{{isBPAdded}}">
                          <iron-icon class="m-right-8" src="../../images/icons/ico_blood_pressure.png"></iron-icon>Blood Pressure</paper-item>
                        <paper-item disabled$="{{isHRAdded}}">
                          <iron-icon class="m-right-8" src="../../images/icons/ico_pulse_rate.png"></iron-icon>Heart Rate</paper-item>
                        <paper-item disabled$="{{isBMIAdded}}">
                          <iron-icon class="m-right-8" src="../../images/icons/ico_body_shape.png"></iron-icon>BMI</paper-item>
                        <paper-item disabled$="{{isRRAdded}}">
                          <iron-icon class="m-right-8" src="../../images/icons/ico_lungs.png"></iron-icon>Respiratory Rate</paper-item>
                        <paper-item disabled$="{{isSpO2Added}}">
                          <iron-icon class="m-right-8" src="../../images/icons/oxygen-symbol.png"></iron-icon>SpO2</paper-item>
                        <paper-item disabled$="{{isTempAdded}}">
                          <iron-icon class="m-right-8" src="../../images/icons/ico_thermometer.png"></iron-icon>Temperature</paper-item>
                      </paper-menu>
                    </paper-dropdown-menu>
                  </div>
                  <div class="action-area">
                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 0)}}">
                      <paper-button class="btn-add" on-tap="addBloodPressureButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>
                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 1)}}">
                      <paper-button class="btn-add" on-tap="addPulseRateButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>
                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 2)}}">
                      <paper-button class="btn-add" on-tap="calculateBMIButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>
                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 3)}}">
                      <paper-button class="btn-add" on-tap="addRespiratoryRateButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>

                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 4)}}">
                      <paper-button class="btn-add" on-tap="addOxygenSaturationButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>

                    <template is="dom-if" if="{{_compareFn(selectedVitalIndex, '==', 5)}}">
                      <paper-button class="btn-add" on-tap="addTemperatureButtonClicked">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>

                  </div>
                </div>
                <iron-pages style="background-color: #fafafa;" selected="{{selectedVitalIndex}}">
                  <!-- Add Blood Pressure -->
                  <section hidden$="{{isBPAdded}}">

                    <div class="custom-content">
                      <paper-input class="p-horizontal-4 flex one" id="systolic" label="[[$TRANSLATE('Systolic',LANG)]]" type="number" min="0" max="300" value="{{bloodPressure.data.systolic}}" auto-validate="" error-message="Value must be within 1-300"></paper-input>
                      <paper-input class="p-horizontal-4 flex one" id="diastolic" label="[[$TRANSLATE('Diastolic',LANG)]]" type="number" min="0" max="200" value="{{bloodPressure.data.diastolic}}" disabled$="[[!bloodPressure.data.systolic]]" auto-validate="" error-message="Value must not be greater than 200 and Systolic Value"></paper-input>
                      <paper-input class="p-horizontal-4 flex one" label="[[$TRANSLATE('Unit',LANG)]]" readonly="" value="[[$TRANSLATE('mm Hg',LANG)]]"></paper-input>
                    </div>
                  </section>
                  <!-- /Add Blood Pressure -->

                  <!-- Add Heart Rate -->
                  <section hidden$="{{isHRAdded}}">
                    <div class="card-content">
                      <div class="form-group">
                        <div>
                          <paper-input label="[[$TRANSLATE('Heart Rate',LANG)]]" type="number" min="20" max="225" auto-validate="" value="{{pulseRate.data.bpm}}" error-message="Value must be within 20-225">
                            <div class="text-muted" suffix="">[[$TRANSLATE('bpm',LANG)]]</div>
                          </paper-input>
                        </div>
                      </div>
                    </div>
                  </section>
                  <!-- /Add Heart Rate -->

                  <!-- Add BMI -->
                  <section hidden$="{{isBMIAdded}}">
                    <div class="card-content">

                      <div class="form-group">
                        <div>
                          <paper-dropdown-menu label="[[$TRANSLATE('Unit',LANG)]]">
                            <paper-menu class="dropdown-content" selected="{{heightUnitSelectedIndex}}" on-iron-select="heightUnitSelectedIndexChanged">
                              <paper-item>[[$TRANSLATE('cm',LANG)]]</paper-item>
                              <paper-item>[[$TRANSLATE('metre',LANG)]]</paper-item>
                              <paper-item>[[$TRANSLATE('ft/inch',LANG)]]</paper-item>
                            </paper-menu>
                          </paper-dropdown-menu>
                        </div>
                        <template is="dom-if" if="[[ifChosenCmMtAsHeight(heightUnitSelectedIndex)]]">
                          <div>
                            <paper-input label="[[$TRANSLATE('Height',LANG)]]" type="number" value="{{bmi.data.height}}" error-message="Value must be within 250"></paper-input>
                          </div>
                        </template>
                        <!--If Chosen Ft/inch as Unit-->
                        <template is="dom-if" if="[[ifChosenFtInchAsHeight(heightUnitSelectedIndex)]]">
                          <div>
                            <paper-input label="[[$TRANSLATE('Ft',LANG)]]" type="number" max="8" min="0" auto-validate="" value="{{bmi.data.heightInFt}}" error-message="Value must be within 8"></paper-input>
                          </div>
                          <div>
                            <paper-input label="[[$TRANSLATE('Inch',LANG)]]" type="number" max="12" min="0" auto-validate="" value="{{bmi.data.heightInInch}}" error-message="Value must be within 12"></paper-input>
                          </div>
                        </template>
                      </div>

                      <div class="form-group">
                        <div>
                          <paper-dropdown-menu label="[[$TRANSLATE('Unit',LANG)]]">
                            <paper-menu class="dropdown-content" selected="{{weightUnitSelectedIndex}}" on-iron-select="weightUnitSelectedIndexChanged">
                              <paper-item>[[$TRANSLATE('kgs',LANG)]]</paper-item>
                              <paper-item>[[$TRANSLATE('lbs',LANG)]]</paper-item>
                              <paper-item>stone-lbs</paper-item>
                            </paper-menu>
                          </paper-dropdown-menu>
                        </div>
                        <div>
                          <paper-input label="[[$TRANSLATE('Weight',LANG)]]" type="number" value="{{bmi.data.weight}}" min="0"></paper-input>
                        </div>
                      </div>
                    </div>
                  </section>
                  <!-- /Add BMI -->

                  <!-- Add Respiratory Rate -->
                  <section hidden$="{{isRRAdded}}">
                    <div class="card-content">
                      <div class="form-group">
                        <div>
                          <paper-input id="rr" label="[[$TRANSLATE('Respiratory Rate',LANG)]]" type="number" min="1" max="65" auto-validate="" value="{{respiratoryRate.data.respiratoryRate}}" error-message="Value Must be within 1-65">
                            <div class="text-muted" suffix="">[[$TRANSLATE('rpm',LANG)]]</div>
                          </paper-input>
                        </div>
                      </div>
                    </div>
                  </section>
                  <!-- /Add Respiratory Rate -->
                  <!-- Add Oxygen Saturation -->
                  <section hidden$="{{isSpO2Added}}">
                    <div class="card-content">
                      <div class="form-group">
                        <div>
                          <paper-input label="[[$TRANSLATE('Oxygen Saturation',LANG)]]" type="number" min="0" max="100" auto-validate="" value="{{oxygenSaturation.data.spO2Percentage}}" error-message="Value must be within 100">
                            <div class="text-muted" suffix="">%</div>
                          </paper-input>
                        </div>
                      </div>
                    </div>
                  </section>
                  <!-- /Add Oxygen Saturation -->

                  <!-- Add Temperature -->
                  <section hidden$="{{isTempAdded}}">
                    <div class="card-content">
                      <div class="form-group">
                        <div>
                          <template is="dom-if" if="[[isTempCelsius(tempUnitSelectedIndex)]]">
                            <paper-input label="[[$TRANSLATE('Temperature in Celsius',LANG)]]" type="number" max="48" auto-validate="" value="{{temperature.data.temperature}}" error-message="Value must be within 48"></paper-input>
                          </template>
                          <template is="dom-if" if="[[!isTempCelsius(tempUnitSelectedIndex)]]">
                            <paper-input label="[[$TRANSLATE('Temperature in Fahrenheit',LANG)]]" type="number" max="115" auto-validate="" value="{{temperature.data.temperature}}" error-message="Value must be within 115"></paper-input>
                          </template>
                        </div>
                        <div>
                          <paper-dropdown-menu label="[[$TRANSLATE('Unit',LANG)]]">
                            <paper-menu class="dropdown-content" selected="{{tempUnitSelectedIndex}}" on-iron-select="tempUnitSelected">
                              <paper-item>[[$TRANSLATE('Â°C',LANG)]]</paper-item>
                              <paper-item>[[$TRANSLATE('Â°F',LANG)]]</paper-item>
                            </paper-menu>
                          </paper-dropdown-menu>
                        </div>
                      </div>
                    </div>
                  </section>
                  <!-- /Add Temperature -->
                </iron-pages>
                <template is="dom-if" if="[[!_isEmpty(addedVitalList.length)]]">
                  <div class="p-0 border-top">
                    <paper-listbox>
                      <template is="dom-repeat" items="[[addedVitalList]]">

                        <paper-item class="custom layout horizontal center">

                          <div class="flex layout horizontal center">
                            <div class="type caption secondary">[[_returnSerial(index)]]</div>
                            <div class="m-left-16 flex">
                              <div class="type body">{{item.vitalType}}: [[_pritifyVitalData(item)]]</div>
                              <div class="type caption secondary">{{_formatDateTime(item.vitalObject.createdDatetimeStamp)}}</div>
                            </div>
                            <paper-icon-button icon="delete" on-tap="_deleteAddedVitalItemClicked"></paper-icon-button>
                          </div>

                        </paper-item>
                      </template>

                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Vitals - end -->

              <!-- Card - Test Advised - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_medicine_flask.png"></iron-icon> -->
                  <vaadin-combo-box class="flex combobox-custom-style" label="Investigation" id="comboBoxInvestigaiton" items="{{investigationDataList}}" allow-custom-value="true" value-changed="onComboBoxInvestigationValueChanged" on-keyup="comboBoxKeyUpInvestigationValueChanged" selected-item="{{comboBoxInvestigationSelectedItem}}" value="{{comboBoxInvestigationInputValue}}">
                  </vaadin-combo-box>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="addInvestigation">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>
                <div class="horizontal layout center end-justified">
                  <paper-button class="btn-add colored" style="margin-bottom: 8px; margin-right: 12px; font-size: 14px;" on-tap="showFavoriteInvestigationDialog">pick from favorites</paper-button>
                </div>
                <template is="dom-if" if="[[!_isEmpty(addedInvestigationList.length)]]">

                  <div class="p-0 b-radius">
                    <paper-listbox>
                      <template id="added-advised-test-list-repeater" is="dom-repeat" items="[[addedInvestigationList]]">
                        <paper-item class="custom layout horizontal center">

                          <div class="type caption secondary">[[_returnSerial(index)]]</div>
                          <div class="flex type body m-left-8 vertical layout">
                            <div class="type body-lead">{{item.investigationName}}</div>
                            <div class="horizontal layout wrap">

                              <template is="dom-if" if="[[_compareFn(item.testList.length, '==', 1)]]">
                                <div class="type body">{{item.testList.0.name}}</div>
                              </template>

                              <template is="dom-if" if="[[_compareFn(item.testList.length, '>', 1)]]">
                                <template is="dom-repeat" items="[[item.testList]]">
                                  <div class="horizontal layout center">
                                    <paper-icon-button icon="icons:remove-circle-outline" class="m-right-4" on-tap="removeInvestigationMember"></paper-icon-button>
                                    <div class="type body">{{item.name}}</div>
                                  </div>
                                </template>
                              </template>

                            </div>
                            <div class="type caption-2 secondary italic capitalize">
                              <template is="dom-if" if="[[_isEmptyString(item.suggestedInstitutionName)]]">
                                <paper-button style="padding: 3px !important;" on-click="_openSuggestedInstitutionDialog">add suggeted institution</paper-button>
                              </template>



                              <template is="dom-if" if="[[!_isEmptyString(item.suggestedInstitutionName)]]">
                                <strong>Suggested Institution: </strong>
                                <span class="flex">[[item.suggestedInstitutionName]]</span>
                                <paper-button class="btn btn-default" style="padding: 3px !important;" on-click="_openSuggestedInstitutionDialog">change</paper-button>
                              </template>
                            </div>
                            <!-- <div class="type caption-2 secondary">
                              <strong>Suggested Institution: </strong>
                              <span class="flex">{{item.suggestedInstitutionName}}</span>
                            </div> -->

                          </div>
                          <paper-icon-button icon="icons:add-circle" on-tap="showInevestigationMemberDialog"></paper-icon-button>
                          <paper-icon-button icon="delete" on-tap="_selectedAddedInvestigationtDeleteBtnPressed"></paper-icon-button>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Test Advised - end -->

              <!-- Card - Diagnosis - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_medical_records.png"></iron-icon> -->
                  <!-- <iron-ajax url="../../static-data/diagnosis-list.json" last-response="{{response}}" auto></iron-ajax> -->
                  <vaadin-combo-box class="flex combobox-custom-style" label="Diagnosis" id="comboBoxDiagnosis" items="{{diagnosisListArray}}" allow-custom-value="true" value-changed="onComboBoxDiagnosisValueChanged" on-keyup="comboBoxKeyUpDiagnosisValueChanged" selected-item="{{comboBoxDiagnosisSelectedItem}}" value="{{comboBoxDiagnosisInputValue}}"></vaadin-combo-box>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="addDiagnosis">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>
                <template is="dom-if" if="{{!_isEmpty(diagnosis.data.diagnosisList.length)}}">
                  <div class="p-0 b-radius">
                    <paper-listbox>
                      <template is="dom-repeat" items="[[diagnosis.data.diagnosisList]]">
                        <paper-item class="custom layout horizontal">
                          <div class="type caption secondary m-right-8">[[_returnSerial(index)]].</div>
                          <div class="type body flex">
                            {{item.name}}
                          </div>
                          <paper-icon-button icon="delete" on-tap="_deleteSelectedDiagnosisButtonPressed"></paper-icon-button>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Diagnosis - end -->

              <!-- Card - Notes - start -->
              <div class="card-item-2">
                <div class="preview-title">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_notes.png"></iron-icon> -->
                  <div class="flex">
                    <paper-input class="paper-input-custom" label="Note/Advised" value="{{doctorNotesMessage}}"></paper-input>
                  </div>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="_addNotePressed">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>
                <template is="dom-if" if="{{!_isEmpty(doctorNotes.data.messageList.length)}}">

                  <div class="p-0 b-radius">
                    <paper-listbox>
                      <template is="dom-repeat" items="[[doctorNotes.data.messageList]]">
                        <paper-item class="custom layout horizontal center">
                          <div class="type caption secondary">[[_returnSerial(index)]]</div>
                          <div class="m-left-8 flex type body" style="word-break: break-word;">
                            {{item}}
                          </div>
                          <paper-icon-button icon="delete" on-tap="_onDoctorNoteDeletedButtonPressed"></paper-icon-button>
                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>
              </div>
              <!-- Card - Notes - end -->

              <!-- Card - Next Visit - start -->
              <div class="card-item-2">

                <div class="preview-title wrap">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_calander_time.png"></iron-icon> -->
                  <vaadin-date-picker style="padding-top: 27px;" label="[[$TRANSLATE('Next Visit Date',LANG)]]" class="flex one date-picker-custom-style" value="{{nextVisit.data.nextVisitDateTimestamp}}"></vaadin-date-picker>
                  <vaadin-combo-box class="flex one combobox-custom-style" label="Add Priority" items="{{priorityTypeList}}" allow-custom-value="true" on-keyup="comboBoxKeyUpPriorityValueChanged" value="{{priorityValue}}">
                  </vaadin-combo-box>
                  <div class="action-area">
                    <paper-button class="btn-add" on-tap="_addNextVisitPressed">
                      <iron-icon icon="icons:save"></iron-icon>
                    </paper-button>
                  </div>

                </div>
                <template is="dom-if" if="[[!_isEmptyString(nextVisit.data.nextVisitDateTimestamp)]]">
                  <div class="card-content">
                    <div class="type body">
                      <span class="type bold">Date: [[$mkDate(nextVisit.data.nextVisitDateTimestamp)]]</span>
                      (
                      <span>{{nextVisit.data.priorityType}}</span>)
                    </div>
                  </div>
                </template>
              </div>
              <!-- Card - Next Visit - end -->

              <!-- Card - Referral start -->
              <div class="card-item-2">
                <div class="preview-title layout">
                  <div class="type title-2 flex">Referral</div>
                  <div class="action-area">
                    <paper-button class="btn-add m-vert" on-tap="openReferralDialogPressed">
                      <iron-icon icon="icons:add"></iron-icon>
                    </paper-button>
                  </div>
                </div>

                <div class="card-content">
                  <div class="layout horizontal">
                    <span class="type bold">Referred By: </span> [[referral.data.referredByDoctorName]]
                  </div>
                  <template is="dom-if" if="[[referral.data.doctorName]]">
                    <div class="layout horizontal">
                      <span class="type bold">Referred To: </span> [[referral.data.doctorName]]
                    </div>
                    <div class="layout horizontal">
                      <span class="type bold">Speciality: </span> [[referral.data.speciality]]</div>
                  </template>
                  <template is="dom-if" if="[[referral.data.organizationName]]">
                    <div class="layout horizontal">
                      <span class="type bold">Organization Name: </span> [[referral.data.organizationName]]</div>
                  </template>
                </div>

              </div>
              <!-- Card - Referral end -->
              <!-- Card :: Invoice - start -->
              <div class="card-item-2">

                <div class="preview-title layout">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_invoice.png"></iron-icon> -->
                  <div class="type title-2 flex">Invoice</div>
                  <div class="action-area">
                    <template is="dom-if" if="{{!isInvoiceValid}}">
                      <paper-button class="btn-add m-vert" on-tap="createInvoicePressed">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>
                    </template>
                    <template is="dom-if" if="{{isInvoiceValid}}">
                      <paper-button class="btn-add m-vert" on-tap="printInvoicePressed">
                        <iron-icon icon="icons:print"></iron-icon>
                      </paper-button>
                      <paper-button class="btn-add m-vert" on-tap="editInvoicePressed">
                        <iron-icon icon="icons:create"></iron-icon>
                      </paper-button>
                    </template>
                  </div>
                </div>

                <template is="dom-if" if="[[visit.invoiceSerial]]">
                  <div class="card-content">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Service</th>
                          <th>Qty</th>
                          <th>Price</th>
                        </tr>
                      </thead>
                      <tbody>
                        <template is="dom-repeat" items="[[invoice.data]]">
                          <tr>
                            <td>[[item.name]]</td>
                            <td>[[item.qty]]</td>
                            <td>
                              <div class="layout horizontal center">
                                <span class="flex">[[item.price]]</span>
                                <paper-icon-button class="type danger" icon="delete" on-tap="deleteInvoiceItem"></paper-icon-button>
                              </div>
                            </td>
                          </tr>
                        </template>
                      </tbody>
                      <tfoot>
                        <tr>
                          <th colspan="2">Total</th>
                          <th>[[invoice.totalBilled]]</th>
                        </tr>
                        <tr>
                          <td colspan="2">Available Outdoor Balance</td>
                          <td>[[patientServiceBalance.outdoorBalance]]</td>
                        </tr>
                        <tr>
                          <th colspan="2">Balance After Deduction</th>
                          <th>[[calculatedOutDoorBalanceAfterDeduction(patientServiceBalance.outdoorBalance, invoice.totalBilled)]]</th>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </template>
              </div>
              <!-- Card :: Invoice - end -->
            </div>

            <div class="content right">

              <!-- Card - History And Physical - start -->
              <div class="card-item-2">

                <!-- preview-title - start -->
                <div class="preview-title layout wrap">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_history_and_physical.png"></iron-icon> -->

                  <div class="type title-2 flex">History &amp; Physical</div>


                  <div class="layout horizontal wrap">


                    <template is="dom-if" if="[[_isEmptyString(visit.historyAndPhysicalRecordSerial)]]">
                      <paper-button class="btn-add" on-tap="historyAndPhysicalRecordCreate">
                        <iron-icon icon="icons:add"></iron-icon>
                      </paper-button>


                      <template is="dom-if" if="[[recordInClipboard]]">
                        <paper-button class="btn-add btn btn-default" on-tap="pasteRecordPressed">
                          <iron-icon icon="icons:content-paste" class="m-right-8"></iron-icon>Paste Record: [[recordInClipboard.serial]]
                        </paper-button>
                      </template>
                    </template>

                    <template is="dom-if" if="[[!_isEmptyString(visit.historyAndPhysicalRecordSerial)]]">
                      <paper-checkbox checked="[[historyAndPhysicalRecord.availableToPatient]]" on-change="historyAndPhysicalAvailableToPatientCheckBoxChanged">Available to Patient</paper-checkbox>

                      <!-- <paper-icon-button icon="print" on-tap="historyAndPhysicalRecordPrint"></paper-icon-button> -->

                      <paper-icon-button icon="create" on-tap="historyAndPhysicalRecordEdit"></paper-icon-button>
                      <paper-icon-button icon="icons:content-copy" on-tap="historyAndPhysicalRecordCopy"></paper-icon-button>
                      <paper-icon-button icon="icons:delete" on-tap="historyAndPhysicalRecordRemove"></paper-icon-button>

                      <!-- <div>[[$mkDate(record.content.preopAssessment.lastChangedDatetimeStamp)]]</div> -->
                    </template>
                  </div>
                </div>
                <!-- preview-title - end -->


                <template is="dom-if" if="[[shouldRender]]">
                  <div class="p-horizontal-16" style="background: #fff;">
                    <html-block html="[[recordPartHtmlContent]]"></html-block>
                  </div>
                </template>
              </div>
              <!-- Card - History And Physical - end -->

              <!-- Card :: Prescription - start -->
              <div class="card-item-2">
                <div class="preview-title horizontal layout center">
                  <!-- <iron-icon class="m-right-8" src="../../images/icons/medical-kit.png"></iron-icon> -->
                  <div class="type title-2"> Prescription </div>
                </div>

                <template is="dom-if" if="[[!_isEmpty(matchingPrescribedMedicineList.length)]]">
                  <div class="p-0 b-radius">
                    <paper-listbox>


                      <template is="dom-repeat" items="[[matchingPrescribedMedicineList]]">
                        <paper-item class="custom layout horizontal center">
                          <div class="type caption secondary">[[_returnSerial(index)]]</div>

                          <div class="flex m-left-8">
                            <div class="layout horizontal wrap center">


                              <div class="flex">
                                <div class="type body">{{item.data.brandName}}
                                  <span class="type caption bg-gray">[[item.data.manufacturer]]</span>
                                </div>
                                <div class="type caption italic secondary">{{item.data.genericName}} {{item.data.strength}}</div>
                              </div>

                              <div>
                                <div class="type caption m-horizontal-4">
                                  <!-- <span>[[$TRANSLATE_NUMBER(item.data.dose, LANG)]] [[$TRANSLATE(item.data.form, LANG)]] [[$TRANSLATE('As', LANG)]]</span> -->[[$TRANSLATE_NUMBER(item.data.doseDirection, LANG)]] [[$TRANSLATE('for', LANG)]] [[_computeTotalDaysCount(item.data.endDateTimeStamp,item.data.startDateTimeStamp)]]
                                  <span hidden$="[[!item.data.endDateTimeStamp]]">[[$TRANSLATE('Days',LANG)]]</span>
                                </div>

                                <div class="type caption m-horizontal-4">
                                  <span>[[$TRANSLATE('By', LANG)]] </span>
                                  <span class="text-cap">[[$TRANSLATE(item.data.route, LANG)]]</span>
                                  <span>[[$TRANSLATE(item.data.direction, LANG)]] </span>
                                </div>
                                <div class="type caption m-horizontal-4">[[item.data.comments]]</div>
                              </div>

                            </div>
                          </div>

                          <paper-icon-button icon="delete" on-tap="deleteMedicinePressed"></paper-icon-button>

                        </paper-item>
                      </template>
                    </paper-listbox>
                  </div>
                </template>

                <paper-tabs class="basic-tabs" selected="{{selectedMedicinePage}}" scrollable="" hide-scroll-buttons="true">
                  <paper-tab class="p-horizontal-16">Patient Current Medicine</paper-tab>
                  <paper-tab class="p-horizontal-16">Add New Medicine</paper-tab>
                  <paper-tab class="p-horizontal-16">Pick From Favorite</paper-tab>
                </paper-tabs>

                <iron-pages selected="{{selectedMedicinePage}}">
                  <!-- current medicine - start -->
                  <section>
                    <template is="dom-if" if="[[_isEmpty(matchingCurrentMedicineList.length)]]">
                      <div class="card-content layout horizontal center center-justified">
                        <div class="type body secondary">-- empty --</div>
                      </div>
                    </template>

                    <div class="p-0 b-radius">
                      <paper-listbox>
                        <template id="current-medicine-list-repeater" is="dom-repeat" items="[[matchingCurrentMedicineList]]">
                          <paper-item class="custom layout horizontal center">
                            <div class="type caption secondary">[[_returnSerial(index)]]</div>
                            <div class="flex m-left-8">
                              <div class="layout horizontal wrap center">

                                <div class="flex">
                                  <div class="type body">{{item.data.brandName}} {{item.data.strength}}
                                    <span class="type caption bg-gray">[[item.data.manufacturer]]</span>
                                  </div>
                                  <div class="type caption italic secondary">{{item.data.genericName}} {{item.data.strength}}</div>
                                </div>

                                <div>
                                  <div class="type caption m-horizontal-4">
                                    <!-- <span>[[$TRANSLATE_NUMBER(item.data.dose, LANG)]] [[$TRANSLATE(item.data.form, LANG)]] [[$TRANSLATE('As', LANG)]]</span> -->
                                    <span hidden="[[!item.data.doseDirection]]">
                                      [[$TRANSLATE_NUMBER(item.data.doseDirection, LANG)]]</span>
                                    [[$TRANSLATE('for',LANG)]] [[_computeTotalDaysCount(item.data.endDateTimeStamp,item.data.startDateTimeStamp)]]
                                    <span hidden$="[[!item.data.endDateTimeStamp]]">[[$TRANSLATE('Days',LANG)]]</span>
                                  </div>

                                  <div class="type caption m-horizontal-4">
                                    <span>[[$TRANSLATE('By',LANG)]] </span>
                                    <span class="text-cap">[[$TRANSLATE(item.data.route, LANG)]]</span>
                                    <span>[[$TRANSLATE(item.data.direction, LANG)]] </span>
                                  </div>
                                  <div class="type caption m-horizontal-4">[[item.data.comments]]</div>
                                </div>

                              </div>
                            </div>
                            <paper-menu-button class="p-0 b-radius" vertical-align="bottom" horizontal-align="right">
                              <paper-icon-button icon="icons:more-vert" class="dropdown-trigger" alt="options"></paper-icon-button>
                              <paper-menu class="dropdown-content">
                                <paper-item on-tap="continueMedicinePressed">Continue</paper-item>
                                <paper-item on-tap="stopMedicinePressed">Stop</paper-item>
                              </paper-menu>
                            </paper-menu-button>
                          </paper-item>
                        </template>

                      </paper-listbox>
                    </div>
                  </section>
                  <!-- current medicine - end -->

                  <!-- add medicine - start -->
                  <section>
                    <div class="card-content">
                      <div class="layout horizontal justified center end">
                        <paper-toggle-button checked="{{showDetailedForm}}">Show Advanced</paper-toggle-button>
                      </div>
                      <div class="form-group">
                        <div>
                          <paper-autocomplete id="brandName" label="[[$TRANSLATE('Brand Name',LANG)]]" text="{{medicine.brandName}}" source="[[brandNameSourceDataList]]" on-autocomplete-selected="brandNameAutocompleteSelected" on-autocomplete-reset="brandNameCleared" min-length="2" on-input="validate" error-message="Input Required" required=""></paper-autocomplete>
                        </div>
                      </div>

                      <div hidden="[[!showDetailedForm]]">
                        <div class="form-group">
                          <div>
                            <paper-autocomplete id="genericName" label="[[$TRANSLATE('Generic Name',LANG)]]" text="{{medicine.genericName}}" source="[[genericNameSourceDataList]]" on-autocomplete-selected="genericNameAutocompleteSelected" on-autocomplete-reset="genericNameCleared" min-length="2" error-message="Input Required" on-input="validate" required=""></paper-autocomplete>
                          </div>
                          <div>
                            <paper-autocomplete id="manufacturer" label="[[$TRANSLATE('Manufacturer Name',LANG)]]" text="{{medicine.manufacturer}}" source="[[manufacturerSourceDataList]]" on-autocomplete-selected="manufacturerAutocompleteSelected" on-autocomplete-reset="manufacturerCleared" error-message="Input Required" min-length="2" on-input="validate" required=""></paper-autocomplete>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <!--Dose-->
                        <div>
                          <vaadin-combo-box label="Dose" items="[[doseList]]" allow-custom-value="true" value="{{medicine.doseDirection}}" on-value-changed="doseDirectionValueChanged"></vaadin-combo-box>
                        </div>
                        <!--Dose-->
                      </div>

                      <div class="form-group">
                        <!--Direction-->
                        <div>
                          <paper-dropdown-menu label="[[$TRANSLATE('Direction',LANG)]]">
                            <paper-menu selected="{{directionSelectedIndex}}" class="dropdown-content" on-iron-select="_directionSelectedIndexChanged">
                              <template is="dom-repeat" items="[[directionList]]">
                                <paper-item>[[$TRANSLATE(item,LANG)]]</paper-item>
                              </template>
                            </paper-menu>
                          </paper-dropdown-menu>
                        </div>
                        <!--Direction-->
                        <!--Form-->
                        <div>
                          <paper-dropdown-menu id="form" error-message="Chose an option" label="[[$TRANSLATE('Form',LANG)]]" required="">
                            <paper-menu selected="{{medicineFormSelectedIndex}}" class="dropdown-content" on-iron-select="_medicineFormSelectedIndexChanged">
                              <template is="dom-repeat" items="{{medicineFormList}}">
                                <paper-item>{{item}}</paper-item>
                              </template>
                            </paper-menu>
                          </paper-dropdown-menu>
                        </div>
                        <template is="dom-if" if="[[_isFormCustom(matchingMedicineList, medicineFormSelectedIndex)]]">
                          <div>
                            <paper-input label="Form" value="{{medicine.form}}" id="custom-form" error-message="Input Required" required=""></paper-input>
                          </div>
                        </template>
                        <!--Form-->
                      </div>

                      <div hidden="[[!showDetailedForm]]">
                        <div class="form-group">
                          <!--Strength-->
                          <template is="dom-if" if="[[_isStregnthDropdown(matchingMedicineList)]]">
                            <div>
                              <paper-dropdown-menu label="[[$TRANSLATE('Strength',LANG)]]" id="strength" error-message="Chose an Option">
                                <paper-menu id="strengthDropdown" selected="{{strengthSelectedIndex}}" class="dropdown-content" on-iron-select="_strengthSelectedIndexChanged">
                                  <template is="dom-repeat" items="{{strengthList}}">
                                    <paper-item>{{item}}</paper-item>
                                  </template>
                                </paper-menu>
                              </paper-dropdown-menu>
                            </div>
                          </template>
                          <template is="dom-if" if="[[_isStregnthCustom(matchingMedicineList, strengthSelectedIndex)]]">
                            <div>
                              <paper-input label="[[$TRANSLATE('Strength',LANG)]]" required="" value="{{medicine.strength}}" id="strength" error-message="Input Required" on-input="validate"></paper-input>
                            </div>
                          </template>
                          <!--Strength-->
                          <!--Route-->
                          <div>
                            <paper-dropdown-menu label="[[$TRANSLATE('Route',LANG)]]">
                              <paper-menu selected="{{routeSelectedIndex}}" class="dropdown-content" on-iron-select="_routeSelectedIndexChanged">
                                <template is="dom-repeat" items="[[routeList]]">
                                  <paper-item>[[$TRANSLATE(item,LANG)]]</paper-item>
                                </template>
                              </paper-menu>
                            </paper-dropdown-menu>
                          </div>
                          <template is="dom-if" if="[[_isRouteCustom(routeSelectedIndex)]]">
                            <div>
                              <paper-input label="[[$TRANSLATE('Route',LANG)]]" value="{{medicine.route}}" error-message="Input Required"></paper-input>
                            </div>
                          </template>
                          <!--Route-->
                        </div>

                        <div class="form-group">
                          <!--Unit-->
                          <div>
                            <paper-dropdown-menu id="doseUnit" error-message="Chose an option" label="[[$TRANSLATE('Unit',LANG)]]" required="">
                              <paper-menu selected="{{doseUnitSelectedIndex}}" class="dropdown-content" on-iron-select="_doseUnitSelectedIndexChanged">
                                <template is="dom-repeat" items="[[doseUnitList]]">
                                  <paper-item>{{item}}</paper-item>
                                </template>
                              </paper-menu>
                            </paper-dropdown-menu>
                          </div>
                          <template is="dom-if" if="[[_isUnitCustom(doseUnitSelectedIndex)]]">
                            <div>
                              <paper-input id="custom-dose-unit" label="Custom Unit" value="{{medicine.doseUnit}}" required="" error-message="Input Required"></paper-input>
                            </div>
                          </template>
                          <!--Unit-->
                        </div>
                      </div>


                      <div class="form-group layout horizontal end screen-sm">
                        <!--Start Date-->
                        <div>
                          <vaadin-date-picker label="[[$TRANSLATE('Start Date',LANG)]]" value="{{medicine.startDateTimeStamp}}"></vaadin-date-picker>
                        </div>
                        <!--Start Date-->

                        <!--End Date-->

                        <div>
                          <vaadin-date-picker id="endDate" label="[[$TRANSLATE('Ends on',LANG)]]" value="{{medicine.endDateTimeStamp}}"></vaadin-date-picker>
                        </div>
                        <div>
                          <paper-checkbox checked="{{medicine.continue}}" on-change="asNeededSelected">[[$TRANSLATE('Continue As Needed',LANG)]]</paper-checkbox>
                        </div>
                        <!--End Date-->
                      </div>

                      <br>
                      <br>

                      <div hidden="[[!showDetailedForm]]">
                        <div class="form-group">
                          <div>
                            <paper-textarea label="[[$TRANSLATE('Comments',LANG)]]" value="{{medicine.comments}}"></paper-textarea>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- <div class="layout horizontal end-justified">
                      <paper-checkbox class="remind" checked="{{medicine.remind}}">[[$TRANSLATE('Remind Me To Take This Medicine',LANG)]]</paper-checkbox>
                    </div> -->

                    <div class="preview-title layout end-justified" style="padding-top: 4px;">

                      <paper-button class="btn-dd" on-click="cancelButtonClicked">Clear</paper-button>
                      <paper-button class="btn-add" on-click="saveAndAddAsFavoriteMedicinePressed" raised="">
                        <iron-icon class="m-right-8" src="../../images/icons/medical-assistance-symbol.png"></iron-icon>Favorite</paper-button>
                      <paper-button class="btn-add colored" on-click="saveMedicineButtonClicked" raised="">
                        <iron-icon class="m-right-8" icon="add"></iron-icon>Add</paper-button>
                    </div>

                  </section>
                  <!-- add medicine - end -->

                  <!-- favorite medicine - start -->
                  <section>
                    <template is="dom-if" if="[[_isEmpty(matchingFavoriteMedicineList.length)]]">
                      <div class="card-content layout horizontal center center-justified">
                        <div class="type body secondary">-- empty --</div>
                      </div>
                    </template>

                    <div class="p-0 b-radius">
                      <paper-listbox>
                        <template id="favorite-medicine-list-repeater" is="dom-repeat" items="[[matchingFavoriteMedicineList]]">
                          <paper-item class="custom" on-tap="favoriteMedicineTapped">

                            <div class="custom-list-item">
                              <div class="item-header layout horizontal center">
                                <div class="type caption secondary">[[_returnSerial(index)]]</div>
                                <div class="flex m-left-8">
                                  <span class="type body capitalize">{{item.data.brandName}}</span>
                                  <span class="m-horizontal-4 type caption secondary italic lowercase">[ {{item.data.genericName}} {{item.data.strength}} ]</span>
                                  <span class="m-horizontal-4 type caption bg-gray">{{item.data.manufacturer}}</span>
                                </div>
                                <paper-icon-button class="m-left-8" icon="add" on-tap="addFavMedicineAsNewMedicineBtnPressed"></paper-icon-button>
                                <paper-icon-button icon="delete" on-tap="deleteFavoriteMedicinePressed"></paper-icon-button>

                              </div>

                              <div class="item-content" hidden$="[[_isFavoriteMedicineContentHidden(index, favoriteMedicineShownIndex)]]">

                                <div class="form-group screen-sm">
                                  <div>
                                    <paper-input label="Dose Administer Timing e.g 1+1+1" value="{{item.data.doseDirection}}"></paper-input>
                                  </div>

                                  <!--End Date-->
                                  <div>
                                    <paper-dropdown-menu id="duplicateMedicineEndDateTimeStamp" error-message="Chose an Date" label="Ends on">
                                      <paper-menu selected="{{endDateTimeTypeSelectedIndex}}" class="dropdown-content" on-iron-select="_endDateTimeTypeSelectedIndexChanged">
                                        <template is="dom-repeat" items="[[endDateTimeTypeList]]">
                                          <paper-item>[[item]]</paper-item>
                                        </template>
                                      </paper-menu>
                                    </paper-dropdown-menu>
                                    <template is="dom-if" if="[[computedEndDate]]">
                                      <span class="text-sm text-primary">Ends on [[computedEndDate]]</span>
                                    </template>
                                  </div>
                                  <!--If chosen Weeks-->
                                  <template is="dom-if" if="[[_isNthWeekSelectedAsEndDate(endDateTimeTypeSelectedIndex, endDateTimeTypeList)]]">
                                    <div>
                                      <paper-dropdown-menu label="Days">
                                        <paper-menu selected="{{endDateTimeTypeArgument2SelectedIndex}}" class="dropdown-content" on-iron-select="_endDateTimeTypeSelectedIndexChanged">
                                          <template is="dom-repeat" items="{{endDateTimeTypeArgument2List}}">
                                            <paper-item>{{item}}</paper-item>
                                          </template>
                                        </paper-menu>
                                      </paper-dropdown-menu>
                                    </div>
                                  </template>
                                  <!--If chosen Custom-->
                                  <template is="dom-if" if="[[_isCustomSelectedAsEndDate(endDateTimeTypeSelectedIndex, endDateTimeTypeList)]]">
                                    <div>
                                      <vaadin-date-picker label="Ends on" value="{{duplicateMedicineEditablePart.endDateTimeStamp}}"></vaadin-date-picker>
                                    </div>
                                  </template>
                                  <!--End Date-->

                                </div>
                              </div>
                            </div>
                          </paper-item>
                        </template>
                      </paper-listbox>
                    </div>
                  </section>
                  <!-- favorite medicine - start -->
                </iron-pages>
              </div>
              <!-- Card :: Prescription - end -->

              <!-- Card :: Patient Stay - start -->
              <template is="dom-if" if="[[_checkUserAccess('D015')]]">
                <div class="card-item-2">

                  <div class="preview-title layout">
                    <!-- <iron-icon class="m-right-8" src="../../images/icons/ico_patient_stay.png"></iron-icon> -->
                    <div class="type title-2 flex">Patient Stay</div>
                    <div class="action-area">
                      <paper-button class="btn-add m-vert" on-tap="savePatientStayPressed">
                        <iron-icon icon="icons:save"></iron-icon>
                      </paper-button>
                    </div>
                  </div>

                  <iron-pages selected="{{selectedView}}">

                    <section id="admission-section">

                      <div class="type body-lead p-vertical-8 p-horizontal-16">Type</div>
                      <div class="card-content layout vertical types">
                        <paper-radio-group id="admissionTypeRadioGroup" selected="{{patientStay.data.admissionType}}" class="layout vertical" on-iron-select="admissionTypeChanged">
                          <template is="dom-repeat" items="[[admissionTypeList]]">
                            <paper-radio-button name="[[item]]">[[item]]</paper-radio-button>
                          </template>
                        </paper-radio-group>

                        <template is="dom-if" if="[[!advisedAdmission]]">
                          <paper-input class="p-16" label="Advice" value="{{patientStay.data.advise}}"></paper-input>
                        </template>
                        <template is="dom-if" if="[[advisedAdmission]]">
                          <paper-input label="Referred By" value="{{patientStay.data.referredByDoctorName}}"></paper-input>
                          <paper-input label="Admitted By" value="{{patientStay.data.admittedByDoctorName}}"></paper-input>
                        </template>
                      </div>


                      <template is="dom-if" if="[[advisedAdmission]]">

                        <!-- Admission to - start -->
                        <div class="type body-lead p-vertical-8 p-horizontal-16">Admission to</div>
                        <div class="card-content layout horizontal start">
                          <div class="m-right-8">
                            <vaadin-date-picker label="Admission Date" value="{{patientStay.data.admissionDateTimeStamp}}"></vaadin-date-picker>
                          </div>
                          <paper-dropdown-menu class="m-right-8" label="Clinic/Hospital" id="organizationDropdown">
                            <paper-listbox class="dropdown-content" on-iron-select="organizationSelected" selected="{{selectedOrganizationIndex}}">
                              <template is="dom-repeat" items="[[organizationsIBelongToList]]" as="organization">
                                <paper-item>[[organization.name]]</paper-item>
                              </template>
                            </paper-listbox>
                          </paper-dropdown-menu>

                          <template is="dom-if" if="[[$notUndefined(selectedOrganizationIndex)]]">
                            <paper-dropdown-menu class="m-right-8" label="Department" id="departmentDropdown">
                              <paper-listbox class="dropdown-content" on-iron-select="departmentSelected" selected="{{selectedDepartmentIndex}}">
                                <template is="dom-repeat" items="[[patientStayObject.departmentList]]" as="department">
                                  <paper-item>[[department.name]]</paper-item>
                                </template>
                              </paper-listbox>
                            </paper-dropdown-menu>
                          </template>

                          <template is="dom-if" if="[[$notUndefined(selectedDepartmentIndex)]]">
                            <paper-dropdown-menu class="m-right-8" label="Unit" id="unitDropdown">
                              <paper-listbox class="dropdown-content" on-iron-select="unitSelected" selected="{{selectedUnitIndex}}">
                                <template is="dom-repeat" items="[[unitList]]" as="unit">
                                  <paper-item>[[unit.name]]</paper-item>
                                </template>
                              </paper-listbox>
                            </paper-dropdown-menu>
                          </template>

                          <template is="dom-if" if="[[$notUndefined(selectedUnitIndex)]]">
                            <paper-dropdown-menu class="m-right-8" label="Ward" id="wardDropdown">
                              <paper-listbox class="dropdown-content" on-iron-select="wardSelected" selected="{{selectedWardIndex}}">
                                <template is="dom-repeat" items="[[wardList]]" as="ward">
                                  <paper-item>[[ward.name]]</paper-item>
                                </template>
                              </paper-listbox>
                            </paper-dropdown-menu>
                          </template>
                        </div>
                        <!-- Admission to - end -->

                        <!-- Seat List - start -->
                        <template is="dom-if" if="[[seatList.length]]">
                          <div class="card-content">
                            <iron-list id="seatList" items="[[seatList]]" style="max-height: 300px;">
                              <template>
                                <paper-item class="layout horizontal seat center">
                                  <div class="m-right-16">
                                    <paper-input value="[[item.department]]" label="department" disabled="disabled"></paper-input>
                                  </div>
                                  <div class="m-right-16">
                                    <paper-input value="[[item.unit]]" label="unit" disabled="disabled"></paper-input>
                                  </div>
                                  <div class="m-right-16">
                                    <paper-input value="[[item.ward]]" label="ward" disabled="disabled"></paper-input>
                                  </div>
                                  <div class="m-right-16">[[item.name]]</div>
                                  <template is="dom-if" if="[[item.isOverflow]]">
                                    <div style="color: red">OVERFLOW</div>
                                  </template>
                                  <template is="dom-if" if="[[$equals(patient.serial, item.patientSerial)]]">
                                    Occupied by this patient ([[item.location]])
                                    <div hidden="">[[index]]</div>
                                    <paper-button class="btn btn-default btn-sm btn-danger" raised="" on-tap="dischargeTapped">Discharge</paper-button>
                                  </template>
                                  <template is="dom-if" if="[[!$equals(patient.serial, item.patientSerial)]]">
                                    <template is="dom-if" if="[[!item.patientSerial]]">
                                      Vacant &nbsp;
                                      <div hidden="">[[index]]</div>
                                      <paper-button class="btn btn-default btn-sm" raised="" on-tap="fillTapped">Fill</paper-button>
                                    </template>
                                    <template is="dom-if" if="[[item.patientSerial]]">
                                      Occupied
                                    </template>
                                  </template>
                                </paper-item>
                              </template>
                            </iron-list>
                          </div>
                          <div class="card-actions">
                            <paper-button class="btn btn-default" raised="" on-tap="addOverflow">Add as overflow</paper-button>
                          </div>
                        </template>
                        <!-- Seat List - end -->

                        <template is="dom-if" if="[[seatList.length]]">

                          <!-- Location Logs - start -->
                          <div class="type body-lead p-vertical-8 p-horizontal-16">Location Logs</div>
                          <div class="card-content" style="max-height: 200px;overflow: auto">
                            <template is="dom-repeat" items="[[patientStay.data.currentLocation]]" sort="_sortByDate">
                              <paper-item class="layout center">
                                <div class="flex">[[$mkDateTime(item.datetimeStamp)]] :
                                  <span class="type primary">[[item.location]]</span>
                                </div>
                                <paper-icon-button class="type danger" icon="delete" on-tap="deleteLocationEntry"></paper-icon-button>
                              </paper-item>
                            </template>
                          </div>
                          <!-- Location Logs - end -->

                          <!-- Patient's Current Location - start -->
                          <div class="type body-lead p-vertical-8 p-horizontal-16">Patient's Current Location</div>
                          <div class="card-content">
                            <paper-radio-group id="locationRadioGroup" selected="{{selectedLocation}}" class="layout" on-iron-select="locationChanged">
                              <template is="dom-repeat" items="[[patientStayObject.locations]]">
                                <paper-radio-button name="[[item]]">[[item]]</paper-radio-button>
                              </template>
                            </paper-radio-group>
                            <paper-textarea label="Custom Location" on-keyup="customLocationAdded"></paper-textarea>
                          </div>
                          <!-- Patient's Current Location - end -->

                        </template>

                      </template>
                    </section>

                    <section id="discharge-section">
                      <template is="dom-if" if="[[patientDischarged]]">

                        <!-- Discharged Reason - start -->
                        <div class="type body-lead p-vertical-8 p-horizontal-16">Discharged Reason</div>
                        <div class="card-content layout vertical discharge-reason">
                          <div>
                            <vaadin-date-picker class="m-left-16" label="Discharged Date" value="{{patientStay.data.dischargeDatetimeStamp}}"></vaadin-date-picker>
                            <br>
                          </div>
                          <div class="checkbox-group layout vertical m-left-16">
                            <template is="dom-repeat" items="[[dischargeReasonList]]">
                              <paper-checkbox on-change="dischargeReasonChanged" name="[[item]]">[[item]]</paper-checkbox>
                            </template>
                          </div>

                          <template is="dom-if" if="[[patientStay.data.dischargeReason.length]]">
                            <div class="p-16 bg-gray" style="text-align: left;">
                              <template is="dom-repeat" items="[[patientStay.data.dischargeReason]]">
                                <span class="type italic bold m-right-8 primary">[[item]]</span>,
                              </template>
                            </div>
                          </template>

                          <paper-textarea class="m-left-16" label="Discharged Custom Resaon" on-keyup="customDischargeReasonAdded"></paper-textarea>
                        </div>
                        <!-- Discharged Reason - end -->

                        <!-- Discharged - start -->
                        <div class="type body-lead p-vertical-8 p-horizontal-16">Discharged to</div>
                        <div class="card-content layout vertical discharge-reason">
                          <div class="checkbox-group layout vertical m-left-16">
                            <template is="dom-repeat" items="[[dischargedToList]]">
                              <paper-checkbox on-change="dischargedToChanged" name="[[item]]">[[item]]</paper-checkbox>
                            </template>
                          </div>
                          <template is="dom-if" if="[[patientStay.data.dischargeTo.length]]">
                            <div class="p-16 bg-gray" style="text-align: left;">
                              <template is="dom-repeat" items="[[patientStay.data.dischargeTo]]">
                                <span class="type italic bold m-right-8 primary">[[item]]</span>,
                              </template>
                            </div>
                          </template>
                          <paper-textarea class="m-left-16" label="Discharged To Custom Resaon" on-keyup="customDischargeToAdded"></paper-textarea>

                          <paper-input label="Discharged By" value="{{patientStay.data.dischargedByDoctorName}}"></paper-input>
                        </div>
                        <!-- Discharged - end -->

                      </template>
                    </section>

                  </iron-pages>
                </div>
              </template>
              <!-- Card :: Patient Stay - end -->

            </div>
          </div>
          <!-- visit content - end -->
        </paper-card>
        <!-- New Visit - end -->
      </div>
    </div>

    <!-- Dialog for - Continue Current Medication - start -->
    <paper-dialog id="dialogContinueCurrentMedication">
      <div>
        <vaadin-date-picker id="continueEndDate" label="[[$TRANSLATE('Ends on',LANG)]]" value="{{continueMedicineEndsOnDate}}"></vaadin-date-picker>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button on-click="addSelectedCurrentMedicine" autofocus="" raised="">Save</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Continue Current Medication - end -->

    <!-- Dialog for - Suggested Institution - start -->
    <paper-dialog id="dialogSuggestedInstitution">
      <div>
        <vaadin-combo-box label="Suggested Institution" items="{{machingUserAddedInstitutionList}}" allow-custom-value="true" on-keyup="comboBoxKeyUpSeggestedInstitutionNameChanged" value="{{suggestedInstitutionValue}}">
        </vaadin-combo-box>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <!-- <paper-button on-click="_saveSuggestedInstituonName" autofocus raised>Save</paper-button> -->
      </div>
    </paper-dialog>
    <!-- Dialog for - Suggested Institution - end -->

    <!-- Dialog for - Investigation Member Name - start -->
    <paper-dialog id="dialogInvestigationMemberValue">
      <div>
        <paper-input label="Add Test" value="{{investigationMemberValue}}"></paper-input>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button on-click="addInvestigationMember" autofocus="" raised="">Add</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Investigation Member Name - end -->

    <!-- Dialog for - Examination Member Name - start -->
    <paper-dialog id="dialogExaminationMemberValue">
      <div>
        <paper-input label="Add Examination" value="{{customExaminationValue}}"></paper-input>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button on-click="addExaminationMember" autofocus="" raised="">Add</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Examination Member Name - end -->

    <!-- Dialog for - Custom Investigation - start -->
    <paper-dialog id="dialogCustomInvestigation">

      <div class="dialog-content">
        <div class="type body-lead" style="color: green;">[[comboBoxInvestigationInputValue]]</div>
        <paper-input label="[[$TRANSLATE('Reference Range',LANG)]]" value="{{customInvestigationObject.data.investigationList.0.referenceRange}}"></paper-input>

        <div class="horizontal layout center wrap">
          <paper-input class="flex" label="[[$TRANSLATE('Add Unit',LANG)]]" value="{{customInvestigationUnitValue}}"></paper-input>
          <paper-icon-button icon="add" on-click="_addUnitValueForCustomInvestigation"></paper-icon-button>
        </div>

        <div>
          <template is="dom-if" if="{{!_isEmpty(customInvestigationUnitList.length)}}">
            <strong>Added Units: </strong>
            <div class="horizontal layout wrap">
              <template is="dom-repeat" items="{{customInvestigationUnitList}}">
                <div class="card-item horizontal layout center">
                  <div class="type body flex p-horizontal-8">{{item}}</div>
                  <div style="border-left: 1px solid #eee;" class="horizontal layout center">
                    <paper-icon-button style="color: red;" icon="delete" on-tap="_deleteSelectedUnit"></paper-icon-button>
                  </div>
                </div>
              </template>
            </div>

          </template>
        </div>

      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button class="btn btn-success" on-click="_saveCustomInvestigation" autofocus="" raised="">Save</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Custom Investigation - end -->


    <!-- Dialog for - Favorite Investigation - start -->
    <paper-dialog id="dialogFavoriteInvestigation">
      <div class="type body-lead">Add Test</div>
      <div class="dialog-content">
        <template is="dom-repeat" items="[[favoriteInvestigaitonList]]">
          <paper-checkbox checked="{{item.isSelected}}">{{item.data.name}}</paper-checkbox>
        </template>
      </div>

      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button class="colored" on-click="addInvestigationFromFavorite" autofocus="" raised="">Add</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Custom Investigation - end -->

    <!-- Dialog - Visit Settings - start -->
    <paper-dialog id="dialogVisitSettings">
      <div class="dialog-content">
        <div class="type body-lead">
          <iron-icon icon="icons:settings" class="m-right-8 "></iron-icon>Visit Settings</div>


        <vaadin-combo-box class="flex combobox-custom-style" label="Change Record Title" id="comboBoxRecordTitle" items="{{visitHeaderTitleList}}" allow-custom-value="true" on-keyup="comboBoxKeyUpRecordTitleValueChanged" value="{{visit.recordTitle}}"></vaadin-combo-box>
        <paper-dropdown-menu label="Institution " class="flex ">
          <paper-listbox class="dropdown-content " selected="{{doctorInstitutionSelectedIndex}} " on-iron-select="_institutionSelectedIndexChanged ">
            <template is="dom-repeat " items="{{doctorInstitutionList}} ">
              <paper-item>{{item}}</paper-item>
            </template>

          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="Speciality " class="flex ">
          <paper-listbox class="dropdown-content " selected="{{doctorSpecialitySelectedIndex}} " on-iron-select="_specialitySelectedIndexChanged ">
            <template is="dom-repeat " items="{{doctorSpecialityList}} ">
              <paper-item>{{item}}</paper-item>
            </template>

          </paper-listbox>
        </paper-dropdown-menu>
      </div>

      <div class="buttons ">
        <paper-button dialog-dismiss="" autofocus="" raised="" on-tap="saveVisitSettings">
          <iron-icon icon="save" class="m-right-8"></iron-icon>Save</paper-button>
      </div>
    </paper-dialog>

    <!-- Dialog for - Referral start -->
    <paper-dialog id="dialogReferral" style="width: 360px">
      <h2>Add Referral</h2>
      <div class="p-16">
        <paper-dropdown-menu label="Select Referral Type">
          <paper-listbox class="dropdown-content" selected="{{selectedReferralTypeIndex}}">
            <paper-item>Doctor</paper-item>
            <paper-item>Hospital</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>

        <template is="dom-if" if="[[!selectedReferralTypeIndex]]">
          <paper-input label="Referred By" value="[[user.name]]"></paper-input>
          <div>
            <paper-autocomplete id="doctorSearch" label="[[$TRANSLATE('Search for Doctor',LANG)]]" text="{{doctorSearchFieldInput}}" text-property="name" value-property="idOnServer" remote-source="true" on-autocomplete-reset="doctorSearchCleared" on-keyup="doctorSearchStartKeyPressed" error-message="Input Required" required="">
              <template autocomplete-custom-template="">
                <paper-item on-tap="_onSelect" id$="[[_getSuggestionId(index)]]" role="option" aria-selected="false">
                  <paper-item-body two-line="">
                    <div class="type bold">[[item.name]]</div>
                    <div secondary="">
                      <span class="type secondary caption-2">([[item.phone]])</span>
                      <span class="type secondary caption-2 m-left-8">[[item.email]]</span>
                    </div>
                  </paper-item-body>
                  <paper-ripple></paper-ripple>
                </paper-item>
              </template>
            </paper-autocomplete>
            <paper-button class="btn btn-success" on-tap="doctorSearchButtonPressed">Search</paper-button>
          </div>
          <paper-dropdown-menu label="Specialist Type">
            <paper-listbox class="dropdown-content" selected="{{referredDoctorSpecialitySelectedIndex}}">
              <template is="dom-repeat" items="[[referredDoctorSpecialityList]]">
                <paper-item>[[item]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
        </template>


        <template is="dom-if" if="[[selectedReferralTypeIndex]]">
          <paper-autocomplete class="flex" id="organizationSearch" label="[[$TRANSLATE('Search for Hospital',LANG)]]" text="{{organizationSearchFieldInput}}" text-property="name" value-property="idOnServer" remote-source="true" on-autocomplete-selected="organizationSelected" on-autocomplete-reset="organizationSearchCleared" on-keyup="organizationSearchStartKeyPressed" error-message="Input Required" required="">
            <template autocomplete-custom-template="">
              <paper-item on-tap="_onSelect" id$="[[_getSuggestionId(index)]]" role="option" aria-selected="false">
                <div class="type bold">[[item.name]]</div>
                <paper-ripple></paper-ripple>
              </paper-item>
            </template>
          </paper-autocomplete>
          <paper-button class="btn btn-success" on-tap="organizationSearchButtonPressed">Search</paper-button>
        </template>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button class="btn btn-primary" on-tap="addReferralButtonClicked">Add Referral</paper-button>
      </div>
    </paper-dialog>
    <!-- Dialog for - Referral start -->

    <!-- Print Preview Area - start -->
    <div id="printPreview">
      <div class="print-header horizontal layout center">
        <template is="dom-if" if="[[settings.printDecoration.logoDataUri]]">
          <div class="m-right-16">
            <img style="max-width: 42px; height: auto;" class="logo" src="[[settings.printDecoration.logoDataUri]]" alt="">
          </div>
        </template>
        <h1>[[settings.printDecoration.headerLine]]</h1>
      </div>

      <!-- Print Header - Main - start -->
      <div class="">
        <table class="table">
          <tbody><tr>
            <th>Consultation Site:</th>
            <td>[[organization.name]]</td>
          </tr>
          <tr>
            <th>Consultant Name:</th>
            <td>[[visit.doctorName]]</td>
          </tr>
          <tr>
            <th>Consultant Grade</th>
            <td></td>
          </tr>
          <tr>
            <th>Patient Id / Policy Id:</th>
            <td>
              <template is="dom-if" if="[[patient.policyList.length]]">
                <template is="dom-repeat" items="[[patient.policyList]]" as="policy">
                  <span class="">[[policy.number]]</span>
                </template>
              </template>
            </td>
          </tr>
          <tr>
            <th>Patient Name:</th>
            <td>{{$getFullName(patient.name)}}</td>
          </tr>
          <tr>
            <th>Age/Sex:</th>
            <td>[[_computeAge(patient.dateOfBirth)]] years / {{patient.gender}}</td>
          </tr>
          <tr>
            <th>Blood Group</th>
            <td>[[patient.bloodGroup]]</td>
          </tr>
          <tr>
            <th>Allergies</th>
            <td>[[patient.allergy]]</td>
          </tr>
          <tr>
            <th>Factory name:</th>
            <td>
              <template is="dom-if" if="[[patient.employmentDetailsList.length]]">
                <template is="dom-repeat" items="[[patient.employmentDetailsList]]" as="factory">
                  [[factory.institutionName]]
                </template>
              </template>
            </td>
          </tr>
          <tr>
            <th>Prescription Id:</th>
            <td>[[visit.serial]]</td>
          </tr>
          <tr>
            <th>Date &amp; Time:</th>
            <td>[[$mkDateTime(visit.createdDatetimeStamp)]]</td>
          </tr>
        </tbody></table>
      </div>
      <br>
      <br>
      <!-- Print Header - Main - end -->

      <!-- Print Header - record Title - start -->
      <div class="p-16 horizontal layout center center-justified" hidden$="{{!printPrescriptionOnly}}">
        <div class="type headline">{{visit.recordTitle}}</div>
      </div>
      <!-- Print Header - record Title - start -->

      <!-- Print Content [FULL] - start -->
      <div class="print-content" hidden$="{{printPrescriptionOnly}}">
        <!-- Print Content - Left - start -->
        <div class="left">

          <!-- Print - Symptoms - start -->
          <template is="dom-if" if="[[!_isEmpty(addedIdentifiedSymptomsList.length)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Symptoms</div>
            </div>
            <template is="dom-repeat" items="[[addedIdentifiedSymptomsList]]">
              <div class="type caption-2">
                <span class="type secondary">[[_returnSerial(index)]]. </span>
                <span>{{item.name}}</span>
                <template is="dom-if" if="[[_compareFn(item.possibleValueList.length, '>', 0)]]">
                  (
                  <template is="dom-repeat" items="[[item.possibleValueList]]">
                    <span>{{item}}, </span>
                  </template>)
                </template>
              </div>
            </template>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - Symptoms - end -->

          <!-- Print - Examination - start -->
          <template is="dom-if" if="[[!_isEmpty(addedExaminationList2.length)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Examination</div>
            </div>
            <template is="dom-repeat" items="[[addedExaminationList2]]" as="examination">
              <div class="type caption-2">
                <span class="type secondary">[[_returnSerial(index)]]. </span>
                <span>{{examination.name}}</span>
                (
                <template is="dom-repeat" items="[[examination.examinationValueList]]" as="examItem">
                  <span hidden$="{{!examItem.checked}}">{{examItem.value}}, </span>
                </template>)
              </div>
            </template>
            <div class="b-top m-top-8 "></div>
          </template>
          <!-- Print - Examination - end -->

          <!-- Print - Vitals - start -->
          <template is="dom-if" if="[[!_isEmpty(addedVitalList.length)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Vitals</div>
            </div>
            <template is="dom-repeat" items="[[addedVitalList]]">
              <div class="type caption-2">
                <strong>{{item.vitalType}}: </strong>
                <span>[[_pritifyVitalData(item)]]</span>
              </div>
            </template>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - Vitals - end -->

          <!-- Print - Test Advised - start -->
          <template is="dom-if" if="[[!_isEmpty(addedInvestigationList.length)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Advised Test</div>
            </div>
            <template is="dom-repeat" items="[[addedInvestigationList]]">
              <div class="type caption-2 layout horizontal">
                <div class="type secondary m-right-8">[[_returnSerial(index)]]. </div>
                <div class="flex vertical layout">
                  <div>{{item.investigationName}}</div>
                  <template is="dom-if" if="[[_compareFn(item.testList.length, '==', 1)]]">
                    <ol class="order-list">
                      <li>{{item.testList.0.name}}</li>
                    </ol>
                  </template>
                  <template is="dom-if" if="[[_compareFn(item.testList.length, '>', 1)]]">
                    <ol class="order-list">
                      <template is="dom-repeat" items="[[item.testList]]">
                        <li>{{item.name}}</li>
                      </template>
                    </ol>
                  </template>
                </div>
                <template is="dom-if" if="[[item.suggestedInstitutionName]]">
                  <div class="type caption secondary m-left-16">
                    <strong>Suggested Institution: </strong>
                    <span class="flex">{{item.suggestedInstitutionName}}</span>
                  </div>
                </template>
              </div>
            </template>
            <div class="b-top"></div>
          </template>
          <!-- Print - Test Advised - end -->

          <!-- Print - Diagnosis - start -->
          <template is="dom-if" if="{{!_isEmpty(diagnosis.data.diagnosisList.length)}}">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Diagnosis</div>
            </div>
            <template is="dom-repeat" items="[[diagnosis.data.diagnosisList]]">
              <div class="type caption-2">
                <span class="type secondary">[[_returnSerial(index)]]. </span>
                <span>{{item.name}}</span>
                <template is="dom-if" if="[[_compareFn(item.possibleValueList.length, '>', 0)]]">
                  (
                  <template is="dom-repeat" items="[[item.possibleValueList]]">
                    <span>{{item}}, </span>
                  </template>)
                </template>
              </div>
            </template>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - Diagnosis - end -->

          <!-- Print Referral Start -->

          <div class="layout horizontal">
            <span class="type bold">Referred By: </span> [[referral.data.referredByDoctorName]]
          </div>
          <template is="dom-if" if="[[referral.data.doctorName]]">
            <div class="layout horizontal">
              <span class="type bold">Referred To: </span> [[referral.data.doctorName]]
            </div>
            <div class="layout horizontal">
              <span class="type bold">Speciality: </span> [[referral.data.speciality]]</div>
          </template>
          <template is="dom-if" if="[[referral.data.organizationName]]">
            <div class="layout horizontal">
              <span class="type bold">Organization Name: </span> [[referral.data.organizationName]]</div>
          </template>
          <!-- Print Referral end -->

          <!-- Print - Notes - start -->
          <template is="dom-if" if="{{!_isEmpty(doctorNotes.data.messageList.length)}}">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Doctor Advised/Notes</div>
            </div>
            <ul class="unorderd-list-custom">
              <template is="dom-repeat" items="[[doctorNotes.data.messageList]]">
                <li class="type caption-2" style="word-break: break-word; margin-right: 4px;">{{item}}</li>
              </template>
            </ul>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - Notes - end -->

          <!-- Print - Next Visit - start -->
          <template is="dom-if" if="[[!_isEmptyString(nextVisit.data.nextVisitDateTimestamp)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body">Next Visit</div>
            </div>
            <div class="type caption-2">
              <div>
                <strong>Date: </strong>
                <span>[[$mkDate(nextVisit.data.nextVisitDateTimestamp)]]</span>
              </div>
              <div>{{nextVisit.data.priorityType}}</div>
            </div>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - Next Visit - end -->
        </div>
        <!-- Print Content - Left - end -->

        <!-- Print Content - right - start -->
        <div class="right">

          <!-- Print - History And Physical - start -->
          <template is="dom-if" if="[[shouldRender]]">
            <div class="horizontal layout center">
              <div class="type body print-sub-header">[[recordPartTitle]]</div>
            </div>
            <div class="p-horizontal-16">
              <html-block html="[[recordPartHtmlContent]]"></html-block>
            </div>
            <div class="b-top m-top-8"></div>
          </template>
          <!-- Print - History And Physical - end -->

          <br>
          <br>

          <!-- Print - Prescription - start -->
          <template is="dom-if" if="[[!_isEmpty(matchingPrescribedMedicineList.length)]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body p-left-16">Prescription</div>
            </div>

            <template is="dom-repeat" items="[[matchingPrescribedMedicineList]]">
              <div class="m-vertical-8 p-left-16 horizontal layout center">
                <div class="type caption secondary m-right-8">[[_returnSerial(index)]].</div>
                <div>
                  <div>
                    <span class="type caption-2 text-bold">{{item.data.brandName}}</span>
                    <span class="type caption bg-gray">[[item.data.manufacturer]]</span>
                    <span class="type caption italic">{{item.data.genericName}} {{item.data.strength}}</span>
                  </div>


                  <div class="type caption">
                    <strong>Instruction: </strong>
                    <span>[[$TRANSLATE_NUMBER(item.data.doseDirection, LANG)]] [[$TRANSLATE('for', LANG)]] [[_computeTotalDaysCount(item.data.endDateTimeStamp,item.data.startDateTimeStamp)]]
                      <span hidden$="[[!item.data.endDateTimeStamp]]">[[$TRANSLATE('Days',LANG)]]</span>
                    </span>
                    <span>[[$TRANSLATE('By', LANG)]] </span>
                    <span>[[$TRANSLATE(item.data.route, LANG)]]</span>
                    <span>[[$TRANSLATE(item.data.direction, LANG)]] </span>
                  </div>
                  <div class="type caption">[[item.data.comments]]</div>
                </div>
              </div>
            </template>

          </template>
          <!-- Print - Prescription - end -->
          <br>
          <!-- Patient Stay Preview -->
          <template is="dom-if" if="[[patientStay.serial]]">
            <div class="horizontal layout center print-sub-header">
              <div class="type body p-left-16">Patient Stay</div>
            </div>
            <div class="p-horizontal-16">
              <div class="layout horizontal">
                <span class="type bold"> Admission Date: </span>
                <span>&nbsp;[[$mkDate(patientStay.data.admissionDateTimeStamp)]]</span>
              </div>
              <div>
                <span class="type bold">Type: </span> [[patientStay.data.admissionType]]
              </div>
              <template is="dom-if" if="[[patientStay.adviseOnly]]">
                <div>
                  <span class="type bold">Advice: </span> [[patientStay.data.advise]]
                </div>
              </template>
              <template is="dom-if" if="[[!patientStay.adviseOnly]]">
                <div>
                  <span class="type bold">Referred By: </span> [[patientStay.data.referredByDoctorName]]
                </div>
                <div>
                  <span class="type bold">Admitted By: </span> [[patientStay.data.admittedByDoctorName]]
                </div>
                <div class="type italic">
                  <span>[[patientStay.data.locationHospitalName]]</span> &gt;
                  <span>[[patientStay.data.locationDepartment]]</span> &gt;
                  <span>[[patientStay.data.locationUnit]]</span> &gt;
                  <span>[[patientStay.data.locationWard]]</span> &gt;
                  <span>[[patientStay.data.locationBed]]</span>
                </div>
              </template>
              <template is="dom-if" if="[[patientStay.data.currentLocation.length]]">
                <div>
                  <span class="type bold"> Current Location:</span>
                  <span>[[patientStay.data.currentLocation.0.location]]</span>
                </div>
              </template>
              <template is="dom-if" if="[[patientStay.data.dischargeDatetimeStamp]]">
                <div>
                  <span class="type bold"> Discharge Date:</span>
                  <span>[[$mkDate(patientStay.data.dischargeDatetimeStamp)]]</span>
                </div>
                <div>
                  <span class="type bold">Discharged By: </span> [[patientStay.data.dischargedByDoctorName]]
                </div>
                <div>
                  <span class="type bold"> Length of Stay:</span>
                  <span>[[calculateLengthOfStay(patientStay.data.admissionDateTimeStamp, patientStay.data.dischargeDatetimeStamp)]]
                    Days
                  </span>
                </div>
              </template>
              <template is="dom-if" if="[[patientStay.data.dischargeReason.length]]">
                <div>
                  <span class="type bold">Discharge Reason: </span> [[patientStay.data.dischargeReason]]</div>
              </template>
              <template is="dom-if" if="[[patientStay.data.dischargeTo.length]]">
                <div>
                  <span class="type bold"> Discharged To:</span> [[patientStay.data.dischargeTo]]</div>
              </template>
            </div>
          </template>
          <!-- Patient Stay Preview End -->
        </div>
        <!-- Print Content - right - end -->
      </div>
      <!-- Print Content [FULL] - end -->

      <!-- Print Content - [Prescripton only] - start -->
      <div hidden$="{{!printPrescriptionOnly}}">
        <template is="dom-if" if="[[!_isEmpty(matchingPrescribedMedicineList.length)]]">
          <div class="horizontal layout center print-sub-header">
            <div class="type body p-left-16">Prescription</div>
          </div>

          <template is="dom-repeat" items="[[matchingPrescribedMedicineList]]">
            <div class="m-vertical-8 p-left-16 horizontal layout center">
              <div class="type caption secondary m-right-8">[[_returnSerial(index)]].</div>
              <div>
                <div>
                  <span class="type caption-2 text-bold">{{item.data.brandName}}</span>
                  <span class="type caption bg-gray">[[item.data.manufacturer]]</span>
                  <span class="type caption italic">{{item.data.genericName}} {{item.data.strength}}</span>
                </div>


                <div class="type caption">
                  <strong>Instruction: </strong>
                  <span>[[$TRANSLATE_NUMBER(item.data.doseDirection, LANG)]] [[$TRANSLATE('for', LANG)]] [[_computeTotalDaysCount(item.data.endDateTimeStamp,item.data.startDateTimeStamp)]]
                    <span hidden$="[[!item.data.endDateTimeStamp]]">[[$TRANSLATE('Days',LANG)]]</span>
                  </span>
                  <span>[[$TRANSLATE('By', LANG)]] </span>
                  <span>[[$TRANSLATE(item.data.route, LANG)]]</span>
                  <span>[[$TRANSLATE(item.data.direction, LANG)]] </span>
                </div>
                <div class="type caption">[[item.data.comments]]</div>
              </div>
            </div>
          </template>
        </template>
      </div>
      <!-- Print Content - [Prescripton only] - end -->

      <div class="footer">

        <div class="horizontal layout end-justified center">
          <template is="dom-if" if="[[settings.printDecoration.signatureDataUri]]">
            <img height="96" width="128" class="logo" src="[[settings.printDecoration.signatureDataUri]]" alt="signature">
          </template>
        </div>
        <div class="type caption p-8">
          <strong>Printed By: </strong>[[user.name]], <strong>Printed On: </strong>[[getPrintedOnTime()]]
        </div>

        <div class="horizontal layout center b-top">
          <div class="partner-logo layout">
            <div class="horizontal layout center center-justified">
              <template is="dom-if" if="[[settings.printDecoration.partner1LogoDataUri]]">
                <img style="max-width: 42px; height: auto;" class="logo" src="[[settings.printDecoration.partner1LogoDataUri]]" alt="">
              </template>
              <template is="dom-if" if="[[settings.printDecoration.partner2LogoDataUri]]">
                <img style="max-width: 42px; height: auto;" class="logo" src="[[settings.printDecoration.partner2LogoDataUri]]" alt="">
              </template>
              <template is="dom-if" if="[[settings.printDecoration.partner3LogoDataUri]]">
                <img style="max-width: 42px; height: auto;" class="logo" src="[[settings.printDecoration.partner3LogoDataUri]]" alt="">
              </template>
            </div>
          </div>
          <template is="dom-if" if="[[settings.flags.showFooterLine]]">
            <div class="type caption secondary">[[settings.printDecoration.footerLine]]</div>
          </template>
        </div>

      </div>
    </div>
    <!-- Print Preview Area - end -->

    <!-- local DOM -->
  </template>
  <script>(function(){app.behaviors.local.patientStayMixin||(app.behaviors.local.patientStayMixin={}),app.behaviors.local.patientStayMixin={properties:{selectedView:{type:Number,value:function(){return 0}},patientStay:{type:Object,notify:!0,value:function(){return null}},patientStayObject:{type:Object,notify:!0,value:function(){return null}},organizationsIBelongToList:{type:Array,value:function(){return[]}},admissionTypeList:{type:Array,value:function(){return["Out patient/ Discharged with advice","Out patient/ Advised admission","Seen in emergency/ Discharged with advice","Seen in emergency/ Advised admission"]}},locationList:{type:Array,value:function(){return[]}},dischargeReasonList:{type:Array,value:function(){return["Patient Got better","Patient require care at bigger facility","Patient care not possible at current facility","Patient do not require further stay at hospital","Death"]}},dischargedToList:{type:Array,value:function(){return["Home","Rehabilitation","Mortuary"]}},selectedOrganizationIndex:{type:Number,value:function(){return null}},selectedDepartmentIndex:{type:Number,value:function(){return null},observer:"departmentSelected"},selectedUnitIndex:{type:Number,value:function(){return null},observer:"unitSelected"},selectedWardIndex:{type:Number,value:function(){return null},observer:"wardSelected"},seatList:{type:Array,value:function(){return[]}},patientDischarged:{type:Boolean,value:function(){return!1}},advisedAdmission:{type:Boolean}},_notifyInvalidPatientStay:function(){return this.isPatientStayValid=!1,this.domHost.showModalDialog("Invalid Patient Stay Provided")},_loadVisitPatientStay:function(t){var e;if(e=app.db.find("visit-patient-stay",function(e){var i;return i=e.serial,i===t}),1===e.length){if(this.isPatientStayValid=!0,this.isFullVisitValid=!0,this.set("patientStay",e[0]),this.patientStay.adviseOnly===!0)return;return this.async(function(t){return function(){return t.patientStay.data.admissionDateTimeStamp=t.$mkDate(t.patientStay.data.admissionDateTimeStamp)}}(this)),this._loadOrganizationsIBelongTo(function(t){return function(){var e;return e=t.patientStay.organizationQueryParameters,t.set("selectedOrganizationIndex",e.selectedOrganizationIndex),t._loadPatientStayObject(t.organizationsIBelongToList[t.selectedOrganizationIndex].idOnServer,function(){return t._loadDropdowns()})}}(this))}return this._notifyInvalidPatientStay()},_loadOrganizationsIBelongTo:function(t){var e;return e={apiKey:this.user.apiKey},this.callApi("/bdemr-organization-list-those-user-belongs-to",e,function(e){return function(i,a){return a.hasError?e.domHost.showModalDialog(a.error.message):(e.set("organizationsIBelongToList",a.data.organizationObjectList),t?t():void 0)}}(this))},_loadDropdowns:function(){var t;if("organizationQueryParameters"in this.patientStay)return t=this.patientStay.organizationQueryParameters,this.set("selectedOrganizationIndex",t.selectedOrganizationIndex),this.set("selectedDepartmentIndex",t.selectedDepartmentIndex),this.set("selectedUnitIndex",t.selectedUnitIndex),this.set("selectedWardIndex",t.selectedWardIndex)},$notUndefined:function(t){return null!=t},_loadPatientStayObject:function(t,e){var i;return i={apiKey:this.user.apiKey,organizationId:t},this.callApi("/bdemr-organization-patient-stay-get-object",i,function(t){return function(i,a){return a.hasError?t.domHost.showModalDialog(a.error.message):(t.set("patientStayObject",a.data.patientStayObject),t.patientStayObject.locations||(t.patientStayObject.locations=["Absconded","Bed","CT","Discharged but waiting in bed","Doctors chamber outside hospital","Laboratory","Out of bed on permission","Pathology","Ultrasound","X-ray","Nil"]),e?e():void 0)}}(this))},organizationSelected:function(t){if(null!=this.selectedOrganizationIndex)return this.set("organization",this.organizationsIBelongToList[this.selectedOrganizationIndex]),this._loadPatientStayObject(this.organization.idOnServer,function(t){return function(){return t.async(function(){return this._populateSeatList()})}}(this))},departmentSelected:function(t){var e;if(null!=this.selectedDepartmentIndex)return e=this.patientStayObject.departmentList[this.selectedDepartmentIndex],this.department=e,this.set("unitList",e.unitList),this.debounce("iron-select",function(){return this._populateSeatList(this.department)},50)},unitSelected:function(t){var e;if(null!=this.selectedUnitIndex)return e=this.department.unitList[this.selectedUnitIndex],this.unit=e,this.set("wardList",e.wardList),this.debounce("iron-select",function(){return this._populateSeatList(this.department,this.unit)},50)},wardSelected:function(t){var e;if(null!=this.selectedWardIndex)return e=this.unit.wardList[this.selectedWardIndex],this.ward=e,this.debounce("iron-select",function(){return this._populateSeatList(this.department,this.unit,this.ward)},50)},_populateSeatList:function(t,e,i){var a,n;return null==t&&(t=null),null==e&&(e=null),null==i&&(i=null),i?(n=function(){var n,s,r,o;for(r=this.patientStayObject.seatList,o=[],n=0,s=r.length;n<s;n++)a=r[n],t.name===a.department&&e.name===a.unit&&i.name===a.ward&&o.push(a);return o}.call(this),this.set("seatList",n)):e?(n=function(){var i,n,s,r;for(s=this.patientStayObject.seatList,r=[],i=0,n=s.length;i<n;i++)a=s[i],t.name===a.department&&e.name===a.unit&&r.push(a);return r}.call(this),this.set("seatList",n)):t?(n=function(){var e,i,n,s;for(n=this.patientStayObject.seatList,s=[],e=0,i=n.length;e<i;e++)a=n[e],t.name===a.department&&s.push(a);return s}.call(this),this.set("seatList",n)):(this.set("seatList",this.patientStayObject.seatList),this.$$("#seatList").fire("iron-resize"))},fillTapped:function(t){var e,i,a,n,s;for(n=this.seatList,i=e=0,a=n.length;e<a;i=++e)s=n[i],s.patientSerial===this.patient.serial&&(this.set("seatList."+i+".patientSerial",null),this.set("seatList."+i+".location",""));return this.set("seatList."+t.model.index+".patientSerial",this.patient.serial),this.set("seatList."+t.model.index+".location","Nil"),this.savePatientStayObject()},dischargeTapped:function(t){return this.set("seatList."+t.model.index+".patientSerial",null),this.set("seatList."+t.model.index+".location",""),this.unshift("patientStay.data.currentLocation",{datetimeStamp:lib.datetime.now(),location:"Discharged"}),this.patientDischarged=!0,this.set("selectedView",1),this.patientStay.data.dischargedByDoctorName=this.user.name},addOverflow:function(){var t;return t={department:this.department.name,unit:this.unit.name,ward:this.ward.name},t.patientSerial=this.patient.serial,t.name="Overflow Seat",t.uid=this.patientStayObject.seatSeed++,t.isOverflow=!0,this.push("seatList",t)},admissionTypeChanged:function(t){switch(this.patientStay.data.admissionType){case"Out patient/ Discharged with advice":case"Seen in emergency/ Discharged with advice":return this.advisedAdmission=!1;case"Out patient/ Advised admission":case"Seen in emergency/ Advised admission":return this.advisedAdmission=!0;default:return this.showAdmission=!0}},customLocationAdded:function(t){var e,i,a,n,s,r,o,d;if(13===t.keyCode){for(d=t.target.value,t.target.value="",this.push("patientStayObject.locations",d),e=this.$$("#locationRadioGroup"),e.selected=d,s=this.seatList,r=[],a=i=0,n=s.length;i<n;a=++i)o=s[a],o.patientSerial===this.patient.serial?r.push(this.set("seatList."+a+".location",d)):r.push(void 0);return r}},locationChanged:function(t){var e,i,a,n,s,r;for(n=this.seatList,s=[],i=e=0,a=n.length;e<a;i=++e){if(r=n[i],r.patientSerial===this.patient.serial){this.set("seatList."+i+".location",this.selectedLocation),this.unshift("patientStay.data.currentLocation",{datetimeStamp:lib.datetime.now(),location:this.selectedLocation});break}s.push(void 0)}return s},dischargeReasonChanged:function(t){var e,i,a;return e=t.target.checked,a=t.target.name,e?this.push("patientStay.data.dischargeReason",a):(i=this.patientStay.data.dischargeReason.indexOf(a))>-1?this.splice("patientStay.data.dischargeReason",i,1):void 0},customDischargeReasonAdded:function(t){var e;if(13===t.keyCode)return e=t.target.value,t.target.value="",this.push("patientStay.data.dischargeReason",e)},dischargedToChanged:function(t){var e,i,a;return e=t.target.checked,a=t.target.name,e?this.push("patientStay.data.dischargeTo",a):(i=this.patientStay.data.dischargeTo.indexOf(a))>-1?this.splice("patientStay.data.dischargeTo",i,1):void 0},customDischargeToAdded:function(t){var e;if(13===t.keyCode)return e=t.target.value,t.target.value="",this.push("patientStay.data.dischargeTo",e)},$findCreator:function(t){return"me"},_makeNewPatientStay:function(){var t;return t={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,visitSerial:null,patientSerial:this.patient.serial,adviseOnly:!1,data:{referredByDoctorName:"",admittedByDoctorName:this.user.name,admissionDateTimeStamp:this.$mkDate(new Date),admissionType:"",advise:"",locationHospitalName:"",locationDepartment:"",locationUnit:"",locationWard:"",locationBed:"",currentLocation:[],dischargedByDoctorName:"",dischargeDatetimeStamp:null,dischargeReason:[],dischargeTo:[]}},this.set("patientStay",t),this.isPatientStayValid=!0},arrowBackButtonPressed:function(t){return this.domHost.navigateToPreviousPage()},$of:function(t,e){return e in t||(t[e]=null),t[e]},_sortByDate:function(t,e){return e.datetimeStamp-t.datetimeStamp},addCustomDischargedPressed:function(t){var e;if(13===t.which)return e=t.target.value,t.target.value="",this.patientStay.data.dischargeCustomCheckedMap[e]=!1,this.push("patientStay.data.dischargeCustomList",e)},patientStayDischargeChanged:function(t){var e,i;return e=t.model.item,i=!this.get("patientStay.data.dischargeCustomCheckedMap."+e),this.set("patientStay.data.dischargeCustomCheckedMap."+e,i)},_saveBedInfo:function(){var t,e,i,a,n;for(a=this.seatList,n=[],t=0,i=a.length;t<i;t++){if(e=a[t],e.patientSerial===this.patient.serial){this.patientStay.data.locationHospitalName=this.organizationsIBelongToList[this.selectedOrganizationIndex].name,this.patientStay.data.locationDepartment=e.department,this.patientStay.data.locationUnit=e.unit,this.patientStay.data.locationWard=e.ward,this.patientStay.data.locationBed=e.name;break}n.push(void 0)}return n},_validatePatientStayData:function(t){if(this.patientDischarged){if(!t.data.dischargeDatetimeStamp)return this.domHost.showToast("Discharge Date is required"),!1;if(!t.data.dischargeReason.length)return this.domHost.showToast("Please specify a discharge reason"),!1}else if(this.advisedAdmission){if(!t.data.admissionDateTimeStamp)return this.domHost.showToast("Admission Date is required"),!1;if(!t.data.currentLocation.length)return this.domHost.showToast("Please spcify patient current location"),!1}else if(!t.data.advise)return this.domHost.showToast("Specify Advise to patient"),!1;return!0},savePatientStayPressed:function(){if(this._validatePatientStayData(this.patientStay))return this.advisedAdmission?this._savePatientStay():this._savePatientStayAdviseOnly()},savePatientStayObject:function(t){var e;return e={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,patientStayObject:this.patientStayObject},this.callApi("/bdemr-organization-patient-stay-set-object",e,function(e){return function(i,a){return a.hasError?e.domHost.showModalDialog(a.error.message):t?t():void 0}}(this))},_savePatientStay:function(){var t;return null===this.visit.patientStaySerial&&null===this.patientStay.serial&&(this.patientStay.serial=this.generateSerialForPatientStay(),this.patientStay.createdDatetimeStamp=lib.datetime.now(),this.visit.patientStaySerial=this.patientStay.serial,this._saveVisit()),this._saveBedInfo(),this.patientStay.organizationQueryParameters={selectedOrganizationIndex:this.selectedOrganizationIndex,selectedDepartmentIndex:this.selectedDepartmentIndex,selectedUnitIndex:this.selectedUnitIndex,selectedWardIndex:this.selectedWardIndex},this.patientStay.data.admissionDateTimeStamp=new Date(this.patientStay.data.admissionDateTimeStamp).getTime(),this.patientDischarged&&(this.patientStay.data.dischargeDatetimeStamp=new Date(this.patientStay.data.dischargeDatetimeStamp).getTime()),this.organization.idOnServer?this.savePatientStayObject(function(t){return function(){return t.patientStay.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-patient-stay",t.patientStay,function(e){var i;return i=e.serial,t.patientStay.serial===i}),t.domHost.showToast("Patient Stay Saved!")}}(this)):(this.patientStay.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-patient-stay",this.patientStay,function(t){return function(e){var i;return i=e.serial,t.patientStay.serial===i}}(this)),this.domHost.showToast("Patient Stay Saved!")),t=this.patientStay,this.set("patientStay",{}),this.set("patientStay",t),this.selectedVisitPageIndex=0},_savePatientStayAdviseOnly:function(){var t;return null===this.visit.patientStaySerial&&null===this.patientStay.serial&&(this.patientStay.serial=this.generateSerialForPatientStay(),this.patientStay.createdDatetimeStamp=lib.datetime.now(),this.visit.patientStaySerial=this.patientStay.serial,this._saveVisit()),this.patientStay.lastModifiedDatetimeStamp=lib.datetime.now(),this.patientStay.adviseOnly=!0,app.db.upsert("visit-patient-stay",this.patientStay,function(t){return function(e){var i;return i=e.serial,t.patientStay.serial===i}}(this)),this.domHost.showToast("Patient Stay Saved!"),t=this.patientStay,this.set("patientStay",{}),this.set("patientStay",t),this.selectedVisitPageIndex=0},_notifyInvalidPatientStay:function(){return this.isVisitValid=!1,this.domHost.showModalDialog("Invalid Patient Stay Provided")},calculateLengthOfStay:function(t,e){var i;return i=lib.datetime.diff(new Date(e),new Date(t)),i/864e5},navigatedOut:function(){return this.patientStay={},this.isPatientStayValid=!0,this.selectedView=0,this.patientStay=null,this.patientStayObject=null,this.organizationsIBelongToList=[],this.selectedOrganizationIndex=null,this.selectedDepartmentIndex=null,this.selectedUnitIndex=null,this.selectedWardIndex=null,this.seatList=[],this.patientDischarged=!1,this.advisedAdmission=null}}}).call(this);
//# sourceMappingURL=mixin-patient-stay.coffee-compiled.js.map</script>
  <script>(function(){app.behaviors.local.loadPriceListMixin||(app.behaviors.local.loadPriceListMixin={}),app.behaviors.local.loadPriceListMixin={properties:{priceList:{type:Object,value:function(){return{}}}},_getLastSyncedDatetime:function(){return parseInt(window.localStorage.getItem("lastSyncedDatetimeStamp"))},_loadPriceList:function(t,e){return this._createNewPriceList(function(t){return function(i){return t.set("priceList",i),e(i)}}(this))},_prepareNewItemForDB:function(t){return t.serial=this.generateSerialForPriceListItem(),t.organizationId=this.organization.idOnServer,t.createdDatetimeStamp=lib.datetime.now(),t.lastModifiedDatetimeStamp=lib.datetime.now(),t.createdByUserSerial=this.user.serial,t},_preparePriceListData:function(t){return t.map(function(t){return function(t){return t.actualCost=t.actualCost||t.price,t.qty=t.qty||null,t}}(this))},_createNewPriceList:function(t){return this.domHost.getStaticData("uhcpInvoicePriceList",function(e){return function(i){var r;return r=e._preparePriceListData(i),t(r)}}(this))},_insertItemIntoDatabase:function(t){var e,i,r,a;for(app.db.__allowCommit=!1,i=e=0,a=t.length;e<a;i=++e)r=t[i],i===t.length-1&&(app.db.__allowCommit=!0),app.db.insert("organization-price-list",r);return app.db.__allowCommit=!0}}}).call(this);
//# sourceMappingURL=load-price-list-mixin.coffee-compiled.js.map</script>
  <script>(function(){app.behaviors.local.invoiceMixin||(app.behaviors.local.invoiceMixin={}),app.behaviors.local.invoiceMixin={properties:{invoice:{type:Object,value:function(){return{}}}},observers:["calculateTotalPrice(invoice.data.splices)"],_makeNewInvoice:function(){var i;return i={serial:this.generateSerialForinvoice(),referenceNumber:null,createdDatetimeStamp:lib.datetime.now(),createdByUserSerial:this.user.serial,patientSerial:this.patient.serial,patientName:this.patient.name,patientPhone:this.patient.phone,patientEmail:this.patient.email,organizationId:this.organization.idOnServer,organizationName:this.organization.name,modificationHistory:[],lastModifiedDatetimeStamp:null,category:"",totalBilled:0,paid:null,lastPaid:null,discount:null,totalAmountReceieved:null,flags:{flagAsError:!1,markAsCompleted:!1},data:[],commission:{},availableToPatient:!0},this.set("invoice",i)},_reduceInventoryItems:function(i){var t,e,a,n,r,s;for(r=i.data,s=[],e=0,n=r.length;e<n;e++)a=r[e],"custom"!==a.category&&(t=app.db.find("organization-price-list",function(i){return function(i){var t;return t=i.serial,t===a.serial}}(this))[0],(null!=t?t.qty:void 0)?(t.qty-=a.qty,s.push(app.db.update("organization-price-list",t._id,t))):s.push(void 0));return s},_addModificationHistory:function(){var i;return i={userSerial:this.user.serial,lastModifiedDatetimeStamp:lib.datetime.now()},this.invoice.modificationHistory.push(i),this.invoice.lastModifiedDatetimeStamp=lib.datetime.now()},_updateVisit:function(i){var t;return t=this.domHost.getPageParams(),"new"===t.visit&&(this.visit.serial=this.generateSerialForVisit()),null===this.visit.invoiceSerial&&this.set("visit.invoiceSerial",i),this.visit.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("doctor-visit",this.visit,function(i){return function(t){var e;return e=t.serial,i.visit.serial===e}}(this))},_saveInvoice:function(i){return i&&(this.invoice.flags.markAsCompleted=!0),this._addModificationHistory(),this._reduceInventoryItems(this.invoice),app.db.upsert("visit-invoice",this.invoice,function(i){return function(t){var e;return e=t.serial,e===i.invoice.serial}}(this)),this.domHost.showToast("Invoice Saved Successfully"),this._updateVisit(this.invoice.serial),this.domHost.navigateToPage("#/visit-editor/visit:"+this.visit.serial+"/patient:"+this.patient.serial)},itemUnitPriceChanged:function(i){var t,e,a,n,r,s;return s=parseInt(i.target.value),t=this.locateParentNode(i.target,"PAPER-ITEM"),r=this.$$("#invoice-item-repeater"),e=r.indexForElement(t),n=r.modelForElement(t),a=this.invoice.data[e],a.price=s,a.totalPrice=s*a.qty,n.set("item.totalPrice",s*n.item.qty),this.splice("invoice.data",e,1,a)},quantityChanged:function(i){var t,e;return t=i.model,e=parseInt(i.target.value),e>1?(t.set("item.qty",e),t.set("item.totalPrice",parseInt(t.item.price*parseInt(e))),this.calculateTotalPrice()):(t.set("item.qty",1),t.set("item.totalPrice",t.item.price))},deleteInvoiceItem:function(i){return this.splice("invoice.data",i.model.index,1),this._saveInvoice()},calculateTotalPrice:function(){var i;if(Object.keys(this.invoice).length)return this.invoice.data.length?(i=this.invoice.data.reduce(function(i,t){return i+parseInt(t.price*(t.qty||1))},0),this.set("invoice.totalBilled",i)):void this.set("invoice.totalBilled",0)}}}).call(this);
//# sourceMappingURL=invoice-module.coffee-compiled.js.map</script>
  <script>(function(){var t=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};Polymer({is:"page-visit-editor",$toJson:function(t){return JSON.stringify(t)},$isNumber:function(t){return"number"==typeof t},$listMissingKeys:function(e,i){var a,n;n=[];for(a in e)t.call(i,a)<0&&n.push(a);return n},behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.pageLike,app.behaviors.translating,app.behaviors.apiCalling,app.behaviors.local.patientStayMixin,app.behaviors.local.loadPriceListMixin,app.behaviors.local.invoiceMixin],properties:{comboBoxSymptomsInputValue:{type:String,notify:!0,value:null},walletBalance:{type:Number,value:-1},patientServiceBalance:{type:Object,value:null},organization:{type:Object,notify:!0,value:null},selectedMedicinePage:{type:Number,notify:!1,value:0},printPrescriptionOnly:{type:Boolean,notify:!0,value:!0},isBPAdded:{type:Boolean,notify:!0,value:!1},isHRAdded:{type:Boolean,notify:!0,value:!1},isBMIAdded:{type:Boolean,notify:!0,value:!1},isSpO2Added:{type:Boolean,notify:!0,value:!1},isRRAdded:{type:Boolean,notify:!0,value:!1},isTempAdded:{type:Boolean,notify:!0,value:!1},isThatNewVisit:{type:Boolean,notify:!0,value:!0},visitHeaderTitleList:{type:Array,notify:!1,value:["UHCP Complete Visit","UHCP Discharge Note"]},visitHeaderTitleSelectedIndex:{type:Number,notify:!1,value:0},isVisitValid:{type:Boolean,notify:!1,value:!1},selectedVisitPageIndex:{type:Number,notify:!1,value:!1},isPrescriptionValid:{type:Boolean,notify:!1,value:!1},isNoteValid:{type:Boolean,notify:!1,value:!1},isNextVisitValid:{type:Boolean,notify:!0,value:!1},isInvoiceValid:{type:Boolean,notify:!1,value:!1},isTestAdvisedValid:{type:Boolean,notify:!1,value:!1},isPatientValid:{type:Boolean,notify:!1,value:!1},isFullVisitValid:{type:Boolean,notify:!1,value:!1},user:{type:Object,notify:!0,value:null},patient:{type:Object,notify:!0,value:null},visit:{type:Object,notify:!0,value:null},doctorNotes:{type:Object,notify:!0,value:null},doctorNotesMessage:{type:String,notify:!0,value:""},nextVisit:{type:Object,notify:!0,value:null},testAdvised:{type:Object,notify:!0,value:null},matchingPrescribedMedicineList:{type:Array,notify:!0,value:[]},doctorInstitutionList:{type:Array,notify:!0,value:[]},doctorSpecialityList:{type:Array,notify:!0,value:[]},doctorInstitutionSelectedIndex:{type:Number,notify:!0,value:0},doctorSpecialitySelectedIndex:{type:Number,notify:!0,value:0},hasTestResults:{type:Boolean,notify:!0,value:!1},computedEndDate:{type:String,computed:"_showComputedEndDate(duplicateMedicineEditablePart.endDateTimeStamp)"},historyAndPhysicalRecord:{type:Object,notify:!0,value:null},matchingRecordList:{type:Object,notify:!0,value:null},diagnosis:{type:Object,notify:!0,value:null},isDiagnosisValid:{type:Boolean,value:!1},diagnosisListArray:{type:Array,notify:!0,value:[]},selectedDiagnosisListArray:{type:Array,notify:!0,value:[]},prescription:{type:Object,notify:!0,value:null},matchingPrescribedMedicineList:{type:Array,notify:!0,value:[]},matchingCurrentMedicineList:{type:Array,notify:!0,value:[]},matchingFavoriteMedicineList:{type:Array,notify:!0,value:[]},duplicateMedicineEditablePart:{type:Object,notify:!0,value:null},favoriteMedicineShownIndex:{type:Number,value:0},isMedicineValid:{type:Boolean,notify:!1,value:!0},isThatNewMedicine:{type:Boolean,notify:!1,value:!0},medicine:{type:Object,notify:!0,value:{}},strengthList:{type:Array,value:[]},continueMedicineEndsOnDate:{type:String,value:null},doseList:{type:Array,value:function(){return["1+1+1","1+0+1","0+0+1","1+0+0","1+1+1+1","2+2+2","2+0+2","0+0+2","2+0+0","1/2+1/2+1/2","1/2+0+1/2","0+0+1/2","1/2+0+0","1/4+1/4+1/4","1/4+0+1/4","0+0+1/4","1/4+0+0","1/4+1/4+1/4+1/4"]}},medicineFormList:{type:Array,value:["Tablet","Injection","Syrup","Drop","Capsule","Suspension","I.V Injection","I.M injection","S/C Injection","PR (Per Rectal)","Suppository","Solution","Ointment","Cream","Skin Patch","Custom"]},doseUnitList:{type:Array,value:["Custom"]},endDateTimeTypeList:{type:Array,value:["As Needed","0 Weeks","1 Week","2 Weeks","3 Weeks","Custom"]},endDateTimeTypeArgument2List:{type:Array,value:["0 Day","1 Day","2 Days","3 Days","4 Days","5 Days","6 Days"]},directionList:{type:Array,value:["Anytime","Before Meal","After Meal","Full Stomach","Empty Stomach"]},routeList:{type:Array,value:["Oral","I.V injection","I.M injection","PR (Per Rectal)","S/L","S/C","Nebulizer","Inhaler","Topical application skin","Topical application ear","Topical application eye","Intravaginal","Transdermal","Custom"]},intervalInDays:{type:Number,value:1},medicineFormSelectedIndex:{type:Number,value:0},doseUnitSelectedIndex:{type:Number,value:0},directionSelectedIndex:{type:Number,value:0},routeSelectedIndex:{type:Number,value:0},endDateTimeTypeSelectedIndex:{type:Number,value:0},endDateTimeTypeArgument2SelectedIndex:{type:Number,value:0},strengthSelectedIndex:{type:Number,value:0,notify:!0},matchingMedicineList:{type:Array,value:[]},doseGuidelineList:{type:Array},activeDoseGuideline:{type:Object,value:null},guidelineIndicationSelectedIndex:{type:Number,value:null},guidelineAgeSelectedIndex:{type:Number,value:null},guidelineIndicationList:{type:Array,value:function(){return[]}},guidelineAgeList:{type:Array,value:function(){return[]}},medicineCompositionList:{type:Array,value:[]},brandNameSourceDataList:{type:Array,value:[]},brandNameSelectedObjectList:{type:Array,value:[]},genericNameSourceDataList:{type:Array,value:[]},showDetailedForm:{type:Boolean,value:!1},showGuidelineDisclaimer:{type:Boolean,value:!0,notify:!0},selectedCurrentMedicineData:{type:Object,value:null},symptomsDataList:{type:Array,notify:!0,value:[]},addedIdentifiedSymptomsList:{type:Array,notify:!0,value:[]},customSymptomsObject:{type:Object,notify:!0,value:{}},examinationDataList:{type:Array,notify:!0,value:[]},addedExaminationList:{type:Array,notify:!0,value:[]},addedExaminationList2:{type:Array,notify:!0,value:function(){return[]}},examinationObject:{type:Object,notify:!0,value:{}},favoriteInvestigaitonList:{type:Array,notify:!0,value:[]},investigationMemberValue:{type:String,notify:!0,value:""},investigationDataList:{type:Array,notify:!0,value:[]},addedInvestigationList:{type:Array,notify:!0,value:[]},testAdvisedObject:{type:Object,notify:!0,value:{}},suggestedInstitutionValue:{type:String,value:"",notify:!0},machingUserAddedInstitutionList:{type:Array,value:[],notify:!0},addedInvestigationNameIndex:{type:Number,value:0},customInvestigationObject:{type:Object,notify:!0,value:{}},customInvestigationUnitValue:{type:String,value:"",notify:!0},customInvestigationUnitList:{type:Array,value:[],notify:!0},selectedVitalIndex:{type:Number,value:-1,notify:!0},heightUnitSelectedIndex:{type:Number,value:0,notify:!0},weightUnitSelectedIndex:{type:Number,value:0,notify:!0},tempUnitSelectedIndex:{type:Number,value:0,notify:!0},bloodPressure:{type:Object,notify:!0,value:{}},pulseRate:{type:Object,notify:!0,value:{}},bmi:{type:Object,notify:!0,value:{}},respiratoryRate:{type:Object,notify:!0,rpm:{}},oxygenSaturation:{type:Object,notify:!0,value:{}},temperature:{type:Object,notify:!0,value:{}},addedVitalList:{type:Array,value:[]},priorityTypeList:{type:Array,value:["As Necessary","Others"]},nextVisitDurationTypeList:{type:Array,value:["0 Day","1 Day","2 Days","3 Days","4 Days","5 Days","6 Days","7 Days","8 Days","9 Days","10 Days","11 Days","12 Days","13 Days","14 Days","15 Days","1 Week","2 Weeks","3 Weeks","4 Weeks","1 month","2 months","3 months","4 months","5 months","6 months","7 months","8 months","9 months","11 month","1 year","2 years","3 years","Custom"]},nextVisitDurationTypeSelectedIndex:{type:Number,notify:!0,value:0},nextVisitPriorityTypeSelectedIndex:{type:Number,notify:!0,value:0},computedNextVisitDate:{type:String,notify:!0,computed:"_showComputedNextVisitDate(nextVisit.nextVisitDateTimeStamp)"},isCustomDateTypeSelected:{type:Boolean,notify:!0,value:!1},settings:{type:Object,notify:!0},record:{type:Object,notify:!0,value:null},patient:{type:Object,notify:!0,value:null},recordDatabaseCollectionName:{type:String,value:null},recordPartName:{type:String,value:null},recordPartData:{type:Object,value:null},recordPartDef:{type:Object,value:null},recordPartTitle:{type:String,value:null},recordPartHtmlContent:{type:String,value:null},shouldRender:{type:Boolean,value:!1},delayRendering:{type:Boolean,value:!1},referral:{type:Object,value:function(){return{}}},selectedReferralTypeIndex:{type:Number,value:function(){return 0}},referredDoctorSpecialityList:{type:Array,value:function(){return["Cardiology","General Surgery","Haemotology","Neuro surgery","Neuro medicine","Oncology","Oral-maxillo-facial surgery","Physical medicine","Psychiatry","Respiratory medicine","Rapid access clinic","Radiology"]}}},observers:["_computeQuantityPerPrescription(medicine.intakePerDay, medicine.endDateTimeStamp, medicine.startDateTimeStamp)"],$of:function(t,e){return e in t||(t[e]=null),t[e]},_isEmpty:function(t){return 0===t},_isEmptyArray:function(t){return 0===t.length},_isEmptyString:function(t){return null===t||""===t||"undefined"===t},_compareFn:function(t,e,i){return"<"===e?t<i:">"===e?t>i:"=="===e?t===i:">="===e?t>=i:"<="===e?t<=i:"!="===e?t!==i:void 0},_sortByDate:function(t,e){return t.lastModifiedDatetimeStamp<e.lastModifiedDatetimeStamp?1:t.lastModifiedDatetimeStamp>e.lastModifiedDatetimeStamp?-1:void 0},_computeTotalDaysCount:function(t,e){var i,a;return t?(a=864e5,e=new Date(e),t=new Date(t),i=t-e,this.$TRANSLATE(Math.round(i/a),this.LANG)):this.$TRANSLATE("As Needed",this.LANG)},_returnSerial:function(t){return t+1},_computeAge:function(t){var e,i,a,n;return n=new Date,i=new Date(t),e=n.getFullYear()-i.getFullYear(),a=n.getMonth()-i.getMonth(),(a<0||0===a&&n.getDate()<i.getDate())&&e--,e},_getPatientServiceBalance:function(t,e){var i;return i={patientId:t,apiKey:this.user.apiKey},this.callApi("/bdemr-uhcp--get-patient-service-value",i,function(t){return function(i,a){return a.hasError?t.domHost.showToast(a.error.message):e(a.data)}}(this))},_deductServiceValueToPatient:function(t,e){var i,a,n;return n=t.patientId,a=t.outdoorBalanceToDeduct,i=t.indoorBalanceToDeduct,this._getPatientServiceBalance(n,function(t){return function(s){var r,o,l,d,u,c;return c=s.outdoorBalance,l=s.indoorBalance,u=c-a,d=l-i,u<0?(t.domHost.showModalDialog("Do not have sufficient OPD Balance"),e(o=!0)):d<0?(t.domHost.showModalDialog("Do not have sufficient IPD Balance"),e(o=!0)):(r={apiKey:t.user.apiKey,targetUserId:n,outdoorBalance:parseInt(u),indoorBalance:parseInt(d)},t.callApi("/bdemr-uhcp--add-service-value-to-patient",r,function(i,a){return a.hasError?(t.domHost.showModalDialog(a.error.message),e(i=!0)):(t.domHost.showToast("Value Deducted Successfully"),e())}))}}(this))},_loadUser:function(t){var e;return e=app.db.find("user"),1===e.length?(this.user=e[0],this._getEmploymentList(this.user),this._getSpecializationList(this.user)):this.domHost.showModalDialog("Invalid User!"),t()},_getEmploymentList:function(t){var e,i,a,n,s;if(t.employmentDetailsList.length>0){for(n=t.employmentDetailsList,s=[],i=0,a=n.length;i<a;i++)e=n[i],s.push(this.push("doctorInstitutionList",e.institutionName));return s}return this.doctorInstitutionList=[]},_getSpecializationList:function(t){var e,i,a,n,s;if(t.specializationList.length>0){for(a=t.specializationList,n=[],e=0,i=a.length;e<i;e++)s=a[e],n.push(this.push("doctorSpecialityList",s.specializationTitle));return n}return this.doctorSpecialityList=[]},$getFullName:function(t){var e,i,a,n;return"object"==typeof t?(i="",e="",a="",n="",t.honorifics&&(i=t.honorifics+". "),t.first&&(e=t.first),t.middle&&(n=" "+t.middle),t.last&&(a=" "+t.last),i+e+n+a):t},getDoctorSpeciality:function(){return 0!==this.user.specializationList.length?this.user.specializationList[0].specializationTitle:"not provided yet"},_makeNewNextVisit:function(){return this.nextVisit={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:0,lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:this.visit.serial,patientSerial:this.patient.serial,doctorName:this.$getFullName(this.user.name),doctorSpeciality:this.getDoctorSpeciality(),data:{nextVisitDateTimestamp:null,priorityType:"As Necessary"}},this.isNextVisitValid=!0},_makeNewNote:function(){return this.doctorNotes={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:0,lastSyncedDatetimeStamp:0,createdByUserSerial:null,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.user.name,doctorSpeciality:this.getDoctorSpeciality(),data:{messageList:[]}},this.isNoteValid=!0},_loadPatient:function(t,e){var i;return i=app.db.find("patient-list",function(e){var i;return i=e.serial,i===t}),1===i.length?(this.isPatientValid=!0,this.patient=i[0]):this._notifyInvalidPatient(),e()},_isFavoriteMedicineContentHidden:function(t,e){return!(t===e)},favoriteMedicineTapped:function(t){return this.favoriteMedicineShownIndex=t.model.index},_listPrescribedMedications:function(t){var e,i;i=app.db.find("patient-medications",function(e){return function(e){var i;return i=e.prescriptionSerial,t===i}}(this)),e=[].concat(i),e.sort(function(t,e){return t.createdDatetimeStamp<e.createdDatetimeStamp?-1:t.createdDatetimeStamp>e.createdDatetimeStamp?1:0}),this.matchingPrescribedMedicineList=e},_listCurrentMedications:function(t){var e,i,a,n,s;for(e=app.db.find("patient-medications",function(e){var i,a;if(a=e.patientSerial,i=e.data,a===t&&"continue"===i.status)return!0}),s=[].concat(e),s.sort(function(t,e){return t.createdDatetimeStamp<e.createdDatetimeStamp?-1:t.createdDatetimeStamp>e.createdDatetimeStamp?1:0}),i=0,a=s.length;i<a;i++)n=s[i],n.flags={isLocalOnly:!0};return this.matchingCurrentMedicineList=s},_listFavoriteMedicine:function(t){var e,i,a,n,s;for(e=app.db.find("favorite-medicine-list",function(e){var i;return i=e.createdByUserSerial,t===i}),s=[].concat(e),s.sort(function(t,e){return t.data.brandName<e.data.brandName?-1:t.data.brandName>e.data.brandName?1:0}),i=0,a=s.length;i<a;i++)n=s[i],n.flags={isLocalOnly:!0};return this.matchingFavoriteMedicineList=s},_makeNewPrescription:function(){return this.prescription={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:this.visit.serial,patientSerial:this.patient.serial,doctorName:this.user.name,doctorSpeciality:this.getDoctorSpeciality(),availableToPatient:!0},this.isPrescriptionValid=!0},_makeDuplicateMedicineEditablePart:function(){return this.duplicateMedicineEditablePart={startDateTimeStamp:lib.datetime.now(),endDateTimeStamp:lib.datetime.now()},this.computedEndDate=null,this.endDateTimeTypeArgument2SelectedIndex=0,this.endDateTimeTypeSelectedIndex=0},_savePrescription:function(){return this.visit.serial||this._saveVisit(),null===this.visit.prescriptionSerial&&(this.prescription.serial=this.generateSerialForPrescription(),this.prescription.visitSerial=this.visit.serial,this.visit.prescriptionSerial=this.prescription.serial,this._saveVisit()),this.prescription.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-prescription",this.prescription,function(t){return function(e){var i;return i=e.serial,t.prescription.serial===i}}(this)),this.domHost.showToast("Prescription Saved.")},_notifyInvalidPrescription:function(){return this.isPrescriptionValid=!1,this.domHost.showModalDialog("Invalid Prescription Provided")},_loadPrescription:function(t){var e;return e=app.db.find("visit-prescription",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isPrescriptionValid=!0,this.prescription=e[0],this._listPrescribedMedications(this.prescription.serial),!0):(this._notifyInvalidPrescription(),!1)},deleteMedicinePressed:function(t){var e,i,a,n;return e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),e.opened=!1,n=this.$$("#prescribed-medicine-list-repeater"),i=t.model.index,a=this.matchingPrescribedMedicineList[i],this.domHost.showModalPrompt("Are you sure?",function(t){return function(e){var n;if(e===!0)return n=app.db.find("patient-medications",function(t){var e;return e=t.serial,e===a.serial})[0]._id,app.db.remove("patient-medications",n),app.db.insert("patient-medications--deleted",{serial:a.serial}),t.splice("matchingPrescribedMedicineList",i,1),t.domHost.showToast("Medicine Deleted!")}}(this))},_saveMedicine:function(t){return app.db.upsert("patient-medications",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_isNthWeekSelectedAsEndDate:function(t){return 0!==t&&this.endDateTimeTypeList.length!==t+1},_endDateTimeTypeSelectedIndexChanged:function(){var t,e,i,a,n,s;if(a=this.get(["endDateTimeTypeList",this.endDateTimeTypeSelectedIndex]),i=this.get(["endDateTimeTypeArgument2List",this.endDateTimeTypeArgument2SelectedIndex]),a+=" "+i,n=this.get("duplicateMedicineEditablePart.startDateTimeStamp"),s=parseInt(a.substr(0,1)),t=parseInt(i.substr(0,1)),n&&(s||t))return e=this._makeEndDateStampfromCustom(n,s,t),this.set("duplicateMedicineEditablePart.endDateTimeStamp",e)},getClassForItem:function(t,e){return e?"item expanded":"item"},_makeDuplicatedMedicineFromFavorite:function(t){var e;return e={serial:this.generateSerialForMedication("DPMD"),createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,patientSerial:this.patient.serial,prescriptionSerial:this.prescription.serial},e.data=t.data,e.data.endDateTimeStamp=this.duplicateMedicineEditablePart.endDateTimeStamp,e.data.startDateTimeStamp=this.duplicateMedicineEditablePart.startDateTimeStamp,e.organizationId=this.organization.idOnServer,this.visit.serial||this._saveVisit(),e.visitSerial=this.visit.serial,app.db.insert("patient-medications",e),this.domHost.showToast("Medicine Added."),this._makeDuplicateMedicineEditablePart()},_makeDuplicatedMedicineFromCurrent:function(){var t;return t={serial:this.generateSerialForMedication("DP"),createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:this.visit.serial,patientSerial:this.patient.serial,prescriptionSerial:this.prescription.serial,data:{brandName:this.selectedCurrentMedicineData.data.brandName,comments:this.selectedCurrentMedicineData.data.comments,direction:this.selectedCurrentMedicineData.data.direction,dose:this.selectedCurrentMedicineData.data.dose,doseDirection:this.selectedCurrentMedicineData.data.doseDirection,timeOfDay:this.selectedCurrentMedicineData.data.timeOfDay,doseUnit:this.selectedCurrentMedicineData.data.doseUnit,endDateTimeStamp:this.continueMedicineEndsOnDate,form:this.selectedCurrentMedicineData.data.form,genericName:this.selectedCurrentMedicineData.data.genericName,intakeDateTimeStampList:this.selectedCurrentMedicineData.data.intakeDateTimeStampList,intervalInHours:this.selectedCurrentMedicineData.data.intervalInHours,manufacturer:this.selectedCurrentMedicineData.data.manufacturer,nextDoseDateTimeStamp:this.selectedCurrentMedicineData.data.nextDoseDateTimeStamp,numberOfRefill:this.selectedCurrentMedicineData.data.numberOfRefill,quantityPerPrescription:this.selectedCurrentMedicineData.data.quantityPerPrescription,remind:this.selectedCurrentMedicineData.data.remind,route:this.selectedCurrentMedicineData.data.route,startDateTimeStamp:this.selectedCurrentMedicineData.data.startDateTimeStamp,status:this.selectedCurrentMedicineData.data.status,strength:this.selectedCurrentMedicineData.data.strength,timesPerInterval:this.selectedCurrentMedicineData.data.timesPerInterval}}},continueMedicinePressed:function(t){var e,i,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#current-medicine-list-repeater"),i=a.indexForElement(e),this.selectedCurrentMedicineData=this.matchingCurrentMedicineList[i],this.continueMedicineEndsOnDate=lib.datetime.now(),this.$$("#dialogContinueCurrentMedication").toggle()},addSelectedCurrentMedicine:function(){var t;return t=this._makeDuplicatedMedicineFromCurrent(),null===this.visit.prescriptionSerial?(this._savePrescription(),t.prescriptionSerial=this.prescription.serial):t.prescriptionSerial=this.prescription.serial,t.organizationId=this.organization.idOnServer,this.visit.serial||this._saveVisit(),t.visitSerial=this.visit.serial,app.db.insert("patient-medications",t),this.domHost.showToast("Medicine Added."),this.selectedCurrentMedicineData.data.status="stopped",this._saveMedicine(this.selectedCurrentMedicineData),this.selectedCurrentMedicineData={},this._listPrescribedMedications(this.prescription.serial),this.continueMedicineEndsOnDate=lib.datetime.now(),this.$$("#dialogContinueCurrentMedication").close()},stopMedicinePressed:function(t){var e,i,a,n;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,n=this.$$("#current-medicine-list-repeater"),i=n.indexForElement(e),a=this.matchingCurrentMedicineList[i],a.data.status="stopped",a.lastModifiedDatetimeStamp=lib.datetime.now(),this._saveMedicine(a),this.domHost.showToast("Medicine Stopped!"),this._listCurrentMedications(this.patient.serial)},addFavMedicineAsNewMedicineBtnPressed:function(t){var e,i,a,n,s;return e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),s=this.$$("#favorite-medicine-list-repeater"),a=s.indexForElement(e),i=this.matchingFavoriteMedicineList[a],n=this.domHost.getPageParams(),this._savePrescription(),this._makeDuplicatedMedicineFromFavorite(i),this._listPrescribedMedications(this.prescription.serial)},deleteFavoriteMedicinePressed:function(t){var e,i,a,n;return e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),n=this.$$("#favorite-medicine-list-repeater"),i=n.indexForElement(e),a=this.matchingFavoriteMedicineList[i],this.domHost.showModalPrompt("Are you sure?",function(t){return function(e){var i;if(e===!0)return i=app.db.find("favorite-medicine-list",function(t){var e;return e=t.serial,e===a.serial})[0]._id,app.db.remove("favorite-medicine-list",i),app.db.insert("favorite-medicine-list--deleted",{serial:a.serial}),t.domHost.showToast("Favorite Medicine Deleted!"),t._listFavoriteMedicine(t.user.serial)}}(this))},_resetMedicineForm:function(){return this.medicine={serial:this.generateSerialForMedication(),genericName:"",strength:"",brandName:"",manufacturer:"",dose:1,doseDirection:"",doseUnit:"",form:"",startDateTimeStamp:lib.datetime.mkDate(new Date),endDateTimeStamp:null,route:function(){return this.routeList[this.routeSelectedIndex]},direction:function(){return this.directionList[this.directionSelectedIndex]},quantityPerPrescription:0,numberOfRefill:0,comments:"",intakePerDay:0,intakeDateTimeStampList:[],nextDoseDateTimeStamp:null,timesPerInterval:1,intervalInHours:24,remind:!1,status:"continue"},this.strengthSelectedIndex=0,this.medicineFormSelectedIndex=0,this.doseUnitSelectedIndex=0,this.routeSelectedIndex=0,this.endDateTimeTypeSelectedIndex=0,this.endDateTimeTypeArgument2SelectedIndex=0,this.showCustomDoseDropdown=!1,this.directionSelectedIndex=0},_checkValidity:function(t,e){var i,a,n,s,r,o;for(o=[],n=0,s=t.length;n<s;n++)a=t[n],this.medicine.item||(i=this.$$("#"+a).validate(),o.push(i));return r=o.every(function(t){return t}),e(r)},validate:function(t){return t.target.validate()},cancelButtonClicked:function(t){return this._resetMedicineForm()},arrowBackButtonPressed:function(t){return this.domHost.setSelectedVisitSerial("new"),this.domHost.navigateToPage("#/patient-manager")},makeNewVisitButtonPressed:function(t){return this.domHost.setSelectedVisitSerial("new"),this.domHost.selectedPatientPageIndex=1,this.domHost.selectedPatientPageIndex=0},toggleGuideline:function(t){return this.$.guidelineContainer.toggle()},_loadDefaultMedicineCompositionList:function(){var t,e,i,a,n,s,r;for(t={},s={},e={},r=this.medicineCompositionList,a=0,n=r.length;a<n;a++)i=r[a],t[i.brandName]=null,s[i.manufacturer]=null,e[i.genericName]=null;return this.brandNameSourceDataList=function(){var e,a,n,s;for(n=Object.keys(t),s=[],e=0,a=n.length;e<a;e++)i=n[e],s.push({text:i,value:i});return s}(),this.manufacturerSourceDataList=function(){var t,e,a,n;for(a=Object.keys(s),n=[],t=0,e=a.length;t<e;t++)i=a[t],n.push({text:i,value:i});return n}(),this.genericNameSourceDataList=function(){var t,a,n,s;for(n=Object.keys(e),s=[],t=0,a=n.length;t<a;t++)i=n[t],s.push({text:i,value:i});return s}()},brandNameAutocompleteSelected:function(t){var e,i,a,n;return e=t.detail.value,this.matchingMedicineList=function(){var t,i,n,s;for(n=this.medicineCompositionList,s=[],t=0,i=n.length;t<i;t++)a=n[t],a.brandName===e&&s.push(a);return s}.call(this),0!==this.matchingMedicineList.length&&(this.set("medicine.manufacturer",this.matchingMedicineList[0].manufacturer),this.set("medicine.genericName",this.matchingMedicineList[0].genericName),n=lib.array.unique(function(){var t,e,i,n;for(i=this.matchingMedicineList,n=[],t=0,e=i.length;t<e;t++)a=i[t],n.push(a.type);return n}.call(this)),this.medicineFormList=[],this.medicineFormList=n,this.push("medicineFormList","Custom"),this.set("medicineFormSelectedIndex",null),lib.util.delay(5,function(t){return function(){return t.set("medicineFormSelectedIndex",0)}}(this))),i=["genericName","brandName","manufacturer"],this._checkValidity(i,function(t){return function(){}}(this)),this.$.form.invalid=!1,this.$.doseUnit.invalid=!1},genericNameAutocompleteSelected:function(t){var e,i,a,n,s,r,o,l,d,u;for(i=t.detail.text,d=this.medicineCompositionList,n=0,r=d.length;n<r;n++)a=d[n],a.composition&&a.genericName===i&&this.matchingMedicineList.push(a);for(e={},l={},u=this.matchingMedicineList,s=0,o=u.length;s<o;s++)a=u[s],e[a.brandName]=null,l[a.manufacturer]=null;return this.brandNameSourceDataList=function(){var t,i,n,s;for(n=Object.keys(e),s=[],t=0,i=n.length;t<i;t++)a=n[t],s.push({text:a,value:a});return s}(),this.manufacturerSourceDataList=function(){var t,e,i,n;for(i=Object.keys(l),n=[],t=0,e=i.length;t<e;t++)a=i[t],n.push({text:a,value:a});return n}()},manufacturerAutocompleteSelected:function(t){var e,i,a,n,s,r,o;if(r=t.detail.text,o=function(){var t,e,i,n;for(i=this.medicineCompositionList,n=[],t=0,e=i.length;t<e;t++)a=i[t],a.manufacturer===r&&n.push(a);return n}.call(this),0!==o.length){for(i={},e={},n=0,s=o.length;n<s;n++)a=o[n],e[a.brandName]=null,a.composition&&(i[a.genericName]=null);return this.genericNameSourceDataList=function(){var t,e,n,s;for(n=Object.keys(i),s=[],t=0,e=n.length;t<e;t++)a=n[t],s.push({text:a,value:a});return s}(),this.brandNameSourceDataList=function(){var t,i,n,s;for(n=Object.keys(e),s=[],t=0,i=n.length;t<i;t++)a=n[t],s.push({text:a,value:a});return s}()}},brandNameCleared:function(t){return this._resetMedicineForm(),this.activeDoseGuideline={},this._loadDefaultMedicineCompositionList()},manufacturerCleared:function(t){return this.set("medicine.manufacturer",null),this._loadDefaultMedicineCompositionList()},genericNameCleared:function(t){return this.set("medicine.genericName",null),this.activeDoseGuideline={},this._loadDefaultMedicineCompositionList()},_isNthWeekSelectedAsEndDate:function(t){return 0!==t&&this.endDateTimeTypeList.length!==t+1},_isCustomSelectedAsEndDate:function(t){return this.endDateTimeTypeList.length===t+1},_isRouteCustom:function(){return this.routeSelectedIndex===this.routeList.length-1},_isUnitCustom:function(){return this.doseUnitSelectedIndex===this.doseUnitList.length-1},_isStregnthDropdown:function(){if(this.matchingMedicineList.length)return!0},_isStregnthCustom:function(){return 0===this.matchingMedicineList.length||(this.strengthSelectedIndex===this.strengthList.length-1||void 0)},_isFormCustom:function(){if(this.medicineFormSelectedIndex===this.medicineFormList.length-1)return!0},_makeEndDateStampfromCustom:function(t,e,i){var a;return e<=0||(i+=7*e),a=new Date(t),a=a.setDate(a.getDate()+i)},convertStringToDecimal:function(t){var e,i;return i=t.split("/"),e=parseInt(i[0])/parseInt(i[1])},doseDirectionValueChanged:function(t){var e,i,a;if(i=t.detail.value)return a=i.split("+"),e=a.reduce(function(t){return function(e,i){var a;return i.length>1?(a=t.convertStringToDecimal(i),e+a):e+parseInt(i)}}(this),0),this.medicine.intakePerDay=e,this.medicine.doseDirection=t.detail.value},_doseValueChanged:function(t){if(this.medicine.dose>20&&(this.medicine.dose=20,t.target.value=20),this.medicine.dose<1)return this.medicine.dose=1,t.target.value=1},_computeIntervalInHours:function(t,e){var i;return i=Math.floor(24*e/t),this.set("medicine.intervalInHours",i)},_directionSelectedIndexChanged:function(){var t;return t=this.get(["directionList",this.directionSelectedIndex]),this.set("medicine.direction",t)},_medicineFormSelectedIndexChanged:function(){var t,e,i,a,n,s,r,o,l,d;if(null!==this.medicineFormSelectedIndex){if(t=this.get(["medicineFormList",this.medicineFormSelectedIndex]),this.medicineFormSelectedIndex===this.medicineFormList.length-1?(this.doseUnitSelectedIndex=this.doseUnitList.length-1,this.routeSelectedIndex=this.routeList.length-1,this.set("medicine.form",""),this.set("medicine.doseUnit",""),this.set("medicine.strength","")):this.set("medicine.form",t),this.matchingMedicineList){for(o=[],s=this.matchingMedicineList,e=0,a=s.length;e<a;e++)n=s[e],n.type===t&&o.push(n.strength);this.set("strengthList",[]),this.set("strengthList",o),this.push("strengthList","Custom"),this.set("strengthSelectedIndex",null),lib.util.delay(10,function(t){return function(){return t.set("strengthSelectedIndex",0)}}(this))}l={Tablet:["Tablet"],Injection:["Injection"],Syrup:["ml","t.s.f","teaspoonfull"],Drop:["Drop"],Capsule:["Capsule"],Suspension:["ml","t.s.f","teaspoonfull"],"I.V Injection":["ampoule","m/l","vial"],"I.M injection":["ampoule","m/l","vial"],"I.M/I.V Injection":["ampoule","m/l","vial"],"IV/IM Injection":["ampoule","m/l","vial"],"S/C Injection":["Injection"],"PR (Per Rectal)":["Suppository"],Suppository:["Suppository"],Solution:["ml"],Ointment:["application"],Cream:["application"],"Skin Patch":["skin patch"]},r={Tablet:["p.o"],Injection:["i.v injection","i.m injection","s/c injection"],Syrup:["p.o"],Drop:["p.o","topical application ear","topical application eye"],Capsule:["p.o"],Suspension:["p.o"],"I.V Injection":["i.v injection"],"I.M Injection":["i.m injection"],"S/C Injection":["s/c injection"],"PR (Per Rectal)":["p.r (per rectal)"],Suppository:["p.r (per rectal)"],Solution:["nebulizer"],Cream:["topical application skin","topical application eye","topical application ear","intravaginal"],Ointment:["topical application skin","topical application eye","topical application ear","intravaginal"],"Skin Patch":["transdermal"]};for(i in l)if(d=l[i],i===t){this.set("doseUnitList",[]),this.set("doseUnitList",d),this.push("doseUnitList","Custom"),this.set("doseUnitSelectedIndex",null),lib.util.delay(10,function(t){return function(){return t.set("doseUnitSelectedIndex",0)}}(this));break}for(i in r)if(d=r[i],i===t){this.set("routeList",[]),this.set("routeList",d),this.push("routeList","Custom"),this.set("routeSelectedIndex",null),lib.util.delay(10,function(t){return function(){return t.set("routeSelectedIndex",0)}}(this));break}return this.$.form.invalid=!1,this.$.doseUnit.invalid=!1}},_routeSelectedIndexChanged:function(){var t;return this.routeSelectedIndex===this.routeList.length-1?this.set("medicine.route",""):(t=this.get(["routeList",this.routeSelectedIndex]),this.set("medicine.route",t))},_strengthSelectedIndexChanged:function(){var t;if(t=this.get(["strengthList",this.strengthSelectedIndex]),this.strengthSelectedIndex!==this.strengthList.length-1)return this.set("medicine.strength",t)},_doseUnitSelectedIndexChanged:function(){var t;if(this.doseUnitSelectedIndex!==this.doseUnitList.length-1)return t=this.get(["doseUnitList",this.doseUnitSelectedIndex]),this.set("medicine.doseUnit",t)},_showComputedEndDate:function(t){return 0===this.endDateTimeTypeSelectedIndex?null:lib.datetime.mkDate(t,"dd-mmm-yyyy");
},_computeQuantityPerPrescription:function(t,e,i){var a,n,s,r;return Date.parse(e)>0&&(n=864e5,a=Date.parse(e)-Date.parse(i),r=Math.round(a/n),s=Math.ceil(r*t)),this.set("medicine.quantityPerPrescription",s)},asNeededSelected:function(t){return t.target.checked?(this.$.endDate.disabled=!0,this.medicine.endDateTimeStamp=null):this.$.endDate.disabled=!1},saveMedicineButtonClicked:function(t){var e,i;return i=this.domHost.getPageParams(),e=this.medicineFormSelectedIndex===this.medicineFormList.length-1?["brandName","strength","custom-form","custom-dose-unit","custom-route"]:["brandName","form","doseUnit"],this._checkValidity(e,function(t){return function(e){var a;return e?(a={},a.data=t.medicine,a.serial=t.medicine.serial,delete a.data.serial,a.createdDatetimeStamp=lib.datetime.now(),a.lastSyncedDatetimeStamp=null,a.createdByUserSerial=t.user.serial,a.patientSerial=i.patient,a.organizationId=t.organization.idOnServer,null===t.visit.prescriptionSerial?(t._savePrescription(),a.prescriptionSerial=t.prescription.serial):a.prescriptionSerial=t.prescription.serial,t.visit.serial||t._saveVisit(),a.visitSerial=t.visit.serial,a.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.insert("patient-medications",a),t.domHost.showToast("Medicine Added!"),t._addMedicinePriceToInvoice(a.data.brandName,a.data.quantityPerPrescription,t.visit.serial),t._resetMedicineForm(),t._listPrescribedMedications(t.prescription.serial)):t.domHost.showModalDialog("Enter Required Inputs")}}(this))},_makeNewFavoriteMedicine:function(t){var e;return e={serial:this.generateSerialForFavoriteMedicine(),createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial},e.data=t.data,e.data.startDateTimeStamp=lib.datetime.now(),app.db.insert("favorite-medicine-list",e)},saveAndAddAsFavoriteMedicinePressed:function(t){var e,i;return i=this.domHost.getPageParams(),e=this.medicineFormSelectedIndex===this.medicineFormList.length-1?["genericName","brandName","manufacturer","strength","custom-form","custom-dose-unit","custom-route"]:["genericName","brandName","manufacturer","strength","form","doseUnit"],this._checkValidity(e,function(t){return function(e){var a;return e?(a={},a.data=t.medicine,a.serial=t.medicine.serial,delete a.data.serial,a.createdDatetimeStamp=lib.datetime.now(),a.lastSyncedDatetimeStamp=null,a.createdByUserSerial=t.user.serial,a.patientSerial=i.patient,null===t.visit.prescriptionSerial?(t._savePrescription(),a.prescriptionSerial=t.prescription.serial):a.prescriptionSerial=t.prescription.serial,a.lastModifiedDatetimeStamp=lib.datetime.now(),a.organizationId=t.organization.idOnServer,t.visit.serial||t._saveVisit(),a.visitSerial=t.visit.serial,app.db.insert("patient-medications",a),t._makeNewFavoriteMedicine(a),t._resetMedicineForm(),t._listPrescribedMedications(t.prescription.serial),t._listFavoriteMedicine(t.user.serial),t.domHost.showToast("Added & Saved As a Favorite!")):t.domHost.showModalDialog("Enter Required Inputs")}}(this))},shouldShowDisclaimer:function(t){var e;return e=lib.localStorage.getItem("showGuidelineDisclaimer"),!(!e&&"null"!==e)},showGuidelineDisclaimerChanged:function(t){var e;return lib.localStorage.setItem("showGuidelineDisclaimer",!t.target.checked),this.set("showGuidelineDisclaimer",!t.target.checked),e=lib.localStorage.getItem("showGuidelineDisclaimer")},$doesPassFilter:function(e,i,a,n,s){var r,o,l,d;return o=this.guidelineAgeList[s],l=this.guidelineIndicationList[n],"not-available"!==a&&alert("something went wrong"),r=!1,r="No Age Indicated"===o||o===this._ageToText(i),d=!1,d="No Special Indications"===l||t.call(this._extractIndication(i),l)>=0,!(!r||!d)},_extractIndication:function(t){var e,i,a,n,s;for(n=["indication","secondaryIndication","tertiaryIndication","condition","secondaryCondition"],e=[],i=0,s=n.length;i<s;i++)a=n[i],a in t&&e.push(t[a]);return e},_ageToText:function(t){var e;return"ageGroup"in t&&(e=t.ageGroup),"ageRange"in t&&(e="min"in t.ageRange?"max"in t.ageRange?"from "+t.ageRange.min+" "+t.ageRange.unit+"(s) to "+t.ageRange.max+" "+t.ageRange.unit+"(s)":t.ageRange.min+" "+t.ageRange.unit+"(s) and upwards":"Upto "+t.ageRange.max+" "+t.ageRange.unit+"(s)"),e},_setActiveDoseGuideline:function(t){var e,i,a,n,s,r,o,l,d,u,c;for(this.set("activeDoseGuideline",t),a=[],d=t.doseList,n=0,o=d.length;n<o;n++)e=d[n],r=this._extractIndication(e),a=[].concat(a,r);for(a=lib.array.unique(a),a.unshift("No Special Indications"),this.set("guidelineIndicationList",a),this.set("guidelineIndicationSelectedIndex",0),i=[],u=t.doseList,s=0,l=u.length;s<l;s++)e=u[s],c=this._ageToText(e),c.length>0&&i.push(c);return i=lib.array.unique(i),i.unshift("No Age Indicated"),this.set("guidelineAgeList",i),this.set("guidelineAgeSelectedIndex",0)},populateDoseGuideline:function(){var t,e,i,a,n,s;for(e=this.get("medicine.genericName"),n=null,s=this.doseGuidelineList,i=0,a=s.length;i<a;i++)if(t=s[i],e===t.genericName){n=t;break}if(n)return this._setActiveDoseGuideline(n)},runSanitizationCheckForDoseGuidelineList:function(e){var i,a,n,s,r,o,l,d,u,c,h,m;for(n=["subDoseList","route","ageGroup","description","ageRange","notRecommended","indication","secondaryIndication","notes","condition","alternateRoiute","secondaryCondition","tertiaryIndication"],n=[].concat(n,[]),o=[],s=["type","unit","amount","timesDaily","connectionToMeal","notes","condition"],s=[].concat(s,["Interval","treatmentPeriod","timesWeekly","notRecommended","secondaryIndication","timesMonthly","indication"]),s=[].concat(s,[]),l=[],h=[],r=0,d=e.length;r<d;r++)a=e[r],h.push(function(){var e,r,d,h,p,v;for(p=a.doseList,v=[],e=0,d=p.length;e<d;e++){for(i=p[e],c=this.$listMissingKeys(i,n),r=0,h=c.length;r<h;r++)u=c[r],t.call(o,u)<0&&o.push(u);"subDoseList"in i?v.push(function(){var e,a,n,r;for(n=i.subDoseList,r=[],a=0,e=n.length;a<e;a++)m=n[a],c=this.$listMissingKeys(m,s),r.push(function(){var e,i,a;for(a=[],i=0,e=c.length;i<e;i++)u=c[i],t.call(l,u)<0?a.push(l.push(u)):a.push(void 0);return a}());return r}.call(this)):v.push(void 0)}return v}.call(this));return h},_fillCommons:function(t,e){var i,a;if(e.connectionToMeal&&(a={"after meal":"After meal","with meal":"After meal","with food":"After meal","after food":"After meal","after a meal":"After meal","with meals":"After meal",before:"Before meal"},e.connectionToMeal.when in a))return i=this.directionList.indexOf(a[e.connectionToMeal.when]),this.set("directionSelectedIndex",i)},_fillMinOrMax:function(t,e,i){if(e.timesDaily&&e.timesDaily[i]&&this.set("medicine.timesPerInterval",e.timesDaily[i]),e.amount&&e.amount[i],e.route)return"todo when interface supports. take hints from subDose.connectionToMeal"},fillMinimumPressed:function(t){var e,i,a;return i=t.model,e=i.dose,a=i.subDose,this._fillCommons(e,a),this._fillMinOrMax(e,a,"min")},fillMaximumPressed:function(t){var e,i,a;return i=t.model,e=i.dose,a=i.subDose,this._fillCommons(e,a),this._fillMinOrMax(e,a,"max")},_makeNewIdentifiedSymptomsObject:function(){return this.identifiedSymptomsObject={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.user.name,doctorSpeciality:this.getDoctorSpeciality(),data:{symptomsList:[]},availableToPatient:!0},this.isIdentifiedSymptomsValid=!0},_loadIdentifiedSymptoms:function(t){var e;return e=app.db.find("visit-identified-symptoms",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isIdentifiedSymptomsValid=!0,this.identifiedSymptomsObject=e[0],this.addedIdentifiedSymptomsList=e[0].data.symptomsList,!0):(this._notifyInvalidIdentifeidSymptoms(),!1)},_loadSymptomsListFromSystem:function(t){return this.set("symptomsDataList",[]),this.domHost.getStaticData("symptomsList",function(e){return function(i){var a,n,s,r,o,l,d,u;if(0!==i.length)for(r=0,l=i.length;r<l;r++)s=i[r],""!==s.name&&(u={},u.label=s.name,u.value=s,e.push("symptomsDataList",u));if(n=app.db.find("custom-symptoms-list",function(e){var i;return i=e.createdByUserSerial,t===i}),0!==n.length)for(o=0,d=n.length;o<d;o++)s=n[o],a={},a.label=s.data.name,a.value=s.data.name,e.push("symptomsDataList",a);return e.symptomsDataList.sort(function(t,e){return t.label<e.label?-1:t.label>e.label?1:0})}}(this))},saveUserAddedCustomSymptoms:function(t){var e;return e={serial:this.generateSerialForCustomSymptoms,lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,data:{name:t}},app.db.insert("custom-symptoms-list",e)},_duplicationSymptomsCheck:function(t){var e,i,a,n;for(n=this.symptomsDataList,i=0,a=n.length;i<a;i++)if(e=n[i],e.label===t)return!0},_notifyInvalidIdentifeidSymptoms:function(){return this.isIdentifiedSymptomsValid=!1,this.domHost.showModalDialog("Invalid Stymptoms Provided")},_selectedAddedIdentifiedSymtomsDeleteBtnPressed:function(t){var e,i,a,n;return a=t.model.index,this.splice("addedIdentifiedSymptomsList",a,1),i=this.identifiedSymptomsObject.serial,0===this.addedIdentifiedSymptomsList.length?(n=app.db.find("visit-identified-symptoms",function(t){var e;return e=t.serial,e===i}),e=n[0]._id,app.db.remove("visit-identified-symptoms",e),app.db.insert("visit-identified-symptoms--deleted",{serial:this.identifiedSymptomsObject.serial}),this.visit.identifiedSymptomsSerial=null,this._saveVisit(),this.domHost.showToast("Deleted Successfully!")):(this.saveIdentifiedSymptoms(),this.domHost.showToast("Deleted Successfully!"))},comboBoxKeyUpSymptomsValueChanged:function(t){if(""!==this.comboBoxSymptomsInputValue&&13===t.which)return"object"==typeof this.comboBoxSymptomsInputValue?this.push("addedIdentifiedSymptomsList",{name:this.comboBoxSymptomsInputValue.name}):(this.push("addedIdentifiedSymptomsList",{name:this.comboBoxSymptomsInputValue}),this._duplicationSymptomsCheck(this.comboBoxSymptomsInputValue)||this.saveUserAddedCustomSymptoms(this.comboBoxSymptomsInputValue),this.push("symptomsDataList",{label:this.comboBoxSymptomsInputValue,value:this.comboBoxSymptomsInputValue})),this.saveIdentifiedSymptoms()},addSymptoms:function(){if(""!==this.comboBoxSymptomsInputValue)return"object"==typeof this.comboBoxSymptomsInputValue?this.push("addedIdentifiedSymptomsList",{name:this.comboBoxSymptomsInputValue.name}):(this.push("addedIdentifiedSymptomsList",{name:this.comboBoxSymptomsInputValue}),this._duplicationSymptomsCheck(this.comboBoxSymptomsInputValue)||this.saveUserAddedCustomSymptoms(this.comboBoxSymptomsInputValue),this.push("symptomsDataList",{label:this.comboBoxSymptomsInputValue,value:this.comboBoxSymptomsInputValue})),this.saveIdentifiedSymptoms()},saveIdentifiedSymptoms:function(){if(0!==this.addedIdentifiedSymptomsList.length)return this.identifiedSymptomsObject.data.symptomsList=this.addedIdentifiedSymptomsList,null===this.visit.identifiedSymptomsSerial&&(this.identifiedSymptomsObject.serial=this.generateSerialForIdentifiedSymptoms(),this.visit.identifiedSymptomsSerial=this.identifiedSymptomsObject.serial,this._saveVisit(),this.identifiedSymptomsObject.visitSerial=this.visit.serial),this.identifiedSymptomsObject.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-identified-symptoms",this.identifiedSymptomsObject,function(t){return function(e){var i;return i=e.serial,t.identifiedSymptomsObject.serial===i}}(this)),this.set("comboBoxSymptomsInputValue",""),this.domHost.showToast("Symptoms Added.")},_loadExaminationList:function(t){return this.domHost.getStaticData("examinationList",function(e){return function(i){var a,n,s,r,o,l,d,u,c,h,m,p,v,f,g;for(l=0,c=i.length;l<c;l++)if(p=i[l],""!==p.name&&"undefined"!=typeof p.examinationValueList&&0!==p.examinationValueList.length)if(p.examinationValueList.length>1)for(r={},r.label=p.name,r.value=p,e.push("examinationDataList",r),v=p.examinationValueList,d=0,h=v.length;d<h;d++)o=v[d],"string"==typeof o.name&&(s={},s.label=o.name,s.value={name:o.name,examinationValueList:[{value:o.name}]},e.push("examinationDataList",s));else g={},g.label=p.name,g.value=p,e.push("examinationDataList",g);if(a=app.db.find("custom-examination-list",function(e){var i;return i=e.createdByUserSerial,t===i}),0!==a.length){for(f=[],u=0,m=a.length;u<m;u++)o=a[u],n={},n.label=o.data.name,n.value=o.data,f.push(e.push("examinationList",n));return f}}}(this))},_makeNewExaminationObject:function(){return this.examinationObject={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.user.name,doctorSpeciality:this.getDoctorSpeciality(),data:{examinationValueList:[]},availableToPatient:!0},this.isExaminationValid=!0},_loadExamination:function(t){var e;return e=app.db.find("visit-examination",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isExaminationValid=!0,this.examinationObject=e[0],this.addedExaminationList=e[0].data.examinationValueList,!0):(this._notifyInvalidExamination(),!1)},_notifyInvalidExamination:function(){return this.isExaminationValid=!1,this.domHost.showModalDialog("Invalid Examination Provided")},saveUserAddedCustomExamination:function(t){var e;return e={serial:this.generateSerialForCustomExamination(),lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,data:{name:t,examinationValueList:[]}},app.db.insert("custom-examination-list",e),this._addToInvoice(e.data.name(this.visit.serial))},removeExaminationMember:function(t){var e,i,a,n,s;return e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),e.opened=!1,n=this.$$("#added-examination-list-repeater"),i=n.indexForElement(e),a=t.model.index,s="addedExaminationList."+i+".examinationValueList",this.splice(s,a,1),this.saveExamination()},checkExaminationMember:function(t){var e;return e=this.addedExaminationList,this.set("addedExaminationList",e),this.saveExamination()},_selectedAddedExaminationDeleteBtnPressed:function(t){var e,i,a,n;return a=t.model.index,this.splice("addedExaminationList",a,1),e=this.examinationObject.serial,0===this.addedExaminationList.length?(n=app.db.find("visit-examination",function(t){var i;return i=t.serial,i===e}),i=n[0]._id,app.db.remove("visit-examination",i),app.db.insert("visit-examination--deleted",{serial:e}),this.visit.examinationSerial=null,this._saveVisit(),this.domHost.showToast("Deleted Successfully!")):(this.saveExamination(),this.domHost.showToast("Deleted Successfully!"))},comboBoxKeyUpExaminationValueChanged:function(t){var e,i,a,n,s,r,o,l;if(""!==this.comboBoxExaminationInputValue&&13===t.which){if("object"==typeof this.comboBoxExaminationInputValue){if(s=[],0!==this.comboBoxExaminationInputValue.examinationValueList){for(l=this.comboBoxExaminationInputValue.examinationValueList,e=a=0,n=l.length;a<n;e=++a)i=l[e],o={},o.value=i.value,o.checked=!1,s.push(o);r={name:this.comboBoxExaminationInputValue.name,examinationValueList:s},this.unshift("addedExaminationList",r)}}else o={name:this.comboBoxExaminationInputValue,examinationValueList:[]},this.unshift("addedExaminationList",o);return this.saveExamination()}},openDialogForExaminationMember:function(t){var e,i;return this.customExaminationValue="",e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),e.opened=!1,i=this.$$("#added-examination-list-repeater"),this.ARBITARY_INDEX=i.indexForElement(e),this.$$("#dialogExaminationMemberValue").toggle()},addExaminationMember:function(){var t,e;return t={value:this.customExaminationValue,checked:!0},e="addedExaminationList."+this.ARBITARY_INDEX+".examinationValueList",this.push(e,t),this.saveExamination(),this.$$("#dialogExaminationMemberValue").close()},addExamination:function(){var t,e,i,a,n,s,r,o;if(""!==this.comboBoxExaminationInputValue){if("object"==typeof this.comboBoxExaminationInputValue){if(n=[],0!==this.comboBoxExaminationInputValue.examinationValueList){for(o=this.comboBoxExaminationInputValue.examinationValueList,t=i=0,a=o.length;i<a;t=++i)e=o[t],r={},r.index=t,r.value=e.value,r.checked=!1,n.push(r);s={name:this.comboBoxExaminationInputValue.name,examinationValueList:n},this.unshift("addedExaminationList",s),this._addToInvoice(s.name,this.visit.serial)}}else r={name:this.comboBoxExaminationInputValue,examinationValueList:[]},this.unshift("addedExaminationList",r);return this.saveExamination()}},filterExaminationList:function(t){var e,i,a,n,s,r,o,l,d,u;for(r=[],i=0,n=t.length;i<n;i++){if(d=t[i],0!==d.examinationValueList){for(l=[],u=d.examinationValueList,a=0,s=u.length;a<s;a++)e=u[a],e.checked&&l.push(e);o={name:d.name,examinationValueList:l}}r.push(o)}return r},saveExamination:function(){if(0!==this.addedExaminationList.length)return this.examinationObject.data.examinationValueList=this.filterExaminationList(this.addedExaminationList),null===this.visit.examinationSerial&&(this.examinationObject.serial=this.generateSerialForExamination(),this.visit.examinationSerial=this.examinationObject.serial,this._saveVisit(),this.examinationObject.visitSerial=this.visit.serial),this.examinationObject.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-examination",this.examinationObject,function(t){return function(e){var i;return i=e.serial,t.examinationObject.serial===i}}(this)),this.set("comboBoxExaminationInputValue",""),this.domHost.showToast("Examination Updated!")},_makeNewTestAdvisedObject:function(){return this.testAdvisedObject={serial:null,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.user.name,doctorSpeciality:this.getDoctorSpeciality(),data:{testAdvisedName:null,testAdvisedList:[]},availableToPatient:!0},this.isTestAdvisedValid=!0},_makeNewAddedInvestigationObject:function(t){var e,i;return e={},i={},i.hasTestResults=!1,i.testResultsSerial=null,e.investigationName=t.name,e.testList=t.investigationList,e.status=i,e.serial=this.generateSerialForTestAdvisedInvestigation(),0!==this.machingUserAddedInstitutionList.length&&(e.suggestedInstitutionName=this.machingUserAddedInstitutionList[0].label),e.suggestedInstitutionName="",e},_makeCustomInvestigationObject:function(){return this.customInvestigationObject={serial:this.generateSerialForCustomInvestigation(),lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:this.visit.serial,patientSerial:this.patient.serial,data:{name:"",investigationList:[{name:"",referenceRange:"",unitList:[]}]}}},_loadAdvisedTest:function(t){var e;return e=app.db.find("visit-advised-test",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isTestAdvisedValid=!0,this.testAdvisedObject=e[0],this.addedInvestigationList=e[0].data.testAdvisedList,!0):(this._notifyInvalidTestAdvised(),!1)},_loadInvestigationList:function(t){var e,i,a,n,s;if(this.domHost.getStaticData("investigationList",function(t){return function(e){var i,a,n,s,r,o,l,d,u,c;for(i=[],d=[],u=[],r=0,o=e.length;r<o;r++)l=e[r],""!==l.name&&"undefined"!=typeof l.investigationList&&0!==l.investigationList.length?l.investigationList.length>1?(a={},a.label=l.name,a.value=l,t.push("investigationDataList",a),u.push(function(){var t,e,i,a;for(i=l.investigationList,a=[],t=0,e=i.length;t<e;t++)s=i[t],"string"==typeof s.name?(n={},n.label=s.name,n.value={name:s.name,investigationList:[{name:s.name,referenceRange:s.referenceRange,unitList:s.unitList}]},a.push(this.push("investigationDataList",n))):a.push(void 0);return a}.call(t))):(c={},c.label=l.name,c.value=l,u.push(t.push("investigationDataList",c))):u.push(void 0);return u}}(this)),e=app.db.find("custom-investigation-list",function(e){return function(e){var i;return i=e.createdByUserSerial,t===i}}(this)),0!==e.length)for(n=0,s=e.length;n<s;n++)a=e[n],i={},i.label=a.data.name,i.value={name:a.data.name,investigationList:a.data.investigationList},this.push("investigationDataList",i);return this.investigationDataList.sort(function(t,e){return t.label<e.label?-1:t.label>e.label?1:0})},_loadUserAddedInstitutionList:function(t){var e,i,a,n,s,r;if(s=app.db.find("user-added-institution-list",function(e){return function(e){var i;return i=e.createdByUserSerial,t===i}}(this)),0!==s.length){for(e=[].concat(s),a=0,n=e.length;a<n;a++)i=e[a],r={},r.label=i.data.institutionName,r.value=i.data.institutionName,this.push("machingUserAddedInstitutionList",r);return this.machingUserAddedInstitutionList.sort(function(t,e){return t.label<e.label?-1:t.label>e.label?1:0})}},saveUserAddedCustomInvestigation:function(t){return app.db.insert("custom-investigation-list",t)},_duplicationInvestigationCheck:function(t){var e,i,a,n;for(n=this.investigationDataList,i=0,a=n.length;i<a;i++)if(e=n[i],e.label===t)return!0},saveUserAddedInstituion:function(){var t;return t={serial:this.generateSerialForUserAddedInstituion,createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),createdByUserSerial:this.user.serial,data:{institutionName:this.suggestedInstitutionValue}},this.push("machingUserAddedInstitutionList",{label:this.suggestedInstitutionValue,value:this.suggestedInstitutionValue}),app.db.upsert("user-added-institution-list",t,function(e){var i;return i=e.serial,i===t.serial})},comboBoxKeyUpSeggestedInstitutionNameChanged:function(t){if(""!==this.suggestedInstitutionValue&&13===t.which)return"object"==typeof this.suggestedInstitutionValue?(this.addedInvestigationList[this.addedInvestigationNameIndex].suggestedInstitutionName=this.suggestedInstitutionValue.value,this._isInstitutionAddedByUserAlready(this.suggestedInstitutionValue.value)||this.saveUserAddedInstituion()):(this.addedInvestigationList[this.addedInvestigationNameIndex].suggestedInstitutionName=this.suggestedInstitutionValue,this._isInstitutionAddedByUserAlready(this.suggestedInstitutionValue)||this.saveUserAddedInstituion()),this.saveAdvisedTest(),this._loadAdvisedTest(this.visit.advisedTestSerial),this.$$("#dialogSuggestedInstitution").toggle()},_saveSuggestedInstituonName:function(t){if(""!==this.suggestedInstitutionValue)return"object"==typeof this.suggestedInstitutionValue?(this.addedInvestigationList[this.addedInvestigationNameIndex].suggestedInstitutionName=this.suggestedInstitutionValue.value,this._isInstitutionAddedByUserAlready(this.suggestedInstitutionValue.value)||this.saveUserAddedInstituion()):(this.addedInvestigationList[this.addedInvestigationNameIndex].suggestedInstitutionName=this.suggestedInstitutionValue,this._isInstitutionAddedByUserAlready(this.suggestedInstitutionValue)||this.saveUserAddedInstituion()),this.saveAdvisedTest(),this._loadAdvisedTest(this.visit.advisedTestSerial),this.$$("#dialogSuggestedInstitution").close()},_isInstitutionAddedByUserAlready:function(t){var e,i,a,n,s;for(s=this.machingUserAddedInstitutionList,e=a=0,n=s.length;a<n;e=++a)if(i=s[e],this.machingUserAddedInstitutionList.value===t)return!0;return!1},_notifyInvalidTestAdvised:function(){return this.isTestAdvisedValid=!1,this.domHost.showModalDialog("Invalid Test Advised Provided")},_selectedAddedInvestigationtDeleteBtnPressed:function(t){var e,i,a,n;return a=t.model.index,this.splice("addedInvestigationList",a,1),e=this.testAdvisedObject.serial,0===this.addedInvestigationList.length?(n=app.db.find("visit-advised-test",function(t){var i;return i=t.serial,i===e}),i=n[0]._id,app.db.remove("visit-advised-test",i),app.db.insert("visit-advised-test--deleted",{serial:this.testAdvisedObject.serial}),this.visit.advisedTestSerial=null,this._saveVisit(),this.domHost.showToast("Deleted Successfully!")):(this.saveAdvisedTest(),this.domHost.showToast("Deleted Successfully!"))},removeInvestigationMember:function(t){var e,i,a,n,s;return a=t.model.index,e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),e.opened=!1,n=this.$$("#added-advised-test-list-repeater"),i=n.indexForElement(e),s="addedInvestigationList."+i+".testList",this.splice(s,a,1),this.saveAdvisedTest()},showInevestigationMemberDialog:function(t){var e,i;return this.investigationMemberValue="",e=this.locateParentNode(t.target,"PAPER-ICON-BUTTON"),e.opened=!1,i=this.$$("#added-advised-test-list-repeater"),this.ARBITARY_INDEX=i.indexForElement(e),this.$$("#dialogInvestigationMemberValue").toggle()},addInvestigationMember:function(t){var e,i;return e={},i="addedInvestigationList."+this.ARBITARY_INDEX+".testList",e.name=this.investigationMemberValue,this.push(i,e),this.saveAdvisedTest(),this.$$("#dialogInvestigationMemberValue").close()},_openSuggestedInstitutionDialog:function(t){var e,i;return e=this.locateParentNode(t.target,"PAPER-BUTTON"),e.opened=!1,i=this.$$("#added-advised-test-list-repeater"),this.addedInvestigationNameIndex=i.indexForElement(e),this.set("suggestedInstitutionValue",this.addedInvestigationList[this.addedInvestigationNameIndex].suggestedInstitutionName),this.$$("#dialogSuggestedInstitution").toggle()},onComboBoxInvestigationValueChanged:function(t){},comboBoxKeyUpInvestigationValueChanged:function(t){if(""!==this.comboBoxInvestigationInputValue&&13===t.which){if("object"==typeof this.comboBoxInvestigationInputValue)return this.push("addedInvestigationList",this._makeNewAddedInvestigationObject(this.comboBoxInvestigationInputValue)),this.saveAdvisedTest();if(!this._duplicationInvestigationCheck(this.comboBoxInvestigationInputValue))return this._makeCustomInvestigationObject(),this.customInvestigationObject.data.name=this.comboBoxInvestigationInputValue,this.customInvestigationObject.data.investigationList[0].name=this.comboBoxInvestigationInputValue,this.$$("#dialogCustomInvestigation").toggle()}},addInvestigation:function(){if(""!==this.comboBoxInvestigationInputValue){if("object"==typeof this.comboBoxInvestigationInputValue)return this._addToInvoice(this.comboBoxInvestigationInputValue.name,this.visit.serial),this.push("addedInvestigationList",this._makeNewAddedInvestigationObject(this.comboBoxInvestigationInputValue)),this.addInvestigationAsFavorite(this.comboBoxInvestigationInputValue),this.saveAdvisedTest();if(!this._duplicationInvestigationCheck(this.comboBoxInvestigationInputValue))return this._makeCustomInvestigationObject(),this.customInvestigationObject.data.name=this.comboBoxInvestigationInputValue,this.customInvestigationObject.data.investigationList[0].name=this.comboBoxInvestigationInputValue,this.$$("#dialogCustomInvestigation").toggle()}},loadFavoriteInvestigationList:function(t,e){var i;return i=app.db.find("favorite-advised-test",function(e){var i;return i=e.createdByUserSerial,t===i}),i.sort(function(t,e){return t.data.investigationName>e.data.investigationName?-1:t.data.investigationName<e.data.investigationName?1:0}),this.favoriteInvestigaitonList=i,e()},addInvestigationAsFavorite:function(t){var e;if(!this._duplicatieInvestigationCheck(t.name))return e={createdByUserSerial:this.user.serial,isSelected:!1,data:t},app.db.insert("favorite-advised-test",e)},_duplicatieInvestigationCheck:function(t){var e,i,a,n,s;if(s=this.user.serial,n=app.db.find("favorite-advised-test",function(t){var e;return e=t.createdByUserSerial,s===e}),n.length>0){for(i=0,a=n.length;i<a;i++)if(e=n[i],e.data.name===t)return!0;return!1}return!1},_addUnitValueForCustomInvestigation:function(){if(""!==this.customInvestigationUnitValue)return this.push("customInvestigationUnitList",this.customInvestigationUnitValue),this.set("customInvestigationUnitValue","")},_saveCustomInvestigation:function(){return this.customInvestigationObject.data.investigationList[0].unitList=this.customInvestigationUnitList,this.saveUserAddedCustomInvestigation(this.customInvestigationObject),this.push("investigationDataList",{label:this.customInvestigationObject.data.investigationName,value:this.customInvestigationObject.data}),this.push("addedInvestigationList",this._makeNewAddedInvestigationObject(this.customInvestigationObject.data)),this.addInvestigationAsFavorite(this.customInvestigationObject.data),this.saveAdvisedTest(),this._loadInvestigationList(this.user.serial),this.set("comboBoxInvestigationInputValue",""),this.$$("#dialogCustomInvestigation").close()},_deleteSelectedUnit:function(t){var e;return e=t.model.index,this.splice("customInvestigationUnitList",e,1)},_onAddedInvestigationTestChange:function(t){var e,i,a,n;return e=this.locateParentNode(t.target,"PAPER-BUTTON"),e.opened=!1,i=this.$$("#added-advised-test-list-repeater"),n=i.indexForElement(e),a=t.model.index,this.addedInvestigationList[n].testList.splice(a,1),this.saveAdvisedTest()},saveAdvisedTest:function(){if(0!==this.addedInvestigationList.length)return this.testAdvisedObject.data.testAdvisedList=this.addedInvestigationList,null===this.visit.advisedTestSerial&&(this.testAdvisedObject.serial=this.generateSerialForTestAdvised(),this.visit.advisedTestSerial=this.testAdvisedObject.serial,this._saveVisit(),this.testAdvisedObject.visitSerial=this.visit.serial),this.testAdvisedObject.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-advised-test",this.testAdvisedObject,function(t){return function(e){var i;return i=e.serial,t.testAdvisedObject.serial===i}}(this)),this.set("comboBoxInvestigationInputValue",""),this.domHost.showToast("Test Added.")},showFavoriteInvestigationDialog:function(){return this.loadFavoriteInvestigationList(this.user.serial,function(t){return function(){}}(this)),this.$$("#dialogFavoriteInvestigation").toggle()},addInvestigationFromFavorite:function(){var t,e,i,a;for(a=this.favoriteInvestigaitonList,e=0,i=a.length;e<i;e++)t=a[e],t.isSelected&&this.push("addedInvestigationList",this._makeNewAddedInvestigationObject(t.data));return this.$$("#dialogFavoriteInvestigation").close()},_isAllVitalsAdded:function(t,e,i,a,n,s){return t===!0&&e===!0&&i===!0&&a===!0&&n===!0&&s===!0},_makeBloodPressure:function(){return this.bloodPressure={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{systolic:"",diastolic:"",random:"",unit:"mm Hg",flags:{flagAsError:!1}}}},_makePulseRate:function(){return this.pulseRate={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{bpm:"",unit:"bpm",flags:{flagAsError:!1}}}},_makeBmi:function(){return this.bmi={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{height:"",heightInFt:"",heightInInch:"",heightUnit:"cm",weight:"",weightUnit:"kg",calculatedBMI:"",flags:{flagAsError:!1}}}},_makeRespiratoryRate:function(){return this.respiratoryRate={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{respiratoryRate:"",unit:"rpm",flags:{flagAsError:!1}}}},_makeOxygenSaturation:function(){return this.oxygenSaturation={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{spO2Percentage:"",unit:"%",flags:{flagAsError:!1}}}},_makeTemperature:function(){return this.temperature={serial:null,visitSerial:this.visit.serial,createdByUserSerial:null,organizationId:this.organization.idOnServer,
patientSerial:null,createdDatetimeStamp:null,lastModifiedDatetimeStamp:null,lastSyncedDatetimeStamp:null,data:{temperature:"",unit:"",flags:{flagAsError:!1}}}},_saveBloodPressure:function(t){return app.db.upsert("patient-vitals-blood-pressure",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_savePulseRate:function(t){return app.db.upsert("patient-vitals-pulse-rate",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_saveBmi:function(t){return app.db.upsert("patient-vitals-bmi",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_saveRespiratoryRate:function(t){return app.db.upsert("patient-vitals-respiratory-rate",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_saveOxygenSaturation:function(t){return app.db.upsert("patient-vitals-spo2",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_saveTemperature:function(t){return app.db.upsert("patient-vitals-temperature",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_addToVitalList:function(t,e){return lib.util.delay(5,function(i){return function(){return i.push("addedVitalList",{vitalType:e,vitalObject:t})}}(this))},_pritifyVitalData:function(t){var e,i;return"Blood Pressure"===t.vitalType?t.vitalObject.data.systolic+"/"+t.vitalObject.data.diastolic:"Heart Rate"===t.vitalType?t.vitalObject.data.bpm+" "+t.vitalObject.data.unit:"BMI"===t.vitalType?(e="ft/inch"===t.vitalObject.data.heightUnit?t.vitalObject.data.heightInFt+"'"+t.vitalObject.data.heightInInch+"'' "+t.vitalObject.data.heightUnit:t.vitalObject.data.height+" "+t.vitalObject.data.heightUnit,i=t.vitalObject.data.weight+t.vitalObject.data.weightUnit,t.vitalObject.data.calculatedBMI+", Height: "+e+", Weight: "+i):"Respirtory Rate"===t.vitalType?t.vitalObject.data.respiratoryRate+t.vitalObject.data.unit:"SpO2"===t.vitalType?t.vitalObject.data.spO2Percentage+t.vitalObject.data.unit:"Temperature"===t.vitalType?t.vitalObject.data.temperature+t.vitalObject.data.unit:void 0},_addedVitalsSaveButtonPressed:function(){var t,e,i,a;if(0===this.addedVitalList.length)return this.domHost.showToast("Please Add atleast 1 Vital.");for(a=this.addedVitalList,e=0,i=a.length;e<i;e++)t=a[e],"Blood Pressure"===t.vitalType?this._saveBloodPressure(t.vitalObject):"Heart Rate"===t.vitalType?this._savePulseRate(t.vitalObject):"BMI"===t.vitalType?this._saveBmi(t.vitalObject):"Respirtory Rate"===t.vitalType?this._saveRespiratoryRate(t.vitalObject):"SpO2"===t.vitalType?this._saveOxygenSaturation(t.vitalObject):"Temperature"===t.vitalType&&this._saveTemperature(t.vitalObject);return this.arrowBackButtonPressed()},_deleteAddedVitalItemClicked:function(t){var e,i;return e=t.model.index,i=this.addedVitalList[e],this.deleteFromCollection(i),this.splice("addedVitalList",e,1),this.domHost.showToast("Vital Deleted!")},deleteFromCollection:function(t){var e;return e=t.vitalObject._id,"Blood Pressure"===t.vitalType?(app.db.remove("patient-vitals-blood-pressure",e),this._makeBloodPressure(),this.isBPAdded=!1,this.visit.vitalSerial.bp=null):"Heart Rate"===t.vitalType?(app.db.remove("patient-vitals-pulse-rate",e),this._makePulseRate(),this.isHRAdded=!1,this.visit.vitalSerial.hr=null):"BMI"===t.vitalType?(app.db.remove("patient-vitals-bmi",e),this._makeBmi(),this.isBMIAdded=!1,this.visit.vitalSerial.bmi=null):"Respirtory Rate"===t.vitalType?(app.db.remove("patient-vitals-respiratory-rate",e),this._makeRespiratoryRate(),this.isRRAdded=!1,this.visit.vitalSerial.rr=null):"Spo2"===t.vitalType?(app.db.remove("patient-vitals-spo2",e),this._makeOxygenSaturation(),this.isSpO2Added=!1,this.visit.vitalSerial.spo2=null):"Temperature"===t.vitalType&&(app.db.remove("patient-vitals-temperature",e),this._makeTemperature(),this.isTempAdded=!1,this.visit.vitalSerial.temp=null),this._saveVisit()},updateVisitForVital:function(t,e){return"Blood Pressure"===e?(this.visit.vitalSerial.bp=t,this.isBPAdded=!0):"Heart Rate"===e?(this.visit.vitalSerial.hr=t,this.isHRAdded=!0):"BMI"===e?(this.visit.vitalSerial.bmi=t,this.isBMIAdded=!0):"Respirtory Rate"===e?(this.visit.vitalSerial.rr=t,this.isRRAdded=!0):"SpO2"===e?(this.visit.vitalSerial.spo2=t,this.isSpO2Added=!0):"Temperature"===e&&(this.visit.vitalSerial.temp=t,this.isTempAdded=!0),this._saveVisit()},addBloodPressureButtonClicked:function(){var t,e;return e=parseInt(this.get("bloodPressure.data.systolic")),t=parseInt(this.get("bloodPressure.data.diastolic")),e&&t?1<=e&&e<=300?1<=t&&t<=200?t<=e?this.addBP():void this.domHost.showToast("Diastolic value must not be greater than Systolic Value"):void this.domHost.showToast("Diastolic Value must be betwen 1-200"):void this.domHost.showToast("Systolic value must be betwen 1-300"):void this.domHost.showToast("Please Enter All The Data")},addBP:function(){return this.set("bloodPressure.serial",this.generateSerialForVitals("BP")),this.set("bloodPressure.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("bloodPressure.createdByUserSerial",this.userSerial),this.set("bloodPressure.patientSerial",this.patient.serial),this.set("bloodPressure.createdDatetimeStamp",lib.datetime.now()),this._addToVitalList(this.bloodPressure,"Blood Pressure"),this.updateVisitForVital(this.bloodPressure.serial,"Blood Pressure"),this.bloodPressure.visitSerial=this.visit.serial,this._saveBloodPressure(this.bloodPressure),this.domHost.addActivityLog("blood-pressure","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now()}),this.domHost.showToast("Added Successfully"),this._makeBloodPressure()},addPulseRateButtonClicked:function(){var t;return t=parseInt(this.get("pulseRate.data.bpm")),t?20<=t&&t<=225?(this.set("pulseRate.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("pulseRate.serial",this.generateSerialForVitals("P")),this.set("pulseRate.createdByUserSerial",this.userSerial),this.set("pulseRate.patientSerial",this.patient.serial),this.set("pulseRate.createdDatetimeStamp",lib.datetime.now()),this.updateVisitForVital(this.pulseRate.serial,"Heart Rate"),this.pulseRate.visitSerial=this.visit.serial,this._savePulseRate(this.pulseRate),this._addToVitalList(this.pulseRate,"Heart Rate"),this.domHost.addActivityLog("pulse-rate","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now()}),this.domHost.showToast("Added Successfully"),this._makePulseRate()):void 0:void this.domHost.showToast("Please Enter BPM")},isHeightCmOrM:function(t){if("ft/inch"!==t)return!0},isHeightFtInch:function(t){if("ft/inch"===t)return!0},heightUnitSelectedIndexChanged:function(){return 0===this.heightUnitSelectedIndex?this.set("bmi.data.heightUnit","cm"):1===this.heightUnitSelectedIndex?this.set("bmi.data.heightUnit","m"):this.set("bmi.data.heightUnit","ft/inch")},weightUnitSelectedIndexChanged:function(){return 0===this.weightUnitSelectedIndex?this.set("bmi.data.weightUnit","kg"):1===this.weightUnitSelectedIndex?this.set("bmi.data.weightUnit","lbs"):this.set("bmi.data.weightUnit","st-lbs")},ifChosenCmMtAsHeight:function(t){return 2!==t||0===t},ifChosenFtInchAsHeight:function(t){return 2===t},_convertHeightToMeter:function(){var t,e;return e=this.get("bmi.data.heightUnit"),t=0,"cm"===e?t=.01*this.get("bmi.data.height"):"m"===e?t=this.get("bmi.data.height"):"ft/inch"===e&&(t=.3048*this.get("bmi.data.heightInFt")+.0254*this.get("bmi.data.heightInInch")),t},_convertWeightToKg:function(){var t,e;return e=this.get("bmi.data.weightUnit"),t=0,"lbs"===e?t=.453592*this.get("bmi.data.weight"):"st-lbs"===e?t=6.35029*this.get("bmi.data.weight"):"kg"===e&&(t=this.get("bmi.data.weight")),t},_calculateBMI:function(t,e){return e/t/t},_calculateBMIVerdict:function(t){return 0!==t&&t?t<18.5?"Underweight":18.5<=t&&t<24.9?"Normal":25<=t&&t<29.9?"Overweight":"Obese":"Pending"},calculateBMIButtonClicked:function(){var t,e,i;return(this.bmi.data.height||this.bmi.data.heightFt)&&this.bmi.data.weight||this.domHost.showToast("Please Enter All The Data"),(this.bmi.data.height>0||this.bmi.data.heightInFt>0)&&this.bmi.data.weight>0?(i=this._convertWeightToKg(),e=this._convertHeightToMeter(),t=this._calculateBMI(e,i),this.set("bmi.data.calculatedBMI",t.toPrecision(3)),this.set("bmi.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("bmi.serial",this.generateSerialForVitals("BMI")),this.set("bmi.createdByUserSerial",this.userSerial),this.set("bmi.patientSerial",this.patient.serial),this.set("bmi.createdDatetimeStamp",lib.datetime.now()),this.domHost.addActivityLog("bmi","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now()}),this._addToVitalList(this.bmi,"BMI"),this.updateVisitForVital(this.bmi.serial,"BMI"),this.bmi.visitSerial=this.visit.serial,this._saveBmi(this.bmi),this.domHost.showToast("Added Successfully!")):this.domHost.showToast("Correct Required Input")},addRespiratoryRateButtonClicked:function(t){var e;return this.respiratoryRate.data.respiratoryRate||this.domHost.showToast("Please Enter RPM"),1<(e=this.respiratoryRate.data.respiratoryRate)&&e<=65?(this.set("respiratoryRate.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("respiratoryRate.serial",this.generateSerialForVitals("RR")),this.set("respiratoryRate.createdByUserSerial",this.userSerial),this.set("respiratoryRate.patientSerial",this.patient.serial),this.set("respiratoryRate.createdDatetimeStamp",lib.datetime.now()),this.updateVisitForVital(this.respiratoryRate.serial,"Respirtory Rate"),this.respiratoryRate.visitSerial=this.visit.serial,this._saveRespiratoryRate(this.respiratoryRate),this._addToVitalList(this.respiratoryRate,"Respirtory Rate"),this.domHost.addActivityLog("respiratory-rate","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now()}),this.domHost.showToast("Added Successfully"),this._makeRespiratoryRate()):this.$.rr.invalid=!0},addOxygenSaturationButtonClicked:function(t){var e;if(this.oxygenSaturation.data.spO2Percentage||this.domHost.showToast("Please Enter Percentage"),0<=(e=this.oxygenSaturation.data.spO2Percentage)&&e<=100)return this.set("oxygenSaturation.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("oxygenSaturation.serial",this.generateSerialForVitals("OS")),this.set("oxygenSaturation.createdByUserSerial",this.userSerial),this.set("oxygenSaturation.patientSerial",this.patient.serial),this.set("oxygenSaturation.createdDatetimeStamp",lib.datetime.now()),this.updateVisitForVital(this.oxygenSaturation.serial,"SpO2"),this.oxygenSaturation.visitSerial=this.visit.serial,this._saveOxygenSaturation(this.oxygenSaturation),this._addToVitalList(this.oxygenSaturation,"SpO2"),this.domHost.addActivityLog("oxygen-saturation","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now()}),this.domHost.showToast("Added Successfully"),this._makeOxygenSaturation()},isTempCelsius:function(t){return 0===t},tempUnitSelected:function(t){return lib.localStorage.setItem("lastSelectedTempUnit",this.tempUnitSelectedIndex),0===this.tempUnitSelectedIndex?this.set("temperature.data.unit","Â°C"):this.set("temperature.data.unit","Â°F")},addTemperatureButtonClicked:function(t){var e;return e=parseInt(this.get("temperature.data.temperature")),e||this.domHost.showToast("Please Enter value"),this.tempUnitSelectedIndex?0<=e&&e<=115?this.addTemperature():this.domHost.showToast("Correct Required Input"):0<=e&&e<=48?this.addTemperature():this.domHost.showToast("Correct Required Input")},addTemperature:function(){return null===this.temperature.data.unit&&(0===this.tempUnitSelectedIndex?this.set("temperature.data.unit","Â°C"):this.set("temperature.data.unit","Â°F")),this.set("temperature.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("temperature.serial",this.generateSerialForVitals("T")),this.set("temperature.createdByUserSerial",this.userSerial),this.set("temperature.patientSerial",this.patient.serial),this.set("temperature.createdDatetimeStamp",lib.datetime.now()),this.updateVisitForVital(this.temperature.serial,"Temperature"),this.temperature.visitSerial=this.visit.serial,this._saveTemperature(this.temperature),this._addToVitalList(this.temperature,"Temperature"),this.domHost.addActivityLog("temperature","add",{patientSerial:this.patient.serial,createdByUserSerial:this.userSerial,createdDatetimeStamp:lib.datetime.now(),temperature:this.temparature}),this.domHost.showToast("Added Successfully"),this._makeTemperature()},_showComputedNextVisitDate:function(t){return 0===this.nextVisitDurationTypeSelectedIndex?null:lib.datetime.mkDate(t,"dd-mmm-yyyy")},_nextVisitDurationTypeSelectedIndexChanged:function(){var t,e,i,a,n;return e=this.nextVisitDurationTypeList[this.nextVisitDurationTypeSelectedIndex],e=e.toLowerCase(),e.search("day")!==-1?(t=parseInt(e),this._setNextVisitDateTimestamp(t)):e.search("week")!==-1?(a=parseInt(e.substr(0,1)),t=7*a,this._setNextVisitDateTimestamp(t)):e.search("month")!==-1?(i=parseInt(e.substr(0,1)),t=30*i,this._setNextVisitDateTimestamp(t)):e.search("year")!==-1?(n=parseInt(e.substr(0,1)),t=365*n,this._setNextVisitDateTimestamp(t)):e.search("custom")!==-1?this.isCustomDateTypeSelected=!0:void 0},_setNextVisitDateTimestamp:function(t){var e,i;return e=lib.datetime.now(),i=e+24*t*60*60*1e3,this.nextVisit.data.nextVisitDateTimestamp=i},_nextVisitPriorityTypeSelectedIndexChanged:function(){return this.nextVisit.data.priorityType=this.priorityTypeList[this.nextVisitPriorityTypeSelectedIndex]},_saveNextVisit:function(t){return t.visitSerial=this.visit.serial,t.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-next-visit",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_addNextVisitPressed:function(){if(0!==this.nextVisit.data.nextVisitDateTimestamp)return this.nextVisit.serial=this.generateSerialForNextVisit(),this.nextVisit.createdDatetimeStamp=lib.datetime.now(),null===this.visit.nextVisitSerial&&(this.visit.nextVisitSerial=this.nextVisit.serial,this._saveVisit()),this.nextVisit.data.priorityType=this.priorityValue,this._saveNextVisit(this.nextVisit),this._loadNextVisit(this.nextVisit.serial),this.domHost.showToast("Next Visit Saved!")},_saveNote:function(t){return t.visitSerial=this.visit.serial,t.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("visit-note",t,function(e){return function(e){var i;return i=e.serial,t.serial===i}}(this))},_addNotePressed:function(){if(""!==this.doctorNotesMessage)return this.push("doctorNotes.data.messageList",this.doctorNotesMessage),null===this.doctorNotes.serial&&(this.doctorNotes.createdDatetimeStamp=lib.datetime.now(),this.doctorNotes.serial=this.generateSerialForNote()),null===this.visit.doctorNotesSerial&&(this.visit.doctorNotesSerial=this.doctorNotes.serial,this._saveVisit()),this._saveNote(this.doctorNotes),this.doctorNotesMessage="",this._loadVisitNote(this.doctorNotes.serial),this.domHost.showToast("Note Saved.")},$findCreator:function(t){return"me"},printFullVisitPressed:function(t){var e;return e=this.domHost.getPageParams(),this.domHost.navigateToPage("#/page-print-full-visit/patient:"+this.patient.serial+"/visit:"+this.visit.serial+"/record:"+this.visit.historyAndPhysicalRecordSerial+"/prescription:"+this.prescription.serial+"/test-adviced:"+this.visit.advisedTestSerial+"/doctor-note:"+this.visit.doctorNotesSerial+"/next-visit:"+this.visit.nextVisitSerial+"/patient-stay:"+this.visit.patientStaySerial+"/diagnosis:"+this.visit.diagnosisSerial)},printPrescriptionPressed:function(t){var e;if(e=this.domHost.getPageParams(),"new"!==e.prescription)return this.domHost.navigateToPage("#/print-record/prescription:"+this.prescription.serial+"/patient:"+this.patient.serial)},$findCreator:function(t){return"me"},_institutionSelectedIndexChanged:function(){var t;if(null!==this.doctorInstitutionSelectedIndex)return t=this.doctorInstitutionList[this.doctorInstitutionSelectedIndex],this.visit.hospitalName=t},_specialitySelectedIndexChanged:function(){var t;if(null!==this.doctorSpecialitySelectedIndex)return t=this.doctorSpecialityList[this.doctorSpecialitySelectedIndex],this.visit.doctorSpeciality=t},_makeNewVisit:function(t){return this.visit={serial:null,idOnServer:null,source:"local",createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:0,lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,doctorsPrivateNote:"",patientSerial:this.patient.serial,recordType:"doctor-visit",doctorName:this.user.name,hospitalName:null,doctorSpeciality:null,prescriptionSerial:null,doctorNotesSerial:null,nextVisitSerial:null,advisedTestSerial:null,patientStaySerial:null,invoiceSerial:null,historyAndPhysicalRecordSerial:null,diagnosisSerial:null,identifiedSymptomsSerial:null,examinationSerial:null,referralSerial:null,recordTitle:"Complete Visit",vitalSerial:{bp:null,hr:null,bmi:null,rr:null,spo2:null,temp:null},testResults:{serial:null,name:null,attachmentSerialList:[]}},this.isVisitValid=!0,this.isThatNewVisit=!0,t()},_saveVisit:function(){var t;return t=this.domHost.getPageParams(),"new"===t.visit&&(this.isThatNewVisit=!1,this.visit.serial=this.generateSerialForVisit(),this.domHost.modifyCurrentPagePath("#/visit-editor/visit:"+this.visit.serial+"/patient:"+this.patient.serial),this.domHost.setSelectedVisitSerial(this.visit.serial)),this.visit.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("doctor-visit",this.visit,function(t){return function(e){var i;return i=e.serial,t.visit.serial===i}}(this))},_notifyInvalidPatient:function(){return this.isPatientValid=!1,this.domHost.showModalDialog("Invalid Patient Provided")},_notifyInvalidVisit:function(){return this.isVisitValid=!1},_loadVisit:function(t,e){var i;return i=app.db.find("doctor-visit",function(e){var i;return i=e.serial,i===t}),1!==i.length?void this._notifyInvalidVisit():(this.isVisitValid=!0,this.visit=i[0],e())},_loadVitalsForVisit:function(t,e){return"Blood Pressure"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-blood-pressure"),this.isBPAdded=!0):"Heart Rate"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-pulse-rate"),this.isHRAdded=!0):"BMI"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-bmi"),this.isBMIAdded=!0):"Respirtory Rate"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-respiratory-rate"),this.isRRAdded=!0):"Spo2"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-spo2"),this.isSpO2Added=!0):"Temperature"===e?(this.loadIdentifiedVitalData(t,e,"patient-vitals-temperature"),this.isTempAdded=!0):void 0},loadIdentifiedVitalData:function(t,e,i){var a,n;return a=app.db.find(i,function(e){return function(e){var i;return i=e.serial,i===t}}(this)),1===a.length&&(n=a[0],this._addToVitalList(n,e),!0)},_formatDateTime:function(t){return lib.datetime.format(new Date(t),"mmm d, yyyy h:MMTT")},_loadVisitPrescription:function(t){var e;return e=app.db.find("visit-prescription",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isPrescriptionValid=!0,this.isFullVisitValid=!0,this.prescription=e[0],this._listPrescribedMedications(this.prescription.serial),!0):(this.isPrescriptionValid=!1,!1)},_loadVisitNote:function(t){var e;return e=app.db.find("visit-note",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isNoteValid=!0,this.isFullVisitValid=!0,this.doctorNotes=e[0],!0):(this.isNoteValid=!1,!1)},_loadNextVisit:function(t){var e;return e=app.db.find("visit-next-visit",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isNextVisitValid=!0,this.isFullVisitValid=!0,this.nextVisit=e[0],!0):(this.isNextVisitValid=!1,!1)},_checkForTestResults:function(t){var e;return!!t.hasTestResults&&(e=app.db.find("patient-test-results",function(e){var i;return i=e.serial,i===t.testResultsSerial}),1===e.length)},_loadInvoice:function(t){var e;return e=app.db.find("visit-invoice",function(e){var i;return i=e.serial,i===t}),1===e.length?(this.isInvoiceValid=!0,this.set("invoice",e[0]),this.isInvoiceValid=!0):(this.isInvoiceValid=!1,!1)},_onDoctorNoteDeletedButtonPressed:function(t){var e;return e=t.model.index,this.domHost.showModalPrompt("Are you sure?",function(t){return function(i){if(i===!0)return t.splice("doctorNotes.data.messageList",e,1),app.db.upsert("visit-note",t.doctorNotes,function(e){var i;return i=e.serial,t.doctorNotes.serial===i})}}(this))},_headerTitleListIndexChanged:function(){if(this.visit.serial)return this.visit.recordTitle="",this.set("visit.recordTitle",this.visitHeaderTitleList[this.visitHeaderTitleSelectedIndex]),this._saveVisit()},_makeSettings:function(){return this.settings={createdByUserSerial:this.user.serial,lastModifiedDatetimeStamp:0,createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:null,serial:this.user.serial,printDecoration:{leftSideLine1:"My Institution",leftSideLine2:"My Institution Address",leftSideLine3:"My Institution Contact",rightSideLine1:"My Name",rightSideLine2:"My Degrees",rightSideLine3:"My Contact",footerLine:"A simple message on the bottom",logoDataUri:null,partner1LogoDataUri:null,partner2LogoDataUri:null,partner3LogoDataUri:null},billingTargetEmailAddress:"",nsqipTargetEmailAddress:"",monetaryUnit:"BDT",otherSettings:{patientSignUpDefaultPassword:"123456"}}},_getSettings:function(){var t,e;return t=app.db.find("settings"),e=0===t.length?this._makeSettings():t[0]},_getRecord:function(t,e){var i;return i=app.db.find(e,function(e){var i;return i=e.serial,i===t}),1===i.length?i[0]:null},generateHtmlContent:function(t,e){var i;return i=this.handle_type(t,e.data),i=this.filterHtmlContent(i)},filterHtmlContent:function(t){return t=t.replace(/@VALUE@/g,"")},printOutStyleSheet:function(){return"<style>\n  \n  .default-category {\n    /* font-size: 20px; \n    font-weight: bold; */\n    text-align: center; \n  }\n  .default-collection {\n    /* font-size: 16px; \n    font-weight: bold; */\n  }\n  .default-group {\n    /* text-decoration: overline; */\n  }\n  .default-card {\n    /* text-decoration: underline; */\n  }\n  span {\n    font-size: 14px;\n  }\n  .unprocessed {\n    color: red;\n  }\n</style>"},handle_children:function(t,e){var i,a,n,s,r,o,l;if(s="","childMap"in e&&"childList"in t&&null!==t.childList)for(l=t.childList,n=r=0,o=l.length;r<o;n=++r)i=l[n],i.key in e.childMap&&(a=this.handle_type(i,e.childMap[i.key]),a&&";"!==a&&":;"!==a&&": ;"!==a&&(a=this.sanitizeOutput(a),s+=a));return s},handle_type:function(t,e){return"print"in t||(t.print={}),"systemRoot"===t.type?(this.flattenStyle(t),this.type_systemRoot(t,e)):"category"===t.type?("boldLabel"in t.print||(t.print.boldLabel=!0),"fontSize"in t.print||(t.print.fontSize=18),this.flattenStyle(t),this.type_category(t,e)):"collection"===t.type?("boldLabel"in t.print||(t.print.boldLabel=!0),"fontSize"in t.print||(t.print.fontSize=16),this.flattenStyle(t),this.type_collection(t,e)):"group"===t.type?("passThrough"in t.print||(t.print.passThrough=!0),"fontSize"in t.print||(t.print.fontSize=14),this.flattenStyle(t),this.type_group(t,e)):"card"===t.type?("boldLabel"in t.print||(t.print.boldLabel=!0),"fontSize"in t.print||(t.print.fontSize=14),this.flattenStyle(t),this.type_card(t,e)):"checkbox"===t.type?(this.flattenStyle(t),this.type_checkbox(t,e)):"toggleableContainer"===t.type?(this.flattenStyle(t),this.type_toggleableContainer(t,e)):"label"===t.type?(this.flattenStyle(t),this.type_label(t,e)):"autocomplete"===t.type?("selectionType"in t&&"label"===t.selectionType&&("separatorString"in t.print||(t.print.separatorString=", ")),this.flattenStyle(t),this.type_autocomplete(t,e)):"container"===t.type?(this.flattenStyle(t),this.type_container(t,e)):"checkList"===t.type?("separatorString"in t.print||(t.print.separatorString=", "),this.flattenStyle(t),this.type_checkList(t,e)):"radioList"===t.type?("separatorString"in t.print||(t.print.separatorString=", "),this.flattenStyle(t),this.type_radioList(t,e)):"input"===t.type?(this.flattenStyle(t),this.type_input(t,e)):"singleSelectDropdown"===t.type?(this.flattenStyle(t),this.type_singleSelectDropdown(t,e)):"incrementalCounter"===t.type?(this.flattenStyle(t),this.type_incrementalCounter(t,e)):'<span class="unprocessed">UNPROCESSED '+t.type+" - "+t.key+"</span>"},flattenStyle:function(t){if("passThrough"in t.print&&("hideLabel"in t.print||(t.print.hideLabel=!0),"noColonAfterThis"in t.print||(t.print.noColonAfterThis=!0),"noSemicolonAfterThis"in t.print||(t.print.noSemicolonAfterThis=!1)),"newLineBeforeThis"in t.print&&("boolean"==typeof t.print.newLineBeforeThis?t.print.newLineBeforeThis=t.print.newLineBeforeThis===!0?1:0:t.print.newLineBeforeThis=parseInt(t.print.newLineBeforeThis)),"newLineAfterThis"in t.print&&("boolean"==typeof t.print.newLineAfterThis?t.print.newLineAfterThis=t.print.newLineAfterThis===!0?1:0:t.print.newLineAfterThis=parseInt(t.print.newLineAfterThis)),"newLineAfterThisAndChildren"in t.print&&("boolean"==typeof t.print.newLineAfterThisAndChildren?t.print.newLineAfterThisAndChildren=t.print.newLineAfterThisAndChildren===!0?1:0:t.print.newLineAfterThisAndChildren=parseInt(t.print.newLineAfterThisAndChildren)),"newLineAfterEachValue"in t.print)return"boolean"==typeof t.print.newLineAfterEachValue?t.print.newLineAfterEachValue=t.print.newLineAfterEachValue===!0?1:0:t.print.newLineAfterEachValue=parseInt(t.print.newLineAfterEachValue)},sanitizeOutput:function(t){var e,i;for(e=i=0;i<=2;e=++i)t=t.replace(/\;;/g,";"),t=t.replace(/\;;/g,";"),t=t.replace(/\; ;/g,";"),t=t.replace(/\: ;/g,";"),t=t.replace(/\: :/g,":"),t=t.replace(/\, ;/g,";"),t=t.replace(/\; ,/g,";"),t=t.replace(/\,;/g,";"),t=t.replace(/<\/span style=""><\/span>/g,""),t=t.replace(/<\/span>;<\/span>/g,"</span></span>"),t=t.replace(/<\/span>; <\/span>/g,"</span></span>"),t=t.replace(/<\/span> ,<\/span>/g,"</span></span>");return t},_computeElementStyle:function(t){var e;return e="",t.print.fontSize&&(e+="font-size: "+t.print.fontSize+"px;"),t.print.hide&&(e+="display: none;"),e},_computeTitleOrLabelStyle:function(t){var e;return e="",t.print.boldLabel&&(e+="font-weight: bold;"),e},type_systemRoot:function(t,e){var i;return i=this.handle_children(t,e),this.printOutStyleSheet()+i},type_category:function(t,e){var i,a,n,s;return i=this.handle_children(t,e),0===i.length?"":(n=this._computeTitleOrLabelStyle(t),s='<span style="'+n+'">'+t.label+"</span>",n=this._computeElementStyle(t),a='<div class="default-category" style="'+n+'">'+s+"</div>"+i)},type_collection:function(t,e){var i,a,n,s;return 0===Object.keys(e.childMap).length?"":(i=t.defaultGroup&&!e.isDefaultGroupDismissed?this.handle_type(t.defaultGroup,e.childMap[t.defaultGroup.key]):this.handle_children(t,e),n=this._computeTitleOrLabelStyle(t),s='<br><span style="'+n+'">'+t.label+"</span><br>",n=this._computeElementStyle(t),a='<span class="default-collection" style="'+n+'">'+s+"</span>: "+i+"<br>")},type_group:function(t,e){var i,a,n,s;return i=this.handle_children(t,e),n=this._computeTitleOrLabelStyle(t),s='<span style="'+n+'">'+t.label+"</span>",t.print.passThrough?a=i+";":(n=this._computeElementStyle(t),a='<span class="default-group" style="'+n+'">'+s+"</span>: "+i+"; "),a},_makePrintableContent:function(t,e,i,a,n){var s,r,o,l,d,u,c,h,m,p,v,f,g,y,S;if(0===e.length&&0===i.length&&"label"!==a.type)return"";if(m=a.print,h="",r="",S="",m.hide)return"";if(t.length>0&&(m.hideLabel||(y="",m.boldLabel&&(y+="font-weight: bold;"),m.fontSize&&(y+="font-size:"+m.fontSize+"px;"),h='<span style="'+y+'">'+t+"</span>")),i.length>0&&(m.hideValue||(y="",m.boldValue&&(y+="font-weight: bold;"),m.fontSize&&(y+="font-size:"+m.fontSize+"px;"),S='<span style="'+y+'">'+i+"</span>")),e.length>0&&(m.hideChildren||(y="",m.boldChildren&&(y+="font-weight: bold;"),r='<span style="'+y+'">'+e+"</span>")),0===(h+r+S).length)return"";if("newLineBeforeThis"in m)for(l=d=0,p=m.newLineBeforeThis;0<=p?d<p:d>p;l=0<=p?++d:--d)h="<br>"+h;if("newLineAfterThis"in m)for(l=u=0,v=m.newLineAfterThis;0<=v?u<v:u>v;l=0<=v?++u:--u)h+="<br>";if(s="noColonAfterThis"in m&&m.noColonAfterThis||0===h.length?"":": ",g="noSemicolonAfterThis"in m&&m.noSemicolonAfterThis?"":"; ",o=h+s+r+S+g,"newLineAfterThisAndChildren"in m)for(l=c=0,f=m.newLineAfterThisAndChildren;0<=f?c<f:c>f;l=0<=f?++c:--c)o+="<br>";return o},type_card:function(t,e){var i,a,n;return i=this.handle_children(t,e),a=t.label,n=null,this._makePrintableContent(a||"",i||"",n||"",t,e)},type_checkbox:function(t,e){var i,a,n;return i=null,a=null,n=e.isChecked?t.label:"",this._makePrintableContent(a||"",i||"",n||"",t,e)},type_label:function(t,e){var i,a,n;return i=null,a=e.label||t.label||t.defaultLabel,n=null,this._makePrintableContent(a||"",i||"",n||"",t,e)},type_toggleableContainer:function(t,e){var i,a,n;return e.isChecked?(i=this.handle_children(t,e),a=t.label,n=null,this._makePrintableContent(a||"",i||"",n||"",t,e)):""},type_container:function(t,e){var i,a,n;return i=this.handle_children(t,e),a=e.label||t.defaultLabel,n=null,this._makePrintableContent(a||"",i||"",n||"",t,e)},type_checkList:function(t,e){var i,a,n,s,r,o,l,d,u,c,h,m,p;for(d=t.print,m=[],u=e.checkedValueList,s=0,l=u.length;s<l;s++)n=u[s],m.push(n);if(h=d.separatorString,"newLineAfterEachValue"in d)for(a=r=0,c=d.newLineAfterEachValue;0<=c?r<c:r>c;a=0<=c?++r:--r)h+="<br>";return p=m.join(h),o=null,i=null,this._makePrintableContent(o||"",i||"",p||"",t,e)},type_radioList:function(t,e){var i,a,n;return n=e.selectedValue,a=null,i=null,this._makePrintableContent(a||"",i||"",n||"",t,e)},type_singleSelectDropdown:function(t,e){var i,a,n;return n=t.possibleValueList[e.selectedIndex],a=null,i=null,this._makePrintableContent(a||"",i||"",n||"",t,e)},type_input:function(t,e){var i,a,n,s;return i=e.value,t.unitDetails&&(n=t.unitDetails.unitList[e.selectedUnitIndex]),s=i,a=t.label,i=null,this._makePrintableContent(a||"",i||"",s||"",t,e)},type_autocomplete:function(t,e){var i,a,n,s,r,o,l,d,u,c,h,m,p,v,f;if(l=t.print,"label"===t.selectionType){m=[],d=e.virtualChildMap;for(r in d)v=d[r],p=r.split("_"),p.pop(),p.shift(),p=p.join("_"),m.push(p);if(h=l.separatorString,"newLineAfterEachValue"in l)for(n=s=0,u=l.newLineAfterEachValue;0<=u?s<u:s>u;n=0<=u?++s:--s)h+="<br>";return v=m.join(h),o=t.label,a=null,this._makePrintableContent(o||"",a||"",v||"",t,e)}a="",c=e.virtualChildMap;for(r in c)v=c[r],p=r.split("_"),p.pop(),p.shift(),p=p.join("_"),f={type:"container",defaultLabel:p,key:r,childList:t.childListForEachContainer},i=this.handle_type(f,v)+", ",a+=i;return v=null,o=t.label,this._makePrintableContent(o||"",a||"",v||"",t,e)},type_incrementalCounter:function(t,e){var i,a,n,s,r,o,l,d,u;i="",r=e.virtualChildMap;for(n in r)return d=r[n],l=n.replace("item",""),o=parseInt(l),u={type:"container",defaultLabel:function(){try{return t.unit.singular}catch(e){return a=e,"unit"}}()+" #"+(o+1),key:n,childList:t.childListForEachContainer},i+=this.handle_type(u,d)+";",d=null,s=t.label,this._makePrintableContent(s||"",i||"",d||"",t,e)},should_boldLabel:function(t){return"print"in t&&"boldLabel"in t.print&&t.print.boldLabel},should_passThrough:function(t){return"print"in t&&"passThrough"in t.print&&t.print.passThrough},should_newLineBeforeThis:function(t){return"print"in t&&"newLineBeforeThis"in t.print&&t.print.newLineBeforeThis},inject_passThrough_special_card:function(t,e){var i;if(t.key===t.label&&("Details"===(i=t.key)||"Default"===i))return t.print||(t.print={}),t.print.passThrough=!0},inject_passThrough_special_group:function(t,e){var i;if(t.key===t.label&&("List"===(i=t.key)||"Default"===i))return t.print||(t.print={}),t.print.passThrough=!0},__debug_print:function(t,e){var i,a;i="print"in t?Object.keys(t.print):[],a=lib.array.minus(i,e),a.length>0},checkForPrintPreviewType:function(){return!this.visit.historyAndPhysicalRecordSerial&&(!this.visit.identifiedSymptomsSerial&&(!this.visit.examinationSerial&&(!this.visit.vitalSerial.bp&&(!this.visit.vitalSerial.hr&&(!this.visit.vitalSerial.bmi&&(!this.visit.vitalSerial.rr&&(!this.visit.vitalSerial.spo2&&(!this.visit.vitalSerial.temp&&(!this.visit.advisedTestSerial&&(!this.visit.diagnosisSerial&&(!this.visit.doctorNotesSerial&&!this.visit.nextVisitSerial)))))))))));
},getPrintedOnTime:function(){return lib.datetime.format(new Date,"mmm d, yyyy h:MMTT")},printButtonPressed:function(t){return this.set("addedExaminationList2",[]),this.printPrescriptionOnly=this.checkForPrintPreviewType(),lib.util.delay(200,function(t){return function(){return t.set("addedExaminationList2",t.addedExaminationList),lib.util.delay(200,function(){return window.print()})}}(this))},saveVisitSettings:function(){return this.recordTitleValueChanged(),this.$$("#dialogVisitSettings").close()},_getRecordSerial:function(t){return"undefined"==typeof t?"new":"new"===t?t:t},getExaminationValueList:function(t){var e,i,a,n;if(n="",0!==t.length){for(i=0,a=t.length;i<a;i++)e=t[i],e.checked?n=n+e.value+", ":n+="";return"("+n+")"}return""},loadMedicineList:function(){return this.domHost.getStaticData("pccMedicineList",function(t){return function(e){return t.medicineCompositionList=e,t._loadDefaultMedicineCompositionList()}}(this))},_checkUserAccess:function(t){var e,i,a,n;if("none"===t)return!0;if(this.organization){if(this.organization.isCurrentUserAnAdmin)return!0;if(this.organization.isCurrentUserAMember){if(!this.organization.userActiveRole)return!0;if(n=this.organization.userActiveRole.privilegeList,0!==n.length)for(e=0,i=n.length;e<i;e++)if(a=n[e],a.serial===t)return!0;return!1}return!1}return!0},_loadVariousWallets:function(){return this._getPatientServiceBalance(this.patient.idOnServer,function(t){return function(e){t.set("patientServiceBalance",e)}}(this))},onVitalIndexChange:function(){},editPatientBtnPressed:function(){return this.domHost.navigateToPage("#/patient-editor/patient:"+this.patient.serial)},navigatedIn:function(){return this.domHost.selectedPatientPageIndex=0,this.organization=this.getCurrentOrganization(),this.organization||this.domHost.navigateToPage("#/select-organization"),this._loadUser(function(t){return function(){var e;return e=t.domHost.getPageParams(),t.settings=t._getSettings(),t._loadPatient(e.patient,function(){var i;return t._loadVariousWallets(function(){return null}),e.selected?t.selectedVisitPageIndex=e.selected:t.selectedVisitPageIndex=0,t.historyAndPhysicalRecord={},t._resetMedicineForm(),t._makeDuplicateMedicineEditablePart(),t.matchingPrescribedMedicineList=[],t.addedIdentifiedSymptomsList=[],t.comboBoxSymptomsInputValue="",t.comboBoxExaminationInputValue="",i=parseInt(lib.localStorage.getItem("lastSelectedTempUnit")),i?t.tempUnitSelectedIndex=i:t.tempUnitSelectedIndex=0,t.addedVitalList=[],t.investigationDataList=[],t.addedInvestigationList=[],t.comboBoxInvestigationInputValue="",t.loadMedicineList(),t._listFavoriteMedicine(t.user.serial),t._listCurrentMedications(e.patient),t._loadSymptomsListFromSystem(t.user.serial),t._loadExaminationList(t.user.serial),t._loadInvestigationList(t.user.serial),t._loadUserAddedInstitutionList(t.user.serial),t.loadDiagnosisListData(),e.visit?(t._loadPriceList(t.organization.idOnServer,function(){}),"new"===e.visit?t._makeNewVisit(function(){return t._makeNewPrescription(),t._makeNewIdentifiedSymptomsObject(),t._makeNewExaminationObject(),t._makeBloodPressure(),t._makePulseRate(),t._makeBmi(),t._makeRespiratoryRate(),t._makeOxygenSaturation(),t._makeTemperature(),t._makeNewTestAdvisedObject(),t._makeNewDiagnosis(),t._makeNewNote(),t._makeNewNextVisit(),t.invoice={},t._loadOrganizationsIBelongTo(),t._makeNewPatientStay()}):t._loadVisit(e.visit,function(){return t.domHost.setSelectedVisitSerial(e.visit),t.visit.hasOwnProperty("historyAndPhysicalRecordSerial")?t.visit.historyAndPhysicalRecordSerial?(t.historyAndPhysical_navigatedIn(),t.set("recordPartName","history-and-physical-record"),t.recordDatabaseCollectionName="history-and-physical-record",t.record=t._getRecord(t.visit.historyAndPhysicalRecordSerial,t.recordDatabaseCollectionName),t.recordPartData=t.record,t.recordPartTitle="History and Physical Record",t.domHost.getStaticData("dynamicElementDefinitionPreoperativeAssessment",function(e){if(t.recordPartDef=e,t.recordPartHtmlContent=t.generateHtmlContent(t.recordPartDef,t.recordPartData),!t.delayRendering)return t.shouldRender=!0})):t.historyAndPhysicalRecord={}:(t.visit.historyAndPhysicalRecordSerial=null,t.historyAndPhysicalRecord={}),t.visit.hasOwnProperty("prescriptionSerial")?t.visit.prescriptionSerial?t._loadPrescription(t.visit.prescriptionSerial):t._makeNewPrescription():(t.visit.prescriptionSerial=null,t._makeNewPrescription()),t.medicine.timesPerInterval=1,t.visit.hasOwnProperty("identifiedSymptomsSerial")?t.visit.identifiedSymptomsSerial?t._loadIdentifiedSymptoms(t.visit.identifiedSymptomsSerial):t._makeNewIdentifiedSymptomsObject():(t.visit.identifiedSymptomsSerial=null,t._makeNewIdentifiedSymptomsObject()),t.visit.hasOwnProperty("examinationSerial")?t.visit.examinationSerial?t._loadExamination(t.visit.examinationSerial):t._makeNewExaminationObject():(t.visit.examinationSerial=null,t._makeNewExaminationObject()),t.visit.hasOwnProperty("vitalSerial")?(t.visit.vitalSerial.bp?t._loadVitalsForVisit(t.visit.vitalSerial.bp,"Blood Pressure"):t._makeBloodPressure(),t.visit.vitalSerial.hr?t._loadVitalsForVisit(t.visit.vitalSerial.hr,"Heart Rate"):t._makePulseRate(),t.visit.vitalSerial.bmi?t._loadVitalsForVisit(t.visit.vitalSerial.bmi,"BMI"):t._makeBmi(),t.visit.vitalSerial.rr?t._loadVitalsForVisit(t.visit.vitalSerial.rr,"Respirtory Rate"):t._makeRespiratoryRate(),t.visit.vitalSerial.spo2?t._loadVitalsForVisit(t.visit.vitalSerial.spo2,"Spo2"):t._makeOxygenSaturation(),t.visit.vitalSerial.temp?t._loadVitalsForVisit(t.visit.vitalSerial.temp,"Temperature"):t._makeTemperature()):(t._makeBloodPressure(),t._makePulseRate(),t._makeBmi(),t._makeRespiratoryRate(),t._makeOxygenSaturation(),t._makeTemperature(),t.visit.vitalSerial={bp:null,hr:null,bmi:null,rr:null,spo2:null,temp:null}),t.visit.hasOwnProperty("advisedTestSerial")?t.visit.advisedTestSerial?t._loadAdvisedTest(t.visit.advisedTestSerial):t._makeNewTestAdvisedObject():(t.visit.advisedTestSerial=null,t._makeNewTestAdvisedObject()),t.visit.hasOwnProperty("diagnosisSerial")?t.visit.diagnosisSerial?t._loadDiagnosis(t.visit.diagnosisSerial):t._makeNewDiagnosis():(t.visit.diagnosisSerial=null,t._makeNewDiagnosis()),t.visit.hasOwnProperty("referralSerial")?t.visit.referralSerial?t._loadReferral(t.visit.referralSerial):t._makeNewReferral():(t.visit.referralSerial=null,t._makeNewReferral()),t.visit.hasOwnProperty("doctorNotesSerial")?t.visit.doctorNotesSerial?t._loadVisitNote(t.visit.doctorNotesSerial):t._makeNewNote():(t.visit.doctorNotesSerial=null,t._makeNewNote()),t.visit.hasOwnProperty("nextVisitSerial")?t.visit.nextVisitSerial?t._loadNextVisit(t.visit.nextVisitSerial):t._makeNewNextVisit():(t.visit.nextVisitSerial=null,null===t._makeNewNextVisit()),t._loadOrganizationsIBelongTo(),t.visit.hasOwnProperty("patientStaySerial")?t.visit.patientStaySerial?t._loadVisitPatientStay(t.visit.patientStaySerial):t._makeNewPatientStay():(t.visit.patientStaySerial=null,null===t._makeNewPatientStay()),t.visit.hasOwnProperty("invoiceSerial")?t.visit.invoiceSerial?t._loadInvoice(t.visit.invoiceSerial):t.invoice={}:(t.visit.invoiceSerial=null,t.invoice={})})):void t._notifyInvalidVisit()})}}(this))},navigatedOut:function(){return this.visit={},this.patient={},this.doctorNotes={},this.patientStay={},this.isVisitValid=!1,this.isPatientValid=!1,this.isNoteValid=!1,this.isPatientStayValid=!1,this.isInvoiceValid=!1,this.doctorInstitutionList=[],this.doctorSpecialityList=[],this.prescription={},this.isPrescriptionValid=!1,this.matchingPrescribedMedicineList=[],this.matchingCurrentMedicineList=[],this.matchingFavoriteMedicineList=[],this.medicine={},this.isMedicineValid=!1,this.isTestAdvisedValid=!1,this.testAdvisedObject={},this.matchingFavoriteInvestigationList=[],this.investigationDataList=[],this.addedExaminationList=[],this.selectedView=0,this.patientStay=null,this.patientStayObject=null,this.organizationsIBelongToList=[],this.selectedOrganizationIndex=null,this.selectedDepartmentIndex=null,this.selectedUnitIndex=null,this.selectedWardIndex=null,this.seatList=[],this.patientDischarged=!1,this.shouldRender=!1,this.historyAndPhysicalRecord={}},historyAndPhysical_navigatedIn:function(){return this._loadHistoryAndPhysicalRecord(),this._loadRecordInClipboard()},historyAndPhysicalRecordCreate:function(t){var e;return e=this.domHost.getPageParams(),"new"===e.visit&&this._saveVisit(),this.historyAndPhysicalRecord={lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,serial:this.generateSerialForHistoryAndPhysical(),patientSerial:this.patient.serial,visitSerial:this.visit.serial,availableToPatient:!0},this.visit.historyAndPhysicalRecordSerial=this.historyAndPhysicalRecord.serial,this.visit.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("doctor-visit",this.visit,function(t){return function(e){var i;return i=e.serial,t.visit.serial===i}}(this)),this._saveHistoryAndPhysicalRecord(),this._loadHistoryAndPhysicalRecord(),this.domHost.navigateToPage("#/record-history-and-physical/record:"+this.historyAndPhysicalRecord.serial),window.location.reload()},_loadRecordInClipboard:function(){var t;return t=sessionStorage.getItem("HISTORY-AND-PHYSICAL-IN-CLIPBOARD"),t&&(t=JSON.parse(t)),this.recordInClipboard=t},historyAndPhysicalRecordCopy:function(t){var e;return e=this.historyAndPhysicalRecord,sessionStorage.setItem("HISTORY-AND-PHYSICAL-IN-CLIPBOARD",JSON.stringify(e)),this.domHost.showModalDialog("This record has been copied to clipboard"),this._loadRecordInClipboard()},pasteRecordPressed:function(t){var e;return e=this.domHost.getPageParams(),"new"===e.visit&&this._saveVisit(),this.recordInClipboard.patientSerial=this.patient.serial,this.recordInClipboard.visitSerial=this.visit.serial,this.recordInClipboard.lastChangedDatetimeStamp=lib.datetime.now(),this.recordInClipboard.serial=this.generateSerialForRecord(),this.visit.historyAndPhysicalRecordSerial=this.recordInClipboard.serial,this.historyAndPhysicalRecord=this.recordInClipboard,app.db.upsert("doctor-visit",this.visit,function(t){return function(e){var i;return i=e.serial,t.visit.serial===i}}(this)),this._saveHistoryAndPhysicalRecord(),this._loadHistoryAndPhysicalRecord(),this.recordInClipboard=null,sessionStorage.removeItem("HISTORY-AND-PHYSICAL-IN-CLIPBOARD"),this.domHost.showModalDialog("Successfully Imported. Reloading Interface."),this.domHost.navigateToPage("#/record-history-and-physical/record:"+this.historyAndPhysicalRecord.serial),window.location.reload()},_updateVisitForHistoryAndPhysicalRecord:function(t){},historyAndPhysicalRecordPrint:function(t){return this.domHost.navigateToPage("#/print-history-and-physical-record/record:"+this.historyAndPhysicalRecord.serial)},historyAndPhysicalRecordEdit:function(t){return this.domHost.navigateToPage("#/record-history-and-physical/record:"+this.historyAndPhysicalRecord.serial)},historyAndPhysicalRecordRemove:function(t){return this.domHost.showModalPrompt("Are you sure?",function(t){return function(e){if(e)return app.db.remove("history-and-physical-record",t.historyAndPhysicalRecord._id),t._loadHistoryAndPhysicalRecord()}}(this))},_loadHistoryAndPhysicalRecord:function(){var t,e;t=this.visit.serial,e=app.db.find("history-and-physical-record",function(e){return function(e){var i;return i=e.visitSerial,i===t}}(this)),1===e.length?this.set("historyAndPhysicalRecord",e[0]):this.set("historyAndPhysicalRecord",null)},_saveVisitPrescription:function(){return app.db.upsert("visit-prescription",this.prescription,function(t){return function(e){var i;return i=e.serial,t.prescription.serial===i}}(this)),this.domHost.showToast("Record Saved")},_saveVisitTestAdvised:function(){return app.db.upsert("visit-advised-test",this.testAdvised,function(t){return function(e){var i;return i=e.serial,t.testAdvised.serial===i}}(this)),this.domHost.showToast("Record Saved")},_saveHistoryAndPhysicalRecord:function(){return app.db.upsert("history-and-physical-record",this.historyAndPhysicalRecord,function(t){return function(e){var i;return i=e.serial,t.historyAndPhysicalRecord.serial===i}}(this)),this.domHost.showToast("Record Saved")},_updatePatientSerialSyncByCollection:function(t,e,i){var a,n,s,r,o,l,d,u;if(l=app.db.find("filterd-patient-serial-list-for-sync",function(e){var i;return i=e.collectionName,i===t}),1===l.length)for(s=l[0],d={},u=s.patientSerialList,a=r=0,o=u.length;r<o;a=++r)if(n=u[a],n.patientSerial===e)return s.patientSerialList[a].isSync=i,app.db.upsert("filterd-patient-serial-list-for-sync",s,function(t){return function(t){var e;return e=t._id,s._id===e}}(this)),!0},historyAndPhysicalSyncCheckboxChanged:function(t){var e,i;return e=this.domHost.getPageParams(),e.patient&&(i=e.patient),t.target.checked?this._updatePatientSerialSyncByCollection("history-and-physical-record",i,!0):this._updatePatientSerialSyncByCollection("history-and-physical-record",i,!1)},historyAndPhysicalAvailableToPatientCheckBoxChanged:function(t){if(this.historyAndPhysicalRecord)return t.target.checked?(this.historyAndPhysicalRecord.availableToPatient=!0,this._saveHistoryAndPhysicalRecord()):(this.historyAndPhysicalRecord.availableToPatient=!1,this._saveHistoryAndPhysicalRecord())},prescriptionAvailableToPatientCheckBoxChanged:function(t){if(this.prescription)return t.target.checked?(this.prescription.availableToPatient=!0,this._saveVisitPrescription()):(this.prescription.availableToPatient=!1,this._saveVisitPrescription())},testAdvisedAvailableToPatientCheckBoxChanged:function(t){if(this.testAdvised)return t.target.checked?(this.testAdvised.availableToPatient=!0,this._saveVisitTestAdvised()):(this.testAdvised.availableToPatient=!1,this._saveVisitTestAdvised())},_loadDiagnosis:function(t){return lib.util.delay(5,function(e){return function(){var i;return i=app.db.find("diagnosis-record",function(e){var i;return i=e.serial,i===t}),1===i.length?(e.isDiagnosisValid=!0,e.isFullVisitValid=!0,e.diagnosis=i[0],!0):(e.isDiagnosisValid=!1,!1)}}(this))},_makeNewDiagnosis:function(){return this.diagnosis={serial:null,lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.visit.doctorName,doctorSpeciality:this.visit.doctorSpeciality,data:{diagnosisList:[]}}},_saveDiagnosis:function(){return null===this.visit.serial&&(this._saveVisit(),this.diagnosis.visitSerial=this.visit.serial),null===this.diagnosis.serial&&(this.diagnosis.serial=this.generateSerialForDiagnosis(),this.visit.diagnosisSerial=this.diagnosis.serial,this.diagnosis.visitSerial=this.visit.serial,this._saveVisit()),this.diagnosis.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("diagnosis-record",this.diagnosis,function(t){return function(e){var i;return i=e.serial,t.diagnosis.serial===i}}(this)),this.comboBoxDiagnosisInputValue=""},loadDiagnosisListData:function(){return this.domHost.getStaticData("diagnosisList",function(t){return function(e){var i,a;return a=function(){var t,a,n;for(n=[],t=0,a=e.length;t<a;t++)i=e[t],i.name&&n.push({label:i.name,value:i.name});return n}(),t.set("diagnosisListArray",a)}}(this))},comboBoxKeyUpRecordTitleValueChanged:function(t){if((""!==this.visit.recordTitle||null!==this.visit.recordTitle)&&13===t.which)return this._saveVisit()},recordTitleValueChanged:function(){if(""!==this.visit.recordTitle||null!==this.visit.recordTitle)return this._saveVisit()},openVisitSettingsDialog:function(t){return this.$$("#dialogVisitSettings").toggle()},comboBoxKeyUpDiagnosisValueChanged:function(t){var e;if(""!==this.comboBoxDiagnosisInputValue&&13===t.which)return e="",e="object"==typeof this.comboBoxDiagnosisInputValue?this.comboBoxDiagnosisInputValue.name:this.comboBoxDiagnosisInputValue,this.push("diagnosis.data.diagnosisList",{name:e}),this._saveDiagnosis(),this.domHost.showToast("Diagnosis Added!"),this.comboBoxDiagnosisInputValue=""},addDiagnosis:function(){var t;if(""!==this.comboBoxDiagnosisInputValue)return t="",t="object"==typeof this.comboBoxDiagnosisInputValue?this.comboBoxDiagnosisInputValue.name:this.comboBoxDiagnosisInputValue,this.push("diagnosis.data.diagnosisList",{name:t}),this._saveDiagnosis(),this._addToInvoice(t,this.visit.serial),this.domHost.showToast("Diagnosis Added!"),this.comboBoxDiagnosisInputValue=""},_deleteSelectedDiagnosisButtonPressed:function(t){var e;return e=t.model.index,this.splice("diagnosis.data.diagnosisList",e,1),this._saveDiagnosis(),this.domHost.showToast("Diagnosis Deleted!")},_getServiceRendered:function(t){var e;return e=["Doctor Visit","2nd Visit","Online Phone Consultation","In Patient (Hospital/Clinic Visits)","Report Assessment","Custom"],5===t?this.invoice.customServiceRendered:e[t]},createInvoicePressed:function(){var t;return t=this.domHost.getPageParams(),"new"===t.visit&&(this.visit.serial=this.generateSerialForVisit(),this.visit.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("doctor-visit",this.visit,function(t){return function(e){var i;return i=e.serial,t.visit.serial===i}}(this))),this.domHost.navigateToPage("#/create-invoice/visit:"+this.visit.serial+"/patient:"+this.patient.serial+"/invoice:new")},editInvoicePressed:function(t){return this.domHost.navigateToPage("#/create-invoice/visit:"+this.visit.serial+"/patient:"+this.patient.serial+"/invoice:"+this.invoice.serial)},printInvoicePressed:function(){var t;if(t=this.domHost.getPageParams(),"new"!==t["visit-invoice"])return this.domHost.navigateToPage("#/print-invoice/visit:"+this.visit.serial+"/patient:"+this.patient.serial+"/invoice:"+this.invoice.serial)},_loadReferral:function(t){return lib.util.delay(5,function(e){return function(){var i;if(i=app.db.find("referral-record",function(e){var i;return i=e.serial,i===t}),1===i.length)return e.referral=i[0],!0}}(this))},_makeNewReferral:function(){return this.referral={serial:null,lastModifiedDatetimeStamp:lib.datetime.now(),createdDatetimeStamp:lib.datetime.now(),lastSyncedDatetimeStamp:0,createdByUserSerial:this.user.serial,organizationId:this.organization.idOnServer,visitSerial:null,patientSerial:this.patient.serial,doctorName:this.visit.doctorName,doctorSpeciality:this.visit.doctorSpeciality,data:{}}},_saveReferral:function(){return null===this.visit.serial&&(this._saveVisit(),this.referral.visitSerial=this.visit.serial),null===this.referral.serial&&(this.referral.serial=this.generateSerialForReferral(),this.visit.referralSerial=this.referral.serial,this.referral.visitSerial=this.visit.serial,this._saveVisit()),this.referral.lastModifiedDatetimeStamp=lib.datetime.now(),app.db.upsert("referral-record",this.referral,function(t){return function(e){var i;return i=e.serial,t.referral.serial===i}}(this))},openReferralDialogPressed:function(t){return this.$.dialogReferral.toggle()},doctorSearchStartKeyPressed:function(t){if(13===t.which)return this.doctorSearchButtonPressed()},doctorSearchButtonPressed:function(){return this.callApi("/bdemr-doctor-search",{searchQuery:this.doctorSearchFieldInput},function(t){return function(e,i){var a,n,s;return i.hasError?t.domHost.showModalDialog(i.error.message):(a=i.data,a.length>0?(n=function(){var t,e,i;for(i=[],t=0,e=a.length;t<e;t++)s=a[t],i.push(s);return i}(),t.$$("#doctorSearch").suggestions(n)):t.domHost.showToast("No Match Found"))}}(this))},doctorSearchCleared:function(){return this.set("searchFieldMainInput","")},organizationSearchStartKeyPressed:function(t){if(13===t.which)return this.organizationSearchButtonPressed()},organizationSearchButtonPressed:function(){var t;return t={apiKey:this.user.apiKey,searchString:this.organizationSearchFieldInput},this.callApi("/bdemr-organization-search",t,function(e){return function(i,a){var n,s;return a.hasError?e.domHost.showModalDialog(a.error.message):(t=a.data.matchingOrganizationList,t.length>0?(s=function(){var e,i,a;for(a=[],e=0,i=t.length;e<i;e++)n=t[e],a.push(n);return a}(),e.$$("#organizationSearch").suggestions(s)):e.domHost.showToast("No Match Found"))}}(this))},addReferralButtonClicked:function(){var t;if(this.doctorSearchFieldInput||this.organizationSearchFieldInput)return t={referredByDoctorName:this.user.name,referredByDoctorId:this.user.idOnServer,selectedReferralType:"",doctorName:"",doctorId:"",speciality:"",organizationName:"",organizationId:""},0===this.selectedReferralTypeIndex&&(t.doctorName=this.doctorSearchFieldInput,t.speciality=this.referredDoctorSpecialityList[this.referredDoctorSpecialitySelectedIndex],t.doctorId=this.$$("#doctorSearch").value),1===this.selectedReferralTypeIndex&&(t.organizationName=this.organizationSearchFieldInput,t.organizationId=this.$$("#organizationSearch").value),this.set("referral.data",t),this._saveReferral(),this.$.dialogReferral.toggle()},_addMedicinePriceToInvoice:function(t,e,i){var a,n,s;return s=function(){var e,i,a,s;for(a=this.medicineCompositionList,s=[],e=0,i=a.length;e<i;e++)n=a[e],n.brandName===t&&s.push(n);return s}.call(this)[0],a={name:(null!=s?s.brandName:void 0)||t,qty:e,price:s.retailPrice||0,actualCost:s.actualCost||0,category:"medicine",subCategory:"",serial:null,visitSerial:i,organizationId:this.organization.idOnServer,createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),createdByUserSerial:this.user.serial},Object.keys(this.invoice).length?this.push("invoice.data",a):(this._makeNewInvoice(),this.push("invoice.data",a)),this._saveInvoice()},_addToInvoice:function(t,e){var i,a;a=function(){var e,a,n,s;for(n=this.priceList,s=[],e=0,a=n.length;e<a;e++)i=n[e],i.name===t&&s.push(i);return s}.call(this)[0],a&&(a.qty=1),a||(a={name:t,qty:1,price:0,actualCost:0,category:"custom",subCategory:"",serial:null,visitSerial:e,organizationId:this.organization.idOnServer,createdDatetimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now(),createdByUserSerial:this.user.serial}),Object.keys(this.invoice).length?this.push("invoice.data",a):(this._makeNewInvoice(),this.push("invoice.data",a)),this._saveInvoice()},calculatedOutDoorBalanceAfterDeduction:function(t,e){return parseInt(t)-parseInt(e)},finishButtonPressed:function(){var t;return this.domHost.showSuccessToast("Visit Saved Successfully"),(null!=(t=this.invoice)?t.totalBilled:void 0)&&this._deductServiceValueToPatient({patientId:this.patient.idOnServer,outdoorBalanceToDeduct:this.invoice.totalBilled,indoorBalanceToDeduct:0},function(t){return function(e){return e?void 0:t._getPatientServiceBalance(t.patient.idOnServer,function(e){return t.set("patientServiceBalance",e),t.makeNewVisitButtonPressed()})}}(this)),this.arrowBackButtonPressed()}})}).call(this);
//# sourceMappingURL=page-visit-editor.coffee-compiled.js.map</script>
</dom-module>