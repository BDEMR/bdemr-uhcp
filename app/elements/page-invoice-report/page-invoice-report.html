<!-- paper-* --><!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><div hidden="" by-polymer-bundler=""><link rel="import" href="../custom-vital-search/custom-vital-search.html"></div><dom-module id="page-invoice-report">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
        width: 95%;
      }

      .header {
        background-color: var(--paper-grey-100);
        padding: 15px;
      }

      .label {
        background-color: var(--paper-grey-100);
        padding: 5px;
      }

      paper-progress {
        width: 100%;
        --paper-progress-active-color: var(--paper-orange-500);
      }

      .fixed {
        min-width: 100px;
        text-align: right;
      }

      .data{
        margin: 0;
        padding-left: 10px;
      }

      .paper-custom {
        background-color: #fafafa;
        border: 1px solid #dadada;
        padding: 0px 8px 12px 8px;
        margin: 4px;
        margin-left: 0;
      }
    </style>

    <!-- local DOM -->

    <div class="master-container">

      <div class="limiting-container">

        <!-- Card - Search - start -->
        <paper-card>

          <paper-progress indeterminate="" hidden$="[[!getBoolean(loadingCounter)]]"></paper-progress>

          <div class="card-content">
            <div class="layout horizontal paper-custom end wrap">

              <!-- <paper-autocomplete id="invoiceSearchInput" label="Search By Investigation" source="[[investigationNameSourceDataList]]"
                  text="{{investigationQuery}}" on-autocomplete-reset-blur="resetInvestigationSearchPressed">
                </paper-autocomplete> -->
              <vaadin-combo-box id="invoiceOrganizationSelector" class="organization-dropdown m-right-8" label="Organization" items="[[childOrganizationList]]" on-value-changed="organizationSelected" loading="[[loading]]" disabled="[[!childOrganizationList.length]]">
              </vaadin-combo-box>

              <!-- <paper-dropdown-menu label="Filter by Category" class="m-right-8">
                <paper-listbox class="dropdown-content" on-iron-activate="categorySelected">
                  <template is="dom-repeat" items="[[categoryList]]">
                    <paper-item>[[item]]</paper-item>
                  </template>
                </paper-listbox>
              </paper-dropdown-menu> -->

              <paper-input label="EmployeeId/Phone" value="{{employeeIdOrPhone}}" class="m-right-8"></paper-input>
              <paper-input label="Search by Doctor Phone Number" type="number" value="{{doctorPhone}}" class="m-right-8"></paper-input>

              <custom-vital-search class="" on-date-select="filterByDateClicked" on-clear="filterByDateClearButtonClicked"></custom-vital-search>

              <div class="flex"></div>

              <paper-button class="btn btn-primary btn-large" style="margin: 0" on-tap="searchButtonClicked">Search</paper-button>
              <paper-icon-button icon="clear" on-tap="resetButtonClicked">Reset</paper-icon-button>

            </div>

          </div>
          <br>

          <div class="layout horizontal justified p-horizontal-16">
            <h4 class="">Total Invoice: [[matchingInvoiceReportList.length]]</h4>
            <h4 class="">
              <paper-checkbox checked="{{showOnlyDues}}">Show Only Dues</paper-checkbox>
            </h4>
          </div>
          <vaadin-grid items="[[matchingInvoiceReportList]]" id="inoviceListGrid">
            <vaadin-grid-column width="150px" flex-grow="0">
              <template class="header">
                <vaadin-grid-sorter path="serial">Visit Serial</vaadin-grid-sorter>
              </template>
              <template>
                <strong class="label">[[item.visitSerial]]</strong>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column resizable="">
              <template class="header">
                <vaadin-grid-sorter path="createdDatetimeStamp" direction="desc">Date</vaadin-grid-sorter>
              </template>
              <template>
                <div>[[$formatDateTime(item.createdDatetimeStamp)]]</div>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column resizable="">
              <template class="header">
                <span>Patient Name</span>
              </template>
              <template>
                <div>[[item.patientInfo.name]]</div>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column resizable="">
              <template class="header">
                <span>Employee Id</span>
              </template>
              <template>
                <div>[[item.patientInfo.employeeId]]</div>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column resizable="">
              <template class="header">
                <span>Items</span>
              </template>
              <template>
                <ul class="data">
                  <template is="dom-repeat" items="[[item.data]]">
                    <li>[[item.name]]</li>
                  </template>
                </ul>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
              <template class="header">
                <span>Total Billed</span>
              </template>
              <template>
                <div>[[$toTwoDecimalPlace(item.totalBilled)]]</div>
              </template>
              <template class="footer">
                <strong>[[$toTwoDecimalPlace(totalInvoiceBilled)]]</strong>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
              <template class="header">
                <span>Total Received</span>
              </template>
              <template>
                <div>[[$toTwoDecimalPlace(item.totalAmountReceieved)]]</div>
              </template>
              <template class="footer">
                <strong>[[$toTwoDecimalPlace(totalInvoiceIncome)]]</strong>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
              <template class="header">
                <span>Due</span>
              </template>
              <template>
                <div>[[$calculateDue(item.totalBilled, item.totalAmountReceieved)]]</div>
              </template>
              <template class="footer">
                <div>[[$calculateDue(totalInvoiceBilled, totalInvoiceIncome)]]</div>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
              <template class="header">Action
                <span></span>
              </template>
              <template>
                <div>
                  <paper-icon-button icon="launch" on-tap="viewInvoiceButtonPressed"></paper-icon-button>
                </div>
              </template>
            </vaadin-grid-column>
          </vaadin-grid>

          <div class="card-actions">
            <paper-button raised="" on-tap="exportButtonClicked">Export</paper-button>
          </div>

        </paper-card>

      </div>

    </div>

    



  </template>
  <script>(function(){Polymer({is:"page-invoice-report",behaviors:[app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling,app.behaviors.commonComputes,app.behaviors.dbUsing],properties:{user:{type:Object,value:{}},organization:{type:Object,value:{}},childOrganizationList:{type:Array,notify:!0,value:[]},dateCreatedFrom:String,dateCreatedTo:String,selectedGender:String,selectedOrganizationId:String,invoiceReportList:{type:Array,notify:!0,value:[]},matchingInvoiceReportList:{type:Array,notify:!0,value:[]},totalInvoiceIncome:{type:Number,computed:"_calculateTotalInvoiceIncome(matchingInvoiceReportList)"},totalInvoiceBilled:{type:Number,computed:"_computedTotalInvoiceBilled(matchingInvoiceReportList)"},totalProfit:{type:Number,value:0},investigationNameSourceDataList:{type:Array,value:function(){return[]}},categoryList:{type:Array,value:function(){return["All","Investigation","Medicine"]}},showOnlyDues:{type:Boolean,value:!1,observer:"_showOnlyDuesChcked"},loadingCounter:{type:Number,value:function(){return 0}}},_sortByDate:function(t,e){return t.createdDatetimeStamp<e.createdDatetimeStamp?1:t.createdDatetimeStamp>e.createdDatetimeStamp?-1:void 0},$isAdmin:function(t,e){var i,a,n;for(i=0,a=e.length;i<a;i++)if(n=e[i],t===n.id)return n.isAdmin;return!1},getBoolean:function(t){return!!t},_calculateTotalInvoiceIncome:function(t){var e,i,a,n;for(n=0,i=0,a=t.length;i<a;i++)e=t[i],n+=parseInt(null!=e.totalAmountReceieved?e.totalAmountReceieved:e.totalAmountReceieved=0);return n},_computedTotalInvoiceBilled:function(t){var e,i,a,n;for(n=0,i=0,a=t.length;i<a;i++)e=t[i],n+=parseInt(null!=e.totalBilled?e.totalBilled:e.totalBilled=0);return n},_calculateTotalProfit:function(){var t,e,i,a,n;for(n=0,a=this.matchingInvoiceReportList,e=0,i=a.length;e<i;e++)t=a[e],n+=this.calculateProfit(t);return this.set("totalProfit",n)},$calculateDue:function(t,e){return null==t&&(t=0),null==e&&(e=0),this.$toTwoDecimalPlace(t-e)},calculateProfit:function(t){var e,i,a,n,o,r;if(t){for(r=0,n=t.data,i=0,a=n.length;i<a;i++)e=n[i],o=(null!=e.actualCost?e.actualCost:e.actualCost=0)*e.qty,r+=o;return t.totalAmountReceieved-r}},navigatedIn:function(){return this._loadUser(),this._loadOrganization()},_loadUser:function(){var t;if(t=app.db.find("user"),1===t.length)return this.user=t[0]},_loadOrganization:function(){var t;if(t=app.db.find("organization"),1===t.length)return this.set("organization",t[0]),this._loadChildOrganizationList(this.organization.idOnServer)},organizationSelected:function(t){var e;return e=t.detail.value,this.set("selectedOrganizationId",e)},_loadChildOrganizationList:function(t){var e;return this.loading=!0,e={apiKey:this.user.apiKey,organizationId:t},this.callApi("/bdemr--get-child-organization-list",e,function(t){return function(e,i){var a,n,o;return t.loading=!1,n=i.data,n.length?(a=n.map(function(t){return{label:t.name,value:t._id}}),a.unshift({label:"All",value:""}),t.set("childOrganizationList",a)):(o=t.$.invoiceOrganizationSelector,o.items=[{label:t.organization.name,value:t.organization.idOnServer}],o.value=t.organization.idOnServer)}}(this))},_loadInvoice:function(t,e,i,a){var n,o;return null==e&&(e=100),null==i&&(i=1),this.set("invoiceReportList",[]),this.set("matchingInvoiceReportList",[]),o={apiKey:this.user.apiKey,organizationIdList:[],size:e,page:i,searchParameters:{employeeIdOrPhone:this.employeeIdOrPhone,doctorPhone:this.doctorPhone,dateCreatedFrom:null!=this.dateCreatedFrom?this.dateCreatedFrom:this.dateCreatedFrom="",dateCreatedTo:null!=this.dateCreatedTo?this.dateCreatedTo:this.dateCreatedTo=""}},this.selectedOrganizationId?o.organizationIdList=[this.selectedOrganizationId]:(n=this.childOrganizationList.map(function(t){return function(t){return t.value}}(this)),n.splice(0,1,this.organization.idOnServer),o.organizationIdList=n),this.loadingCounter++,this.callApi("uhcp--get-organization-invoice-report",o,function(t){return function(e,i){var n;return i.hasError?(t.domHost.showModalDialog(i.error.message),t.loadingCounter-=1):(t.loadingCounter-=1,n=i.data,t.set("invoiceReportList",n),t.set("matchingInvoiceReportList",n),a?a():void 0)}}(this))},_notifyInvalidOrganization:function(){return this.domHost.showModalDialog("No Organization is Present. Please Select an Organization first.")},searchButtonClicked:function(){return this._loadInvoice()},viewInvoiceButtonPressed:function(t){var e;return e=t.model.item,this.domHost.navigateToPage("#/print-invoice/invoice:"+e.serial+"/visit:"+e.visitSerial+"/patient:"+e.patientSerial)},filterByDateClicked:function(t){var e,i;return i=new Date(t.detail.startDate),i.setHours(0,0,0,0),e=new Date(t.detail.endDate),e.setHours(23,59,59,999),this.set("dateCreatedFrom",i.getTime()),this.set("dateCreatedTo",e.getTime())},filterByDateClearButtonClicked:function(){return this.dateCreatedFrom=0,this.dateCreatedTo=0},_showOnlyDuesChcked:function(t){var e;return t?(e=this.matchingInvoiceReportList.filter(function(t){return function(e){return t.$calculateDue(e.totalBilled,e.totalAmountReceieved)>0}}(this)),this.set("matchingInvoiceReportList",e)):this.set("matchingInvoiceReportList",this.invoiceReportList)},resetButtonClicked:function(){return this.domHost.reloadPage()},navigatedOut:function(){return this.employeeIdOrPhone="",this.doctorPhone="",this.dateCreatedFrom="",this.dateCreatedTo=""},_prepareJsonData:function(t){return t.map(function(t){return function(e){return{"Visit Serial":e.visitSerial,"Invoice Serial":e.serial,Date:t.$formatDateTime(e.createdDatetimeStamp),EmployeeId:e.patientInfo?e.patientInfo.employeeId:"",Name:e.patientInfo?e.patientInfo.name:"","Invoice Items":e.data.length?e.data.map(function(t){return t.name}):"","Total Billed":e.totalBilled,"Total Received":e.totalAmountReceieved,Due:t.$calculateDue(e.totalBilled,e.totalAmountReceieved)}}}(this))},downloadCsv:function(t){var e,i,a,n;return i="uhcp-invoice-export-"+Date.now()+".csv",e=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(e),a.setAttribute("href",n),a.setAttribute("download",i),a.style.visibility="hidden",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)},exportButtonClicked:function(){var t,e;return this.matchingInvoiceReportList.length?(e=this._prepareJsonData(this.matchingInvoiceReportList),t=Papa.unparse(e),this.downloadCsv(t)):this.domHost.showModalDialog("Search for a Report First")}})}).call(this);
//# sourceMappingURL=page-invoice-report.coffee-compiled.js.map</script>
</dom-module>