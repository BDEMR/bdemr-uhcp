<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><div hidden="" by-polymer-bundler=""><link rel="import" href="../custom-vital-search/custom-vital-search.html"></div><dom-module id="page-patient-manager">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
    
      .limiting-container {
        margin-top: 10px;
      }
      
      
      .more-optons {
        color: #777777;
      }
      
      
      .new-patient-fab {
        position: fixed;
        right: 24px;
        bottom: 128px;
        background-color: #43A047;
      }
      
      
      paper-button {
        margin: 3px;
      }


      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }
  
      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        color: var(--brand-primary-color);
      }

      .modifier {
        font-size: 14px;
        /*background: #000000;*/
        /*color: #ffffff;*/
        margin: 0 4px;
        /*padding: 2px 4px;*/
        /*border-radius: 3px;*/
        text-transform: uppercase;
        font-weight: 500;
      }
      
      .modifier.online {
        color: #757575;
      }
      
      .modifier.local-only {
        color: #039BE5;
      }
      
      .modifier.locally-updated {
        color: #009688;
      }
      
      .modifier.imported {
        color: #4CAF50;
      }
      #search-tab {
        background-color:#43A047;
      }
      #log-tab {
        background-color:var(--paper-teal-800);
      }
      .btn-add {
        min-width: 0;
        padding-top: 0.5em;
        padding-bottom: 0.5em;
        background-color: #eceff1;
        color: rgba(0, 0, 0, .87);
      }
      .paper-input-custom ::content input {
        font-size: 18px !important;
        color: rgba(0, 0, 0, .87) !important;
      }

      .paper-input-custom ::content label {
        font-size: 18px !important;
        color: #737373 !important;
      }
      .preview-title {
        padding-left: 12px;
        padding-right: 12px;
        background-color: #f7f7f7;
        min-height: 60px;
        /*border-bottom: 1px solid #eee;*/
      }

      .custom-menu-button {
        position: fixed;
        right: 16px;
        bottom: 112px;
      }

      .custom-menu-button ::content .dropdown-content {
        background-color: transparent;
        bottom: 80px !important;
        box-shadow: none !important;
      }

      paper-fab {
        background-color: #5c4575;
      }

      .custom-menu {

      }

      .p-8 {
        padding: 8px;
      }

      .custom-item {
        padding: 8px 16px;
        background-color: #5c4575;
        color: #fff;
        border-radius: 6px;
        margin: 8px 0;
        font-size: 16px;
        font-weight: 400;
        line-height: 32px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      .custom-item:hover {
        cursor: pointer;
      }

      .custom-img {
        border-radius: 50%;
      }
      
    </style>

    <!-- local DOM -->

    <div class="tabs-container">
      <paper-tabs id="tabs" selected="{{selectedSearchViewIndex}}" scrollable="" noink="true" on-iron-select="onPageIndexChange">
        <paper-tab>[[$TRANSLATE('Search',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Imported/Local Patients',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Logs',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Pending Patients',LANG)]]</paper-tab>
      </paper-tabs>
    </div>

    <div class="master-container">

      <div class="limiting-container">

        <iron-pages selected="{{selectedSearchViewIndex}}">

          <!-- Search Patient - start -->
          <section>
            <!-- Card - Search - start -->
            <paper-card>
              <div class="p-8 preview-title">
             
                <paper-input class="flex paper-input-custom" value="{{searchFieldMainInput}}" label="Search Patient" on-keyup="searchOnlineEnterKeyPressed"></paper-input>

                <div class="horizontal layout end-justifed center flex">
                  <paper-toggle-button class="flex" checked="{{isAdvancedSearchEnabled}}">Advanced Search</paper-toggle-button>
                  <paper-button class="btn-add colored" raised="" on-tap="searchOnlineButtonPressed"><iron-icon icon="search" class="m-right-8"></iron-icon>SEARCH</paper-button>
                </div>
              </div>

              <!-- advanced search - start -->
              <template is="dom-if" if="{{isAdvancedSearchEnabled}}">
                <paper-listbox>
                  <paper-item class="custom">
                    <div class="layout horizontal center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.initialVisitDate.enabled}}">Initial Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.lastVisitDate.enabled}}">Last Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.admissionDate.enabled}}">Admission Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.createdDate.enabled}}">Created Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox>Handled by me between</paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.lowerBound}}" no-label-float=""></paper-input>
                      <div>and</div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients created by me</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients handled by me at least once</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center end-justified">
                      <span class="more-optons" on-tap="moreOptionsPressed">more options?</span>
                    </div>
                  </paper-item>
                </paper-listbox>
              </template>
              <!-- advanced search - end -->

            </paper-card>
            <!-- Card - Search - end -->

            <template is="dom-if" if="[[$compareFn(arbitaryCounter, '>', 0)]]">
              <paper-card class="m-top-8">
                <div class="card-content">
                  <div class="vertical layout center">
                    <paper-spinner active=""></paper-spinner>
                    <div class="type body secondary">please wait for a while...</div>
                  </div>
                </div>
              </paper-card>
            </template>

            <!-- Card - Search Results - start -->
            <template is="dom-if" if="[[$compareFn(arbitaryCounter, '==', 0)]]">
              <paper-card class="m-top-8">
        
                <div class="card-custom-header">
                  <div class="layout horizontal center">
                    <div class="flex">
                      <!-- <div class="title">Search Results</div> -->
                      <div class="type body secondary">[[matchingPatientList.length]] Patient(s) found</div>
                    </div>

                    <custom-vital-search on-date-select="searchResultFilterByDateClicked" on-clear="searchResultFilterByDateClearButtonClicked"></custom-vital-search>

                    <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                  </div>
                </div>
                
                <div class="p-0">
                  <paper-listbox>
                    
                    <template id="patient-list-repeater" is="dom-repeat" items="[[matchingPatientList]]" as="patient">
                      <paper-item class="custom layout horizontal center wrap">
                        <div class="type caption secondary">[[patient.serial]]</div>
                        
                        <div class="flex m-left-8">
                          <div class="type body capitalize">[[$getFullName(patient.name)]]</div>
                          <div class="type caption">[[patient.email]]</div>
                          <div class="type caption">[[patient.phone]]</div>
                          <!-- <div class="type caption">[[$mkDate(patient.createdDatetimeStamp)]]</div> -->
                          <template is="dom-if" if="[[patient.doctorsPrivateNote]]">
                            <div class="type caption">([[$truncate(patient.doctorsPrivateNote, 20)]])</div>
                          </template>
                        </div>
                        <div class="layout horizontal m-horizontal-4 wrap">
                          <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                            <div class="modifier online">online Only</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isImported]]">
                            <div class="modifier imported">imported</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isLocalOnly]]">
                            <div class="modifier local-only">local only</div>
                          </template>
                          <!-- <template is="dom-if" if="[[patient.flags.isLocallyUpdated]]">
                            <div class="modifier locally-updated">locally updated</div>
                          </template> -->
                        </div>

                        <!-- <paper-icon-button icon="visibility" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"></paper-icon-button> -->

                        <!-- <paper-button raised class="btn-add colored" on-tap="viewPatient" hidden="[[!patient.flags.isImported]]"><iron-icon icon="icons:visibility" class="m-right-8"></iron-icon>View</paper-button> -->
              
                        <paper-menu-button horizontal-align="right" no-animations="">
                          <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                          <paper-menu class="dropdown-content">
                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <!-- <paper-item on-tap="viewPatientPressed">View</paper-item> -->
                              <paper-item on-tap="viewPatient">View Patient</paper-item>
                              <paper-item on-tap="editPatientPressed">Edit Patient Info</paper-item>
                              <!-- <paper-item on-tap="editPatientPreconceptionRecord">Edit PCC Record <img class="m-left-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt=""></paper-item> -->
                              <!-- <paper-item on-tap="_shortcutToNewPrescription">New Prescription</paper-item> -->
                            </template>
                            <!-- export/import start -->
                            <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                              <paper-item on-tap="importPatientPressed">Import from Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[$or(patient.flags.isLocalOnly, patient.flags.isImported)]]">
                              <paper-item on-tap="publishPatientPressed">Publish to Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[patient.flags.isImported]]">
                              <paper-item on-tap="importLatestPatientPressed">Import Latest from Cloud</paper-item>
                            </template>
                        <template is="dom-repeat" items="[[organizationsIBelongToList]]" as="organization">
                          <paper-item on-tap="putInWaitlistTapped">Put in [[organization.name]]'s Waitlist</paper-item>
                        </template>


                            <!-- export/import end -->

                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <paper-item on-tap="deletePatientPressed">Delete local copy</paper-item>
                            </template>

                          </paper-menu>
                        </paper-menu-button>
                        

                      </paper-item>
                    </template>

                  </paper-listbox>
                  
                </div>
              </paper-card>
            </template>
            <!-- Card - Search Results - end -->
          </section>
          <!-- Search Patient - end -->

          <!-- Imported/Offline Patients - start -->
          <section>
            <!-- Card - Search - start -->
            <paper-card>
              <div class="p-8 preview-title">
             
                <paper-input class="flex paper-input-custom" value="{{searchFieldMainInput}}" label="Search Local Patient"></paper-input>

                <div class="horizontal layout end-justifed center flex">
                  <paper-toggle-button class="flex" checked="{{isAdvancedSearchEnabled}}">Advanced Search</paper-toggle-button>
                  <paper-button class="btn-add colored" raised="" on-tap="searchOfflineButtonPressed"><iron-icon icon="search" class="m-right-8"></iron-icon>SEARCH</paper-button>
                </div>
              </div>

              <!-- advanced search - start -->
              <template is="dom-if" if="{{isAdvancedSearchEnabled}}">
                <paper-listbox>
                  <paper-item class="custom">
                    <div class="layout horizontal center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.initialVisitDate.enabled}}">Initial Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.lastVisitDate.enabled}}">Last Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.admissionDate.enabled}}">Admission Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.createdDate.enabled}}">Created Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox>Handled by me between</paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.lowerBound}}" no-label-float=""></paper-input>
                      <div>and</div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients created by me</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients handled by me at least once</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center end-justified">
                      <span class="more-optons" on-tap="moreOptionsPressed">more options?</span>
                    </div>
                  </paper-item>
                </paper-listbox>
              </template>
              <!-- advanced search - end -->

            </paper-card>
            <!-- Card - Search - end -->

            <!-- Card - Search Results - start -->
            <template is="dom-if" if="[[$compareFn(arbitaryCounter, '>', 0)]]">
              <paper-card class="m-top-8">
                <div class="card-content">
                  <div class="vertical layout center">
                    <paper-spinner active=""></paper-spinner>
                    <div class="type body secondary">please wait for a while...</div>
                  </div>
                </div>
              </paper-card>
            </template>
            <template is="dom-if" if="[[$compareFn(arbitaryCounter, '==', 0)]]">
              <paper-card class="m-top-8">
        
                <div class="card-custom-header">
                  <div class="layout horizontal center">
                    <div class="flex">
                      <!-- <div class="title">Search Results</div> -->
                      <div class="type body secondary">[[matchingPatientList.length]] Imported/Offline Patient(s) found</div>
                    </div>

                    <custom-vital-search on-date-select="searchResultFilterByDateClicked" on-clear="searchResultFilterByDateClearButtonClicked"></custom-vital-search>

                    <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                  </div>
                </div>

                <div class="p-0">
                  <paper-listbox>
                    
                    <template id="patient-list-repeater" is="dom-repeat" items="[[matchingPatientList]]" as="patient">
                      <paper-item class="custom layout horizontal center">
                        <div class="type caption secondary">[[patient.serial]]</div>
                        
                        <div class="flex m-left-8">
                          <div class="type body capitalize">[[$getFullName(patient.name)]]</div>
                          <div class="type caption">[[patient.email]]</div>
                          <div class="type caption">[[patient.phone]]</div>
                          <!-- <div class="type caption">[[$mkDate(patient.createdDatetimeStamp)]]</div> -->
                          <template is="dom-if" if="[[patient.doctorsPrivateNote]]">
                            <div class="type caption">([[$truncate(patient.doctorsPrivateNote, 20)]])</div>
                          </template>
                        </div>
                        <div class="layout horizontal m-horizontal-4 wrap">
                          <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                            <div class="modifier online">online Only</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isImported]]">
                            <div class="modifier imported">imported</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isLocalOnly]]">
                            <div class="modifier local-only">local only</div>
                          </template>
                          <!-- <template is="dom-if" if="[[patient.flags.isLocallyUpdated]]">
                            <div class="modifier locally-updated">locally updated</div>
                          </template> -->
                        </div>

                        <!-- <paper-icon-button icon="visibility" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"></paper-icon-button> -->

                        <!-- <paper-button raised class="btn-add colored" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"><iron-icon icon="icons:visibility" class="m-right-8"></iron-icon>View</paper-button> -->
              
                        <paper-menu-button horizontal-align="right" no-animations="">
                          <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                          <paper-menu class="dropdown-content">
                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <!-- <paper-item on-tap="viewPatientPressed">View</paper-item> -->
                              <paper-item on-tap="viewPatient">View Patient</paper-item>
                              <paper-item on-tap="editPatientPressed">Edit</paper-item>
                              <!-- <paper-item on-tap="editPatientPreconceptionRecord">Edit PCC Record <img class="m-left-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt=""></paper-item> -->
                              <!-- <paper-item on-tap="_shortcutToNewPrescription">New Prescription</paper-item> -->
                            </template>
                            <!-- export/import start -->
                            <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                              <paper-item on-tap="importPatientPressed">Import from Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[$or(patient.flags.isLocalOnly, patient.flags.isImported)]]">
                              <paper-item on-tap="publishPatientPressed">Publish to Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[patient.flags.isImported]]">
                              <paper-item on-tap="importLatestPatientPressed">Import Latest from Cloud</paper-item>
                            </template>
                        <template is="dom-repeat" items="[[organizationsIBelongToList]]" as="organization">
                          <paper-item on-tap="putInWaitlistTapped">Put in [[organization.name]]'s Waitlist</paper-item>
                        </template>


                            <!-- export/import end -->

                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <paper-item on-tap="deletePatientPressed">Delete local copy</paper-item>
                            </template>

                          </paper-menu>
                        </paper-menu-button>
                        

                      </paper-item>
                    </template>

                  </paper-listbox>
                  
                </div>
              </paper-card>
            </template>
            <!-- Card - Search Results - end -->
          </section>
          <!-- Imported/Offline Patients - end -->

          <!-- Patient Log - end -->
          <section>
            <!-- Card - Visited Patient Log - start -->
            <paper-card>
      
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <div class="title flex">Visited Patient Log</div>


                  <custom-vital-search on-date-select="searchResultFilterByDateClickedForPatientLog" on-clear="searchResultFilterByDateClearButtonClickedForPatientLog"></custom-vital-search>

                  <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                </div>
              </div>

              <template is="dom-if" if="[[_isEmptyArray(matchingVisitedPatientLogList)]]">
                <div class="card-content layout horizontal center center-justified">
                  <div class="type body secondary">-- no data available --</div>
                </div>
              </template>

              <paper-listbox>
                
                <template id="visited-patient-log-repeater" is="dom-repeat" items="[[matchingVisitedPatientLogList]]" as="patient">
                  <paper-item class="custom layout horizontal center">
                    <div class="type caption secondary">[[patient.patientSerial]]</div>
                    
                    <div class="flex m-left-8">
                      <div class="type body capitalize">[[$getFullName(patient.patientName)]]</div>
                      <div class="type caption">
                        <strong>Visited Date: </strong>
                        <span>[[$mkDateTime(patient.visitedDateTimeStamp)]]</span>
                      </div>
                    </div>
          
                    <paper-button raised="" class="btn-add" on-tap="viewPatientPressedFromLog"><iron-icon icon="visibility" class="m-right-8"></iron-icon>view</paper-button>

                </paper-item></template>
              </paper-listbox>
           
            </paper-card>
            <!-- Card - Visited Patient Log - end -->
          </section>
          <!-- Patient Log - end -->

          <!-- sync - start -->
          <section>
            <paper-card>
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <div class="title flex">Conflicted Patients list</div>
                  <!-- <paper-button raised class="btn-add colored" on-tap="uploadAllOfflineRegisteredPatient"><iron-icon icon="icons:cloud-upload" class="m-right-8"></iron-icon>Upload All</paper-button> -->
                </div>
                <template is="dom-if" if="[[_isEmptyArray(conflictedPatientList)]]">
                  <div class="type body-caption secondary">Your offline created patient already exist on our server. your can either change phone/email or provide patients Doctor Access Pin in order to upload all the records related to this patients.</div>
                </template>
                
              </div>

              <paper-listbox>
                
                <template id="conflicted-patient-repeater" is="dom-repeat" items="[[conflictedPatientList]]" as="patient">
                  <paper-item class="custom layout horizontal center wrap">
                    
                    <div class="flex m-left-8">
                      <div class="type caption secondary">[[patient.data.serial]]</div>
                      <div class="type body capitalize">[[$getFullName(patient.data.name)]]</div>
                      <div class="type caption-2">[[patient.data.phone]]</div>
                    </div>
            
                    <paper-input label="Pin" value="{{patient.doctorAccessPin}}"></paper-input>
              
          
                    
          
                    <paper-button raised="" class="btn-add" on-tap="checkAndUpdateConflictedPatientData"><iron-icon icon="save" class="m-right-8"></iron-icon>save</paper-button>

                </paper-item></template>
              </paper-listbox>
          </paper-card></section>
          <!-- sync registered - end -->


        </iron-pages>

      </div>

    </div>

    

    <paper-fab class="custom-menu-button" icon="add" on-tap="newPatientFabPressed"></paper-fab>
     


  </template>
  <script>(function(){Polymer({is:"page-patient-manager",behaviors:[app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling,app.behaviors.commonComputes,app.behaviors.dbUsing],properties:{selectedSearchViewIndex:{type:Number,notify:!0,value:0},selectedTabPageIndex:{type:Number,notify:!0,value:0},searchContextDropdownSelectedIndex:{type:Number,notify:!0,value:1},isAdvancedSearchEnabled:{type:Boolean,notify:!0,value:!1},advancedSearchParameters:{type:Object,notify:!0,value:{createdDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},initialVisitDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},lastVisitDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},admissionDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},handledDate:{lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())}}},arbitaryCounter:{type:Number,notify:!0,value:0},matchingPatientList:{type:Array,notify:!0,value:[]},searchFieldMainInput:{type:String,notify:!0,value:""},user:{type:Object,notify:!0,value:null},currentDateFilterStartDate:{type:Number},currentDateFilterEndDate:{type:Number},resultedPatientList:{type:Array,notify:!0,value:[]},matchingVisitedPatientLogList:{type:Array,notify:!0,value:[]},filteredPatientVisitedPatientLogList:{type:Array,notify:!0,value:[]},organizationsIBelongToList:{type:Array,value:function(){return[]}},conflictedPatientList:{type:Array,value:function(){return[]}}},_loadUser:function(){var t;if(t=app.db.find("user"),1===t.length)return this.user=t[0]},loadConflictedPatientList:function(){var t;t=app.db.find("conflicted-patient-list"),this.conflictedPatientList=t},checkAndUpdateConflictedPatientData:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-BUTTON"),e.opened=!1,a=this.$$("#conflicted-patient-repeater"),i=a.indexForElement(e),n=this.conflictedPatientList[i],this._importPatient(n.data.serial,n.doctorAccessPin,function(t){return function(e){return t.updatePatientSerialOnExisitingRecords(n.data.serial,n.oldSerial,function(){return t._removeLocalPatient(n.oldSerial,function(){return t.loadConflictedPatientList(),t.domHost.showToast("Patient Data Updated!")})})}}(this))},_removeLocalPatient:function(t,e){var i;return i=app.db.find("conflicted-patient-list",function(t){var e;return e=t.oldSerial,e===e})[0]._id,app.db.remove("conflicted-patient-list",i),i=app.db.find("patient-list",function(e){var i;return i=e.serial,i===t})[0]._id,app.db.remove("patient-list",i),e()},checkAndupdateSerialOnCollection:function(t,e,i){var n,a,r,s,o;if(s=app.db.find(i,function(t){var i;return i=t.patientSerial,i===e}),s.length>0){for(o=[],n=0,r=s.length;n<r;n++)a=s[n],a.patientSerial=t,o.push(app.db.update(i,a._id,a));return o}},updatePatientSerialOnExisitingRecords:function(t,e,i){var n,a,r,s;for(n=["unregsitered-patient-details","anaesmon-record","progress-note-record","visited-patient-log","history-and-physical-record","diagnosis-record","doctor-visit","doctor-visit","visit-note","visit-patient-stay","visit-next-visit","custom-investigation-list","visit-advised-test","patient-test-results","patient-medications","patient-vitals-blood-pressure","patient-vitals-pulse-rate","patient-vitals-respiratory-rate","patient-vitals-spo2","patient-vitals-temperature","patient-vitals-bmi","patient-test-blood-sugar","patient-test-other","comment-patient","comment-doctor","patient-gallery--local-attachment","patient-gallery--online-attachment","patient-test-results","in-app-notification","local-patient-pin-code-list","activity","visit-invoice","visit-diagnosis","visit-identified-symptoms","visit-examination","offline-patient-pin","in-patient-medicine-dispense-log","pcc-records","ndr-records","patient-insulin-list"],r=0,s=n.length;r<s;r++)a=n[r],this.checkAndupdateSerialOnCollection(t,e,a);return i()},_organizationNavigatedIn:function(){var t;return t={apiKey:this.user.apiKey},this.callApi("/bdemr-organization-list-those-user-belongs-to",t,function(t){return function(e,i){return i.hasError?t.domHost.showModalDialog(i.error.message):t.organizationsIBelongToList=i.data.organizationObjectList}}(this))},onPageIndexChange:function(){if(1===this.selectedSearchViewIndex)return this.listAllImportedAndOfflinePatientsPressed()},navigatedIn:function(){var t,e,i,n,a;for(this.organization=this.getCurrentOrganization(),this.organization||this.domHost.navigateToPage("#/select-organization"),this._loadUser(),a=app.db.find("patient-list",function(t){var e;return e=t.isForOrganizationOnly,e===!0}),t=0,e=a.length;t<e;t++)n=a[t],app.db.remove("patient-list",n._id);return this._organizationNavigatedIn(),this.loadConflictedPatientList(),this.domHost.__patientView__oneTimeSearchFilter&&(this.oneTimeSearchFilter=this.domHost.__patientView__oneTimeSearchFilter),i=this.domHost.getPageParams(),i.selected?this.set("selectedSearchViewIndex",parseInt(i.selected)):this.set("selectedSearchViewIndex",0),i.filter&&"today-only"===i.filter?(this.domHost.modifyCurrentPagePath("#/patient-manager"),this.searchFieldMainInput="",this.isAdvancedSearchEnabled=!1,this.set("advancedSearchParameters.createdDate.enabled",!0),this.set("advancedSearchParameters.createdDate.lowerBound",lib.datetime.mkDate(lib.datetime.now())),this.set("advancedSearchParameters.createdDate.upperBound",lib.datetime.mkDate(lib.datetime.now())),this.listAllImportedAndOfflinePatientsPressed(null)):i.filter&&"clear"===i.filter?(this.domHost.modifyCurrentPagePath("#/patient-manager"),this.isAdvancedSearchEnabled=!1,this.searchFieldMainInput="",this.listAllImportedAndOfflinePatientsPressed(null)):i.query?(this.searchFieldMainInput=i.query,this.searchOnlineButtonPressed()):i.unregsiterd?(this.searchFieldMainInput=i.unregsiterd,this.searchOfflineButtonPressed()):this.listAllImportedAndOfflinePatientsPressed(null),this._listVisitedPatientLog()},searchButtonPressed:function(t){return 1===this.searchContextDropdownSelectedIndex?this._searchOnline():this._searchOffline()},listAllImportedAndOfflinePatientsPressed:function(t){return this.searchFieldMainInput="",this.searchContextDropdownSelectedIndex=0,this.searchButtonPressed(null)},searchOfflineButtonPressed:function(t){return 0===this.searchFieldMainInput.length?this.domHost.showModalDialog("Please enter something to search with."):(this.searchContextDropdownSelectedIndex=0,this.searchButtonPressed(null))},searchOnlineButtonPressed:function(t){return this.searchContextDropdownSelectedIndex=1,this.searchButtonPressed(null)},searchOnlineEnterKeyPressed:function(t){if(13===t.keyCode)return this.searchOnlineButtonPressed()},_searchOnline:function(){return this.matchingPatientList=[],this.arbitaryCounter++,this.callApi("/bdemr-patient-search",{apiKey:this.user.apiKey,searchQuery:this.searchFieldMainInput},function(t){return function(e,i){var n,a,r,s,o;if(t.arbitaryCounter--,i.hasError)return t.domHost.showModalDialog(i.error.message);for(s=i.data,n=0,a=s.length;n<a;n++)o=s[n],o.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},r=app.db.find("patient-list",function(t){var e;return e=t.serial,e===o.serial}),0===r.length?o.flags.isOnlineOnly=!0:(o.flags.isImported=!0,o._tempLocalDbId=r[0]._id);return void(t.matchingPatientList=s)}}(this))},_searchOffline:function(){var t,e,i,n,a;for(this.arbitaryCounter++,a=this.searchFieldMainInput,0===a.length,n=app.db.find("patient-list",function(t){return function(e){var i,n,r,s,o,l,d,c,u,h,p,m,P,f,g,v,D,b,w,S,y,L,I;return I=e.serial,D=e.name,d=e.email,b=e.phone,v=e.nIdOrSsn,u=e.hospitalNumber,h=e.initialVisitDate,P=e.lastVisitDate,i=e.admissionDate,t.oneTimeSearchFilter?(n=""+I==""+t.oneTimeSearchFilter,r=!1,s=!1,o=!1,l=!1):(n=D.first.indexOf(a)>-1,r=d.indexOf(a)>-1,s=b.indexOf(a)>-1,o=I.indexOf(a)>-1,l=function(){try{return v.indexOf(a)>-1}catch(t){return c=t,!1}}()),m=!0,p=t.isAdvancedSearchEnabled,p&&(t.advancedSearchParameters.initialVisitDate.enabled?(f=new Date(t.advancedSearchParameters.initialVisitDate.lowerBound),g=new Date(h),L=new Date(t.advancedSearchParameters.initialVisitDate.upperBound),m=f.getTime()<=(w=g.getTime())&&w<=L.getTime()):t.advancedSearchParameters.lastVisitDate.enabled?(f=new Date(t.advancedSearchParameters.lastVisitDate.lowerBound),g=new Date(P),L=new Date(t.advancedSearchParameters.lastVisitDate.upperBound),m=f.getTime()<=(S=g.getTime())&&S<=L.getTime()):t.advancedSearchParameters.admissionDate.enabled&&(f=new Date(t.advancedSearchParameters.admissionDate.lowerBound),g=new Date(i),L=new Date(t.advancedSearchParameters.admissionDate.upperBound),m=f.getTime()<=(y=g.getTime())&&y<=L.getTime())),(n||r||s||o||l)&&m}}(this)),this.oneTimeSearchFilter=null,t=0,e=n.length;t<e;t++)i=n[t],"flags"in i||(i.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},i.flags.isLocalOnly=!0);return this.matchingPatientList=n,this.arbitaryCounter--},clearSearchResultsClicked:function(t){return this.matchingPatientList=[]},moreOptionsPressed:function(t){return this.domHost.showModalDialog('You can search records (instead of patients) by many other options including diseases from the "Record Manager" option from the left menu.')},newPatientFabPressed:function(t){return this.domHost.navigateToPage("#/patient-signup")},newPCCPatient:function(t){return this.domHost.navigateToPage("#/patient-signup")},_getPinForLocalPatient:function(t){var e,i;return e=app.db.find("local-patient-pin-code-list",function(e){return function(e){var i;return i=e.patientSerial,i===t}}(this)),1===e.length?i=e[0].pin:null},_savePinForLocalPatient:function(t,e){var i;return i={},i.organizationId=this.organization.idOnServer,i.patientSerial=e,i.pin=t,app.db.upsert("local-patient-pin-code-list",i,function(t){return function(t){var e;return e=t.patientSerial,i.patientSerial===e}}(this))},_publishPatient:function(t,e,i){return this.callApi("/bdemr-patient-publish",{patient:t,pin:e},function(n){return function(a,r){return r.hasError?"U_PIN_ERR"===r.error.message?n.domHost.showModalInput("Please enter correct patient PIN","0000",function(e){if(e)return n._publishPatient(t,e,i)}):n.domHost.showModalDialog(r.error.message):"success"===r.data.status?(e=n._getPinForLocalPatient(t.serial),n._importPatient(t.serial,e,function(e){return app.db.remove("patient-list",t._id),n.searchContextDropdownSelectedIndex=0,n.oneTimeSearchFilter=t.serial,n.searchButtonPressed(null)})):n.domHost.showModalDialog("Unkown response "+r.data.status)}}(this))},publishPatientPressed:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Publishing will overwrite remote changes (if any). Continue?",function(t){return function(e){if(e)return t._publishPatient(n,null,function(t){})}}(this))},_importPatient:function(t,e,i){return this.callApi("/bdemr-patient-import-new",{serial:t,pin:e,doctorName:this.user.name,organizationId:this.organization.idOnServer},function(t){return function(e,n){var a,r,s;return n.hasError?t.domHost.showModalDialog(n.error.message):(s=n.data,1!==s.length?t.domHost.showModalDialog("Unknown error occurred."):(r=s[0],r.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},r.flags.isImported=!0,t.removePatientIfAlreadyExist(r.serial),a=app.db.insert("patient-list",r),i(a)))}}(this))},removePatientIfAlreadyExist:function(t){var e,i;e=app.db.find("patient-list",function(e){var i;return i=e.serial,i===t}),1===e.length&&(i=e[0],app.db.remove("patient-list",i._id))},importPatientPressed:function(t){var e,i,n,a,r;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,r=this.$$("#patient-list-repeater"),i=r.indexForElement(e),a=this.matchingPatientList[i],n=this._getPinForLocalPatient(a.serial),a.idOnServer?n?this._importPatient(a.serial,n,function(t){return function(e){return t.searchFieldMainInput="",t.searchContextDropdownSelectedIndex=0,t.oneTimeSearchFilter=a.serial,t.listAllImportedAndOfflinePatientsPressed(null),t.goPatientViewPage(a)}}(this)):this.domHost.showModalInput("Please enter patient PIN","0000",function(t){return function(e){if(e)return t._importPatient(a.serial,e,function(i){var n;return t.searchFieldMainInput="",t.searchContextDropdownSelectedIndex=0,t.oneTimeSearchFilter=a.serial,t.listAllImportedAndOfflinePatientsPressed(null),n={serial:a.serial,pin:e},app.db.insert("offline-patient-pin",n),t.goPatientViewPage(a)})}}(this)):this._importPatient(a.serial,null,function(t){return function(e){return t.searchFieldMainInput="",t.searchContextDropdownSelectedIndex=0,t.oneTimeSearchFilter=a.serial,t.listAllImportedAndOfflinePatientsPressed(null)}}(this))},goPatientViewPage:function(t){return this.domHost.setCurrentPatientsDetails(t),this.createdPatientVisitedLog(t),this.domHost.navigateToPage("#/patient-viewer/patient:"+t.serial+"/selected:5"),this.domHost.selectedPatientPageIndex=5},importLatestPatientPressed:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Fetching latest will discard local changes. Continue?",function(e){return function(i){if(i)return app.db.remove("patient-list",n._id),e.importPatientPressed(t)}}(this))},putInWaitlistTapped:function(t){var e,i,n,a,r;return n=t.model.organization,e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,r=this.$$("#patient-list-repeater"),i=r.indexForElement(e),a=this.matchingPatientList[i],this.domHost.navigateToPage("#/organization-manage-waitlist/organization:"+n.idOnServer+"/patient:"+a.serial)},viewPatientPressed:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.createdPatientVisitedLog(n),this.domHost.setCurrentPatientsDetails(n),this.domHost.navigateToPage("#/patient-viewer/patient:"+n.serial+"/selected:5"),this.domHost.selectedPatientPageIndex=5},editPatientPressed:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.domHost.navigateToPage("#/patient-editor/patient:"+n.serial)},deletePatientPressed:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Are you sure?",function(t){return function(e){var i;if(e===!0)return i=n._id,i||0===i||(i=n._tempLocalDbId),app.db.remove("patient-list",i),t.searchButtonPressed(null)}}(this))},$or:function(t,e){return t||e},$log:function(t){},searchResultFilterByDateClicked:function(t){var e,i,n,a;return 0===this.resultedPatientList.length&&(this.resultedPatientList=this.matchingPatientList),this.currentDateFilterStartDate=t.detail.startDate,this.currentDateFilterEndDate=t.detail.endDate,a=new Date(t.detail.startDate),e=new Date(t.detail.endDate),e.setHours(24+e.getHours()),i=function(){var t,i,r,s,o;for(r=this.resultedPatientList,o=[],t=0,i=r.length;t<i;t++)n=r[t],a.getTime()<=(s=new Date(n.lastModifiedDatetimeStamp).getTime())&&s<=e.getTime()&&o.push(n);return o}.call(this),this.matchingPatientList=i},searchResultFilterByDateClearButtonClicked:function(t){return this.currentDateFilterStartDate=null,this.currentDateFilterEndDate=null,this.matchingPatientList=this.resultedPatientList,this.resultedPatientList=[]},viewPatient:function(t){var e,i,n,a;return e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(e),n=this.matchingPatientList[i],this.domHost.setCurrentPatientsDetails(n),this.createdPatientVisitedLog(n),this.domHost.selectedPatientPageIndex=5,this.domHost.navigateToPage("#/patient-viewer/patient:"+n.serial+"/selected:5")},createdPatientVisitedLog:function(t){var e;return e={createdByUserSerial:this.user.serial,serial:this.generateSerialForVisitedPatientLog(),patientSerial:t.serial,patientName:t.name,visitedDateTimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now()},app.db.insert("visited-patient-log",e)},_listVisitedPatientLog:function(){var t,e;return t=app.db.find("visited-patient-log"),e=[].concat(t),e.sort(function(t,e){return t.visitedDateTimeStamp>e.visitedDateTimeStamp?-1:t.visitedDateTimeStamp<e.visitedDateTimeStamp?1:0}),this.matchingVisitedPatientLogList=e},viewPatientPressedFromLog:function(t){var e,i,n,a,r,s,o;if(e=this.locateParentNode(t.target,"PAPER-BUTTON"),e.opened=!1,s=this.$$("#visited-patient-log-repeater"),i=s.indexForElement(e),r=this.matchingVisitedPatientLogList[i],a=app.db.find("patient-list",function(t){var e;return e=t.serial,e===r.patientSerial}),1===a.length&&(n=a[0],o={createdByUserSerial:this.user.serial,serial:this.generateSerialForVisitedPatientLog(),patientSerial:r.patientSerial,patientName:r.patientName,visitedDateTimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now()},app.db.insert("visited-patient-log",o),this.domHost.setCurrentPatientsDetails(n),this.domHost.navigateToPage("#/visit-editor/visit:new/patient:"+r.patientSerial)),0===a.length)return this.domHost.showModalInput("Please enter patient PIN","0000",function(t){return function(e){if(e)return t._importPatient(r.patientSerial,e,function(e){return t.searchFieldMainInput="",t.searchContextDropdownSelectedIndex=0,t.oneTimeSearchFilter=r.patientSerial,t.listAllImportedAndOfflinePatientsPressed(null)})}}(this)),this.selectedSearchViewIndex=0},importPatientPressedFromLog:function(t){var e,i,n,a,r;if(e=this.locateParentNode(t.target,"PAPER-MENU-BUTTON"),e.opened=!1,r=this.$$("#visited-patient-log-repeater"),i=r.indexForElement(e),a=this.matchingVisitedPatientLogList[i],n=app.db.find("patient-list",function(t){var e;return e=t.serial,e===a.patientSerial}),1===n.length&&this.domHost.showModalDialog("Already Imported!"),0===n.length)return this.domHost.showModalInput("Please enter patient PIN","0000",function(t){return function(e){if(e)return t._importPatient(a.patientSerial,e,function(e){return t.searchFieldMainInput="",t.searchContextDropdownSelectedIndex=0,t.oneTimeSearchFilter=a.patientSerial,t.listAllImportedAndOfflinePatientsPressed(null)})}}(this)),this.selectedSearchViewIndex=0},searchResultFilterByDateClickedForPatientLog:function(t){var e,i,n,a;return 0===this.filteredPatientVisitedPatientLogList.length&&(this.filteredPatientVisitedPatientLogList=this.matchingVisitedPatientLogList),this.currentDateFilterStartDate=t.detail.startDate,this.currentDateFilterEndDate=t.detail.endDate,a=new Date(t.detail.startDate),e=new Date(t.detail.endDate),e.setHours(24+e.getHours()),i=function(){var t,i,r,s,o;for(r=this.filteredPatientVisitedPatientLogList,o=[],t=0,i=r.length;t<i;t++)n=r[t],a.getTime()<=(s=new Date(n.visitedDateTimeStamp).getTime())&&s<=e.getTime()&&o.push(n);return o}.call(this),this.matchingVisitedPatientLogList=i},searchResultFilterByDateClearButtonClickedForPatientLog:function(t){return this.currentDateFilterStartDate=null,this.currentDateFilterEndDate=null,this.matchingVisitedPatientLogList=this.filteredPatientVisitedPatientLogList,this.filteredVisitedPatientLogList=[]},_isEmptyArray:function(t){return 0===t.length}})}).call(this);
//# sourceMappingURL=page-patient-manager.coffee-compiled.js.map</script>
</dom-module>
