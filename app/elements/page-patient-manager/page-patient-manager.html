<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><div hidden="" by-polymer-bundler=""><link rel="import" href="../custom-vital-search/custom-vital-search.html"></div><dom-module id="page-patient-manager">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
    
      .limiting-container {
        margin-top: 10px;
      }
      
      
      .more-optons {
        color: #777777;
      }
      
      
      .new-patient-fab {
        position: fixed;
        right: 24px;
        bottom: 128px;
        background-color: #43A047;
      }
      
      
      paper-button {
        margin: 3px;
      }


      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }
  
      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        color: var(--brand-primary-color);
      }

      .modifier {
        font-size: 14px;
        /*background: #000000;*/
        /*color: #ffffff;*/
        margin: 0 4px;
        /*padding: 2px 4px;*/
        /*border-radius: 3px;*/
        text-transform: uppercase;
        font-weight: 500;
      }
      
      .modifier.online {
        color: #757575;
      }
      
      .modifier.local-only {
        color: #039BE5;
      }
      
      .modifier.locally-updated {
        color: #009688;
      }
      
      .modifier.imported {
        color: #4CAF50;
      }
      #search-tab {
        background-color:#43A047;
      }
      #log-tab {
        background-color:var(--paper-teal-800);
      }
      .btn-add {
        min-width: 0;
        padding-top: 0.5em;
        padding-bottom: 0.5em;
        background-color: #eceff1;
        color: rgba(0, 0, 0, .87);
      }
      .paper-input-custom ::content input {
        font-size: 18px !important;
        color: rgba(0, 0, 0, .87) !important;
      }

      .paper-input-custom ::content label {
        font-size: 18px !important;
        color: #737373 !important;
      }
      .preview-title {
        padding-left: 12px;
        padding-right: 12px;
        background-color: #f7f7f7;
        min-height: 60px;
        /*border-bottom: 1px solid #eee;*/
      }

      .custom-menu-button {
        position: fixed;
        right: 16px;
        bottom: 112px;
      }

      .custom-menu-button ::content .dropdown-content {
        background-color: transparent;
        bottom: 80px !important;
        box-shadow: none !important;
      }

      paper-fab {
        background-color: #5c4575;
      }

      .custom-menu {

      }

      .p-8 {
        padding: 8px;
      }

      .custom-item {
        padding: 8px 16px;
        background-color: #5c4575;
        color: #fff;
        border-radius: 6px;
        margin: 8px 0;
        font-size: 16px;
        font-weight: 400;
        line-height: 32px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      .custom-item:hover {
        cursor: pointer;
      }

      .custom-img {
        border-radius: 50%;
      }
      
    </style>

    <!-- local DOM -->

    <div class="tabs-container">
      <paper-tabs id="tabs" selected="{{selectedSearchViewIndex}}" scrollable="" noink="true" on-iron-select="onPageIndexChange">
        <paper-tab>[[$TRANSLATE('Search',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Imported/Local Patients',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Logs',LANG)]]</paper-tab>
        <paper-tab>[[$TRANSLATE('Pending PCC Records',LANG)]]</paper-tab>
      </paper-tabs>
    </div>

    <div class="master-container">

      <div class="limiting-container">

        <iron-pages selected="{{selectedSearchViewIndex}}">

          <!-- Search Patient - start -->
          <section>
            <!-- Card - Search - start -->
            <paper-card>
              <div class="p-8 preview-title">
             
                <paper-input class="flex paper-input-custom" value="{{searchFieldMainInput}}" label="Search Patient"></paper-input>

                <div class="horizontal layout end-justifed center flex">
                  <paper-toggle-button class="flex" checked="{{isAdvancedSearchEnabled}}">Advanced Search</paper-toggle-button>
                  <paper-button class="btn-add colored" raised="" on-tap="searchOnlineButtonPressed"><iron-icon icon="search" class="m-right-8"></iron-icon>SEARCH</paper-button>
                </div>
              </div>

              <!-- advanced search - start -->
              <template is="dom-if" if="{{isAdvancedSearchEnabled}}">
                <paper-listbox>
                  <paper-item class="custom">
                    <div class="layout horizontal center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.initialVisitDate.enabled}}">Initial Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.lastVisitDate.enabled}}">Last Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.admissionDate.enabled}}">Admission Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.createdDate.enabled}}">Created Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox>Handled by me between</paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.lowerBound}}" no-label-float=""></paper-input>
                      <div>and</div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients created by me</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients handled by me at least once</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center end-justified">
                      <span class="more-optons" on-tap="moreOptionsPressed">more options?</span>
                    </div>
                  </paper-item>
                </paper-listbox>
              </template>
              <!-- advanced search - end -->

            </paper-card>
            <!-- Card - Search - end -->

            <!-- Card - Search Results - start -->
            <paper-card class="m-top-8">
      
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <template is="dom-if" if="[[hasSearchBeenPressed]]">
                    <div class="flex">
                      <div class="title">Search Results</div>
                      <div class="type caption-2 secondary">[[matchingPatientList.length]] Patient(s) found</div>
                    </div>
                  </template>

                  <custom-vital-search on-date-select="searchResultFilterByDateClicked" on-clear="searchResultFilterByDateClearButtonClicked"></custom-vital-search>

                  <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                </div>
              </div>

              <template is="dom-if" if="[[hasSearchBeenPressed]]">
                <div class="p-0">
                  <paper-listbox>
                    
                    <template id="patient-list-repeater" is="dom-repeat" items="[[matchingPatientList]]" as="patient">
                      <paper-item class="custom layout horizontal center wrap">
                        <div class="type caption secondary">[[patient.serial]]</div>
                        
                        <div class="flex m-left-8">
                          <div class="type body capitalize">[[$getFullName(patient.name)]]</div>
                          <div class="type caption">[[patient.email]]</div>
                          <div class="type caption">[[patient.phone]]</div>
                          <!-- <div class="type caption">[[$mkDate(patient.createdDatetimeStamp)]]</div> -->
                          <template is="dom-if" if="[[patient.doctorsPrivateNote]]">
                            <div class="type caption">([[$truncate(patient.doctorsPrivateNote, 20)]])</div>
                          </template>
                        </div>
                        <div class="layout horizontal m-horizontal-4 wrap">
                          <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                            <div class="modifier online">online Only</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isImported]]">
                            <div class="modifier imported">imported</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isLocalOnly]]">
                            <div class="modifier local-only">local only</div>
                          </template>
                          <!-- <template is="dom-if" if="[[patient.flags.isLocallyUpdated]]">
                            <div class="modifier locally-updated">locally updated</div>
                          </template> -->
                        </div>

                        <!-- <paper-icon-button icon="visibility" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"></paper-icon-button> -->

                        <!-- <paper-button raised class="btn-add colored" on-tap="viewPatient" hidden="[[!patient.flags.isImported]]"><iron-icon icon="icons:visibility" class="m-right-8"></iron-icon>View</paper-button> -->
              
                        <paper-menu-button horizontal-align="right" no-animations="">
                          <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                          <paper-menu class="dropdown-content">
                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <!-- <paper-item on-tap="viewPatientPressed">View</paper-item> -->
                              <paper-item on-tap="viewPatient">View Patient</paper-item>
                              <paper-item on-tap="editPatientPressed">Edit Patient Info</paper-item>
                              <!-- <paper-item on-tap="editPatientPreconceptionRecord">Edit PCC Record <img class="m-left-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt=""></paper-item> -->
                              <!-- <paper-item on-tap="_shortcutToNewPrescription">New Prescription</paper-item> -->
                            </template>
                            <!-- export/import start -->
                            <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                              <paper-item on-tap="importPatientPressed">Import from Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[$or(patient.flags.isLocalOnly, patient.flags.isImported)]]">
                              <paper-item on-tap="publishPatientPressed">Publish to Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[patient.flags.isImported]]">
                              <paper-item on-tap="importLatestPatientPressed">Import Latest from Cloud</paper-item>
                            </template>
                        <template is="dom-repeat" items="[[organizationsIBelongToList]]" as="organization">
                          <paper-item on-tap="putInWaitlistTapped">Put in [[organization.name]]'s Waitlist</paper-item>
                        </template>


                            <!-- export/import end -->

                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <paper-item on-tap="deletePatientPressed">Delete local copy</paper-item>
                            </template>

                          </paper-menu>
                        </paper-menu-button>
                        

                      </paper-item>
                    </template>

                  </paper-listbox>
                  
                </div>
              </template>

              <!-- <div class="card-actions">
                <paper-button class="btn" on-tap="newPCCPatient">
                  <img class="m-right-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt="">Create New PCC Patient</paper-button>

                <paper-button raised class="btn btn-primary" on-tap="newPatientFabPressed">
                  <iron-icon icon="add"></iron-icon>&nbsp;
                  Create New Patient</paper-button>
              </div> -->
            </paper-card>
            <!-- Card - Search Results - end -->
          </section>
          <!-- Search Patient - end -->

          <!-- Imported/Offline Patients - start -->
          <section>
            <!-- Card - Search - start -->
            <paper-card>
              <div class="p-8 preview-title">
             
                <paper-input class="flex paper-input-custom" value="{{searchFieldMainInput}}" label="Search Local Patient"></paper-input>

                <div class="horizontal layout end-justifed center flex">
                  <paper-toggle-button class="flex" checked="{{isAdvancedSearchEnabled}}">Advanced Search</paper-toggle-button>
                  <paper-button class="btn-add colored" raised="" on-tap="searchOfflineButtonPressed"><iron-icon icon="search" class="m-right-8"></iron-icon>SEARCH</paper-button>
                </div>
              </div>

              <!-- advanced search - start -->
              <template is="dom-if" if="{{isAdvancedSearchEnabled}}">
                <paper-listbox>
                  <paper-item class="custom">
                    <div class="layout horizontal center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.initialVisitDate.enabled}}">Initial Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.initialVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.lastVisitDate.enabled}}">Last Visited date Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.lastVisitDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.admissionDate.enabled}}">Admission Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.admissionDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox checked="{{advancedSearchParameters.createdDate.enabled}}">Created Between </paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.lowerBound}}" no-label-float=""></paper-input>
                      <div> and </div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.createdDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center wrap">
                      <paper-checkbox>Handled by me between</paper-checkbox>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.lowerBound}}" no-label-float=""></paper-input>
                      <div>and</div>
                      <paper-input class="m-horizontal-8" type="date" value="{{advancedSearchParameters.handledDate.upperBound}}" no-label-float=""></paper-input>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients created by me</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center">
                      <paper-checkbox>Show only patients handled by me at least once</paper-checkbox>
                    </div>
                  </paper-item>
                  <paper-item class="custom">
                    <div class="horizontal layout center end-justified">
                      <span class="more-optons" on-tap="moreOptionsPressed">more options?</span>
                    </div>
                  </paper-item>
                </paper-listbox>
              </template>
              <!-- advanced search - end -->

            </paper-card>
            <!-- Card - Search - end -->

            <!-- Card - Search Results - start -->
            <paper-card class="m-top-8">
      
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <template is="dom-if" if="[[hasSearchBeenPressed]]">
                    <div class="flex">
                      <div class="title">Search Results</div>
                      <div class="type caption-2 secondary">[[matchingPatientList.length]] Imported/Offline Patient(s) found</div>
                    </div>
                  </template>

                  <custom-vital-search on-date-select="searchResultFilterByDateClicked" on-clear="searchResultFilterByDateClearButtonClicked"></custom-vital-search>

                  <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                </div>
              </div>

              <template is="dom-if" if="[[hasSearchBeenPressed]]">
                <div class="p-0">
                  <paper-listbox>
                    
                    <template id="patient-list-repeater" is="dom-repeat" items="[[matchingPatientList]]" as="patient">
                      <paper-item class="custom layout horizontal center">
                        <div class="type caption secondary">[[patient.serial]]</div>
                        
                        <div class="flex m-left-8">
                          <div class="type body capitalize">[[$getFullName(patient.name)]]</div>
                          <div class="type caption">[[patient.email]]</div>
                          <div class="type caption">[[patient.phone]]</div>
                          <!-- <div class="type caption">[[$mkDate(patient.createdDatetimeStamp)]]</div> -->
                          <template is="dom-if" if="[[patient.doctorsPrivateNote]]">
                            <div class="type caption">([[$truncate(patient.doctorsPrivateNote, 20)]])</div>
                          </template>
                        </div>
                        <div class="layout horizontal m-horizontal-4 wrap">
                          <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                            <div class="modifier online">online Only</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isImported]]">
                            <div class="modifier imported">imported</div>
                          </template>
                          <template is="dom-if" if="[[patient.flags.isLocalOnly]]">
                            <div class="modifier local-only">local only</div>
                          </template>
                          <!-- <template is="dom-if" if="[[patient.flags.isLocallyUpdated]]">
                            <div class="modifier locally-updated">locally updated</div>
                          </template> -->
                        </div>

                        <!-- <paper-icon-button icon="visibility" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"></paper-icon-button> -->

                        <!-- <paper-button raised class="btn-add colored" on-tap="viewPatientIconPressed" hidden="[[!patient.flags.isImported]]"><iron-icon icon="icons:visibility" class="m-right-8"></iron-icon>View</paper-button> -->
              
                        <paper-menu-button horizontal-align="right" no-animations="">
                          <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                          <paper-menu class="dropdown-content">
                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <!-- <paper-item on-tap="viewPatientPressed">View</paper-item> -->
                              <paper-item on-tap="viewPatient">View Patient</paper-item>
                              <paper-item on-tap="editPatientPressed">Edit</paper-item>
                              <!-- <paper-item on-tap="editPatientPreconceptionRecord">Edit PCC Record <img class="m-left-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt=""></paper-item> -->
                              <!-- <paper-item on-tap="_shortcutToNewPrescription">New Prescription</paper-item> -->
                            </template>
                            <!-- export/import start -->
                            <template is="dom-if" if="[[patient.flags.isOnlineOnly]]">
                              <paper-item on-tap="importPatientPressed">Import from Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[$or(patient.flags.isLocalOnly, patient.flags.isImported)]]">
                              <paper-item on-tap="publishPatientPressed">Publish to Cloud</paper-item>
                            </template>
                            <template is="dom-if" if="[[patient.flags.isImported]]">
                              <paper-item on-tap="importLatestPatientPressed">Import Latest from Cloud</paper-item>
                            </template>
                        <template is="dom-repeat" items="[[organizationsIBelongToList]]" as="organization">
                          <paper-item on-tap="putInWaitlistTapped">Put in [[organization.name]]'s Waitlist</paper-item>
                        </template>


                            <!-- export/import end -->

                            <template is="dom-if" if="[[$or(patient.flags.isImported, patient.flags.isLocalOnly)]]">
                              <paper-item on-tap="deletePatientPressed">Delete local copy</paper-item>
                            </template>

                          </paper-menu>
                        </paper-menu-button>
                        

                      </paper-item>
                    </template>

                  </paper-listbox>
                  
                </div>
              </template>
            </paper-card>
            <!-- Card - Search Results - end -->
          </section>
          <!-- Imported/Offline Patients - end -->

          <!-- Patient Log - end -->
          <section>
            <!-- Card - Visited Patient Log - start -->
            <paper-card>
      
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <div class="title flex">Visited Patient Log</div>


                  <custom-vital-search on-date-select="searchResultFilterByDateClickedForPatientLog" on-clear="searchResultFilterByDateClearButtonClickedForPatientLog"></custom-vital-search>

                  <!-- <paper-icon-button icon="clear" on-tap="clearSearchResultsClicked"></paper-icon-button> -->
                </div>
              </div>

              <template is="dom-if" if="[[_isEmptyArray(matchingVisitedPatientLogList)]]">
                <div class="card-content layout horizontal center center-justified">
                  <div class="type body secondary">-- no data available --</div>
                </div>
              </template>

              <paper-listbox>
                
                <template id="visited-patient-log-repeater" is="dom-repeat" items="[[matchingVisitedPatientLogList]]" as="patient">
                  <paper-item class="custom layout horizontal center">
                    <div class="type caption secondary">[[patient.patientSerial]]</div>
                    
                    <div class="flex m-left-8">
                      <div class="type body capitalize">[[$getFullName(patient.patientName)]]</div>
                      <div class="type caption">
                        <strong>Visited Date: </strong>
                        <span>[[$mkDateTime(patient.visitedDateTimeStamp)]]</span>
                      </div>
                    </div>
          
                    <paper-button raised="" class="btn-add" on-tap="viewPatientPressedFromLog"><iron-icon icon="visibility" class="m-right-8"></iron-icon>view</paper-button>

                </paper-item></template>
              </paper-listbox>
           
            </paper-card>
            <!-- Card - Visited Patient Log - end -->
          </section>
          <!-- Patient Log - end -->

          <!-- sync - start -->
          <section>
            <paper-card>
              <div class="card-custom-header">
                <div class="layout horizontal center">
                  <div class="title flex">Pending PCC records (for Existing Patient)</div>
                  <!-- <paper-button raised class="btn-add colored" on-tap="uploadAllOfflineRegisteredPatient"><iron-icon icon="icons:cloud-upload" class="m-right-8"></iron-icon>Upload All</paper-button> -->
                </div>
                <div class="type body-caption secondary">You'll need Doctor Access Pin Code From Particular Patient in order SAVE PCC Record!</div>
              </div>

              <paper-listbox>
                
                <template id="pending-pcc-record-for-existing-patient-repeater" is="dom-repeat" items="[[patientListForPendingPccRecords]]" as="patient">
                  <paper-item class="custom layout horizontal center wrap">
                    
                    <div class="flex m-left-8">
                      <div class="type caption secondary">[[patient.data.serial]]</div>
                      <div class="type body capitalize">[[$getFullName(patient.data.name)]]</div>
                      <div class="type caption-2">[[patient.data.phone]]</div>
                    </div>
            
                    <paper-input label="Pin" value="{{patient.doctorAccessPin}}"></paper-input>
              
          
                    
          
                    <paper-button raised="" class="btn-add" on-tap="savePendingPccRecords"><iron-icon icon="save" class="m-right-8"></iron-icon>save</paper-button>

                </paper-item></template>
              </paper-listbox>
          </paper-card></section>
          <!-- sync registered - end -->


        </iron-pages>

      </div>

    </div>

    

    <paper-menu-button class="custom-menu-button" horizontal-align="right" vertical-align="bottom">
      <paper-fab class="dropdown-trigger" icon="add"></paper-fab>
      <div class="dropdown-content custom-menu">
        <div class="custom-item horizontal layout center" on-tap="newPCCPatient"><img class="custom-img m-right-8" width="24" height="24" src="../../assets/img/partners/badas_logo.png" alt="">New PCC Patient</div>
        <div class="custom-item" on-tap="newPatientFabPressed"><iron-icon icon="icons:account-circle" class="m-right-8"></iron-icon>New Patient</div>
      </div>
    </paper-menu-button>


  </template>
  <script>(function(){Polymer({is:"page-patient-manager",behaviors:[app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling,app.behaviors.commonComputes,app.behaviors.dbUsing],properties:{selectedSearchViewIndex:{type:Number,notify:!0,value:0},selectedTabPageIndex:{type:Number,notify:!0,value:0},searchContextDropdownSelectedIndex:{type:Number,notify:!0,value:1},isAdvancedSearchEnabled:{type:Boolean,notify:!0,value:!1},advancedSearchParameters:{type:Object,notify:!0,value:{createdDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},initialVisitDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},lastVisitDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},admissionDate:{enabled:!1,lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())},handledDate:{lowerBound:lib.datetime.mkDate(lib.datetime.now()),upperBound:lib.datetime.mkDate(lib.datetime.now())}}},hasSearchBeenPressed:{type:Boolean,notify:!0,value:!0},matchingPatientList:{type:Array,notify:!0,value:[]},searchFieldMainInput:{type:String,notify:!0,value:""},user:{type:Object,notify:!0,value:null},currentDateFilterStartDate:{type:Number},currentDateFilterEndDate:{type:Number},resultedPatientList:{type:Array,notify:!0,value:[]},matchingVisitedPatientLogList:{type:Array,notify:!0,value:[]},filteredPatientVisitedPatientLogList:{type:Array,notify:!0,value:[]},organizationsIBelongToList:{type:Array,value:function(){return[]}},patientListForPendingPccRecords:{type:Array,value:function(){return[]}}},_loadUser:function(){var e;if(e=app.db.find("user"),1===e.length)return this.user=e[0]},loadPatientListForPendingPCCRecords:function(){var e;e=app.db.find("existing-patient-log-for-pending-pcc-records"),this.patientListForPendingPccRecords=e},savePendingPccRecords:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-BUTTON"),t.opened=!1,a=this.$$("#pending-pcc-record-for-existing-patient-repeater"),i=a.indexForElement(t),n=this.patientListForPendingPccRecords[i],this._importPatient(n.data.serial,n.doctorAccessPin,function(e){return function(t){return e._updateLocalPcc(n.data.serial,n.oldSerial),e._removeLocalPatient(n.oldSerial,function(){return e.loadPatientListForPendingPCCRecords()}),e.domHost.showToast("PCC Record has been saved Successfully!")}}(this))},_removeLocalPatient:function(e,t){var i;return i=app.db.find("existing-patient-log-for-pending-pcc-records",function(e){var t;return t=e.oldSerial,t===t})[0]._id,app.db.remove("existing-patient-log-for-pending-pcc-records",i),t()},_updateLocalPcc:function(e,t){var i;return i=app.db.find("pcc-records",function(e){var i;return i=e.patientSerial,i===t})[0],i.patientSerial=e,app.db.update("pcc-records",i._id,i)},_organizationNavigatedIn:function(){var e;return e={apiKey:this.user.apiKey},this.callApi("/bdemr-organization-list-those-user-belongs-to",e,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):e.organizationsIBelongToList=i.data.organizationObjectList}}(this))},onPageIndexChange:function(){if(1===this.selectedSearchViewIndex)return this.listAllImportedAndOfflinePatientsPressed()},navigatedIn:function(){var e,t,i,n,a;for(this.organization=this.getCurrentOrganization(),this.organization||this.domHost.navigateToPage("#/select-organization"),this._loadUser(),a=app.db.find("patient-list",function(e){var t;return t=e.isForOrganizationOnly,t===!0}),e=0,t=a.length;e<t;e++)n=a[e],app.db.remove("patient-list",n._id);return this._organizationNavigatedIn(),this.loadPatientListForPendingPCCRecords(),this.domHost.__patientView__oneTimeSearchFilter&&(this.oneTimeSearchFilter=this.domHost.__patientView__oneTimeSearchFilter),i=this.domHost.getPageParams(),i.selected?this.set("selectedSearchViewIndex",parseInt(i.selected)):this.set("selectedSearchViewIndex",0),i.filter&&"today-only"===i.filter?(this.domHost.modifyCurrentPagePath("#/patient-manager"),this.searchFieldMainInput="",this.isAdvancedSearchEnabled=!1,this.set("advancedSearchParameters.createdDate.enabled",!0),this.set("advancedSearchParameters.createdDate.lowerBound",lib.datetime.mkDate(lib.datetime.now())),this.set("advancedSearchParameters.createdDate.upperBound",lib.datetime.mkDate(lib.datetime.now())),this.listAllImportedAndOfflinePatientsPressed(null)):i.filter&&"clear"===i.filter?(this.domHost.modifyCurrentPagePath("#/patient-manager"),this.isAdvancedSearchEnabled=!1,this.searchFieldMainInput="",this.listAllImportedAndOfflinePatientsPressed(null)):i.query?(this.searchFieldMainInput=i.query,this.searchOnlineButtonPressed()):i.unregsiterd?(this.searchFieldMainInput=i.unregsiterd,this.searchOfflineButtonPressed()):this.listAllImportedAndOfflinePatientsPressed(null),this._listVisitedPatientLog()},searchButtonPressed:function(e){return 1===this.searchContextDropdownSelectedIndex?this._searchOnline():this._searchOffline()},listAllImportedAndOfflinePatientsPressed:function(e){return this.searchFieldMainInput="",this.searchContextDropdownSelectedIndex=0,this.searchButtonPressed(null)},searchOfflineButtonPressed:function(e){return 0===this.searchFieldMainInput.length?this.domHost.showModalDialog("Please enter something to search with."):(this.searchContextDropdownSelectedIndex=0,this.searchButtonPressed(null))},searchOnlineButtonPressed:function(e){return this.searchContextDropdownSelectedIndex=1,this.searchButtonPressed(null)},_searchOnline:function(){return this.matchingPatientList=[],this.callApi("/bdemr-patient-search",{searchQuery:this.searchFieldMainInput},function(e){return function(t,i){var n,a,r,s,o;if(i.hasError)return e.domHost.showModalDialog(i.error.message);for(s=i.data,n=0,a=s.length;n<a;n++)o=s[n],o.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},r=app.db.find("patient-list",function(e){var t;return t=e.serial,t===o.serial}),0===r.length?o.flags.isOnlineOnly=!0:(o.flags.isImported=!0,o._tempLocalDbId=r[0]._id);return e.matchingPatientList=s}}(this))},_searchOffline:function(){var e,t,i,n,a;for(a=this.searchFieldMainInput,0===a.length,n=app.db.find("patient-list",function(e){return function(t){var i,n,r,s,o,d,l,c,u,h,p,m,P,g,f,v,D,w,b,S,L,I,y;return y=t.serial,D=t.name,l=t.email,w=t.phone,v=t.nIdOrSsn,u=t.hospitalNumber,h=t.initialVisitDate,P=t.lastVisitDate,i=t.admissionDate,e.oneTimeSearchFilter?(n=""+y==""+e.oneTimeSearchFilter,r=!1,s=!1,o=!1,d=!1):(n=D.first.indexOf(a)||D.last.indexOf(a)>-1,r=l.indexOf(a)>-1,s=w.indexOf(a)>-1,o=y.indexOf(a)>-1,d=function(){try{return v.indexOf(a)>-1}catch(e){return c=e,!1}}()),m=!0,p=e.isAdvancedSearchEnabled,p&&(e.advancedSearchParameters.initialVisitDate.enabled?(g=new Date(e.advancedSearchParameters.initialVisitDate.lowerBound),f=new Date(h),I=new Date(e.advancedSearchParameters.initialVisitDate.upperBound),m=g.getTime()<=(b=f.getTime())&&b<=I.getTime()):e.advancedSearchParameters.lastVisitDate.enabled?(g=new Date(e.advancedSearchParameters.lastVisitDate.lowerBound),f=new Date(P),I=new Date(e.advancedSearchParameters.lastVisitDate.upperBound),m=g.getTime()<=(S=f.getTime())&&S<=I.getTime()):e.advancedSearchParameters.admissionDate.enabled&&(g=new Date(e.advancedSearchParameters.admissionDate.lowerBound),f=new Date(i),I=new Date(e.advancedSearchParameters.admissionDate.upperBound),m=g.getTime()<=(L=f.getTime())&&L<=I.getTime())),(n||r||s||o||d)&&m}}(this)),this.oneTimeSearchFilter=null,e=0,t=n.length;e<t;e++)i=n[e],"flags"in i||(i.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},i.flags.isLocalOnly=!0);return this.matchingPatientList=n},clearSearchResultsClicked:function(e){return this.matchingPatientList=[]},moreOptionsPressed:function(e){return this.domHost.showModalDialog('You can search records (instead of patients) by many other options including diseases from the "Record Manager" option from the left menu.')},newPatientFabPressed:function(e){return this.domHost.navigateToPage("#/patient-editor/patient:new")},newPCCPatient:function(e){return this.domHost.navigateToPage("#/preconception-record/record:new/patients:new")},_getPinForLocalPatient:function(e){var t,i;return t=app.db.find("local-patient-pin-code-list",function(t){return function(t){var i;return i=t.patientSerial,i===e}}(this)),1===t.length?i=t[0].pin:null},_savePinForLocalPatient:function(e){return app.db.upsert("local-patient-pin-code-list",e,function(t){return function(t){var i;return i=t.patientSerial,e.patientSerial===i}}(this))},_publishPatient:function(e,t,i){return this.callApi("/bdemr-patient-publish",{patient:e,pin:t},function(n){return function(a,r){return r.hasError?"U_PIN_ERR"===r.error.message?n.domHost.showModalInput("Please enter correct patient PIN","0000",function(t){if(t)return n._publishPatient(e,t,i)}):n.domHost.showModalDialog(r.error.message):"success"===r.data.status?(t=n._getPinForLocalPatient(e.serial),n._importPatient(e.serial,t,function(t){return app.db.remove("patient-list",e._id),n.searchContextDropdownSelectedIndex=0,n.oneTimeSearchFilter=e.serial,n.searchButtonPressed(null)})):n.domHost.showModalDialog("Unkown response "+r.data.status)}}(this))},publishPatientPressed:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Publishing will overwrite remote changes (if any). Continue?",function(e){return function(t){if(t)return e._publishPatient(n,null,function(e){})}}(this))},_importPatient:function(e,t,i){return this.callApi("/bdemr-patient-import-new",{serial:e,pin:t,doctorName:this.user.name,organizationId:this.organization.idOnServer},function(n){return function(a,r){var s,o,d,l;return r.hasError?n.domHost.showModalDialog(r.error.message):(d=r.data,1!==d.length?n.domHost.showModalDialog("Unknown error occurred."):(o=d[0],l={patientSerial:e,pin:t},n._savePinForLocalPatient(l),o.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},o.flags.isImported=!0,n.removePatientIfAlreadyExist(o.serial),s=app.db.insert("patient-list",o),i(s)))}}(this))},removePatientIfAlreadyExist:function(e){var t,i;t=app.db.find("patient-list",function(t){var i;return i=t.serial,i===e}),1===t.length&&(i=t[0],app.db.remove("patient-list",i._id))},importPatientPressed:function(e){var t,i,n,a,r;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,r=this.$$("#patient-list-repeater"),i=r.indexForElement(t),a=this.matchingPatientList[i],n=app.db.find("offline-patient-pin",function(e){var t;return t=e.serial,t===a.serial})[0],a.idOnServer?(null!=n?n.pin:void 0)?this._importPatient(a.serial,n.pin,function(e){return function(t){return e.searchFieldMainInput="",e.searchContextDropdownSelectedIndex=0,e.oneTimeSearchFilter=a.serial,e.listAllImportedAndOfflinePatientsPressed(null),e.goPatientViewPage(a)}}(this)):this.domHost.showModalInput("Please enter patient PIN","0000",function(e){return function(t){if(t)return e._importPatient(a.serial,t,function(i){var n;return e.searchFieldMainInput="",e.searchContextDropdownSelectedIndex=0,e.oneTimeSearchFilter=a.serial,e.listAllImportedAndOfflinePatientsPressed(null),n={serial:a.serial,pin:t},app.db.insert("offline-patient-pin",n),e.goPatientViewPage(a)})}}(this)):this._importPatient(a.serial,null,function(e){return function(t){return e.searchFieldMainInput="",e.searchContextDropdownSelectedIndex=0,e.oneTimeSearchFilter=a.serial,e.listAllImportedAndOfflinePatientsPressed(null)}}(this))},goPatientViewPage:function(e){return this.domHost.setCurrentPatientsDetails(e),this.createdPatientVisitedLog(e),this.domHost.navigateToPage("#/patient-viewer/patient:"+e.serial+"/selected:5"),this.domHost.selectedPatientPageIndex=5},importLatestPatientPressed:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Fetching latest will discard local changes. Continue?",function(t){return function(i){if(i)return app.db.remove("patient-list",n._id),t.importPatientPressed(e)}}(this))},putInWaitlistTapped:function(e){var t,i,n,a,r;return n=e.model.organization,t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,r=this.$$("#patient-list-repeater"),i=r.indexForElement(t),a=this.matchingPatientList[i],this.domHost.navigateToPage("#/organization-manage-waitlist/organization:"+n.idOnServer+"/patient:"+a.serial)},viewPatientPressed:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.createdPatientVisitedLog(n),this.domHost.setCurrentPatientsDetails(n),this.domHost.navigateToPage("#/patient-viewer/patient:"+n.serial+"/selected:5"),this.domHost.selectedPatientPageIndex=5},editPatientPressed:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.domHost.navigateToPage("#/patient-editor/patient:"+n.serial)},deletePatientPressed:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.domHost.showModalPrompt("Are you sure?",function(e){return function(t){var i;if(t===!0)return i=n._id,i||0===i||(i=n._tempLocalDbId),app.db.remove("patient-list",i),e.searchButtonPressed(null)}}(this))},$or:function(e,t){return e||t},$log:function(e){},searchResultFilterByDateClicked:function(e){var t,i,n,a;return 0===this.resultedPatientList.length&&(this.resultedPatientList=this.matchingPatientList),this.currentDateFilterStartDate=e.detail.startDate,this.currentDateFilterEndDate=e.detail.endDate,a=new Date(e.detail.startDate),t=new Date(e.detail.endDate),t.setHours(24+t.getHours()),i=function(){var e,i,r,s,o;for(r=this.resultedPatientList,o=[],e=0,i=r.length;e<i;e++)n=r[e],a.getTime()<=(s=new Date(n.lastModifiedDatetimeStamp).getTime())&&s<=t.getTime()&&o.push(n);return o}.call(this),this.matchingPatientList=i},searchResultFilterByDateClearButtonClicked:function(e){return this.currentDateFilterStartDate=null,this.currentDateFilterEndDate=null,this.matchingPatientList=this.resultedPatientList,this.resultedPatientList=[]},viewPatient:function(e){var t,i,n,a;return t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,a=this.$$("#patient-list-repeater"),i=a.indexForElement(t),n=this.matchingPatientList[i],this.domHost.setCurrentPatientsDetails(n),this.createdPatientVisitedLog(n),this.domHost.selectedPatientPageIndex=5,this.domHost.navigateToPage("#/patient-viewer/patient:"+n.serial+"/selected:5")},createdPatientVisitedLog:function(e){var t;return t={createdByUserSerial:this.user.serial,serial:this.generateSerialForVisitedPatientLog(),patientSerial:e.serial,patientName:e.name,visitedDateTimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now()},app.db.insert("visited-patient-log",t)},_listVisitedPatientLog:function(){var e,t;return e=app.db.find("visited-patient-log"),t=[].concat(e),t.sort(function(e,t){return e.visitedDateTimeStamp>t.visitedDateTimeStamp?-1:e.visitedDateTimeStamp<t.visitedDateTimeStamp?1:0}),this.matchingVisitedPatientLogList=t},viewPatientPressedFromLog:function(e){var t,i,n,a,r,s,o;if(t=this.locateParentNode(e.target,"PAPER-BUTTON"),t.opened=!1,s=this.$$("#visited-patient-log-repeater"),i=s.indexForElement(t),r=this.matchingVisitedPatientLogList[i],a=app.db.find("patient-list",function(e){var t;return t=e.serial,t===r.patientSerial}),1===a.length&&(n=a[0],o={createdByUserSerial:this.user.serial,serial:this.generateSerialForVisitedPatientLog(),patientSerial:r.patientSerial,patientName:r.patientName,visitedDateTimeStamp:lib.datetime.now(),lastModifiedDatetimeStamp:lib.datetime.now()},app.db.insert("visited-patient-log",o),this.domHost.setCurrentPatientsDetails(n),this.domHost.navigateToPage("#/visit-editor/visit:new/patient:"+r.patientSerial)),0===a.length)return this.domHost.showModalInput("Please enter patient PIN","0000",function(e){return function(t){if(t)return e._importPatient(r.patientSerial,t,function(t){return e.searchFieldMainInput="",e.searchContextDropdownSelectedIndex=0,e.oneTimeSearchFilter=r.patientSerial,e.listAllImportedAndOfflinePatientsPressed(null)})}}(this)),this.selectedSearchViewIndex=0},importPatientPressedFromLog:function(e){var t,i,n,a,r;if(t=this.locateParentNode(e.target,"PAPER-MENU-BUTTON"),t.opened=!1,r=this.$$("#visited-patient-log-repeater"),i=r.indexForElement(t),a=this.matchingVisitedPatientLogList[i],n=app.db.find("patient-list",function(e){var t;return t=e.serial,t===a.patientSerial}),1===n.length&&this.domHost.showModalDialog("Already Imported!"),0===n.length)return this.domHost.showModalInput("Please enter patient PIN","0000",function(e){return function(t){if(t)return e._importPatient(a.patientSerial,t,function(t){return e.searchFieldMainInput="",e.searchContextDropdownSelectedIndex=0,e.oneTimeSearchFilter=a.patientSerial,e.listAllImportedAndOfflinePatientsPressed(null)})}}(this)),this.selectedSearchViewIndex=0},searchResultFilterByDateClickedForPatientLog:function(e){var t,i,n,a;return 0===this.filteredPatientVisitedPatientLogList.length&&(this.filteredPatientVisitedPatientLogList=this.matchingVisitedPatientLogList),this.currentDateFilterStartDate=e.detail.startDate,this.currentDateFilterEndDate=e.detail.endDate,a=new Date(e.detail.startDate),t=new Date(e.detail.endDate),t.setHours(24+t.getHours()),i=function(){var e,i,r,s,o;for(r=this.filteredPatientVisitedPatientLogList,o=[],e=0,i=r.length;e<i;e++)n=r[e],a.getTime()<=(s=new Date(n.visitedDateTimeStamp).getTime())&&s<=t.getTime()&&o.push(n);return o}.call(this),this.matchingVisitedPatientLogList=i},searchResultFilterByDateClearButtonClickedForPatientLog:function(e){return this.currentDateFilterStartDate=null,this.currentDateFilterEndDate=null,this.matchingVisitedPatientLogList=this.filteredPatientVisitedPatientLogList,this.filteredVisitedPatientLogList=[]},_isEmptyArray:function(e){return 0===e.length}})}).call(this);
//# sourceMappingURL=page-patient-manager.coffee-compiled.js.map</script>
</dom-module>
