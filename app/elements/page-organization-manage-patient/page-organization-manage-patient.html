<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><dom-module id="page-organization-manage-patient">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
      }

      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        color: var(--brand-primary-color);
      }

      paper-input.balance {
        --paper-input-container: {
          padding: 0;
        }
      }
    </style>

    <!-- local DOM -->

    <div class="master-container">

      <div class="limiting-container">

        <!-- Add Patient Start -->
        <paper-card heading="Search Patient And Add Funds">
          <div class="card-content">
            <paper-autocomplete class="flex" id="userSearch" text="{{searchFieldMainInput}}" label="Search with Patient Name, phone, Email, NID or Hospital Number" on-autocomplete-selected="userSelected" on-keyup="onlineSearchEnterKeyPressed" error-message="Input Required" text-property="name" value-property="idOnServer" required="">
              <template autocomplete-custom-template="">
                <paper-item on-tap="_onSelect" id$="[[_getSuggestionId(index)]]" role="option" aria-selected="false">
                  <div class="type bold">[[item.name]]</div>
                  <div class="type secondary m-left-8">([[item.phone]])</div>
                  <div class="type secondary m-left-8">[[item.email]]</div>
                  <paper-ripple></paper-ripple>
                </paper-item>
              </template>
            </paper-autocomplete>
            <br>
            <template is="dom-if" if="[[selectedPatient]]">
              <paper-item class="layout horizontal start">
                <div class="flex">
                  <div class="type body capitalize bold">[[selectedPatient.name]]</div>
                  <div class="type caption">[[selectedPatient.email]]</div>
                  <div class="type caption">[[selectedPatient.phone]]</div>
                  <div class="type caption">Indoor Balance:
                    <strong>[[selectedPatient.indoorBalance]]</strong> BDT</div>
                  <div class="type caption">Outdoor Balance:
                    <strong>[[selectedPatient.outdoorBalance]]</strong> BDT</div>
                </div>
                <div class="">
                  <paper-input class="balance" label="Indoor Balance" type="number" value="{{indoorBalance}}"></paper-input>
                  <paper-input class="balance" label="Outdoor Balance" type="number" value="{{outdoorBalance}}"></paper-input>
                  <paper-button raised="" class="btn btn-primary btn-sm m-top-8" on-tap="addFundsToPatientButtonPressed">
                    Add/Update By This Value</paper-button>
                </div>
                <div class="flex"></div>
                <div class="m-left-16 layout vertical">
                  <paper-button raised="" class="btn-default btn btn-sm m-top-8" on-tap="viewPatientExpenseHistoryPressed">
                    View Expenses</paper-button>
                  <paper-button raised="" class="btn btn-default btn-sm m-top-8" on-tap="removePatientPressed">Delete </paper-button>
                </div>

              </paper-item>

            </template>
          </div>
        </paper-card>
        <!-- Add Patient End -->

      </div>

    </div>

  </template>
  <script>(function(){Polymer({is:"page-organization-manage-patient",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling],properties:{user:{type:Object,notify:!0,value:null},matchingPatientList:{type:Array,value:function(){return[]}},indoorBalance:{type:Number,value:0},outdoorBalance:{type:Number,value:25e3},selectedPatient:{type:Object,value:function(){return null}}},$add:function(e,t){return parseInt(e)+parseInt(t)},navigatedIn:function(){return this._loadUser()},_loadUser:function(){var e;if(e=app.db.find("user"),1===e.length)return this.user=e[0]},arrowBackButtonPressed:function(e){return this.domHost.navigateToPreviousPage()},_notifyInvalidOrganization:function(){return this.isOrganizationValid=!1,this.domHost.showModalDialog("Invalid Organization Provided")},searchOnlineButtonPressed:function(e){return this.searchContextDropdownSelectedIndex=1,this.searchButtonPressed()},onlineSearchEnterKeyPressed:function(e){if(13===e.keyCode){if(!this.searchFieldMainInput)return;return this._searchOnline(this.searchFieldMainInput)}},_searchOnline:function(e){if(e)return this.callApi("/bdemr-patient-search",{apiKey:this.user.apiKey,searchQuery:e},function(e){return function(t,n){var a,i,r,s,o,u,d;if(n.hasError)return e.domHost.showToast(n.error.message);if(0===n.data.length)return e.domHost.showToast("No Patient Found with that Search"),e.searchFieldMainInput="";for(o=n.data,a=0,r=o.length;a<r;a++)u=o[a],u.flags={isImported:!1,isLocalOnly:!1,isOnlineOnly:!1},s=app.db.find("patient-list",function(e){var t;return t=e.serial,t===u.serial}),0===s.length?u.flags.isOnlineOnly=!0:(u.flags.isImported=!0,u._tempLocalDbId=s[0]._id);return o.forEach(function(t){return t.name=e.$getFullName(t.name),t}),d=function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)i=o[e],n.push(i);return n}(),e.$$("#userSearch").suggestions(d)}}(this))},userSelected:function(e){var t;return t=e.detail.option,this.set("selectedPatient",t),this.updatePatientCurrentBalanceView(),this.searchFieldMainInput=""},updatePatientCurrentBalanceView:function(){return this.getPatientServiceBalance(this.selectedPatient.idOnServer,function(e){return function(t){var n,a;return a=t||{},n=Object.assign(e.selectedPatient,a),e.set("selectedPatient",{}),e.set("selectedPatient",n)}}(this))},addFundsToPatientButtonPressed:function(e){return this.selectedPatient?this.addServiceValueToPatient(this.selectedPatient):void this.domHost.showToast("Please search and select a patient to add funds")},getPatientServiceBalance:function(e,t){var n;return n={patientId:e,apiKey:this.user.apiKey},this.callApi("/bdemr-uhcp--get-patient-service-value",n,function(e){return function(n,a){return a.hasError?e.domHost.showToast(a.error.message):t(a.data)}}(this))},addServiceValueToPatient:function(e){var t;return t={apiKey:this.user.apiKey,targetUserId:e.idOnServer,outdoorBalance:parseInt(this.outdoorBalance),indoorBalance:parseInt(this.indoorBalance)},this.callApi("/bdemr-uhcp--add-service-value-to-patient",t,function(e){return function(t,n){return n.hasError?e.domHost.showModalDialog(n.error.message):(e.domHost.showToast("Value Added Successfully"),e.updatePatientCurrentBalanceView())}}(this))},removePatientPressed:function(e){var t;return t={apiKey:this.user.apiKey,patientId:this.selectedPatient.idOnServer},this.callApi("/bdemr-uhcp--remove-patient-from-service",t,function(e){return function(t,n){return n.hasError?e.domHost.showModalDialog(n.error.message):e.set("selectedPatient",{})}}(this))},viewPatientExpenseHistoryPressed:function(e){var t,n,a,i,r,s,o,u,d;for(s=this.selectedPatient,d=["Outdoor Expenses:"],o=s.outdoorTransactionHistory,n=0,i=o.length;n<i;n++)t=o[n],d.push(t.notes+" - "+t.amountInBdt+" BDT - "+this.$mkDate(t.createDatetimeStamp));for(d.push(""),d.push("Indoor Expenses:"),u=s.indoorTransactionHistory,a=0,r=u.length;a<r;a++)t=u[a],d.push(t.notes+" - "+t.amountInBdt+" BDT - "+this.$mkDate(t.createDatetimeStamp));return this.domHost.showModalDialog(d)},navigatedOut:function(){return this.organization=null,this.isOrganizationValid=!1}})}).call(this);
//# sourceMappingURL=page-organization-manage-patient.coffee-compiled.js.map</script>
</dom-module>