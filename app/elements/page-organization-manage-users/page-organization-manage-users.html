<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><dom-module id="page-organization-manage-users">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
      }

      .organization-info-card-counter {
        margin-top: 20px;
        margin-left: 20px;
        margin-right: 10px;
        color: #777777;
      }

      .organization-info-cards {
        @apply(--layout-vertical);
        /*@apply(--layout-center);*/
        margin-top: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-bottom: 20px;
      }

      .organization-info-cards .row {
        margin-left: 10px;
        /*margin-right: 10px;*/
        margin-top: 10px;
      }

      .organization-info-cards .hr {
        margin-left: 20px;
        margin-right: 20px;
        height: 1px;
        /*width: 100px;*/
        background: #dddddd;
      }

      .organization-info-cards .row .modifier {
        font-size: 14px;
        background: #000000;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .organization-info-cards .row .modifier.online {
        background: #757575;
      }

      .organization-info-cards .row .modifier.local-only {
        background: #039BE5;
      }

      .organization-info-cards .row .modifier.locally-updated {
        background: #5c4575;
      }

      .organization-info-cards .row .modifier.imported {
        background: #4CAF50;
      }

      .info-row {
        margin-top: 10px;
      }

      .top-info-row {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .serial-number {
        background: #37474F;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
      }

      .address1 {
        margin-right: 10px;
      }

      .break-on-tablet {
        @apply(--layout-horizontal);
      }

      @media screen and (max-width: 740px) {
        .break-on-tablet {
          display: block;
        }
      }

      .val {
        text-decoration: underline;
      }

      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        color: var(--brand-primary-color);
      }

      .padding-for-rolewise-userslist {
        padding-left: 35px;
      }

      .roleName-style-for-roleWise-userlist {
        background: rgb(50, 114, 109);
        color: #ffffff;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
      }
    </style>

    <!-- local DOM -->

    <div class="master-container">

      <div class="limiting-container">

        <template is="dom-if" if="{{!isOrganizationValid}}">
          Organization invalid
        </template>

        <!-- editing organization - start -->
        <template is="dom-if" if="{{isOrganizationValid}}">

          <div class="organization-info-card-counter">
            <div>Basic Information</div>
          </div>

          <paper-card class="organization-info-cards">
            <div class="card-content">
              <div class="horizontal layout center top-info-row">
                <div>ID: </div>
                <div class="serial-number">[[organization.idOnServer]]</div>
                <div class="flex"></div>
              </div>
              <div class="info-row">
                <div>Name: [[organization.name]]</div>
              </div>
              <div class="info-row">
                <div>Region: [[organization.effectiveRegion]]</div>
              </div>
              <div class="info-row">
                <div>Address: [[organization.address]]</div>
              </div>
            </div>
          </paper-card>

          <div class="organization-info-card-counter">
            <div>Member Organizations</div>
          </div>

          <paper-card class="organization-info-cards">

            <div class="card-custom-header">
              <div class="layout horizontal center">
                <div class="title flex">Currently there are [[memberList.length]] members in this organization.</div>
              </div>
            </div>

            <template is="dom-if" if="[[memberList.length]]">
              <div class="p-0">
                <paper-listbox>

                  <template id="assistant-list-repeater" is="dom-repeat" items="[[memberList]]" as="member">
                    <paper-item class="custom layout horizontal center">

                      <div class="flex m-left-8">

                        <div class="type body capitalize">[[member.name]]
                          <template is="dom-if" if="[[$equals(member.idOnServer, user.idOnServer)]]">
                            (You)
                          </template>

                        </div>

                        <div class="type caption secondary">
                          <template is="dom-if" if="[[$isAdmin(member.idOnServer, organization.userList)]]">
                            Admin
                          </template>
                          <!-- <template is="dom-if" if="[[!$isAdmin(member.idOnServer, organization.userList)]]">
                            Regular User
                          </template> -->
                        </div>
                        <div class="type caption secondary">
                          <strong>Role:</strong> {{_getRoleTitleForUser(member.idOnServer)}}
                        </div>


                      </div>

                      <div class="layout horizontal m-horizontal-4 wrap">
                        <div class="type caption">[[member.email]]&nbsp;</div>
                        <div class="type caption">([[member.phone]])</div>
                      </div>

                      <paper-menu-button horizontal-align="right" no-animations="">
                        <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content">
                          <template is="dom-if" if="[[!$equals(member.idOnServer, user.idOnServer)]]">
                            <div hidden="">[[member]]</div>
                            <paper-item on-tap="removeMemberTapped">Remove as a member</paper-item>
                          </template>

                          <template is="dom-if" if="[[!$isAdmin(member.idOnServer, organization.userList)]]">
                            <div hidden="">[[member]]</div>
                            <paper-item on-tap="makeAdminTapped">Make Admin</paper-item>
                          </template>

                          <template is="dom-if" if="[[$isAdmin(member.idOnServer, organization.userList)]]">
                            <template is="dom-if" if="[[!$equals(member.idOnServer, user.idOnServer)]]">
                              <div hidden="">[[member]]</div>
                              <paper-item on-tap="makeRegularUserTapped">Convert to Regular User</paper-item>
                            </template>
                          </template>

                          <paper-item on-tap="showDialogForSetRole">Set Role</paper-item>

                        </paper-menu>
                      </paper-menu-button>

                    </paper-item>
                  </template>

                </paper-listbox>

              </div>
            </template>
          </paper-card>

          <paper-card class="organization-info-cards" heading="Add A Member">
            <div class="card-content">
              <div class="info-row horizontal layout center">
                <paper-input class="flex" always-float-label="" value="{{memberOrganizationSearchString}}" label="Name/Region/Address of the organization"></paper-input>
                <paper-button raised="" on-tap="searchMemberOrganizationTapped">Search</paper-button>
              </div>
            </div>
            <template is="dom-if" if="[[memberSearchResultList.length]]">
              <div class="p-0">
                <paper-listbox>

                  <template id="assistant-list-repeater" is="dom-repeat" items="[[memberSearchResultList]]" as="member">
                    <paper-item class="custom layout horizontal center">

                      <div class="flex m-left-8">
                        <div class="type body capitalize">[[member.name]]</div>
                        <!-- <div class="type caption secondary">[[member.idOnServer]]</div> -->
                      </div>

                      <div class="layout horizontal m-horizontal-4 wrap">
                        <div class="type caption">[[member.email]]&nbsp;</div>
                        <div class="type caption">([[member.phone]])</div>
                      </div>

                      <paper-menu-button horizontal-align="right" no-animations="">
                        <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content">
                          <div hidden="">[[member]]</div>
                          <paper-item on-tap="addMemberTapped">Add as a member</paper-item>



                        </paper-menu>
                      </paper-menu-button>

                    </paper-item>
                  </template>

                </paper-listbox>

              </div>
            </template>
          </paper-card>

          <!-- Add Role - start -->
          <paper-card heading="Add Role(s)" class="organization-info-cards">
            <paper-listbox>
              <template id="role-list-repeater" is="dom-repeat" items="[[roleList]]" as="role">
                <paper-item class="custom layout horizontal center">
                  <div class="flex">
                    <div class="type body" style="text-transform: capitalize;">{{role.title}}</div>
                    <template is="dom-repeat" items="[[role.privilegeList]]">

                      <span class="type caption secondary">{{item.name}}, </span>
                    </template>
                  </div>
                  <paper-icon-button icon="create" on-tap="showEditRoleDialog"></paper-icon-button>
                  <paper-icon-button style="color: red;" icon="delete" on-tap="removeRole"></paper-icon-button>
                </paper-item>

              </template>
            </paper-listbox>

            <div class="card-actions">
              <paper-button class="colored" raised="" on-tap="showAddRoleDialog">Add New Role</paper-button>
            </div>

          </paper-card>
          <!-- Add Role - end -->

          <paper-card heading="Role-wise userlist" class="organization-info-cards">
            <!-- <paper-listbox>
              <template is="dom-repeat" items="[[memberListByRole]]" as="role">
                <paper-item class="custom layout horizontal center">
                  <div class="roleName-style-for-roleWise-userlist"><strong>[[role.type]]</strong>
                    ([[role.userList.length]])</div>
                </paper-item>
                <template is="dom-repeat" items="[[role.userList]]" as="user" index-as="entryIndex">
                  <div class="p-bottom-8">
                    <div class="p-left-16"><strong>[[_returnSerial(entryIndex)]]. [[user.name]]</strong></div>
                    <div class="padding-for-rolewise-userslist">Email: [[user.email]]</div>
                    <div class="padding-for-rolewise-userslist">Phone: [[user.phone]]</div>
                  </div>
                </template>
              </template>
            </paper-listbox> -->
            <template is="dom-repeat" items="[[memberListByRole]]" as="role">
              <paper-listbox>
                <paper-item class="custom layout horizontal center">
                  <div class="roleName-style-for-roleWise-userlist">
                    <strong>[[role.type]]</strong> ([[role.userList.length]])
                  </div>
                  <div class="flex"></div>
                  <paper-button raised="" class="btn btn-success" on-tap="toggleCollapseClicked">View</paper-button>
                </paper-item>

                <iron-collapse id="[[convertRoleNameToId(role.type)]]">
                  <template is="dom-repeat" items="[[role.userList]]" as="user" index-as="entryIndex">
                    <div class="p-bottom-8">
                      <div class="p-left-16">
                        <strong>[[_returnSerial(entryIndex)]].[[user.name]]</strong></div>
                      <div class="padding-for-rolewise-userslist">Email: [[user.email]]</div>
                      <div class="padding-for-rolewise-userslist">Phone: [[user.phone]]</div>
                    </div>
                  </template>
                </iron-collapse>
              </paper-listbox>
            </template>
          </paper-card>

          <!-- Dialog for - Add/Update Role - start -->
          <paper-dialog id="dialogAddRole">
            <div class="type body-lead" style="color: #5c4575;">
              <iron-icon icon="icons:check-circle" class="m-right-8 "></iron-icon>Add/Edit Role
            </div>

            <div>
              <paper-input label="Role Title" value="{{role.title}}"></paper-input>
            </div>

            

            <div class="type body-lead" style="color: #5c4575;">Privileged features:</div>

            <!-- <div class="type body">Pre Listed Roles:</div> -->

            <div class="horizontal layout wrap">
              <template is="dom-repeat" items="[[preListedRoles]]">
                <paper-button class="btn default" style="background-color: fafafa;" raised="" on-tap="_onPreListedRoleTap">{{item.title}}</paper-button>
              </template>
            </div>

            
            <paper-dialog-scrollable>
              
              <div class="horizontal layout wrap">
                <template is="dom-repeat" items="{{privilegeList}}">
                  <paper-checkbox id="{{item.serial}}" class="m-4" style="background-color: #E0F2F1; padding: 8px; border-radius: 4px; " checked="{{item.isSelected}}">{{item.name}}</paper-checkbox>
                </template>
              </div>

            </paper-dialog-scrollable>

            <div class="buttons m-top-16">
              <paper-button dialog-dismiss="">Cancel</paper-button>
              <template is="dom-if" if="[[!ROLE_EDIT_MODE]]">
                <paper-button class="colored" on-tap="addRole" autofocus="" raised="">Add</paper-button>
              </template>
              <template is="dom-if" if="[[ROLE_EDIT_MODE]]">
                <paper-button class="colored" on-click="editRole" autofocus="" raised="">Edit</paper-button>
              </template>
            </div>
          </paper-dialog>
          <!-- Dialog for - Add/Update Role - end -->

          <!-- Dialog for - Set Role For User- start -->
          <paper-dialog id="dialogSetRoleForUser">
            <div class="type body-lead" style="color: #5c4575;">Select Role</div>

            <div>
              <paper-radio-group selected="{{selectedRoleTypeForUser}}">
                <template is="dom-repeat" items="[[roleList]]">
                  <paper-radio-button name="{{item.type}}">{{item.title}}</paper-radio-button>
                </template>
              </paper-radio-group>
            </div>


            <div class="buttons m-top-16">
              <paper-button dialog-dismiss="">Cancel</paper-button>
              <paper-button class="colored" on-click="setRoleForUser" autofocus="" raised="">Set</paper-button>
            </div>
          </paper-dialog>
          <!-- Dialog for - Set Role For User - end -->

        </template>
        <!-- editing organization - end -->

      </div>

    </div>

  </template>
  <script>(function(){var e=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};Polymer({is:"page-organization-manage-users",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling],properties:{user:{type:Object,notify:!0,value:null},isOrganizationValid:{type:Boolean,notify:!0,value:!1},organization:{type:Object,notify:!0,value:null},memberSearchResultList:{type:Array,value:function(){return[]}},memberList:{type:Array,value:function(){return[]}},role:{type:Object,notify:!0,value:null},roleList:{type:Array,value:function(){return[]}},selectedRoleTypeForUser:{type:String,notify:!0,value:null},selectecMemberId:{type:String,notify:!0,value:null},selectedRoleIndex:{type:Number,notify:!0,value:null},departmentList:{type:Array,notify:!0,value:function(){return[]}},memberListByRole:{type:Array,value:function(){return[]}},privilegeList:{type:Array,value:function(){return[]},notify:!0},ROLE_EDIT_MODE:{type:Boolean,value:!1,notify:!0}},_loadUser:function(){var e;if(e=app.db.find("user"),1===e.length)return this.user=e[0]},arrowBackButtonPressed:function(e){return this.domHost.navigateToPreviousPage()},_notifyInvalidOrganization:function(){return this.isOrganizationValid=!1,this.domHost.showModalDialog("Invalid Organization Provided")},_loadPatientStayObject:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:e},this.callApi("/bdemr-organization-patient-stay-get-object",t,function(e){return function(t,i){var r,o;return i.hasError?e.domHost.showModalDialog(i.error.message):(r=i.data.patientStayObject.departmentList,o=i.data.patientStayObject.seatList,void e.set("departmentList",e._modifyList(r,o)))}}(this))},_modifyList:function(e,t){var i,r,o,a,n,s,l,d,u,g,h,c,m,p,f,v,y;if(u=[],e){for(r=0,n=e.length;r<n;r++){if(i=e[r],d={name:i.name,checked:!1},f=i.unitList,h=[],f){for(o=0,s=f.length;o<s;o++){if(p=f[o],g={name:p.name,checked:!1},y=p.wardList,m=[],y){for(a=0,l=y.length;a<l;a++)v=y[a],c={name:v.name,checked:!1,seatList:this._getSeatListForWard(v.name,t)},m.push(c);g.wardList=m}else g.wardList=m;h.push(g)}d.unitList=h}else d.unitList=h;u.push(d)}return u}return u},_getSeatListForWard:function(e,t){var i,r,o,a;if(o=[],t){for(i=0,r=t.length;i<r;i++)a=t[i],a.ward&&(a.checked=!1,o.push(a));return o}return o},onDeptSelect:function(e){var t,i,r,o,a,n,s,l,d,u,g,h,c,m,p,f;if(t=e.target.checked,m=e.model.dept,i=this.departmentList,f=m.unitList,c=[],t){if(f){for(o=0,d=f.length;o<d;o++)p=f[o],p.checked=!0,c.push(p);m.unitList=c}else m.unitList=c;for(a=n=0,u=i.length;n<u;a=++n)r=i[a],r.name===m.name&&(i[a]=m);return this.set("departmentList",[]),this.set("departmentList",i)}if(f){for(s=0,g=f.length;s<g;s++)p=f[s],p.checked=!1,c.push(p);m.unitList=c}else m.unitList=c;for(a=l=0,h=i.length;l<h;a=++l)r=i[a],r.name===m.name&&(i[a]=m);return this.set("departmentList",i)},navigatedIn:function(){var e;return this._loadUser(),e=this.domHost.getPageParams(),e.organization?(this._loadOrganization(e.organization),this._loadPatientStayObject(e.organization)):this._notifyInvalidOrganization()},navigatedOut:function(){return this.organization=null,this.isOrganizationValid=!1,this.memberSearchResultList=[],this.memberList=[]},searchMemberOrganizationTapped:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,searchString:this.memberOrganizationSearchString,overrideWithIdList:[]},this.callApi("/bdemr-organization-find-user",t,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):e.set("memberSearchResultList",i.data.matchingUserList)}}(this))},_loadOrganization:function(e){var t;return t={apiKey:this.user.apiKey,idList:[e]},this.callApi("/bdemr-organization-list-organizations-by-ids",t,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):1!==i.data.matchingOrganizationList.length?void e.domHost.showModalDialog("Invalid Organization"):(e.set("organization",i.data.matchingOrganizationList[0]),e.set("isOrganizationValid",!0),e._loadRoleList(i.data.matchingOrganizationList[0]),e._loadMemberList())}}(this))},_loadMemberList:function(){var e,t;return e={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,overrideWithIdList:function(){var e,i,r,o;for(r=this.organization.userList,o=[],e=0,i=r.length;e<i;e++)t=r[e],o.push(t.id);return o}.call(this),searchString:"N/A"},this.callApi("/bdemr-organization-find-user",e,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):(e.set("memberList",i.data.matchingUserList),e._getMemberListByRole(e.memberList,e.organization))}}(this))},addMemberTapped:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:i.idOnServer},this.callApi("/bdemr-organization-add-user",t,function(e){return function(t,r){var o;return r.hasError?e.domHost.showModalDialog(r.error.message):(e.domHost.showToast("User Added"),e.splice("memberSearchResultList",e.memberSearchResultList.indexOf(i),1),o=e.domHost.getPageParams(),e._loadOrganization(o.organization))}}(this))},removeMemberTapped:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:i.idOnServer},this.callApi("/bdemr-organization-remove-user",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Removed"),r=e.domHost.getPageParams(),e._loadOrganization(r.organization))}}(this))},$isAdmin:function(e,t){var i,r,o;for(i=0,r=t.length;i<r;i++)if(o=t[i],e===o.id)return o.isAdmin},_setUserPrivilege:function(e,t){var i;return i={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:e.idOnServer,shouldBeAdmin:t},this.callApi("/bdemr-organization-set-user-privilege",i,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Access Updated"),r=e.domHost.getPageParams(),e._loadOrganization(r.organization))}}(this))},makeAdminTapped:function(e){var t;return t=e.model.member,this._setUserPrivilege(t,!0)},makeRegularUserTapped:function(e){var t;return t=e.model.member,this._setUserPrivilege(t,!1)},_loadRoleList:function(e){"undefined"==typeof e.roleList?this.set("roleList",[]):this.set("roleList",this.organization.roleList)},_getPrivilegedFeatureList:function(e){var t;return t=[{serial:"U0001",name:"Summary Report",type:"summary-report",isSelected:!1},{serial:"U0002",name:"Visits Report",type:"uhcp-visits-report",isSelected:!1},{serial:"U0003",name:"Factory Member’s List",type:"factory-member-list",isSelected:!1},{serial:"U0004",name:'Factory Member’s List - Hide "Export" Button',type:"factory-member-list",isSelected:!1},{serial:"U0005",name:"Organization Manager",type:"organization-manager",isSelected:!1},{serial:"U0006",name:"Import/View Patient Profile",type:"patient-view-only-details",isSelected:!1},{serial:"U0007",name:"Create new Visit/Prescription",type:"create-new-visit",isSelected:!1},{serial:"U0008",name:"Patient Medicine",type:"patient-medicine",isSelected:!1},{serial:"U0009",name:"Patient Vitals",type:"patient-vitals",isSelected:!1},{serial:"U00010",name:"Visit History",type:"patient-visit-and-reports",isSelected:!1},{serial:"U00011",name:"Patient Invoice",type:"patient-invoice",isSelected:!1},{serial:"U00012",name:"Test results",type:"patient-invoice",isSelected:!1},{serial:"U00013",name:"Doctor Patients Notes",type:"doctor-patient-notes",isSelected:!1},{serial:"U00014",name:"Patient Gallery",type:"patient-gallery",isSelected:!1},{serial:"U00015",name:"Activity Log",type:"activity-log",isSelected:!1},{serial:"U00016",name:"Leave Info",type:"leave-info",isSelected:!1},{serial:"U00017",name:"Reports Manager",type:"reports-manager",isSelected:!1},{serial:"U00018",name:"Invoice Report",type:"invoice-report",isSelected:!1},{serial:"U00019",name:"Send Notification",type:"send-notification",isSelected:!1},{serial:"U00020",name:"Send Feedback",type:"send-feedback",isSelected:!1},{serial:"U00021",name:"App Settings",type:"app-settings",isSelected:!1},{serial:"U00023",name:"Patient Manager",type:"patient-manager",isSelected:!1},{serial:"U0024",name:"Patient Confirmed Diagnosis",type:"patient-confirmed-diagnosis",isSelected:!1}],this.set("privilegeList",t),e()},_makeNewRole:function(){return this.role={type:"",title:"",serial:null,privilegeList:[],userList:[]}},_makeRoleType:function(e){var t,i,r;return t=e.toString(),i=t.toLowerCase(),r=e.split(" ").join("-")},saveRole:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:e},this.callApi("/bdemr-organization-add-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Added!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization),e.$$("#dialogAddRole").close())}}(this))},_makePreListedRoles:function(){var e;return e=[{title:"Monitoring Role",serialList:["U0003","U00018","U0001","U0002","U0004"]},{title:"Doctor",serialList:["U00016","U0006","U0007","U0008","U0009","U00010","U00011","U00012","U00013","U00014","U00015","U00016","U00021","U00023"]},{title:"Data Entry Operator",serialList:["U00018","U00016","U0006","U00012","U00021","U00023"]},{title:"Employer",serialList:["U0003","U00018"]}],this.set("preListedRoles",e)},_onPreListedRoleTap:function(t){var i,r,o,a,n,s,l,d,u;for(u=t.model.index,d=this.preListedRoles[u],n=[],s=this.privilegeList,r=i=0,a=s.length;i<a;r=++i)o=s[r],l=o.serial,e.call(d.serialList,l)>=0?(o.isSelected=!0,this.$$("#"+o.serial).checked=!0):(o.isSelected=!1,this.$$("#"+o.serial).checked=!1),n.push(o);return this.privilegeList=n,this.set("role.title",d.title)},showAddRoleDialog:function(){return this.set("ROLE_EDIT_MODE",!1),this._getPrivilegedFeatureList(function(e){return function(){return e._makePreListedRoles(),e._makeNewRole(),e.$$("#dialogAddRole").toggle()}}(this))},filterPrivilegeList:function(){var e,t,i,r,o;for(o=[],r=this.privilegeList,e=0,i=r.length;e<i;e++)t=r[e],t.isSelected&&o.push(t);return o},addRole:function(){return""!==this.role.title&&(this.role.type=this.role.title,this.role.privilegeList=this.filterPrivilegeList(),this.role.serial=this.generateSerialForOrgRole(),this.saveRole(this.role)),this.domHost.showToast("Type Role Title!")},getSelectedRolePrevilizedList:function(t,i){var r,o,a,n,s,l,d,u;for(u=t.privilegeList.map(function(e){return function(e){return e.serial}}(this)),s=[],l=this.privilegeList,o=r=0,n=l.length;r<n;o=++r)a=l[o],d=a.serial,e.call(u,d)>=0&&(a.isSelected=!0),s.push(a);return this.privilegeList=s,this.set("role.title",t.title),this.set("role.type",t.type),i()},showEditRoleDialog:function(e){var t,i;return t=e.model.index,i=this.roleList[t],this._getPrivilegedFeatureList(function(e){return function(){return e._makePreListedRoles(),e._makeNewRole(),e.getSelectedRolePrevilizedList(i,function(){return e.$$("#dialogAddRole").toggle(),e.set("ROLE_EDIT_MODE",!0)})}}(this))},editRole:function(e){return""!==this.role.title&&(this.role.type=this.role.title,this.role.privilegeList=this.filterPrivilegeList(),this.role.serial=this.generateSerialForOrgRole(),this.updateRole(this.role)),this.domHost.showToast("Type Role Title!")},updateRole:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:e},this.callApi("/bdemr-organization-update-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Updated!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization),e.set("ROLE_EDIT_MODE",!1),e.$$("#dialogAddRole").close())}}(this))},showDialogForSetRole:function(e){var t,i;return t=e.model.member,this.set("selectecMemberId",t.idOnServer),i=this._getRoleTitleForUser(t.idOnServer),this.set("selectedRoleTypeForUser",i),this.$$("#dialogSetRoleForUser").toggle()},setRoleForUser:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:this.selectecMemberId,roleType:this.selectedRoleTypeForUser},this.callApi("/bdemr-organization-set-user-on-specific-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Role Added."),r=e.domHost.getPageParams(),e._loadOrganization(r.organization),e.$$("#dialogSetRoleForUser").close())}}(this))},removeRole:function(e){var t,i;return i=this.roleList[e.model.index],t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:i},this.callApi("/bdemr-organization-remove-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Removed!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization))}}(this))},_getRoleTitleForUser:function(e){var t,i,r,o,a,n,s,l,d;if(l="",!(this.roleList.length>0))return l;for(a=this.roleList,t=0,r=a.length;t<r;t++)for(s=a[t],n=s.userList,i=0,o=n.length;i<o;i++)if(d=n[i],d.id===e)return l=s.title},_getMemberListByRole:function(e,t){var i,r,o,a,n,s,l,d,u,g,h,c;for(u=Object.create(t),d=u.roleList,i=0,a=d.length;i<a;i++)for(g=d[i],h=g.userList,r=0,n=h.length;r<n;r++)for(c=h[r],o=0,s=e.length;o<s;o++)l=e[o],c.id===l.idOnServer&&Object.assign(c,l);return this.set("memberListByRole",d)},convertRoleNameToId:function(e){return e.toLowerCase().split(" ").join("")},toggleCollapseClicked:function(e){var t;return t=this.convertRoleNameToId(e.model.role.type),this.$$("#"+t).toggle()},_returnSerial:function(e){return e+1}})}).call(this);
//# sourceMappingURL=page-organization-manage-users.coffee-compiled.js.map</script>
</dom-module>