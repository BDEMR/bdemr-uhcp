<!-- style --><!-- behavior --><!-- custom-elements --><!-- element --><dom-module id="page-organization-manage-users">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      .limiting-container {
        margin-top: 10px;
      }

      .organization-info-card-counter {
        margin-top: 20px;
        margin-left: 20px;
        margin-right: 10px;
        color: #777777;
      }

      .organization-info-cards {
        @apply(--layout-vertical);
        /*@apply(--layout-center);*/
        margin-top: 10px;
        margin-left: 10px;
        margin-right: 10px;
        padding-bottom: 20px;
      }

      .organization-info-cards .row {
        margin-left: 10px;
        /*margin-right: 10px;*/
        margin-top: 10px;
      }

      .organization-info-cards .hr {
        margin-left: 20px;
        margin-right: 20px;
        height: 1px;
        /*width: 100px;*/
        background: #dddddd;
      }

      .organization-info-cards .row .modifier {
        font-size: 14px;
        background: #000000;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .organization-info-cards .row .modifier.online {
        background: #757575;
      }

      .organization-info-cards .row .modifier.local-only {
        background: #039BE5;
      }

      .organization-info-cards .row .modifier.locally-updated {
        background: #009688;
      }

      .organization-info-cards .row .modifier.imported {
        background: #4CAF50;
      }

      .info-row {
        margin-top: 10px;
      }

      .top-info-row {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      .serial-number {
        background: #37474F;
        color: #ffffff;
        margin-left: 5px;
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 4px;
        padding-right: 4px;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: bold;
      }

      .address1 {
        margin-right: 10px;
      }

      .break-on-tablet {
        @apply(--layout-horizontal);
      }

      @media screen and (max-width: 740px) {
        .break-on-tablet {
          display: block;
        }
      }

      .val {
        text-decoration: underline;
      }

      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        color: var(--brand-primary-color);
      }
    </style>

    <!-- local DOM -->

    <div class="master-container">

      <div class="limiting-container">

        <template is="dom-if" if="{{!isOrganizationValid}}">
          Organization invalid
        </template>

        <!-- editing organization - start -->
        <template is="dom-if" if="{{isOrganizationValid}}">

          <div class="organization-info-card-counter">
            <div>Basic Information</div>
          </div>

          <paper-card class="organization-info-cards">
            <div class="card-content">
              <div class="info-row">
                <span class="type bold headline">[[organization.name]]</span>
              </div>
              <div class="horizontal layout center top-info-row">
                <span class="type caption bg-gray">[[organization.idOnServer]]</span>
              </div>

              <div class="info-row">
                <div>Region: [[organization.effectiveRegion]]</div>
              </div>
              <div class="info-row">
                <div>Address: [[organization.address]]</div>
              </div>
            </div>
          </paper-card>

          <div class="organization-info-card-counter">
            <div>Member Organizations</div>
          </div>

          <paper-card class="organization-info-cards">

            <div class="card-custom-header">
              <div class="layout horizontal center">
                <div class="title flex">Currently there are [[memberList.length]] members in this organization.</div>
              </div>
            </div>

            <template is="dom-if" if="[[memberList.length]]">
              <div class="p-0">
                <paper-listbox>

                  <template id="assistant-list-repeater" is="dom-repeat" items="[[memberList]]" as="member">
                    <paper-item class="custom layout horizontal center">

                      <div class="flex m-left-8">

                        <div class="type body capitalize">[[member.name]]
                          <template is="dom-if" if="[[$equals(member.idOnServer, user.idOnServer)]]">
                            (You)
                          </template>
                          <template is="dom-if" if="[[$isAdmin(member.idOnServer, organization.userList)]]">
                            <span class="type caption uppercase bg-success">
                              <iron-icon icon="done" class="icon small-tiny"></iron-icon>
                              Admin</span>
                          </template>
                          <template is="dom-if" if="[[!$isAdmin(member.idOnServer, organization.userList)]]">
                            <span class="type caption uppercase bg-gray">Member</span>
                          </template>
                        </div>

                        <div class="type caption secondary">
                          <strong>Role:</strong> {{_getRoleTitleForUser(member.idOnServer)}}
                        </div>

                      </div>

                      <div class="layout horizontal m-horizontal-4 wrap">
                        <div class="type caption">[[member.email]]&nbsp;</div>
                        <div class="type caption">([[member.phone]])</div>
                      </div>

                      <paper-menu-button horizontal-align="right" no-animations="">
                        <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content">
                          <template is="dom-if" if="[[!$equals(member.idOnServer, user.idOnServer)]]">
                            <div hidden="">[[member]]</div>
                            <paper-item on-tap="removeMemberTapped">Remove as a member</paper-item>
                          </template>

                          <template is="dom-if" if="[[!$isAdmin(member.idOnServer, organization.userList)]]">
                            <div hidden="">[[member]]</div>
                            <paper-item on-tap="makeAdminTapped">Make Admin</paper-item>
                          </template>

                          <template is="dom-if" if="[[$isAdmin(member.idOnServer, organization.userList)]]">
                            <template is="dom-if" if="[[!$equals(member.idOnServer, user.idOnServer)]]">
                              <div hidden="">[[member]]</div>
                              <paper-item on-tap="makeRegularUserTapped">Convert to Regular User</paper-item>
                            </template>
                          </template>

                          <paper-item on-tap="showDialogForSetRole">Set Role</paper-item>

                        </paper-menu>
                      </paper-menu-button>

                    </paper-item>
                  </template>

                </paper-listbox>

              </div>
            </template>
          </paper-card>

          <!-- Add Member Start -->
          <paper-card class="organization-info-cards" heading="Add A Member">
            <div class="card-content">
              <div class="info-row horizontal layout center">
                <paper-input class="flex" always-float-label="" value="{{memberOrganizationSearchString}}" label="Name/Phone/Email"></paper-input>
                <paper-button raised="" on-tap="searchMemberOrganizationTapped">Search</paper-button>
              </div>
            </div>
            <template is="dom-if" if="[[memberSearchResultList.length]]">
              <div class="p-0">
                <paper-listbox>

                  <template id="assistant-list-repeater" is="dom-repeat" items="[[memberSearchResultList]]" as="member">
                    <paper-item class="custom layout horizontal center">

                      <div class="flex m-left-8">
                        <div class="type body capitalize">[[member.name]]</div>
                        <!-- <div class="type caption secondary">[[member.idOnServer]]</div> -->
                      </div>

                      <div class="layout horizontal m-horizontal-4 wrap">
                        <div class="type caption">[[member.email]]&nbsp;</div>
                        <div class="type caption">([[member.phone]])</div>
                      </div>

                      <paper-menu-button horizontal-align="right" no-animations="">
                        <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                        <paper-menu class="dropdown-content">
                          <div hidden="">[[member]]</div>
                          <paper-item on-tap="addMemberTapped">Add as a member</paper-item>



                        </paper-menu>
                      </paper-menu-button>

                    </paper-item>
                  </template>

                </paper-listbox>

              </div>
            </template>
          </paper-card>
          <!-- Add Member End -->

          <!-- Add Role - start -->
          <paper-card heading="Add Role(s)" class="organization-info-cards">
            <paper-listbox>
              <template id="role-list-repeater" is="dom-repeat" items="[[roleList]]" as="role">
                <paper-item class="custom layout horizontal center">
                  <div class="flex">
                    <div class="type body" style="text-transform: capitalize;">{{role.title}}</div>
                    <template is="dom-repeat" items="[[role.privilegeList]]">

                      <span class="type caption secondary">{{item.name}}, </span>
                    </template>
                  </div>
                  <!-- <paper-icon-button icon="create" on-tap="showEditRoleDialog"></paper-icon-button> -->
                  <paper-icon-button style="color: red;" icon="delete" on-tap="removeRole"></paper-icon-button>
                </paper-item>

              </template>
            </paper-listbox>

            <div class="card-actions">
              <paper-button class="colored" raised="" on-tap="showAddRoleDialog">Add New Role</paper-button>
            </div>

          </paper-card>
          <!-- Add Role - end -->

          <!-- Dialog for - Add Role - start -->
          <paper-dialog id="dialogAddRole">
            <h2 class="type body-lead" style="color: #5c4575;">
              <iron-icon icon="icons:check-circle" class="m-right-8 "></iron-icon>Add Role
            </h2>

            <div>
              <paper-input label="Role Title" required="" value="{{role.title}}"></paper-input>
            </div>

            <paper-dialog-scrollable>

              <div class="type body" style="color: #5c4575;">Select Privilege:</div>
              <div class="horizontal layout wrap">
                <template is="dom-repeat" items="[[privilegeList]]">
                  <paper-checkbox class="m-8" checked="{{item.isSelected}}">{{item.name}}</paper-checkbox>
                </template>
              </div>

            </paper-dialog-scrollable>

            <div class="buttons m-top-16">
              <paper-button dialog-dismiss="">Cancel</paper-button>
              <paper-button class="colored" on-tap="addRole" autofocus="" raised="">Add</paper-button>
            </div>
          </paper-dialog>
          <!-- Dialog for - Add Role - end -->

          <!-- Dialog for - Edit Role - start -->
          <paper-dialog id="dialogEditRole">
            <div class="type body-lead" style="color: #5c4575;">
              <iron-icon icon="icons:check-circle" class="m-right-8 "></iron-icon>Edit Role
            </div>

            <div>
              <paper-input label="Role Title" value="{{role.title}}"></paper-input>
            </div>

            <div class="type body" style="color: #5c4575;">Selected Privilege:</div>
            <div class="horizontal layout wrap">
              <template is="dom-repeat" items="[[role.privilegeList]]">
                <paper-checkbox class="m-horizontal-4" checked="{{item.isSelected}}">{{item.name}}</paper-checkbox>
              </template>
            </div>
            <div class="buttons m-top-16">
              <paper-button dialog-dismiss="">Cancel</paper-button>
              <paper-button class="colored" on-click="editRole" autofocus="" raised="">Edit</paper-button>
            </div>
          </paper-dialog>
          <!-- Dialog for - Edit Role - end -->

          <!-- Dialog for - Set Role For User- start -->
          <paper-dialog id="dialogSetRoleForUser">
            <div class="type body-lead" style="color: #5c4575;">Select Role</div>

            <div>
              <paper-radio-group selected="{{selectedRoleTypeForUser}}">
                <template is="dom-repeat" items="[[roleList]]">
                  <paper-radio-button name="{{item.type}}">{{item.title}}</paper-radio-button>
                </template>
              </paper-radio-group>
            </div>


            <div class="buttons m-top-16">
              <paper-button dialog-dismiss="">Cancel</paper-button>
              <paper-button class="colored" on-click="setRoleForUser" autofocus="" raised="">Set</paper-button>
            </div>
          </paper-dialog>
          <!-- Dialog for - Set Role For User - end -->

        </template>
        <!-- editing organization - end -->

      </div>

    </div>

  </template>
  <script>(function(){Polymer({is:"page-organization-manage-users",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.translating,app.behaviors.pageLike,app.behaviors.apiCalling],properties:{user:{type:Object,notify:!0,value:null},isOrganizationValid:{type:Boolean,notify:!0,value:!1},organization:{type:Object,notify:!0,value:null},memberSearchResultList:{type:Array,value:function(){return[]}},memberList:{type:Array,value:function(){return[]}},matchingPatientList:{type:Array,value:function(){return[]}},role:{type:Object,notify:!0,value:null},roleList:{type:Array,value:function(){return[]}},selectedRoleTypeForUser:{type:String,notify:!0,value:null},selectecMemberId:{type:String,notify:!0,value:null},selectedRoleIndex:{type:Number,notify:!0,value:null},departmentList:{type:Array,notify:!0,value:function(){return[]}}},_loadUser:function(){var e;if(e=app.db.find("user"),1===e.length)return this.user=e[0]},arrowBackButtonPressed:function(e){return this.domHost.navigateToPreviousPage()},_notifyInvalidOrganization:function(){return this.isOrganizationValid=!1,this.domHost.showModalDialog("Invalid Organization Provided")},_loadPatientStayObject:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:e},this.callApi("/bdemr-organization-patient-stay-get-object",t,function(e){return function(t,i){var r,a;return i.hasError?e.domHost.showModalDialog(i.error.message):(r=i.data.patientStayObject.departmentList,a=i.data.patientStayObject.seatList,void e.set("departmentList",e._modifyList(r,a)))}}(this))},_modifyList:function(e,t){var i,r,a,o,n,s,l,d,u,g,h,m,c,p,f,v,y;if(u=[],e){for(r=0,n=e.length;r<n;r++){if(i=e[r],d={name:i.name,checked:!1},f=i.unitList,h=[],f){for(a=0,s=f.length;a<s;a++){if(p=f[a],g={name:p.name,checked:!1},y=p.wardList,c=[],y){for(o=0,l=y.length;o<l;o++)v=y[o],m={name:v.name,checked:!1,seatList:this._getSeatListForWard(v.name,t)},c.push(m);g.wardList=c}else g.wardList=c;h.push(g)}d.unitList=h}else d.unitList=h;u.push(d)}return u}return u},_getSeatListForWard:function(e,t){var i,r,a,o;if(a=[],t){for(i=0,r=t.length;i<r;i++)o=t[i],o.ward&&(o.checked=!1,a.push(o));return a}return a},onDeptSelect:function(e){var t,i,r,a,o,n,s,l,d,u,g,h,m,c,p,f;if(t=e.target.checked,c=e.model.dept,i=this.departmentList,f=c.unitList,m=[],t){if(f){for(a=0,d=f.length;a<d;a++)p=f[a],p.checked=!0,m.push(p);c.unitList=m}else c.unitList=m;for(o=n=0,u=i.length;n<u;o=++n)r=i[o],r.name===c.name&&(i[o]=c);return this.set("departmentList",[]),this.set("departmentList",i)}if(f){for(s=0,g=f.length;s<g;s++)p=f[s],p.checked=!1,m.push(p);c.unitList=m}else c.unitList=m;for(o=l=0,h=i.length;l<h;o=++l)r=i[o],r.name===c.name&&(i[o]=c);return this.set("departmentList",i)},navigatedIn:function(){var e;return this._loadUser(),this._makePrivilegeList(),e=this.domHost.getPageParams(),e.organization?(this._loadOrganization(e.organization),this._loadPatientStayObject(e.organization)):this._notifyInvalidOrganization()},navigatedOut:function(){return this.organization=null,this.isOrganizationValid=!1,this.memberSearchResultList=[],this.memberList=[]},searchMemberOrganizationTapped:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,searchString:this.memberOrganizationSearchString,overrideWithIdList:[]},this.callApi("/bdemr-organization-find-user",t,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):e.set("memberSearchResultList",i.data.matchingUserList)}}(this))},_loadOrganization:function(e){var t;return t={apiKey:this.user.apiKey,idList:[e]},this.callApi("/bdemr-organization-list-organizations-by-ids",t,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):1!==i.data.matchingOrganizationList.length?void e.domHost.showModalDialog("Invalid Organization"):(e.set("organization",i.data.matchingOrganizationList[0]),e.set("isOrganizationValid",!0),e._loadRoleList(i.data.matchingOrganizationList[0]),e._loadMemberList())}}(this))},_loadMemberList:function(){var e,t;return e={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,overrideWithIdList:function(){var e,i,r,a;for(r=this.organization.userList,a=[],e=0,i=r.length;e<i;e++)t=r[e],a.push(t.id);return a}.call(this),searchString:"N/A"},this.callApi("/bdemr-organization-find-user",e,function(e){return function(t,i){return i.hasError?e.domHost.showModalDialog(i.error.message):e.set("memberList",i.data.matchingUserList)}}(this))},addMemberTapped:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:i.idOnServer},this.callApi("/bdemr-organization-add-user",t,function(e){return function(t,r){var a;return r.hasError?e.domHost.showModalDialog(r.error.message):(e.domHost.showToast("User Added"),e.splice("memberSearchResultList",e.memberSearchResultList.indexOf(i),1),a=e.domHost.getPageParams(),e._loadOrganization(a.organization))}}(this))},removeMemberTapped:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:i.idOnServer},this.callApi("/bdemr-organization-remove-user",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Removed"),r=e.domHost.getPageParams(),e._loadOrganization(r.organization))}}(this))},$isAdmin:function(e,t){var i,r,a;for(i=0,r=t.length;i<r;i++)if(a=t[i],e===a.id)return a.isAdmin},_setUserPrivilege:function(e,t){var i;return i={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:e.idOnServer,shouldBeAdmin:t},this.callApi("/bdemr-organization-set-user-privilege",i,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Access Updated"),r=e.domHost.getPageParams(),e._loadOrganization(r.organization))}}(this))},makeAdminTapped:function(e){var t;return t=e.model.member,this._setUserPrivilege(t,!0)},makeRegularUserTapped:function(e){var t;return t=e.model.member,this._setUserPrivilege(t,!1)},_loadRoleList:function(e){"undefined"==typeof e.roleList?this.set("roleList",[]):this.set("roleList",this.organization.roleList)},_makePrivilegeList:function(){return this.privilegeList=[{serial:"D001",type:"manage-patient",name:"Patient Manager",isSelected:!1},{serial:"D002",type:"manage-reports",name:"Report Manger",isSelected:!1},{serial:"D004",type:"medicine-dispension",name:"Medicine Dispension",isSelected:!1},{serial:"D005",type:"assistant-manager",name:"Assistant Manager",isSelected:!1},{serial:"D006",type:"search-records",name:"Records Manager",isSelected:!1},{serial:"D010",type:"manage-organization",name:"Organization Manger",isSelected:!1},{serial:"D011",type:"send-notification",name:"Send Notification",isSelected:!1},{serial:"D012",type:"send-feedback",name:"Send Feedback",isSelected:!1},{serial:"D013",name:"Create Patient Visit Record",type:"create-visit-record",isSelected:!1},{serial:"D014",name:"Patient Details",type:"patient-details",isSelected:!1},{serial:"D016",name:"Invoice Report",type:"report",isSelected:!1},{serial:"D017",name:"Manage Pending Invoice",type:"invoice",isSelected:!1},{serial:"D022",name:"Patient Leave Info",type:"Patient Leave",isSelected:!1},{serial:"D023",name:"Patient Policy Info",type:"billing-report",isSelected:!1},{serial:"R001",name:"Summary Report",type:"report",isSelected:!1},{serial:"R002",name:"All Visit Report",type:"report",isSelected:!1}]},_makeNewRole:function(){return this.role={type:"",title:"",serial:null,privilegeList:[],userList:[]}},_makeRoleType:function(e){var t,i,r;return t=e.toString(),i=t.toLowerCase(),r=e.split(" ").join("-")},saveRole:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:e},this.callApi("/bdemr-organization-add-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Added!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization),e.$$("#dialogAddRole").close())}}(this))},showAddRoleDialog:function(){return this.$$("#dialogAddRole").toggle(),this._makeNewRole()},filterPrivilegeList:function(){var e,t,i,r,a;for(a=[],r=this.privilegeList,e=0,i=r.length;e<i;e++)t=r[e],t.isSelected&&a.push(t);return a},addRole:function(){return""!==this.role.title&&(this.role.type=this.role.title,this.role.privilegeList=this.filterPrivilegeList(),this.role.serial=this.generateSerialForOrgRole(),this.saveRole(this.role)),this.domHost.showToast("Type Role Title!")},showEditRoleDialog:function(e){var t;return t=e.model.index,this.role=this.roleList[t],this.$$("#dialogEditRole").toggle()},editRole:function(e){if(""!==this.role.title)return this.role.type=this.role.title,this.updateRole(this.role)},updateRole:function(e){var t;return t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:e},this.callApi("/bdemr-organization-update-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Updated!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization),e.$$("#dialogEditRole").close())}}(this))},showDialogForSetRole:function(e){var t,i;return t=e.model.member,this.set("selectecMemberId",t.idOnServer),i=this._getRoleTitleForUser(t.idOnServer),this.set("selectedRoleTypeForUser",i),this.$$("#dialogSetRoleForUser").toggle()},setRoleForUser:function(e){var t,i;return i=e.model.member,t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,targetUserId:this.selectecMemberId,roleType:this.selectedRoleTypeForUser},this.callApi("/bdemr-organization-set-user-on-specific-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("User Role Added."),r=e.domHost.getPageParams(),e._loadOrganization(r.organization),e.$$("#dialogSetRoleForUser").close())}}(this))},removeRole:function(e){var t,i;return i=this.roleList[e.model.index],t={apiKey:this.user.apiKey,organizationId:this.organization.idOnServer,roleObject:i},this.callApi("/bdemr-organization-remove-role",t,function(e){return function(t,i){var r;return i.hasError?e.domHost.showModalDialog(i.error.message):(e.domHost.showToast("Role Removed!"),r=e.domHost.getPageParams(),e._makeNewRole(),e._loadOrganization(r.organization))}}(this))},_getRoleTitleForUser:function(e){var t,i,r,a,o,n,s,l,d;if(l="",!(this.roleList.length>0))return l;for(o=this.roleList,t=0,r=o.length;t<r;t++)for(s=o[t],n=s.userList,i=0,a=n.length;i<a;i++)if(d=n[i],d.id===e)return l=s.title}})}).call(this);
//# sourceMappingURL=page-organization-manage-users.coffee-compiled.js.map</script>
</dom-module>