<!-- style --><!-- behavior --><dom-module id="page-test-blood-sugar-editor">
  <template>
    <style is="custom-style" include="common-style">
      paper-dropdown-menu {
        width: 100%;
      }
      .limiting-container {
        margin-top: 10px;
      }
    </style>

    <div class="master-container">

      <div class="limiting-container">

        <paper-card>

          <div class="card-content">
            <div class="form-group">

              <div><vaadin-date-picker label="Date" value="{{bloodSugar.createdDatetimeStamp}}" max="{{currentDate}}"></vaadin-date-picker></div>

              <div>
                <paper-dropdown-menu label="[[$TRANSLATE('Time',LANG)]]">
                  <paper-menu class="dropdown-content" selected="{{bloodSugarTimeSelectedIndex}}">
                    <paper-item>[[$TRANSLATE('Before Meal (Fasting)',LANG)]]</paper-item>
                    <paper-item>[[$TRANSLATE('After Meal (2 hour)',LANG)]]</paper-item>
                    <paper-item>[[$TRANSLATE('Random',LANG)]]</paper-item>
                  </paper-menu>
                </paper-dropdown-menu>
              </div>

              <div>
                <paper-input label="Value" min="0" auto-validate="" type="number" value="{{bloodSugar.data.value}}" error-message="Valid Input Required"></paper-input>
              </div>

              <div>
                <paper-dropdown-menu label="[[$TRANSLATE('Unit',LANG)]]">
                  <paper-menu class="dropdown-content" selected="{{bloodSugarUnitSelectedIndex}}">
                    <paper-item>[[$TRANSLATE('mmol/L',LANG)]]</paper-item>
                    <paper-item>[[$TRANSLATE('mg/dl',LANG)]]</paper-item>
                  </paper-menu>
                </paper-dropdown-menu>
              </div>

            </div>
          </div>

          <div class="card-actions">
            <template is="dom-if" if="[[isThatNewTest]]">
              <paper-button class="" on-tap="cancelButtonClicked">Cancel</paper-button>
              <paper-button class="colored" raised="" on-tap="addBloodSugarButtonClicked">Add</paper-button>
            </template>
            <template is="dom-if" if="[[!isThatNewTest]]">
              <paper-button class="btn btn-success" on-click="updateBloodSugarPressed" raised="">Update</paper-button>
            </template>

          </div>
        </paper-card>

      </div>
    </div>

  </template>
  <script>(function(){Polymer({is:"page-test-blood-sugar-editor",behaviors:[app.behaviors.commonComputes,app.behaviors.dbUsing,app.behaviors.pageLike,app.behaviors.translating],properties:{user:{type:Object,notify:!0,value:null},patient:{type:Object,notify:!0,value:{}},isPatientValid:{type:Boolean,notify:!1,value:!0},isThatNewTest:{type:Boolean,notify:!1,value:!0},bloodSugarUnitSelectedIndex:{type:Number,value:0,notify:!0},bloodSugarTimeSelectedIndex:{type:Number,value:0,notify:!0},bloodSugar:{type:Object,notify:!0,value:{}},bloodSugarTimeType:{type:Array,value:function(){return["before-meal","after-meal","random"]}},currentDate:{type:String,value:function(){return lib.datetime.mkDate(new Date)}}},_loadUser:function(){var t;if(t=app.db.find("user"),1===t.length)return this.user=t[0]},_loadPatient:function(t){var e;return e=app.db.find("patient-list",function(e){var a;return a=e.serial,a===t}),1===e.length?(this.isPatientValid=!0,this.patient=e[0]):this._notifyInvalidPatient()},_makeBloodSugar:function(){return this.bloodSugar={createdByUserSerial:this.user.serial,patientSerial:this.patient.serial,createdDatetimeStamp:lib.datetime.mkDate(),lastModifiedDatetimeStamp:0,lastSyncedDatetimeStamp:0,data:{type:"",value:null,unit:null}}},_isEmptyString:function(t){return null===t||"undefined"===t||""===t},_loadBloodSugar:function(t){var e;if(e=app.db.find("patient-test-blood-sugar",function(e){var a;return a=e.serial,a===t}),1===e.length){switch(this.isTestValid=!0,this.bloodSugar=e[0],this.bloodSugar.data.type){case"before-meal":this.bloodSugarTimeSelectedIndex=0;break;case"after-meal":this.bloodSugarTimeSelectedIndex=1;break;case"random":this.bloodSugarTimeSelectedIndex=2}return!0}return this._notifyInvalidTest(),!1},updateBloodSugarPressed:function(t){if(this.bloodSugar.data.value||this.domHost.showToast("Please Enter Data"),this.bloodSugar.data.type||this.bloodSugar.data.value||this.bloodSugar.data.unit)return 0===this.bloodSugarUnitSelectedIndex&&this.set("bloodSugar.data.unit","mmol/L"),1===this.bloodSugarUnitSelectedIndex&&this.set("bloodSugar.data.unit","mg/dl"),this.set("bloodSugar.lastModifiedDatetimeStamp",lib.datetime.now()),this._saveBloodSugar(this.bloodSugar),this.domHost.showToast("Updated Successfully!"),this.arrowBackButtonPressed()},cancelButtonClicked:function(t){return this.arrowBackButtonPressed()},arrowBackButtonPressed:function(t){return window.history.back()},_notifyInvalidTest:function(){return this.isTestValid=!1,this.domHost.showModalDialog("Invalid Test Provided")},_saveBloodSugar:function(t){return app.db.upsert("patient-test-blood-sugar",t,function(e){return function(e){var a;return a=e.serial,t.serial===a}}(this))},addBloodSugarButtonClicked:function(){return this.bloodSugar.data.type=this.bloodSugarTimeType[this.bloodSugarTimeSelectedIndex],this.bloodSugar.data.value>=1?(this.set("bloodSugar.lastModifiedDatetimeStamp",lib.datetime.now()),this.set("bloodSugar.serial",this.generateSerialForVitals("BS")),this.bloodSugar.createdDatetimeStamp=+new Date(this.bloodSugar.createdDatetimeStamp),this.bloodSugar.data.value=parseInt(this.bloodSugar.data.value),0===this.bloodSugarUnitSelectedIndex&&this.set("bloodSugar.data.unit","mmol/L"),1===this.bloodSugarUnitSelectedIndex&&this.set("bloodSugar.data.unit","mg/dl"),this._saveBloodSugar(this.bloodSugar),this.domHost.showToast("Added Successfully"),this._makeBloodSugar(),this.arrowBackButtonPressed()):void this.domHost.showToast("Please Input correct value")},navigatedIn:function(){var t,e;return t=this.getCurrentOrganization(),t||this.domHost.navigateToPage("#/select-organization"),e=this.domHost.getPageParams(),this._loadUser(),this._loadPatient(e.patient),e.test?"new"===e.test?(this.isThatNewTest=!0,this._makeBloodSugar()):(this.isThatNewTest=!1,this._loadBloodSugar(e.test)):void this._notifyInvalidTest()},navigatedOut:function(){return this.user={},this.patient={},this.isTestValid=!1,this.isPatientValid=!1}})}).call(this);
//# sourceMappingURL=page-test-blood-sugar-editor.coffee-compiled.js.map</script>
</dom-module>

