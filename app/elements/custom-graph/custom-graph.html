<!-- iron-* --><!-- paper-* --><!-- style --><!-- element --><dom-module id="custom-graph">
  <template>

    <!-- style -->

    <style is="custom-style" include="common-style">
      #canvas {
        width: 100%;
        cursor: crosshair;
        width: 850px;
        height: 576px;
      }

      .top-container {
        margin: 10px;
        overflow-x: auto;
      }

      paper-button {
        background: white;
        min-width: 0px;
        /*padding: 0px;*/
        /*margin: 0px;*/
      }

      paper-button[disabled] {
        background: #dddddd;
      }

      .card-custom-header {
        padding: 15px;
        border-bottom: 1px solid var(--paper-grey-200);
        background-color: var(--paper-grey-50);
      }

      .card-custom-header .title {
        font-size: 20px;
        font-weight: 500;
        line-height: 28px;
        text-align: left;
        color: var(--brand-primary-color);
      }

      paper-icon-button {
        color: var(--brand-primary-color);
      }

      iron-icon {
        margin-right: 8px; color: var(--brand-primary-color);
      }
    </style>
    <!-- local DOM - start -->

    <div class="card-custom-header layout horizontal  center end-justified">
      <iron-icon icon="icons:assessment"></iron-icon>
      <div class="title flex">Graph</div>
      <paper-icon-button icon="chevron-left" on-tap="leftChevronPressed"></paper-icon-button>
      <div hidden="">

        <!-- upper row - start -->
        <div class="horizontal layout wrap">
          <template is="dom-repeat" items="[[pointDefinitionKeyList]]" as="pointDefinitionKey">
            <template is="dom-if" if="[[$shouldShowButtonOnUI(pointDefinition, pointDefinitionKey)]]">
              <paper-button disabled="[[$isDefinitionSelected(pointDefinitionKey, selectedPointDefinitionKey)]]" on-tap="pointDefinitionSwitchPressed">
                <template is="dom-if" if="[[$isMoveButton(pointDefinition, pointDefinitionKey)]]">
                  <iron-icon icon="open-with"></iron-icon>
                </template>
                <template is="dom-if" if="[[$isDeleteButton(pointDefinition, pointDefinitionKey)]]">
                  <iron-icon icon="delete"></iron-icon>
                </template>
                <template is="dom-if" if="[[$isNormalButton(pointDefinition, pointDefinitionKey)]]">
                  [[$getLabel(pointDefinition, pointDefinitionKey)]]
                </template>
              </paper-button>
            </template>
          </template>
        </div>
        <!-- upper row - end -->

        <!-- lower row - start -->
        <div class="horizontal layout center wrap">
          <paper-dropdown-menu-light label="Set Patient Position">
            <paper-listbox class="dropdown-content" selected="{{patientPositionSelectedIndex}}" on-iron-select="patientPositionSelected">
              <template is="dom-repeat" items="[[patientPositionList]]" as="possiblePosition">
                <paper-item data-value="[[possiblePosition]]">[[possiblePosition]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu-light>
          <div class="flex"></div>
          <paper-checkbox checked="{{isExpressDeleteEnabled}}">Express Delete</paper-checkbox>
          &nbsp;
          <paper-checkbox checked="{{isAutoInsertEnabled}}">Auto Insert</paper-checkbox>
        </div>
        <!-- lower row - end -->

      </div>
      <paper-icon-button icon="chevron-right" on-tap="rightChevronPressed"></paper-icon-button>

    </div>

    <div class="top-container">
      <div style="text-align: center;">
        <canvas style="text-align: center;" id="canvas" width="1024" height="576" on-mousemove="canvasMouseMoved" on-click="canvasClicked"></canvas>
      </div>

      <br>
      <br>

      <paper-textarea hidden="" label="Insert comments here" value="[[additionalData.comments]]" on-change="commentChanged"></paper-textarea>

      <!-- local DOM - end -->
  </div></template>
  <script>(function(){Polymer({is:"custom-graph",$keys:function(t){return Object.keys(t)},$of:function(t,e){return t[e]},$shouldShowButtonOnUI:function(t,e){return t[e].showButtonOnUI},$getLabel:function(t,e){return e},$isDefinitionSelected:function(t,e){return t===e},$isMoveButton:function(t,e){return"special"in t[e]&&"move"===t[e].special},$isDeleteButton:function(t,e){return"special"in t[e]&&"delete"===t[e].special},$isNormalButton:function(t,e){return!("special"in t[e])},toImageUrl:function(){return this.$.canvas.toDataURL()},_clipRawLocalCoords:function(t,e){var i,s,a,n;return s=29,i=29,a=s+this.xIntervalGapWidthPx*this.xIntervalLineCount,n=i+this.yIntervalGapWidthPx*this.yIntervalLineCount,e=this.flip(e),t=s<t&&t<a?t-s:NaN,e=i<e&&e<n?e-i:NaN,[t,e]},_translateToLocalCoords:function(t,e){var i,s,a,n,o,h,r,l;return i=this.$.canvas,h=i.getBoundingClientRect(),a=i.width,s=i.height,r=a/i.offsetWidth,l=s/i.offsetHeight,n=t,o=e,n-=h.left,o-=h.top,n=n,o=o,n=Math.floor(n*r),o=Math.floor(o*l),[n,o]},_unclipAndTranslateToPx:function(t,e){var i,s,a,n,o,h,r,l,m;return s=29,i=29,a=s+this.xIntervalGapWidthPx*this.xIntervalLineCount,n=i+this.yIntervalGapWidthPx*this.yIntervalLineCount,t+=s,e+=i,e=this.flip(e),o=this.$.canvas,r=o.width,h=o.height,l=r/o.offsetWidth,m=h/o.offsetHeight,t/=l,e/=m,[t,e]},properties:{shouldRender:{type:Boolean,value:!1},isLive:{type:Boolean,value:!0},isPrintOnly:{type:Boolean,value:!1},isAutoInsertEnabled:{type:Boolean,notify:!0,value:!1},isExpressDeleteEnabled:{type:Boolean,notify:!0,value:!1},clockDatetimeStamp:{type:Number,value:0},startDatetimeStamp:{type:Number,value:0},startOffsetDatetimeStamp:{type:Number,value:0},endDatetimeStamp:{type:Number,value:0},endOffsetDatetimeStamp:{type:Number,value:0},pointList:{type:Array},patientPositionList:{type:Array,value:function(){return["Supine","Lithotomy","Prone","Beach Chair","Trendelenberg","R Trendelenberg","Rt Lateral","Lt Lateral","Fracture Table"]}},pointDefinitionKeyList:{type:Array,value:function(){return["Move","Marker","BPS","BPD","BPM","CVP","Pulse","Vapor","Position","Delete","Anaesthesia Start","Anaesthesia End","Surgery Start","Surgery End"]}},pointDefinition:{type:Object,value:function(){return{Move:{special:"move",shape:"box",fillStyle:"rgba(0,255,0, 0.3)",showLines:!1,autoInsert:!1,boxLength:5,showButtonOnUI:!0},Delete:{special:"delete",shape:"box",fillStyle:"rgba(0,255,0, 0.3)",showLines:!1,autoInsert:!1,boxLength:5,showButtonOnUI:!0},Marker:{shape:"box",fillStyle:"rgba(0,255,0, 0.3)",showLines:!1,autoInsert:!1,boxLength:5,showButtonOnUI:!0},"Anaesthesia Start":{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!1,imageSource:"assets/img/graph-a-start.png",imageObject:null,imageYOrigin:"bottom",preventDelete:!0,showButtonOnUI:!0},"Anaesthesia End":{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!1,imageSource:"assets/img/graph-a-end.png",imageObject:null,imageYOrigin:"bottom",preventDelete:!1,showButtonOnUI:!0},"Surgery Start":{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!1,imageSource:"assets/img/graph-s-start.png",imageObject:null,imageYOrigin:"bottom",preventDelete:!1,showButtonOnUI:!0},"Surgery End":{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!1,imageSource:"assets/img/graph-s-end.png",imageObject:null,imageYOrigin:"bottom",preventDelete:!1,showButtonOnUI:!0},BPS:{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!0,imageSource:"assets/img/graph-bps.png",imageObject:null,imageYOrigin:"center",showButtonOnUI:!0},BPD:{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!0,imageSource:"assets/img/graph-bpd.png",imageObject:null,imageYOrigin:"center",showButtonOnUI:!0},BPM:{shape:"image",fillStyle:"rgb(255,0,0)",showLines:!1,autoInsert:!0,imageSource:"assets/img/graph-bpd.png",imageObject:null,imageYOrigin:"center",showButtonOnUI:!0},CVP:{shape:"circle",fillStyle:"rgb(0,255,0)",showLines:!0,autoInsert:!0,showButtonOnUI:!0},Pulse:{shape:"circle",fillStyle:"rgb(0,0,255)",showLines:!0,autoInsert:!0,showButtonOnUI:!0},Vapor:{shape:"circle",fillStyle:"rgb(255,255,0)",showLines:!0,autoInsert:!0,showButtonOnUI:!0},Position:{shape:"Position",fillStyle:"#7e2e84",showLines:!1,autoInsert:!1,showButtonOnUI:!0}}}},commonOffsetPx:{type:Number,value:30},leftOffsetPx:{type:Number,value:30},bottomOffsetPx:{type:Number,value:30},labels:{type:Object,value:{xAxis:"Time",yAxis:"Magnitude"}},colors:{type:Object,value:{background:"rgb(255,255,255)",axis:"rgb(0,0,0)",text:"rgb(0,0,0)",interval:"rgb(0,127,0)",primaryInterval:"rgb(0,127,0)",primaryHardInterval:"rgb(0,127,0)",currentTimeLine:"rgb(255,0,0)",boundingCircle:"rgb(255, 0, 0)",boundingCircleMove:"rgb(255, 0, 255)",boundingCircleDelete:"rgb(255, 0, 0)"}},xIntervalLineCount:{type:Number,value:36},xPrimaryIntervalLineDivisor:{type:Number,value:3},xPrimaryHardIntervalLineDivisor:{type:Number,value:12},yIntervalLineCount:{type:Number,value:15},yPrimaryIntervalLineDivisor:{type:Number,value:3},yAxisMinValue:{type:Number,value:0},yAxisMaxValue:{type:Number,value:300},xAxisTemporalStepSizeInMinutes:{type:Number,value:5},widthPx:{type:Number,value:1024},heightPx:{type:Number,value:576},selectedPointDefinitionKey:{type:String,value:"Move"},patientPositionSelectedIndex:{type:Number,value:0},xIntervalLineStart:{type:Number,value:0},xIntervalGapWidthPx:{type:Number,value:null},yIntervalGapWidthPx:{type:Number,value:null},xIntervalTopLabelList:{type:Array,value:function(){return[]}},yIntervalLabelList:{type:Array,value:function(){return[]}},xMousePositionPx:{type:Number,value:0},yMousePositionPx:{type:Number,value:0},framesPerSecond:{type:Number,value:0},lastFramesPerSecond:{type:Number,value:0},lastDatetimeStamp:{type:Number,value:0}},setPointList:function(t){return this.pointList=t},_computeEndOffsetDatetimeStamp:function(){var t;return t=new Date(this.startOffsetDatetimeStamp),t.setHours(3+t.getHours()),this.endOffsetDatetimeStamp=t.getTime()},computeExternalOptions:function(){var t,e,i,s,a,n,o,h,r,l,m,u,c,p;for(this.startDatetimeStamp||(this.startDatetimeStamp=lib.datetime.now()),this.startOffsetDatetimeStamp||(this.startOffsetDatetimeStamp=this.startDatetimeStamp),this.endDatetimeStamp||(e=new Date(this.startOffsetDatetimeStamp),e.setHours(3+e.getHours()),this.endDatetimeStamp=e.getTime()),this.endOffsetDatetimeStamp||this._computeEndOffsetDatetimeStamp(),this.clockDatetimeStamp||(this.clockDatetimeStamp=lib.datetime.now()),i=(this.endDatetimeStamp-this.startDatetimeStamp)/60/1e3,c=this.xAxisTemporalStepSizeInMinutes,u=i/this.xAxisTemporalStepSizeInMinutes,n=[],m=s=0,r=u;0<=r?s<=r:s>=r;m=0<=r?++s:--s)m%this.xPrimaryIntervalLineDivisor===0?(t=new Date(this.startDatetimeStamp),t.setMinutes(t.getMinutes()+m*c),n.push(lib.datetime.format(t,"mm-dd"))):n.push(null);for(this.xIntervalTopLabelList=n,h=this.yAxisMinValue,o=this.yAxisMaxValue,u=this.yIntervalLineCount,c=(o-h)/u,n=[],m=a=0,l=u;0<=l?a<=l:a>=l;m=0<=l?++a:--a)p=o<this.yIntervalLineCount?Math.round(m*c*10)/10:Math.ceil(m*c),n.push(p);return this.yIntervalLabelList=n},computeInternalOptions:function(){return this.xIntervalGapWidthPx=Math.floor((this.widthPx-this.commonOffsetPx-this.leftOffsetPx)/this.xIntervalLineCount),this.yIntervalGapWidthPx=Math.floor((this.heightPx-this.commonOffsetPx-this.bottomOffsetPx)/this.yIntervalLineCount)},setTimeRange:function(t,e){if(e-t<108e5&&(e=t+108e5),this.startDatetimeStamp=t,this.endDatetimeStamp=e,this.startOffsetDatetimeStamp=t,this._computeEndOffsetDatetimeStamp(),this.ctx)return this.computeExternalOptions()},setCurrentTime:function(t){return this.clockDatetimeStamp=t},ready:function(){return this.ctx=this.$.canvas.getContext("2d"),this.computeExternalOptions(),this.computeInternalOptions(),this.shouldRender=!0,this._loadImagesAndLoop()},detached:function(){return this.shouldRender=!1},_loadImagesAndLoop:function(){var t,e,i,s,a;s=0,e=0,i=this.pointDefinition;for(t in i)a=i[t],"image"===a.shape&&(s+=1,a.imageObject=new Image,a.imageObject.addEventListener("load",function(t){return function(i){if(e+=1,e===s)return window.requestAnimationFrame(function(){return t.loop()})}}(this),!1),a.imageObject.src=a.imageSource);if(0===s)return window.requestAnimationFrame(function(t){return function(){return t.loop()}}(this))},flip:function(t){return this.heightPx-t},setPostLoopCallback:function(t){return this.postLoopCallback=t},loop:function(){var t;if(this.draw(),this.postLoopCallback&&(this.postLoopCallback(),this.postLoopCallback=null),this.isLive)return null===this.lastDatetimeStamp?this.lastDatetimeStamp=(new Date).getTime():(t=(new Date).getTime(),t-this.lastDatetimeStamp>1e3?(this.lastFramesPerSecond=this.framesPerSecond,this.framesPerSecond=0,this.lastDatetimeStamp=t):this.framesPerSecond+=1),window.requestAnimationFrame(function(t){return function(){return t.loop()}}(this))},draw:function(){var t,e,i,s,a,n,o,h,r,l,m,u,c,p,f,x,d,g,P,S,y,b,v,O,I,D,L,T,A,k,M;for(this.ctx.font="14px Roboto",this.ctx.fillStyle=this.colors.background,this.ctx.fillRect(0,0,this.widthPx,this.heightPx),this.ctx.font="12px Roboto",m=isNaN(this.xMousePositionPx)||isNaN(this.yMousePositionPx)?"Outside":this.xMousePositionPx+"x"+this.yMousePositionPx,m+=" FPS: "+this.lastFramesPerSecond,this.ctx.textAlign="right",this.ctx.fillStyle=this.colors.text,this.ctx.fillText(m,this.widthPx-10,this.flip(this.heightPx-20)),this.ctx.font="14px Roboto",this.ctx.strokeStyle=this.colors.axis,this.ctx.beginPath(),this.ctx.moveTo(this.leftOffsetPx,this.flip(this.bottomOffsetPx)),this.ctx.lineTo(this.widthPx-this.commonOffsetPx,this.flip(this.bottomOffsetPx)),this.ctx.stroke(),this.ctx.strokeStyle=this.colors.axis,this.ctx.beginPath(),this.ctx.moveTo(this.leftOffsetPx,this.flip(this.bottomOffsetPx)),this.ctx.lineTo(this.leftOffsetPx,this.commonOffsetPx),this.ctx.stroke(),this.ctx.textAlign="center",this.ctx.fillStyle=this.colors.text,this.ctx.fillText(this.labels.xAxis,this.widthPx/2,this.heightPx-10),this.ctx.save(),this.ctx.textAlign="center",this.ctx.translate(this.widthPx-10,this.heightPx/2),this.ctx.rotate(-Math.PI/2),this.ctx.fillStyle=this.colors.text,this.ctx.fillText(this.labels.yAxis,0,0),this.ctx.restore(),f=this.yIntervalGapWidthPx*this.yIntervalLineCount,h=o=0,g=this.xIntervalLineCount;0<=g?o<=g:o>=g;h=0<=g?++o:--o)h%this.xPrimaryHardIntervalLineDivisor===0?(this.ctx.globalAlpha=1,this.ctx.strokeStyle=this.colors.primaryHardInterval):h%this.xPrimaryIntervalLineDivisor===0?(this.ctx.globalAlpha=.6,this.ctx.strokeStyle=this.colors.primaryInterval):(this.ctx.globalAlpha=.3,this.ctx.strokeStyle=this.colors.interval),this.ctx.beginPath(),this.ctx.moveTo(this.leftOffsetPx+h*this.xIntervalGapWidthPx,this.flip(this.bottomOffsetPx)),this.ctx.lineTo(this.leftOffsetPx+h*this.xIntervalGapWidthPx,this.flip(f+this.bottomOffsetPx)),this.ctx.stroke(),this.ctx.globalAlpha=1,m=this.xIntervalTopLabelList[h+this.xIntervalLineStart],m&&h!==this.xIntervalLineCount&&(this.ctx.textAlign="left",this.ctx.fillStyle=this.colors.text,t=this.leftOffsetPx+h*this.xIntervalGapWidthPx+3,i=this.flip(f+this.bottomOffsetPx+3),t=this.leftOffsetPx+h*this.xIntervalGapWidthPx,i=this.flip(f+this.bottomOffsetPx),d=2,this.ctx.beginPath(),this.ctx.arc(t,i,d,0,2*Math.PI,!1),this.ctx.strokeStyle=this.colors.text,this.ctx.stroke());for(f=this.yIntervalGapWidthPx*this.yIntervalLineCount,this.startOffsetDatetimeStamp<=(P=this.clockDatetimeStamp)&&P<this.endOffsetDatetimeStamp&&(a=(this.clockDatetimeStamp-this.startOffsetDatetimeStamp)/60/1e3,L=5,D=a,this.ctx.strokeStyle=this.colors.currentTimeLine,this.ctx.beginPath(),this.ctx.moveTo(this.leftOffsetPx+D*this.xIntervalGapWidthPx/5,this.flip(this.bottomOffsetPx)),this.ctx.lineTo(this.leftOffsetPx+D*this.xIntervalGapWidthPx/5,this.flip(f+this.bottomOffsetPx)),this.ctx.stroke()),f=this.xIntervalGapWidthPx*this.xIntervalLineCount,h=r=0,S=this.yIntervalLineCount;0<=S?r<=S:r>=S;h=0<=S?++r:--r)h%this.yPrimaryIntervalLineDivisor===0?(this.ctx.globalAlpha=.6,this.ctx.strokeStyle=this.colors.primaryInterval):(this.ctx.globalAlpha=.3,this.ctx.strokeStyle=this.colors.interval),this.ctx.beginPath(),this.ctx.moveTo(this.bottomOffsetPx,this.flip(this.bottomOffsetPx+h*this.yIntervalGapWidthPx)),this.ctx.lineTo(f+this.bottomOffsetPx,this.flip(this.bottomOffsetPx+h*this.yIntervalGapWidthPx)),this.ctx.stroke(),this.ctx.globalAlpha=1,m=this.yIntervalLabelList[h],this.ctx.textAlign="left",this.ctx.fillStyle=this.colors.text,t=f+this.bottomOffsetPx+2,i=this.flip(this.bottomOffsetPx+h*this.yIntervalGapWidthPx+2),this.ctx.fillText(m,t,i),this.ctx.textAlign="right",this.ctx.fillStyle=this.colors.text,t=this.bottomOffsetPx-4,i=this.flip(this.bottomOffsetPx+h*this.yIntervalGapWidthPx+2),this.ctx.fillText(m,t,i);for(c={},y=this.pointList||[],l=0,p=y.length;l<p;l++)x=y[l],this.startDatetimeStamp<=(b=x.datetimeStamp+this.startDatetimeStamp)&&b<=this.endDatetimeStamp&&this.startOffsetDatetimeStamp<=(v=x.datetimeStamp+this.startDatetimeStamp)&&v<=this.endOffsetDatetimeStamp&&(k=this._timeToX(x.datetimeStamp-(this.startOffsetDatetimeStamp-this.startDatetimeStamp)),M=this._magnitudeToY(x.magnitude),x.key in c||(c[x.key]=null),u=c[x.key],O=this._unclipAndTranslateToPx(k,M),t=O[0],i=O[1],T=this.pointDefinition[x.key],this.ctx.fillStyle=T.fillStyle,"circle"===T.shape?(d=6,this.ctx.beginPath(),this.ctx.arc(t,i,d,0,2*Math.PI,!1),this.ctx.fill()):"box"===T.shape?(A=5*T.boxLength+1,n=4*T.boxLength,k=t,M=i,this.ctx.fillRect(k,M,A,n)):"image"===T.shape?(e=t-T.imageObject.width/2,s=i,"bottom"===T.imageYOrigin&&(s-=T.imageObject.height),"center"===T.imageYOrigin&&(s-=T.imageObject.height/2),this.ctx.drawImage(T.imageObject,e,s)):"Position"===T.shape&&(d=3,this.ctx.beginPath(),this.ctx.arc(t,i,d,0,2*Math.PI,!1),this.ctx.fillStyle=T.fillStyle,this.ctx.fill(),k=t+10,M=i-6,this.ctx.save(),this.ctx.textAlign="left",this.ctx.translate(k,M),this.ctx.rotate(-Math.PI/2),this.ctx.fillStyle=T.fillStyle,this.ctx.fillText(x.extraDataObject.text,0,0),this.ctx.restore()),T.showLines&&null!==u&&(this.ctx.beginPath(),this.ctx.strokeStyle=T.fillStyle,this.ctx.moveTo.apply(this.ctx,this._unclipAndTranslateToPx(this._timeToX(u.datetimeStamp-(this.startOffsetDatetimeStamp-this.startDatetimeStamp)),this._magnitudeToY(u.magnitude))),this.ctx.lineTo.apply(this.ctx,this._unclipAndTranslateToPx(this._timeToX(x.datetimeStamp-(this.startOffsetDatetimeStamp-this.startDatetimeStamp)),this._magnitudeToY(x.magnitude))),this.ctx.stroke()),c[x.key]=x,"Move"===this.selectedPointDefinitionKey&&this.activelySelectedPoint&&x.datetimeStamp===this.activelySelectedPoint.datetimeStamp&&x.magnitude===this.activelySelectedPoint.magnitude&&(d=7,this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.arc(t,i,d,0,2*Math.PI,!1),this.ctx.strokeStyle=this.colors.text,this.ctx.stroke(),d=9,this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.arc(t,i,d,0,2*Math.PI,!1),this.ctx.strokeStyle=this.colors.text,this.ctx.stroke(),this.ctx.globalAlpha=1));if(I=this._unclipAndTranslateToPx(this.xMousePositionPx,this.yMousePositionPx),t=I[0],i=I[1],"Move"===this.selectedPointDefinitionKey?(d=10,this.ctx.globalAlpha=.2,this.ctx.beginPath(),this.ctx.arc(t,i+1,d,0,2*Math.PI,!1),this.ctx.fillStyle=this.colors.boundingCircleMove,this.ctx.fill(),this.ctx.globalAlpha=1):"Delete"===this.selectedPointDefinitionKey?(d=10,this.ctx.globalAlpha=.2,this.ctx.beginPath(),this.ctx.arc(t,i+1,d,0,2*Math.PI,!1),this.ctx.fillStyle=this.colors.boundingCircleDelete,this.ctx.fill(),this.ctx.globalAlpha=1):(d=7,this.ctx.globalAlpha=.4,this.ctx.beginPath(),this.ctx.arc(t,i+1,d,0,2*Math.PI,!1),this.ctx.strokeStyle=this.colors.boundingCircle,this.ctx.stroke(),this.ctx.globalAlpha=1),this.isAutoInsertEnabled&&this.autoInsertAnchor)return this.ctx.beginPath(),this.ctx.moveTo.apply(this.ctx,this._unclipAndTranslateToPx(this._timeToX(this.autoInsertAnchor.datetimeStamp),this._magnitudeToY(this.autoInsertAnchor.magnitude))),this.ctx.lineTo.apply(this.ctx,this._unclipAndTranslateToPx(this.xMousePositionPx,this.yMousePositionPx)),this.ctx.stroke()},pointDefinitionSwitchPressed:function(t){return this.selectedPointDefinitionKey=t.model.pointDefinitionKey},_updateCoordinates:function(t){var e,i,s,a,n;return e=this._translateToLocalCoords(t.x,t.y),a=e[0],n=e[1],i=this._clipRawLocalCoords(a,n),a=i[0],n=i[1],s=[a,n],this.xMousePositionPx=s[0],this.yMousePositionPx=s[1],s},canvasMouseMoved:function(t){var e;if(this._updateCoordinates(t),this.isExpressDeleteEnabled&&"Delete"===this.selectedPointDefinitionKey&&(e=this._getPointWithinRadius(this.xMousePositionPx,this.yMousePositionPx,10)))return this._removePoint(e)},_magnitudeToY:function(t){var e,i,s,a;return e=this.yAxisMaxValue-this.yAxisMinValue,i=this.yIntervalGapWidthPx*this.yIntervalLineCount,s=e/i,a=t/s},_timeToX:function(t){var e,i,s;return t=t,t=t/60/1e3,e=5,i=t/e,s=i*this.xIntervalGapWidthPx},_xToTime:function(t){var e,i,s;return s=Math.round(t/this.xIntervalGapWidthPx),i=5,e=s*i,e=this.startOffsetDatetimeStamp-this.startDatetimeStamp+60*e*1e3},_yToMagnitude:function(t){var e,i,s,a;return e=this.yAxisMaxValue-this.yAxisMinValue,i=this.yIntervalGapWidthPx*this.yIntervalLineCount,s=e/i,a=t*s},_pushOrSplicePoint:function(t){var e,i,s,a,n,o;for(s=null,o=this.pointList,e=0,i=o.length;e<i;e++)if(a=o[e],a.key===t.key&&a.datetimeStamp===t.datetimeStamp){s=a;break}return s?(s.magnitude=t.magnitude,this._notifyPointUpdate()):(n=lib.util.deepCopy(this.pointList),n.push(t),n.sort(function(t,e){return t.datetimeStamp<e.datetimeStamp?-1:t.datetimeStamp>e.datetimeStamp?1:0}),this.pointList=n,this._notifyPointUpdate())},_addChainOfPoints:function(t,e){var i,s,a,n,o,h,r,l,m;for(m=3e5,i=e.datetimeStamp-t.datetimeStamp,r=i/m,h=(e.magnitude-t.magnitude)/r,o=[],l=s=0,n=r;0<=n?s<=n:s>=n;l=0<=n?++s:--s)a=lib.util.deepCopy(t),a.datetimeStamp+=m*l,a.magnitude=a.magnitude+h*l,o.push(this._pushOrSplicePoint(a));return o},_addPointFromUserInteraction:function(t,e,i,s,a){var n,o,h,r;return null==a&&(a={}),"Position"===i&&(r=this.selectedPatientPosition||"No Position",a.text=r),h=this._preparePointToAdd(t,e,i,s,a),this.isAutoInsertEnabled?this.autoInsertAnchor?(n=this.autoInsertAnchor,o=h,this._addChainOfPoints(n,o),this.autoInsertAnchor=null):this.autoInsertAnchor=h:(this.autoInsertAnchor=null,this._pushOrSplicePoint(h))},_getPointWithinRadius:function(t,e,i){var s,a,n,o,h,r,l;for(h=this.pointList,s=0,n=h.length;s<n;s++)if(o=h[s],r=this._timeToX(o.datetimeStamp),l=this._magnitudeToY(o.magnitude),a=Math.sqrt((t-r)*(t-r)+(e-l)*(e-l))<i)return o;return null},_preparePointToAdd:function(t,e,i,s,a){var n,o,h;null==a&&(a={}),h={datetimeStamp:this._xToTime(t),magnitude:this._yToMagnitude(e),key:i,extraDataObject:{}};for(n in a)o=a[n],h.extraDataObject[n]=o;return h},_removePoint:function(t){var e,i,s,a,n,o;for(n=this.pointList,o=[],i=e=0,s=n.length;e<s;i=++e){if(a=n[i],a.key===t.key&&a.datetimeStamp===t.datetimeStamp&&a.magnitude===t.magnitude){this.pointList.splice(i,1),this._notifyPointUpdate();break}o.push(void 0)}return o},canvasClicked:function(t){},leftChevronPressed:function(t){var e;if(e=this.startOffsetDatetimeStamp-72e5,e<this.startDatetimeStamp?(this.startDatetimeStamp=e,this.startOffsetDatetimeStamp=e,this.computeExternalOptions(),this.startTimeOutOfBoundCallback&&this.startTimeOutOfBoundCallback(this.startDatetimeStamp)):(this.startOffsetDatetimeStamp=e,this._computeEndOffsetDatetimeStamp()),this.xIntervalLineStart-=24,this.xIntervalLineStart<0)return this.xIntervalLineStart=0},rightChevronPressed:function(t){var e;return e=this.startOffsetDatetimeStamp+72e5,this.startOffsetDatetimeStamp=e,this._computeEndOffsetDatetimeStamp(),this.endOffsetDatetimeStamp>this.endDatetimeStamp?(this.endDatetimeStamp=this.endOffsetDatetimeStamp,this.computeExternalOptions(),this.endTimeOutOfBoundCallback&&this.endTimeOutOfBoundCallback(this.endDatetimeStamp)):this._computeEndOffsetDatetimeStamp(),this.xIntervalLineStart+=24},shiftRightThreeHours:function(){var t;return t=this.startOffsetDatetimeStamp+108e5,this.startOffsetDatetimeStamp=t,this._computeEndOffsetDatetimeStamp(),this.endOffsetDatetimeStamp>this.endDatetimeStamp?(this.endDatetimeStamp=this.endOffsetDatetimeStamp,this.computeExternalOptions(),this.endTimeOutOfBoundCallback&&this.endTimeOutOfBoundCallback(this.endDatetimeStamp)):this._computeEndOffsetDatetimeStamp(),this.xIntervalLineStart+=24},patientPositionSelected:function(t){return this.selectedPatientPosition=t.detail.item.innerText,this.selectedPatientPosition=this.selectedPatientPosition.replace(/\\n/g,""),this.selectedPatientPosition=this.selectedPatientPosition.replace(/^\s+|\s+$/g,"")},_notifyPointUpdate:function(){return this.pointListUpdateCallback&&this.pointListUpdateCallback(this.pointList),this.domHost.domHost.domHost.addActivityLog("Graph Point","add",{patientSerial:this.domHost.domHost.record.patientSerial})},setAdditionalData:function(t){return this.additionalData=t},commentChanged:function(t){return this.additionalData.comments=t.target.value}})}).call(this);
//# sourceMappingURL=custom-graph.coffee-compiled.js.map</script>
</dom-module>