{"version":3,"sources":["lib.coffee","lib.js"],"names":["Collector","Condition","DatabaseEngine","Iterator","Notifier","asyncIf","dateFormat","delay","iterate","ref","setImmediate","indexOf","item","i","l","this","length","hasProp","hasOwnProperty","slice","window","lib","datetime","now","Date","getTime","format","templates","masks","mkDate","dateObj","date","mkTime","time","mkDatetime","diff","dateObj1","dateObj2","time1","time2","makeRelativeTimeString","Math","round","unique","array","j","len","newArray","call","push","reverse","results","_onceCalledFnList","deepCopy","deepValue","shallowCopy","obj","key","temp","constructor","findDeepValue","val","Obj","prop","result","Array","Object","callOnlyOnce","fn","util","replaceAll","str0","str1","str2","ignore","replace","RegExp","replaceLast","haystack","needle","replacementNeedle","newHaystack","pos","lastIndexOf","substring","substr","string","ISO_8601_FULL","stringify","value","JSON","parse","valueOfKey","test","json","compress","stringValue","pako","deflate","to","decompress","inflate","compression","hash","str","sjcl","codec","base64","fromBits","sha256","encrypt","passPhrase","data","decrypt","sjclEncryptedObject","security","setItem","localStorage","getItem","removeItem","clear","hasItem","sessionStorage","tabStorage","memory","memStorage","callBdemrPostApi","request","serializeAndUrlEncode","params","pairs","proc","object","prefix","el","results1","encodeURIComponent","join","url","method","cbfn","xhr","XMLHttpRequest","open","addEventListener","response","send","api","version","app","config","masterApiVersion","charAt","serverHost","__meta","clientIdentifier","clientName","clientVersion","clientPlatform","error","target","responseText","ensureBaseNetworkDelay","thatTime","args","arguments","options","baseNetworkDelay","apply","network","debug"],"mappings":"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","file":"lib.coffee-compiled.js","sourcesContent":["\r\n### =======================================\r\n# lib.\r\n    datetime.\r\n      now\r\n      format\r\n      templates.\r\n        date\r\n        time\r\n        datetime\r\n      mkDate\r\n      mkTime\r\n      mkDatetime\r\n      diff\r\n      makeRelativeTimeString\r\n    array.\r\n      unique\r\n      reverse\r\n    util.\r\n      Collector\r\n      Iterator\r\n      iterate\r\n      Condition\r\n      asyncIf\r\n      delay\r\n      Notifier\r\n      setImmediate\r\n      shallowCopy\r\n      deepCopy\r\n      findDeepValue\r\n      shallowMerge - TODO\r\n      callOnlyOnce - FIXME\r\n    string.\r\n      replaceAll\r\n      replaceLast\r\n    json.\r\n      stringify\r\n      parse\r\n    compression.\r\n      compress\r\n      decompress\r\n    security.\r\n      hash\r\n      encrypt\r\n      decrypt\r\n    localStorage.\r\n      setItem\r\n      getItem\r\n      removeItem\r\n      clear\r\n      hasItem\r\n    tabStorage.\r\n      setItem\r\n      getItem\r\n      removeItem\r\n      clear\r\n      hasItem\r\n    memStorage.\r\n      setItem\r\n      getItem\r\n      removeItem\r\n      clear\r\n      hasItem\r\n    database.\r\n      DatabaseEngine\r\n    network.\r\n      serializeAndUrlEncode\r\n      request\r\n      callBdemrPostApi * [dependent on app.config]\r\n      ensureBaseNetworkDelay * [dependent on app.config]\r\n    debug\r\n\r\n  \r\n# \r\n======================================= ###\r\n\r\nwindow.lib = {}\r\n\r\n###\r\n  @datetime\r\n###\r\n\r\n{ dateFormat } = window['date-format-library']\r\n\r\nlib.datetime = {}\r\n\r\nlib.datetime.now = -> (new Date).getTime()\r\n\r\nlib.datetime.format = dateFormat\r\n\r\nlib.datetime.templates = dateFormat.masks\r\nlib.datetime.templates['date'] = 'yyyy-mm-dd'\r\nlib.datetime.templates['time'] = 'HH:MM:ss'\r\nlib.datetime.templates['datetime'] = 'yyyy-mm-dd HH:MM:ss'\r\n\r\nlib.datetime.mkDate = (dateObj)-> dateFormat dateObj, lib.datetime.templates.date\r\n\r\nlib.datetime.mkTime = (dateObj)-> dateFormat dateObj, lib.datetime.templates.time\r\n\r\nlib.datetime.mkDatetime = (dateObj, masks)-> dateFormat dateObj, (if masks then masks else lib.datetime.templates.datetime)\r\n\r\nlib.datetime.diff = (dateObj1, dateObj2)-> \r\n  time1 = if dateObj1 then dateObj1.getTime() else 0\r\n  time2 = if dateObj2 then dateObj2.getTime() else 0\r\n  diff = time1 - time2\r\n  return diff\r\n\r\nlib.datetime.makeRelativeTimeString = (diff)->\r\n  diff = Math.round (diff / 1000)\r\n  if diff < 60\r\n    return \"around #{diff} seconds ago\"\r\n  else if diff < 90\r\n    return \"around a minute ago\"\r\n  else\r\n    diff = Math.round (diff / 60)\r\n    if diff < 60\r\n      return \"around #{diff} minutes ago\"\r\n    else\r\n      diff = Math.round (diff / 60)\r\n      return \"around #{diff} hours ago\"\r\n\r\n###\r\n  @array\r\n###\r\n\r\n(->\r\n\r\n  @unique = (array)->\r\n    newArray = []\r\n    for item in array\r\n      unless item in newArray\r\n        newArray.push item\r\n    return newArray\r\n\r\n  @reverse = (array)->\r\n    newArray = (item for item in array)\r\n    newArray.reverse()\r\n    return newArray\r\n\r\n).call (lib.array = {})\r\n\r\n\r\n###\r\n  @util\r\n###\r\n\r\n{ Collector, Iterator, iterate, Condition, asyncIf, delay, Notifier, setImmediate } = window['evolvenode-stdlib']\r\n\r\n(->\r\n  @Collector = Collector\r\n  @Iterator = Iterator\r\n  @iterate = iterate\r\n  @Condition = Condition\r\n  @asyncIf = asyncIf\r\n  @delay = delay\r\n  @Notifier = Notifier\r\n  @setImmediate = setImmediate\r\n\r\n  @shallowCopy = (obj)->\r\n    return obj  if obj is null or typeof (obj) isnt \"object\"\r\n    temp = new obj.constructor()\r\n    for key of obj\r\n      temp[key] = obj[key]\r\n    return temp\r\n\r\n  @deepCopy = deepCopy = (obj)->\r\n    return obj  if obj is null or typeof (obj) isnt \"object\"\r\n    temp = new obj.constructor()\r\n    for key of obj\r\n      temp[key] = deepCopy (obj[key])\r\n    return temp\r\n\r\n  @findDeepValue = deepValue = (val, Obj) ->\r\n    result = null\r\n    if Obj instanceof Array\r\n      i = 0\r\n      while i < Obj.length\r\n        result = deepValue(val, Obj[i])\r\n        if result\r\n          break\r\n        i++\r\n    else\r\n      for prop of Obj\r\n        if prop == val\r\n          return Obj[prop]\r\n        if Obj[prop] instanceof Object or Obj[prop] instanceof Array\r\n          result = deepValue(val, Obj[prop])\r\n          if result\r\n            break\r\n    return result\r\n  \r\n  _onceCalledFnList = []\r\n\r\n  @callOnlyOnce = (fn)->\r\n    unless fn in _onceCalledFnList\r\n      _onceCalledFnList.push fn\r\n      fn()\r\n\r\n).call (lib.util = {})\r\n\r\n###\r\n  @string\r\n###\r\n\r\n(->\r\n\r\n  @replaceAll = (str0, str1, str2, ignore)->\r\n    ## NOTE haystack, needle, replacementNeedle\r\n    str0.replace new RegExp(str1.replace(/([\\/\\,\\!\\\\\\^\\$\\{\\}\\[\\]\\(\\)\\.\\*\\+\\?\\|\\<\\>\\-\\&])/g, \"\\\\$&\"), ((if ignore then \"gi\" else \"g\"))), (if (typeof (str2) is \"string\") then str2.replace(/\\$/g, \"$$$$\") else str2)\r\n\r\n  @replaceLast = (haystack, needle, replacementNeedle)->\r\n    pos = haystack.lastIndexOf needle\r\n    return haystack if pos is -1\r\n    newHaystack = (haystack.substring 0, (pos)) + replacementNeedle + (haystack.substr (pos + needle.length))\r\n\r\n).call (lib.string = {})\r\n\r\n###\r\n  @json\r\n###\r\n\r\n(->\r\n\r\n  ISO_8601_FULL = /^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(\\.\\d+)?(([+-]\\d\\d:\\d\\d)|Z)?$/i\r\n\r\n  @stringify = (value)-> JSON.stringify value\r\n\r\n  @parse = (value)->\r\n    JSON.parse value, (key, valueOfKey)->\r\n      if typeof valueOfKey is 'string'\r\n        # console.log valueOfKey\r\n        if ISO_8601_FULL.test valueOfKey\r\n          return new Date valueOfKey\r\n      return valueOfKey\r\n\r\n).call (lib.json = {})\r\n\r\n###\r\n  @compression\r\n###\r\n\r\n(->\r\n\r\n  @compress = (stringValue)-> pako.deflate(stringValue, {to: 'string'})\r\n\r\n  @decompress = (stringValue)-> pako.inflate(stringValue, { to: 'string' })\r\n\r\n).call (lib.compression = {})\r\n\r\n###\r\n  @security\r\n###\r\n\r\n(->\r\n\r\n  @hash = (str)-> sjcl.codec.base64.fromBits sjcl.hash.sha256.hash str\r\n\r\n  @encrypt = (passPhrase, data)-> sjcl.encrypt passPhrase, data\r\n\r\n  @decrypt = (passPhrase, sjclEncryptedObject)-> sjcl.decrypt passPhrase,sjclEncryptedObject\r\n\r\n).call (lib.security = {})\r\n\r\n###\r\n  @localStorage\r\n###\r\n\r\n(->\r\n\r\n  @setItem = (key, value)-> window.localStorage.setItem key, value\r\n\r\n  @getItem = (key)-> window.localStorage.getItem key\r\n\r\n  @removeItem = (key)-> window.localStorage.removeItem key\r\n\r\n  @clear = -> window.localStorage.clear()\r\n\r\n  @hasItem = (key)-> (window.localStorage.getItem key) isnt null\r\n\r\n).call (lib.localStorage = {})\r\n\r\n###\r\n  @tabStorage\r\n###\r\n\r\n(->\r\n\r\n  @setItem = (key, value)-> window.sessionStorage.setItem key, value\r\n\r\n  @getItem = (key)-> window.sessionStorage.getItem key\r\n\r\n  @removeItem = (key)-> window.sessionStorage.removeItem key\r\n\r\n  @clear = -> window.sessionStorage.clear()\r\n\r\n  @hasItem = (key)-> (window.sessionStorage.getItem key) isnt null\r\n\r\n).call (lib.tabStorage = {})\r\n\r\n###\r\n  @memStorage\r\n###\r\n\r\n(->\r\n\r\n  memory = {}\r\n\r\n  @setItem = (key, value)-> \r\n    memory[key] = value\r\n    return null\r\n\r\n  @getItem = (key)-> \r\n    return memory[key] if key of memory\r\n    return null\r\n\r\n  @removeItem = (key)-> \r\n    delete memory[key] if key of memory\r\n    return null\r\n\r\n  @clear = -> \r\n    memory = {}\r\n    return null\r\n\r\n  @hasItem = (key)-> return (key of memory)\r\n\r\n).call (lib.memStorage = {})\r\n\r\n###\r\n  @DatabaseEngine\r\n###\r\n\r\n{ DatabaseEngine } = window['database-engine']\r\n\r\nlib.DatabaseEngine = DatabaseEngine\r\n\r\n###\r\n  @network\r\n###\r\n\r\n(->\r\n\r\n  @serializeAndUrlEncode = serializeAndUrlEncode = (params) ->\r\n    pairs = []\r\n    do proc = (object=params, prefix=null) ->\r\n      for own key, value of object\r\n        if value instanceof Array\r\n          for el, i in value\r\n            proc(el, if prefix? then \"#{prefix}[#{key}][]\" else \"#{key}[]\")\r\n        else if value instanceof Object\r\n          if prefix?\r\n            prefix += \"[#{key}]\"\r\n          else\r\n            prefix = key\r\n          proc(value, prefix)\r\n        else\r\n          value = encodeURIComponent value\r\n          pairs.push(if prefix? then \"#{prefix}[#{key}]=#{value}\" else \"#{key}=#{value}\")\r\n    pairs.join('&')\r\n\r\n  @request = request = (url, method, data, cbfn)->\r\n\r\n    xhr = new XMLHttpRequest\r\n\r\n    if method is 'GET'\r\n      data = serializeAndUrlEncode data\r\n      xhr.open method, \"#{url}?#{data}\", true\r\n    else\r\n      xhr.open method, url, true\r\n\r\n    xhr.addEventListener 'load', (response)->\r\n      cbfn null, response\r\n    , false\r\n\r\n    xhr.addEventListener 'error', (response)->\r\n      cbfn response\r\n    , false\r\n\r\n    xhr.addEventListener 'abort', (response) ->\r\n      cbfn response\r\n    , false\r\n\r\n    if method is 'GET'\r\n      xhr.send()\r\n    else\r\n      xhr.send data\r\n\r\n  @callBdemrPostApi = callBdemrPostApi = (api, data, cbfn)->\r\n    version = app.config.masterApiVersion\r\n    api = '/' + api if api.charAt(0) isnt '/'\r\n    url = app.config.serverHost + '/api/' + version + api\r\n    data = {} unless typeof data is 'object'\r\n    data.__meta = \r\n      clientIdentifier: app.config.clientIdentifier\r\n      clientName: app.config.clientName\r\n      clientVersion: app.config.clientVersion\r\n      clientPlatform: app.config.clientPlatform\r\n    data = lib.json.stringify data\r\n    request url, 'POST', data, (error, response)->\r\n      return cbfn error if error\r\n      return cbfn null, (lib.json.parse response.target.responseText)\r\n\r\n  @ensureBaseNetworkDelay = (fn)->\r\n    thatTime = lib.datetime.now()\r\n    return (args...)->\r\n      now = lib.datetime.now()\r\n      diff = now - thatTime\r\n      if diff > app.options.baseNetworkDelay\r\n        fn.apply null, args\r\n      else\r\n        lib.util.delay (app.options.baseNetworkDelay - diff), ->\r\n          fn.apply null, args\r\n\r\n).call (lib.network = {})\r\n\r\nlib.debug = (args...)->\r\n  console.log.apply console, args\r\n\r\n","\n/* =======================================\n * lib.\n    datetime.\n      now\n      format\n      templates.\n        date\n        time\n        datetime\n      mkDate\n      mkTime\n      mkDatetime\n      diff\n      makeRelativeTimeString\n    array.\n      unique\n      reverse\n    util.\n      Collector\n      Iterator\n      iterate\n      Condition\n      asyncIf\n      delay\n      Notifier\n      setImmediate\n      shallowCopy\n      deepCopy\n      findDeepValue\n      shallowMerge - TODO\n      callOnlyOnce - FIXME\n    string.\n      replaceAll\n      replaceLast\n    json.\n      stringify\n      parse\n    compression.\n      compress\n      decompress\n    security.\n      hash\n      encrypt\n      decrypt\n    localStorage.\n      setItem\n      getItem\n      removeItem\n      clear\n      hasItem\n    tabStorage.\n      setItem\n      getItem\n      removeItem\n      clear\n      hasItem\n    memStorage.\n      setItem\n      getItem\n      removeItem\n      clear\n      hasItem\n    database.\n      DatabaseEngine\n    network.\n      serializeAndUrlEncode\n      request\n      callBdemrPostApi * [dependent on app.config]\n      ensureBaseNetworkDelay * [dependent on app.config]\n    debug\n\n  \n * \n=======================================\n */\n\n(function() {\n  var Collector, Condition, DatabaseEngine, Iterator, Notifier, asyncIf, dateFormat, delay, iterate, ref, setImmediate,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  window.lib = {};\n\n\n  /*\n    @datetime\n   */\n\n  dateFormat = window['date-format-library'].dateFormat;\n\n  lib.datetime = {};\n\n  lib.datetime.now = function() {\n    return (new Date).getTime();\n  };\n\n  lib.datetime.format = dateFormat;\n\n  lib.datetime.templates = dateFormat.masks;\n\n  lib.datetime.templates['date'] = 'yyyy-mm-dd';\n\n  lib.datetime.templates['time'] = 'HH:MM:ss';\n\n  lib.datetime.templates['datetime'] = 'yyyy-mm-dd HH:MM:ss';\n\n  lib.datetime.mkDate = function(dateObj) {\n    return dateFormat(dateObj, lib.datetime.templates.date);\n  };\n\n  lib.datetime.mkTime = function(dateObj) {\n    return dateFormat(dateObj, lib.datetime.templates.time);\n  };\n\n  lib.datetime.mkDatetime = function(dateObj, masks) {\n    return dateFormat(dateObj, (masks ? masks : lib.datetime.templates.datetime));\n  };\n\n  lib.datetime.diff = function(dateObj1, dateObj2) {\n    var diff, time1, time2;\n    time1 = dateObj1 ? dateObj1.getTime() : 0;\n    time2 = dateObj2 ? dateObj2.getTime() : 0;\n    diff = time1 - time2;\n    return diff;\n  };\n\n  lib.datetime.makeRelativeTimeString = function(diff) {\n    diff = Math.round(diff / 1000);\n    if (diff < 60) {\n      return \"around \" + diff + \" seconds ago\";\n    } else if (diff < 90) {\n      return \"around a minute ago\";\n    } else {\n      diff = Math.round(diff / 60);\n      if (diff < 60) {\n        return \"around \" + diff + \" minutes ago\";\n      } else {\n        diff = Math.round(diff / 60);\n        return \"around \" + diff + \" hours ago\";\n      }\n    }\n  };\n\n\n  /*\n    @array\n   */\n\n  (function() {\n    this.unique = function(array) {\n      var item, j, len, newArray;\n      newArray = [];\n      for (j = 0, len = array.length; j < len; j++) {\n        item = array[j];\n        if (indexOf.call(newArray, item) < 0) {\n          newArray.push(item);\n        }\n      }\n      return newArray;\n    };\n    return this.reverse = function(array) {\n      var item, newArray;\n      newArray = (function() {\n        var j, len, results;\n        results = [];\n        for (j = 0, len = array.length; j < len; j++) {\n          item = array[j];\n          results.push(item);\n        }\n        return results;\n      })();\n      newArray.reverse();\n      return newArray;\n    };\n  }).call((lib.array = {}));\n\n\n  /*\n    @util\n   */\n\n  ref = window['evolvenode-stdlib'], Collector = ref.Collector, Iterator = ref.Iterator, iterate = ref.iterate, Condition = ref.Condition, asyncIf = ref.asyncIf, delay = ref.delay, Notifier = ref.Notifier, setImmediate = ref.setImmediate;\n\n  (function() {\n    var _onceCalledFnList, deepCopy, deepValue;\n    this.Collector = Collector;\n    this.Iterator = Iterator;\n    this.iterate = iterate;\n    this.Condition = Condition;\n    this.asyncIf = asyncIf;\n    this.delay = delay;\n    this.Notifier = Notifier;\n    this.setImmediate = setImmediate;\n    this.shallowCopy = function(obj) {\n      var key, temp;\n      if (obj === null || typeof obj !== \"object\") {\n        return obj;\n      }\n      temp = new obj.constructor();\n      for (key in obj) {\n        temp[key] = obj[key];\n      }\n      return temp;\n    };\n    this.deepCopy = deepCopy = function(obj) {\n      var key, temp;\n      if (obj === null || typeof obj !== \"object\") {\n        return obj;\n      }\n      temp = new obj.constructor();\n      for (key in obj) {\n        temp[key] = deepCopy(obj[key]);\n      }\n      return temp;\n    };\n    this.findDeepValue = deepValue = function(val, Obj) {\n      var i, prop, result;\n      result = null;\n      if (Obj instanceof Array) {\n        i = 0;\n        while (i < Obj.length) {\n          result = deepValue(val, Obj[i]);\n          if (result) {\n            break;\n          }\n          i++;\n        }\n      } else {\n        for (prop in Obj) {\n          if (prop === val) {\n            return Obj[prop];\n          }\n          if (Obj[prop] instanceof Object || Obj[prop] instanceof Array) {\n            result = deepValue(val, Obj[prop]);\n            if (result) {\n              break;\n            }\n          }\n        }\n      }\n      return result;\n    };\n    _onceCalledFnList = [];\n    return this.callOnlyOnce = function(fn) {\n      if (indexOf.call(_onceCalledFnList, fn) < 0) {\n        _onceCalledFnList.push(fn);\n        return fn();\n      }\n    };\n  }).call((lib.util = {}));\n\n\n  /*\n    @string\n   */\n\n  (function() {\n    this.replaceAll = function(str0, str1, str2, ignore) {\n      return str0.replace(new RegExp(str1.replace(/([\\/\\,\\!\\\\\\^\\$\\{\\}\\[\\]\\(\\)\\.\\*\\+\\?\\|\\<\\>\\-\\&])/g, \"\\\\$&\"), (ignore ? \"gi\" : \"g\")), ((typeof str2 === \"string\") ? str2.replace(/\\$/g, \"$$$$\") : str2));\n    };\n    return this.replaceLast = function(haystack, needle, replacementNeedle) {\n      var newHaystack, pos;\n      pos = haystack.lastIndexOf(needle);\n      if (pos === -1) {\n        return haystack;\n      }\n      return newHaystack = (haystack.substring(0, pos)) + replacementNeedle + (haystack.substr(pos + needle.length));\n    };\n  }).call((lib.string = {}));\n\n\n  /*\n    @json\n   */\n\n  (function() {\n    var ISO_8601_FULL;\n    ISO_8601_FULL = /^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(\\.\\d+)?(([+-]\\d\\d:\\d\\d)|Z)?$/i;\n    this.stringify = function(value) {\n      return JSON.stringify(value);\n    };\n    return this.parse = function(value) {\n      return JSON.parse(value, function(key, valueOfKey) {\n        if (typeof valueOfKey === 'string') {\n          if (ISO_8601_FULL.test(valueOfKey)) {\n            return new Date(valueOfKey);\n          }\n        }\n        return valueOfKey;\n      });\n    };\n  }).call((lib.json = {}));\n\n\n  /*\n    @compression\n   */\n\n  (function() {\n    this.compress = function(stringValue) {\n      return pako.deflate(stringValue, {\n        to: 'string'\n      });\n    };\n    return this.decompress = function(stringValue) {\n      return pako.inflate(stringValue, {\n        to: 'string'\n      });\n    };\n  }).call((lib.compression = {}));\n\n\n  /*\n    @security\n   */\n\n  (function() {\n    this.hash = function(str) {\n      return sjcl.codec.base64.fromBits(sjcl.hash.sha256.hash(str));\n    };\n    this.encrypt = function(passPhrase, data) {\n      return sjcl.encrypt(passPhrase, data);\n    };\n    return this.decrypt = function(passPhrase, sjclEncryptedObject) {\n      return sjcl.decrypt(passPhrase, sjclEncryptedObject);\n    };\n  }).call((lib.security = {}));\n\n\n  /*\n    @localStorage\n   */\n\n  (function() {\n    this.setItem = function(key, value) {\n      return window.localStorage.setItem(key, value);\n    };\n    this.getItem = function(key) {\n      return window.localStorage.getItem(key);\n    };\n    this.removeItem = function(key) {\n      return window.localStorage.removeItem(key);\n    };\n    this.clear = function() {\n      return window.localStorage.clear();\n    };\n    return this.hasItem = function(key) {\n      return (window.localStorage.getItem(key)) !== null;\n    };\n  }).call((lib.localStorage = {}));\n\n\n  /*\n    @tabStorage\n   */\n\n  (function() {\n    this.setItem = function(key, value) {\n      return window.sessionStorage.setItem(key, value);\n    };\n    this.getItem = function(key) {\n      return window.sessionStorage.getItem(key);\n    };\n    this.removeItem = function(key) {\n      return window.sessionStorage.removeItem(key);\n    };\n    this.clear = function() {\n      return window.sessionStorage.clear();\n    };\n    return this.hasItem = function(key) {\n      return (window.sessionStorage.getItem(key)) !== null;\n    };\n  }).call((lib.tabStorage = {}));\n\n\n  /*\n    @memStorage\n   */\n\n  (function() {\n    var memory;\n    memory = {};\n    this.setItem = function(key, value) {\n      memory[key] = value;\n      return null;\n    };\n    this.getItem = function(key) {\n      if (key in memory) {\n        return memory[key];\n      }\n      return null;\n    };\n    this.removeItem = function(key) {\n      if (key in memory) {\n        delete memory[key];\n      }\n      return null;\n    };\n    this.clear = function() {\n      memory = {};\n      return null;\n    };\n    return this.hasItem = function(key) {\n      return key in memory;\n    };\n  }).call((lib.memStorage = {}));\n\n\n  /*\n    @DatabaseEngine\n   */\n\n  DatabaseEngine = window['database-engine'].DatabaseEngine;\n\n  lib.DatabaseEngine = DatabaseEngine;\n\n\n  /*\n    @network\n   */\n\n  (function() {\n    var callBdemrPostApi, request, serializeAndUrlEncode;\n    this.serializeAndUrlEncode = serializeAndUrlEncode = function(params) {\n      var pairs, proc;\n      pairs = [];\n      (proc = function(object, prefix) {\n        var el, i, key, results, value;\n        results = [];\n        for (key in object) {\n          if (!hasProp.call(object, key)) continue;\n          value = object[key];\n          if (value instanceof Array) {\n            results.push((function() {\n              var j, len, results1;\n              results1 = [];\n              for (i = j = 0, len = value.length; j < len; i = ++j) {\n                el = value[i];\n                results1.push(proc(el, prefix != null ? prefix + \"[\" + key + \"][]\" : key + \"[]\"));\n              }\n              return results1;\n            })());\n          } else if (value instanceof Object) {\n            if (prefix != null) {\n              prefix += \"[\" + key + \"]\";\n            } else {\n              prefix = key;\n            }\n            results.push(proc(value, prefix));\n          } else {\n            value = encodeURIComponent(value);\n            results.push(pairs.push(prefix != null ? prefix + \"[\" + key + \"]=\" + value : key + \"=\" + value));\n          }\n        }\n        return results;\n      })(params, null);\n      return pairs.join('&');\n    };\n    this.request = request = function(url, method, data, cbfn) {\n      var xhr;\n      xhr = new XMLHttpRequest;\n      if (method === 'GET') {\n        data = serializeAndUrlEncode(data);\n        xhr.open(method, url + \"?\" + data, true);\n      } else {\n        xhr.open(method, url, true);\n      }\n      xhr.addEventListener('load', function(response) {\n        return cbfn(null, response);\n      }, false);\n      xhr.addEventListener('error', function(response) {\n        return cbfn(response);\n      }, false);\n      xhr.addEventListener('abort', function(response) {\n        return cbfn(response);\n      }, false);\n      if (method === 'GET') {\n        return xhr.send();\n      } else {\n        return xhr.send(data);\n      }\n    };\n    this.callBdemrPostApi = callBdemrPostApi = function(api, data, cbfn) {\n      var url, version;\n      version = app.config.masterApiVersion;\n      if (api.charAt(0) !== '/') {\n        api = '/' + api;\n      }\n      url = app.config.serverHost + '/api/' + version + api;\n      if (typeof data !== 'object') {\n        data = {};\n      }\n      data.__meta = {\n        clientIdentifier: app.config.clientIdentifier,\n        clientName: app.config.clientName,\n        clientVersion: app.config.clientVersion,\n        clientPlatform: app.config.clientPlatform\n      };\n      data = lib.json.stringify(data);\n      return request(url, 'POST', data, function(error, response) {\n        if (error) {\n          return cbfn(error);\n        }\n        return cbfn(null, lib.json.parse(response.target.responseText));\n      });\n    };\n    return this.ensureBaseNetworkDelay = function(fn) {\n      var thatTime;\n      thatTime = lib.datetime.now();\n      return function() {\n        var args, diff, now;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        now = lib.datetime.now();\n        diff = now - thatTime;\n        if (diff > app.options.baseNetworkDelay) {\n          return fn.apply(null, args);\n        } else {\n          return lib.util.delay(app.options.baseNetworkDelay - diff, function() {\n            return fn.apply(null, args);\n          });\n        }\n      };\n    };\n  }).call((lib.network = {}));\n\n  lib.debug = function() {\n    var args;\n    args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n    return console.log.apply(console, args);\n  };\n\n}).call(this);\n"]}